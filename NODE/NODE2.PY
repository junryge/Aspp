#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
ë¬¼ë¥˜ì´ë™ ì˜ˆì¸¡ ì‹œìŠ¤í…œ - pyqt-node-editor ê¸°ë°˜ êµ¬í˜„
Requirements:
    pip install pyqt-node-editor
"""

import sys
import json
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *
from PyQt5.QtGui import *

from pyqt_node_editor import *


class LogisticsNodeContent(QWidget):
    """ë…¸ë“œ ì»¨í…ì¸  ìœ„ì ¯"""
    def __init__(self, node, parent=None):
        super().__init__(parent)
        self.node = node
        self.init_ui()
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        layout = QVBoxLayout()
        layout.setContentsMargins(5, 5, 5, 5)
        
        # ë…¸ë“œ íƒ€ì… í‘œì‹œ
        self.type_label = QLabel(f"[{self.node.node_type}]")
        self.type_label.setAlignment(Qt.AlignCenter)
        self.type_label.setStyleSheet("color: #AAA; font-size: 10px;")
        layout.addWidget(self.type_label)
        
        # ìƒíƒœ í‘œì‹œ
        self.status_label = QLabel("âšª ë¯¸ì„¤ì •")
        self.status_label.setAlignment(Qt.AlignCenter)
        self.status_label.setStyleSheet("font-size: 11px;")
        layout.addWidget(self.status_label)
        
        self.setLayout(layout)
        
    def update_status(self, configured):
        """ìƒíƒœ ì—…ë°ì´íŠ¸"""
        if configured:
            self.status_label.setText("ğŸŸ¢ ì„¤ì •ë¨")
        else:
            self.status_label.setText("âšª ë¯¸ì„¤ì •")


class LogisticsNode(Node):
    """ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ ë…¸ë“œ"""
    
    def __init__(self, scene, title="Undefined Node", node_type="undefined", 
                 inputs=[], outputs=[], pos=[0, 0]):
        self.node_type = node_type
        self.is_configured = False
        self.settings = {}
        
        super().__init__(scene, title, inputs, outputs, pos)
        
    def init_inner_classes(self):
        """ë‚´ë¶€ í´ë˜ìŠ¤ ì´ˆê¸°í™”"""
        self.content = LogisticsNodeContent(self)
        self.grNode = NodeGraphicsNode(self)
        
        # ë…¸ë“œ ìƒ‰ìƒ ì„¤ì •
        colors = {
            'data': "#3498db",      # íŒŒë€ìƒ‰
            'preprocess': "#e74c3c", # ë¹¨ê°„ìƒ‰
            'vector': "#f39c12",     # ì£¼í™©ìƒ‰
            'model': "#27ae60",      # ì´ˆë¡ìƒ‰
            'analysis': "#9b59b6",   # ë³´ë¼ìƒ‰
            'prompt': "#34495e",     # íšŒìƒ‰
            'llm': "#16a085"         # ì²­ë¡ìƒ‰
        }
        
        color = colors.get(self.node_type, "#7f8c8d")
        self.grNode._brush_background = QBrush(QColor(color))
        
    def set_configured(self, configured):
        """ì„¤ì • ìƒíƒœ ë³€ê²½"""
        self.is_configured = configured
        self.content.update_status(configured)
        self.markDirty()
        
    def serialize(self):
        """ì§ë ¬í™”"""
        res = super().serialize()
        res['node_type'] = self.node_type
        res['is_configured'] = self.is_configured
        res['settings'] = self.settings
        return res
        
    def deserialize(self, data, hashmap={}, restore_id=True):
        """ì—­ì§ë ¬í™”"""
        res = super().deserialize(data, hashmap, restore_id)
        self.node_type = data.get('node_type', 'undefined')
        self.is_configured = data.get('is_configured', False)
        self.settings = data.get('settings', {})
        self.content.update_status(self.is_configured)
        return res


class LogisticsSubWindow(NodeEditorSubWindow):
    """ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ ì„œë¸Œ ìœˆë„ìš°"""
    
    def __init__(self):
        super().__init__()
        self.setAttribute(Qt.WA_DeleteOnClose)
        self.setTitle()
        self.init_new_node_actions()
        
        # ì”¬ ì´ë²¤íŠ¸ ì—°ê²°
        self.scene.add_has_been_modified_listener(self.set_title)
        self.scene.add_drag_enter_listener(self.on_drag_enter)
        self.scene.add_drop_listener(self.on_drop)
        
    def setTitle(self):
        """íƒ€ì´í‹€ ì„¤ì •"""
        self.setWindowTitle("ë¬¼ë¥˜ì´ë™ ì˜ˆì¸¡ ì‹œìŠ¤í…œ" + ("*" if self.has_been_modified else ""))
        
    def init_new_node_actions(self):
        """ë…¸ë“œ ìƒì„± ì•¡ì…˜ ì´ˆê¸°í™”"""
        self.node_actions = {}
        
        # ë…¸ë“œ ì¹´í…Œê³ ë¦¬
        categories = {
            "ë°ì´í„° ì…ë ¥": [
                ("MCS ë¡œê·¸ ë°ì´í„°", "data", ["ì¶œë ¥"], ["ì…ë ¥"]),
                ("ì§„ë™ì„¼ì„œ ë°ì´í„°", "data", ["ì¶œë ¥"], ["ì…ë ¥"]),
            ],
            "ë°ì´í„° ì „ì²˜ë¦¬": [
                ("ì´ìƒì¹˜ ì œê±°", "preprocess", ["ì¶œë ¥"], ["ì…ë ¥"]),
                ("ì‹œê°„ë³„ ë¶„ë¥˜", "preprocess", ["ì¶œë ¥"], ["ì…ë ¥"]),
                ("ê²½ë¡œë³„ ë¶„ë¥˜", "preprocess", ["ì¶œë ¥"], ["ì…ë ¥"]),
            ],
            "ë²¡í„° ì €ì¥": [
                ("RAG ë²¡í„° ì €ì¥", "vector", ["ë²¡í„°"], ["ë°ì´í„°"]),
            ],
            "ì‹œê³„ì—´ ëª¨ë¸": [
                ("LSTM ëª¨ë¸", "model", ["ì˜ˆì¸¡"], ["ë°ì´í„°"]),
                ("RNN ëª¨ë¸", "model", ["ì˜ˆì¸¡"], ["ë°ì´í„°"]),
                ("ARIMA ëª¨ë¸", "model", ["ì˜ˆì¸¡"], ["ë°ì´í„°"]),
            ],
            "ë¶„ì„": [
                ("ê³¼ê±°íŒ¨í„´ ë¶„ì„", "analysis", ["ë¶„ì„ê²°ê³¼"], ["ë²¡í„°"]),
            ],
            "í”„ë¡¬í”„íŠ¸": [
                ("í”„ë¡¬í”„íŠ¸ ìƒì„±", "prompt", ["í”„ë¡¬í”„íŠ¸"], ["ì˜ˆì¸¡", "ë¶„ì„"]),
            ],
            "LLM": [
                ("PHI-4 íŒë‹¨/ì¶”ë¡ ", "llm", ["ê²°ê³¼"], ["í”„ë¡¬í”„íŠ¸"]),
            ],
        }
        
        # ì•¡ì…˜ ìƒì„±
        for category, nodes in categories.items():
            for name, node_type, outputs, inputs in nodes:
                action = QAction(name)
                action.setData((name, node_type, outputs, inputs))
                self.node_actions[f"{category}/{name}"] = action
                
    def on_drag_enter(self, event):
        """ë“œë˜ê·¸ ì—”í„° ì´ë²¤íŠ¸"""
        if event.mimeData().hasText():
            event.acceptProposedAction()
            
    def on_drop(self, event):
        """ë“œë¡­ ì´ë²¤íŠ¸"""
        if event.mimeData().hasText():
            event_data = event.mimeData().text()
            
            # ë…¸ë“œ ì•¡ì…˜ ì°¾ê¸°
            action = self.node_actions.get(event_data)
            if action:
                name, node_type, outputs, inputs = action.data()
                
                # ì”¬ ì¢Œí‘œë¡œ ë³€í™˜
                mouse_pos = event.pos()
                scene_pos = self.scene.grScene.views()[0].mapToScene(mouse_pos)
                
                # ë…¸ë“œ ìƒì„±
                self.create_node(name, node_type, outputs, inputs, 
                               [scene_pos.x(), scene_pos.y()])
                
                event.acceptProposedAction()
                
    def create_node(self, name, node_type, outputs, inputs, pos=[0, 0]):
        """ë…¸ë“œ ìƒì„±"""
        node = LogisticsNode(
            self.scene, 
            title=name,
            node_type=node_type,
            inputs=[1]*len(inputs),  # ì…ë ¥ ì†Œì¼“ íƒ€ì…
            outputs=[2]*len(outputs),  # ì¶œë ¥ ì†Œì¼“ íƒ€ì…
            pos=pos
        )
        
        # ì†Œì¼“ ë¼ë²¨ ì„¤ì •
        for i, label in enumerate(inputs):
            if i < len(node.inputs):
                node.inputs[i].socket_label = label
                
        for i, label in enumerate(outputs):
            if i < len(node.outputs):
                node.outputs[i].socket_label = label
                
        return node
        
    def configure_node(self, node):
        """ë…¸ë“œ ì„¤ì •"""
        if not isinstance(node, LogisticsNode):
            return
            
        dialog = QDialog()
        dialog.setWindowTitle(f"{node.title} ì„¤ì •")
        dialog.setModal(True)
        layout = QVBoxLayout()
        
        # ë…¸ë“œ íƒ€ì…ë³„ ì„¤ì •
        if node.node_type == 'data':
            self.create_data_config(layout, node)
        elif node.node_type == 'preprocess':
            self.create_preprocess_config(layout, node)
        elif node.node_type == 'model':
            self.create_model_config(layout, node)
        elif node.node_type == 'vector':
            self.create_vector_config(layout, node)
        elif node.node_type == 'analysis':
            self.create_analysis_config(layout, node)
        elif node.node_type == 'prompt':
            self.create_prompt_config(layout, node)
        elif node.node_type == 'llm':
            self.create_llm_config(layout, node)
            
        # ë²„íŠ¼
        buttons = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)
        buttons.accepted.connect(lambda: self.save_node_config(dialog, node))
        buttons.rejected.connect(dialog.reject)
        layout.addWidget(buttons)
        
        dialog.setLayout(layout)
        dialog.exec_()
        
    def create_data_config(self, layout, node):
        """ë°ì´í„° ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>ë°ì´í„° ì†ŒìŠ¤ ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("íŒŒì¼ ê²½ë¡œ:"))
        path_edit = QLineEdit(node.settings.get('path', ''))
        path_edit.setObjectName("path")
        
        browse_btn = QPushButton("ì°¾ì•„ë³´ê¸°...")
        browse_btn.clicked.connect(lambda: self.browse_file(path_edit))
        
        path_layout = QHBoxLayout()
        path_layout.addWidget(path_edit)
        path_layout.addWidget(browse_btn)
        layout.addLayout(path_layout)
        
        layout.addWidget(QLabel("ë°ì´í„° í˜•ì‹:"))
        format_combo = QComboBox()
        format_combo.addItems(["CSV", "JSON", "Excel", "Database"])
        format_combo.setCurrentText(node.settings.get('format', 'CSV'))
        format_combo.setObjectName("format")
        layout.addWidget(format_combo)
        
    def create_preprocess_config(self, layout, node):
        """ì „ì²˜ë¦¬ ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>ì „ì²˜ë¦¬ ì„¤ì •</b>"))
        
        if "ì´ìƒì¹˜" in node.title:
            layout.addWidget(QLabel("ì´ìƒì¹˜ íƒì§€ ë°©ë²•:"))
            method_combo = QComboBox()
            method_combo.addItems(["IQR", "Z-Score", "Isolation Forest", "DBSCAN"])
            method_combo.setCurrentText(node.settings.get('method', 'IQR'))
            method_combo.setObjectName("method")
            layout.addWidget(method_combo)
            
    def create_model_config(self, layout, node):
        """ëª¨ë¸ ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>ëª¨ë¸ ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("ì˜ˆì¸¡ ê¸°ê°„:"))
        period_combo = QComboBox()
        period_combo.addItems(["6ì‹œê°„", "12ì‹œê°„", "24ì‹œê°„", "48ì‹œê°„", "72ì‹œê°„", "1ì£¼ì¼"])
        period_combo.setCurrentText(node.settings.get('period', '24ì‹œê°„'))
        period_combo.setObjectName("period")
        layout.addWidget(period_combo)
        
    def create_vector_config(self, layout, node):
        """ë²¡í„° ì €ì¥ ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>RAG ë²¡í„° ì €ì¥ ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("ì„ë² ë”© ëª¨ë¸:"))
        embed_combo = QComboBox()
        embed_combo.addItems(["OpenAI", "Sentence-BERT", "Custom", "Multilingual"])
        embed_combo.setCurrentText(node.settings.get('embedding_model', 'OpenAI'))
        embed_combo.setObjectName("embedding_model")
        layout.addWidget(embed_combo)
        
    def create_analysis_config(self, layout, node):
        """ë¶„ì„ ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>íŒ¨í„´ ë¶„ì„ ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("ë¶„ì„ ê¸°ê°„:"))
        period_combo = QComboBox()
        period_combo.addItems(["7ì¼", "14ì¼", "30ì¼", "90ì¼", "180ì¼", "1ë…„"])
        period_combo.setCurrentText(node.settings.get('analysis_period', '30ì¼'))
        period_combo.setObjectName("analysis_period")
        layout.addWidget(period_combo)
        
    def create_prompt_config(self, layout, node):
        """í”„ë¡¬í”„íŠ¸ ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>í”„ë¡¬í”„íŠ¸ ìƒì„± ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿:"))
        template_text = QTextEdit()
        template_text.setObjectName("template")
        template_text.setPlainText(node.settings.get('template', 
            """ë‹¤ìŒ ë¬¼ë¥˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì˜ˆì¸¡í•´ì£¼ì„¸ìš”:
- í˜„ì¬ ìƒí™©: {current_status}
- ê³¼ê±° íŒ¨í„´: {past_patterns}
- ì‹œê³„ì—´ ì˜ˆì¸¡: {time_series_prediction}

24ì‹œê°„ ì´ë‚´ì˜ ë¬¼ë¥˜ ì´ë™ì„ ì˜ˆì¸¡í•˜ê³ ,
ì£¼ì˜í•´ì•¼ í•  ë¦¬ìŠ¤í¬ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”."""))
        template_text.setMaximumHeight(150)
        layout.addWidget(template_text)
        
    def create_llm_config(self, layout, node):
        """LLM ë…¸ë“œ ì„¤ì •"""
        layout.addWidget(QLabel("<b>PHI-4 LLM ì„¤ì •</b>"))
        
        layout.addWidget(QLabel("Temperature:"))
        temp_slider = QSlider(Qt.Horizontal)
        temp_slider.setRange(0, 100)
        temp_slider.setValue(int(node.settings.get('temperature', 0.7) * 100))
        temp_slider.setObjectName("temperature")
        
        temp_label = QLabel(f"{node.settings.get('temperature', 0.7):.1f}")
        temp_slider.valueChanged.connect(lambda v: temp_label.setText(f"{v/100:.1f}"))
        
        temp_layout = QHBoxLayout()
        temp_layout.addWidget(temp_slider)
        temp_layout.addWidget(temp_label)
        layout.addLayout(temp_layout)
        
    def browse_file(self, line_edit):
        """íŒŒì¼ ì°¾ì•„ë³´ê¸°"""
        filename, _ = QFileDialog.getOpenFileName(
            self, "íŒŒì¼ ì„ íƒ", "", 
            "Data Files (*.csv *.json *.xlsx);;All Files (*.*)"
        )
        if filename:
            line_edit.setText(filename)
            
    def save_node_config(self, dialog, node):
        """ë…¸ë“œ ì„¤ì • ì €ì¥"""
        settings = {}
        
        # ìœ„ì ¯ì—ì„œ ê°’ ìˆ˜ì§‘
        for widget in dialog.findChildren(QWidget):
            name = widget.objectName()
            if name:
                if isinstance(widget, QLineEdit):
                    settings[name] = widget.text()
                elif isinstance(widget, QComboBox):
                    settings[name] = widget.currentText()
                elif isinstance(widget, QSpinBox):
                    settings[name] = widget.value()
                elif isinstance(widget, QTextEdit):
                    settings[name] = widget.toPlainText()
                elif isinstance(widget, QSlider):
                    settings[name] = widget.value() / 100
                    
        node.settings = settings
        node.set_configured(True)
        
        dialog.accept()
        
    def validate_pipeline(self):
        """íŒŒì´í”„ë¼ì¸ ê²€ì¦"""
        errors = []
        warnings = []
        
        # ë…¸ë“œ í™•ì¸
        nodes = self.scene.nodes
        if not nodes:
            errors.append("ë…¸ë“œê°€ ì—†ìŠµë‹ˆë‹¤")
            return errors, warnings
            
        # ë…¸ë“œ íƒ€ì…ë³„ í™•ì¸
        data_nodes = [n for n in nodes if isinstance(n, LogisticsNode) and n.node_type == 'data']
        llm_nodes = [n for n in nodes if isinstance(n, LogisticsNode) and n.node_type == 'llm']
        
        if not data_nodes:
            errors.append("ë°ì´í„° ì…ë ¥ ë…¸ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤")
            
        if not llm_nodes:
            errors.append("LLM ë…¸ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤")
            
        # ë¯¸ì„¤ì • ë…¸ë“œ í™•ì¸
        unconfigured = [n.title for n in nodes 
                       if isinstance(n, LogisticsNode) and not n.is_configured]
        if unconfigured:
            warnings.append(f"ë¯¸ì„¤ì • ë…¸ë“œ: {', '.join(unconfigured)}")
            
        return errors, warnings
        
    def run_pipeline(self):
        """íŒŒì´í”„ë¼ì¸ ì‹¤í–‰"""
        # ê²€ì¦
        errors, warnings = self.validate_pipeline()
        
        if errors:
            QMessageBox.warning(self, "ê²€ì¦ ì‹¤íŒ¨", 
                               "ì˜¤ë¥˜:\n" + "\n".join(f"- {e}" for e in errors))
            return
            
        # ì‹¤í–‰ ê²°ê³¼ í‘œì‹œ
        result_dialog = QDialog()
        result_dialog.setWindowTitle("ì‹¤í–‰ ê²°ê³¼")
        result_dialog.setModal(True)
        layout = QVBoxLayout()
        
        result_text = QTextEdit()
        result_text.setReadOnly(True)
        result_text.setPlainText("""=== ë¬¼ë¥˜ì´ë™ ì˜ˆì¸¡ ì‹œìŠ¤í…œ ì‹¤í–‰ ê²°ê³¼ ===

ì‹¤í–‰ ì‹œê°„: 2025-07-30 10:30:00

=== ì˜ˆì¸¡ ê²°ê³¼ ===
í–¥í›„ 24ì‹œê°„ ë¬¼ë¥˜ ì´ë™ ì˜ˆì¸¡:
- ì˜ˆìƒ ë¬¼ë™ëŸ‰: 1,234í†¤ (Â±5%)
- ì£¼ìš” ê²½ë¡œ: ì„œìš¸â†’ë¶€ì‚° (45%), ì¸ì²œâ†’ê´‘ì£¼ (30%)
- ë³‘ëª© êµ¬ê°„: ê²½ë¶€ê³ ì†ë„ë¡œ (14:00-18:00)
- ì§€ì—° ìœ„í—˜ë„: ì¤‘ê°„ (ë‚ ì”¨ ì˜í–¥)

ê¶Œì¥ ì‚¬í•­:
1. ì˜¤í›„ 2-6ì‹œ ê²½ë¶€ê³ ì†ë„ë¡œ ìš°íšŒ ê²½ë¡œ í™œìš©
2. ê¸´ê¸‰ í™”ë¬¼ì€ ì˜¤ì „ ë°°ì†¡ ê¶Œì¥
3. ì˜ˆë¹„ ì°¨ëŸ‰ 20% ì¶”ê°€ ë°°ì¹˜ í•„ìš”""")
        
        layout.addWidget(result_text)
        
        close_btn = QPushButton("ë‹«ê¸°")
        close_btn.clicked.connect(result_dialog.accept)
        layout.addWidget(close_btn)
        
        result_dialog.setLayout(layout)
        result_dialog.resize(600, 400)
        result_dialog.exec_()


class LogisticsNodeEditor(NodeEditorMainWindow):
    """ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ ë©”ì¸ ìœˆë„ìš°"""
    
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        self.create_menus()
        self.create_toolbars()
        self.create_dock_widgets()
        self.create_status_bar()
        
        # ìƒˆ ì„œë¸Œìœˆë„ìš° ìƒì„±
        sub_wnd = LogisticsSubWindow()
        self.mdi_area.addSubWindow(sub_wnd)
        sub_wnd.show()
        
        self.setWindowTitle("ë¬¼ë¥˜ì´ë™ ì˜ˆì¸¡ ì‹œìŠ¤í…œ - Node Editor")
        self.resize(1400, 800)
        
    def create_menus(self):
        """ë©”ë‰´ ìƒì„±"""
        # ê¸°ë³¸ ë©”ë‰´
        super().create_menus()
        
        # ì‹¤í–‰ ë©”ë‰´
        run_menu = self.menuBar().addMenu("ì‹¤í–‰")
        
        validate_action = run_menu.addAction("ê²€ì¦")
        validate_action.setShortcut("F5")
        validate_action.triggered.connect(self.on_validate)
        
        run_action = run_menu.addAction("ì‹¤í–‰")
        run_action.setShortcut("F6")
        run_action.triggered.connect(self.on_run)
        
    def create_toolbars(self):
        """íˆ´ë°” ìƒì„±"""
        toolbar = self.addToolBar("ì‹¤í–‰")
        
        validate_action = toolbar.addAction("âœ“ ê²€ì¦")
        validate_action.triggered.connect(self.on_validate)
        
        run_action = toolbar.addAction("â–¶ ì‹¤í–‰")
        run_action.triggered.connect(self.on_run)
        
    def create_dock_widgets(self):
        """ë… ìœ„ì ¯ ìƒì„±"""
        # ë…¸ë“œ ëª©ë¡
        list_widget = QDockWidget("ë…¸ë“œ ëª©ë¡")
        list_widget.setWidget(self.create_nodes_list_widget())
        self.addDockWidget(Qt.LeftDockWidgetArea, list_widget)
        
    def create_nodes_list_widget(self):
        """ë…¸ë“œ ëª©ë¡ ìœ„ì ¯ ìƒì„±"""
        list_widget = QListWidget()
        list_widget.setDragEnabled(True)
        
        # ë…¸ë“œ ì¶”ê°€
        nodes = [
            ("ë°ì´í„° ì…ë ¥/MCS ë¡œê·¸ ë°ì´í„°", "ğŸ’¾"),
            ("ë°ì´í„° ì…ë ¥/ì§„ë™ì„¼ì„œ ë°ì´í„°", "ğŸ“Š"),
            ("ë°ì´í„° ì „ì²˜ë¦¬/ì´ìƒì¹˜ ì œê±°", "ğŸ”§"),
            ("ë°ì´í„° ì „ì²˜ë¦¬/ì‹œê°„ë³„ ë¶„ë¥˜", "â°"),
            ("ë°ì´í„° ì „ì²˜ë¦¬/ê²½ë¡œë³„ ë¶„ë¥˜", "ğŸ›£ï¸"),
            ("ë²¡í„° ì €ì¥/RAG ë²¡í„° ì €ì¥", "ğŸ“¦"),
            ("ì‹œê³„ì—´ ëª¨ë¸/LSTM ëª¨ë¸", "ğŸ§ "),
            ("ì‹œê³„ì—´ ëª¨ë¸/RNN ëª¨ë¸", "ğŸ”„"),
            ("ì‹œê³„ì—´ ëª¨ë¸/ARIMA ëª¨ë¸", "ğŸ“ˆ"),
            ("ë¶„ì„/ê³¼ê±°íŒ¨í„´ ë¶„ì„", "ğŸ”"),
            ("í”„ë¡¬í”„íŠ¸/í”„ë¡¬í”„íŠ¸ ìƒì„±", "ğŸ“"),
            ("LLM/PHI-4 íŒë‹¨/ì¶”ë¡ ", "ğŸ¤–"),
        ]
        
        for node_path, icon in nodes:
            item = QListWidgetItem(f"{icon} {node_path.split('/')[-1]}")
            item.setData(Qt.UserRole, node_path)
            list_widget.addItem(item)
            
        # ë“œë˜ê·¸ ì‹œì‘
        def start_drag(event):
            item = list_widget.currentItem()
            if item:
                drag = QDrag(list_widget)
                mime_data = QMimeData()
                mime_data.setText(item.data(Qt.UserRole))
                drag.setMimeData(mime_data)
                drag.exec_(Qt.MoveAction)
                
        list_widget.mouseMoveEvent = start_drag
        
        return list_widget
        
    def create_status_bar(self):
        """ìƒíƒœë°” ìƒì„±"""
        self.statusBar().showMessage("ì¤€ë¹„ë¨")
        
    def on_validate(self):
        """ê²€ì¦ ì‹¤í–‰"""
        sub_wnd = self.get_current_sub_window()
        if sub_wnd:
            errors, warnings = sub_wnd.validate_pipeline()
            
            if errors or warnings:
                msg = ""
                if errors:
                    msg += "ì˜¤ë¥˜:\n" + "\n".join(f"- {e}" for e in errors) + "\n\n"
                if warnings:
                    msg += "ê²½ê³ :\n" + "\n".join(f"- {w}" for w in warnings)
                    
                QMessageBox.warning(self, "ê²€ì¦ ê²°ê³¼", msg)
            else:
                QMessageBox.information(self, "ê²€ì¦ ê²°ê³¼", "íŒŒì´í”„ë¼ì¸ì´ ìœ íš¨í•©ë‹ˆë‹¤!")
                
    def on_run(self):
        """íŒŒì´í”„ë¼ì¸ ì‹¤í–‰"""
        sub_wnd = self.get_current_sub_window()
        if sub_wnd:
            sub_wnd.run_pipeline()
            
    def get_current_sub_window(self):
        """í˜„ì¬ ì„œë¸Œìœˆë„ìš° ë°˜í™˜"""
        active_sub_window = self.mdi_area.activeSubWindow()
        if active_sub_window:
            return active_sub_window.widget()
        return None
        
    def about(self):
        """About ëŒ€í™”ìƒì"""
        QMessageBox.about(self, "About", 
                         "ë¬¼ë¥˜ì´ë™ ì˜ˆì¸¡ ì‹œìŠ¤í…œ\n\n"
                         "MCS ë¡œê·¸ì™€ ì„¼ì„œ ë°ì´í„°ë¥¼ í™œìš©í•œ\n"
                         "AI ê¸°ë°˜ ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ\n\n"
                         "Qt Node Editor ê¸°ë°˜")


if __name__ == "__main__":
    app = QApplication(sys.argv)
    
    # ìŠ¤íƒ€ì¼ ì„¤ì •
    app.setStyle("Fusion")
    
    # ë‹¤í¬ í…Œë§ˆ
    from pyqt_node_editor import DARK_STYLE
    app.setStyleSheet(DARK_STYLE)
    
    # ë©”ì¸ ìœˆë„ìš° ì‹¤í–‰
    editor = LogisticsNodeEditor()
    editor.show()
    
    sys.exit(app.exec_())