# ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨
fig2 = plt.figure(figsize=(18, 12), facecolor='white')
ax2 = fig2.add_subplot(111)
ax2.set_xlim(0, 18)
ax2.set_ylim(0, 12)
ax2.axis('off')

# ì„¹ì…˜ êµ¬ë¶„ ë°°ê²½
predict_bg = Rectangle((0.5, 5.5), 17, 5.5, 
                       facecolor='#E8F5E9', edgecolor='#4CAF50', 
                       linewidth=2, alpha=0.3, zorder=0)
ax2.add_patch(predict_bg)

rag_bg = Rectangle((0.5, 0.5), 17, 4, 
                   facecolor='#E3F2FD', edgecolor='#2196F3', 
                   linewidth=2, alpha=0.3, zorder=0)
ax2.add_patch(rag_bg)

# ì„¹ì…˜ íƒ€ì´í‹€
ax2.text(9, 10.7, 'ì˜ˆì¸¡ + ì„¤ëª… í”Œë¡œìš°', fontsize=14, weight='bold', 
        ha='center', color='#2E7D32',
        bbox=dict(boxstyle='round,pad=0.5', facecolor='white', 
                 edgecolor='#4CAF50', linewidth=2))

ax2.text(9, 4.2, 'RAG ê²€ìƒ‰ í”Œë¡œìš°', fontsize=14, weight='bold', 
        ha='center', color='#1565C0',
        bbox=dict(boxstyle='round,pad=0.5', facecolor='white', 
                 edgecolor='#2196F3', linewidth=2))

# ===== ì˜ˆì¸¡ í”Œë¡œìš° =====
boxes_predict = [
    (1, 8, 2.5, 1.2, 'ì…ë ¥ ë°ì´í„°\n\n30ë¶„ ì‹œí€€ìŠ¤\në°ì´í„°', '#BBDEFB'),
    (4.5, 8, 2.5, 1.2, 'Feature ìƒì„±\n\nMomentum\nhub/storage/cmd\nsurge_risk_score', '#C8E6C9'),
    (8, 8, 2.5, 1.2, 'XGBoost V7\n\nì˜ˆì¸¡ ìˆ˜í–‰\nConfidence ê³„ì‚°', '#FFECB3'),
    (8, 6, 2.5, 1.2, 'SHAP ë¶„ì„\n\nFeature ì˜í–¥ë„\nìƒìœ„ 10ê°œ ì¶”ì¶œ', '#F8BBD0'),
    (11.5, 7, 2.5, 1.4, 'Qwen 80B\n\nSHAP â†’ ìì—°ì–´\n"hub_highë¡œ ì¸í•œ\në³‘ëª© ë°œìƒ"', '#E1BEE7'),
    (15, 7, 2.5, 1.4, 'ìµœì¢… ì‘ë‹µ\n\nì˜ˆì¸¡: 305.2\nì‹ ë¢°ë„: 87%\nì£¼ìš” ì›ì¸ 3ê°œ', '#B2DFDB')
]

for x, y, w, h, text, color in boxes_predict:
    draw_modern_box(ax2, x, y, w, h, text, color, is_header=False)

# í™”ì‚´í‘œ
draw_clean_arrow(ax2, 3.5, 8.6, 4.5, 8.6, '', '#666666')
draw_clean_arrow(ax2, 7, 8.6, 8, 8.6, 'Predict', '#666666')
draw_clean_arrow(ax2, 10.5, 8.6, 11.5, 7.8, 'Result', '#666666')
draw_clean_arrow(ax2, 10.5, 6.6, 11.5, 7.2, 'SHAP', '#666666')
draw_clean_arrow(ax2, 14, 7.7, 15, 7.7, 'Generate', '#666666')

# ë¶„ì„ í™”ì‚´í‘œ
ax2.plot([9.25, 9.25], [8, 7.2], color='#666666', linewidth=2, zorder=5)
ax2.text(9.6, 7.6, 'Analyze', fontsize=8, color='#666666')

# ===== RAG í”Œë¡œìš° =====
boxes_rag = [
    (1, 2, 2.5, 1.2, 'ì‚¬ìš©ì ì§ˆë¬¸\n\n"ê³¼ê±° ìœ ì‚¬\nì¼€ì´ìŠ¤ëŠ”?"', '#BBDEFB'),
    (4.5, 2, 2.5, 1.2, 'ì„ë² ë”© ë³€í™˜\n\nko-sroberta\n512ì°¨ì› ë²¡í„°', '#C8E6C9'),
    (8, 2, 2.5, 1.2, 'Vector DB\nê²€ìƒ‰\n\nTop-5\nìœ ì‚¬ë„ ë§¤ì¹­', '#FFECB3'),
    (11.5, 2, 2.5, 1.2, 'Qwen 80B\n\nContext +\nQueryë¡œ\në‹µë³€ ìƒì„±', '#E1BEE7'),
    (15, 2, 2.5, 1.2, 'RAG ì‘ë‹µ\n\nìœ ì‚¬ ì¼€ì´ìŠ¤:\n2024-09-15\n14:23:00', '#B2DFDB')
]

for x, y, w, h, text, color in boxes_rag:
    draw_modern_box(ax2, x, y, w, h, text, color, is_header=False)

# í™”ì‚´í‘œ
draw_clean_arrow(ax2, 3.5, 2.6, 4.5, 2.6, '', '#666666')
draw_clean_arrow(ax2, 7, 2.6, 8, 2.6, 'Embed', '#666666')
draw_clean_arrow(ax2, 10.5, 2.6, 11.5, 2.6, 'Docs', '#666666')
draw_clean_arrow(ax2, 14, 2.6, 15, 2.6, 'Answer', '#666666')

# ë©”ì¸ íƒ€ì´í‹€
title_bg2 = Rectangle((3, 11.4), 12, 0.5, 
                      facecolor='#1A237E', edgecolor='none', zorder=10)
ax2.add_patch(title_bg2)
ax2.text(9, 11.65, 'Data Flow Diagram', 
        fontsize=16, weight='bold', ha='center', color='white', zorder=11)

plt.tight_layout()
plt.savefig('/mnt/user-data/outputs/dataflow_professional.png', 
           dpi=300, bbox_inches='tight', facecolor='white')
print("âœ… ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨ ìƒì„± ì™„ë£Œ!")
plt.close()

print("\nğŸ“¦ ìƒì„±ëœ íŒŒì¼ ëª©ë¡:")
print("  1. architecture_professional.png - ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨")
print("  2. dataflow_professional.png - ë°ì´í„° í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨")
print("  3. architecture_documentation.xlsx - ì—‘ì…€ ë¬¸ì„œ")