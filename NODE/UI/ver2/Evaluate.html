<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>M14 ì˜ˆì¸¡ í‰ê°€</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #09090b;
            --bg-secondary: #18181b;
            --bg-card: #1f1f23;
            --border: #27272a;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --accent: #3b82f6;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --orange: #f97316;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Space Grotesk', system-ui, sans-serif;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--purple), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        .logo-text span {
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .nav-btns {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .btn:hover { background: var(--bg-card); border-color: var(--text-secondary); }
        .btn-primary { background: var(--accent); border-color: var(--accent); }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: var(--success); border-color: var(--success); color: #000; }
        .btn-warning { background: var(--warning); border-color: var(--warning); color: #000; }
        .btn-purple { background: var(--purple); border-color: var(--purple); }
        .btn-orange { background: var(--orange); border-color: var(--orange); color: #000; }
        .btn-danger { background: var(--danger); border-color: var(--danger); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn.active { box-shadow: 0 0 0 2px var(--accent); }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: var(--bg-secondary);
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        input[type="date"], input[type="time"] {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        
        .radio-group {
            display: flex;
            gap: 10px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .radio-label:hover {
            border-color: var(--accent);
        }
        
        .radio-label input {
            accent-color: var(--accent);
        }
        
        .radio-label.selected {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent);
        }
        
        .radio-label.source-internal.selected {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success);
        }
        
        .radio-label.source-external.selected {
            background: rgba(249, 115, 22, 0.1);
            border-color: var(--orange);
        }
        
        .source-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 4px;
        }
        
        .source-badge.internal {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }
        
        .source-badge.external {
            background: rgba(249, 115, 22, 0.2);
            color: var(--orange);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px 20px;
        }
        
        .stat-card.highlight {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .stat-card.danger {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .stat-card.success {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .stat-card.warning {
            border-color: var(--warning);
            background: rgba(234, 179, 8, 0.05);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .stat-sub {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 3px;
        }
        
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .confusion-matrix {
            display: grid;
            grid-template-columns: auto 1fr 1fr;
            gap: 2px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .cm-cell {
            padding: 15px 20px;
            text-align: center;
            border-radius: 6px;
        }
        
        .cm-header {
            background: var(--bg-card);
            font-weight: 600;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .cm-tp { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .cm-tn { background: rgba(59, 130, 246, 0.2); color: var(--accent); }
        .cm-fp { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        .cm-fn { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .cm-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .cm-label {
            font-size: 10px;
            margin-top: 3px;
        }
        
        .status-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--bg-card);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .status-item.active {
            box-shadow: 0 0 0 2px var(--accent);
        }
        
        .status-name {
            font-size: 13px;
        }
        
        .status-count {
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-item.tp .status-count { color: var(--success); }
        .status-item.tn .status-count { color: var(--accent); }
        .status-item.fn .status-count { color: var(--danger); }
        .status-item.fp .status-count { color: var(--warning); }
        
        #chart {
            width: 100%;
            height: 500px;
        }
        
        .table-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 20px;
        }
        
        .filter-btn.filter-all { border-color: var(--text-secondary); }
        .filter-btn.filter-tp { border-color: var(--success); color: var(--success); }
        .filter-btn.filter-tn { border-color: var(--accent); color: var(--accent); }
        .filter-btn.filter-fn { border-color: var(--danger); color: var(--danger); }
        .filter-btn.filter-fp { border-color: var(--warning); color: var(--warning); }
        
        .filter-btn.active.filter-all { background: var(--text-secondary); color: #000; }
        .filter-btn.active.filter-tp { background: var(--success); color: #000; }
        .filter-btn.active.filter-tn { background: var(--accent); color: #fff; }
        .filter-btn.active.filter-fn { background: var(--danger); color: #fff; }
        .filter-btn.active.filter-fp { background: var(--warning); color: #000; }
        
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .pagination-info {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .page-size-select {
            padding: 6px 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 12px;
        }
        
        .table-container {
            max-height: 600px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--bg-card);
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover { background: rgba(255,255,255,0.02); }
        
        .value-normal { color: var(--text-primary); }
        .value-warning { color: var(--warning); }
        .value-danger { color: var(--danger); }
        
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-tp { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .badge-tn { background: rgba(59, 130, 246, 0.2); color: var(--accent); }
        .badge-fn { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-fn-early { background: rgba(139, 92, 246, 0.2); color: var(--purple); }
        .badge-fp { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        .badge-fp-valid { background: rgba(249, 115, 22, 0.2); color: var(--orange); }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .warning-box {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--warning);
        }
        
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--accent);
        }
        
        .source-info-box {
            background: rgba(249, 115, 22, 0.1);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--orange);
        }
        
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--purple));
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }
        
        .progress-fill.external {
            background: linear-gradient(90deg, var(--orange), var(--danger));
        }
        
        .divider {
            width: 1px;
            height: 30px;
            background: var(--border);
            margin: 0 5px;
        }
        
        /* ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½ ì¹´ë“œ */
        .category-summary {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .category-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .category-card:hover {
            transform: translateY(-2px);
        }
        
        .category-card.active {
            border-color: var(--accent);
        }
        
        .category-card.cat-tp { border-left: 4px solid var(--success); }
        .category-card.cat-tn { border-left: 4px solid var(--accent); }
        .category-card.cat-fn-miss { border-left: 4px solid var(--danger); }
        .category-card.cat-fn-early { border-left: 4px solid var(--purple); }
        .category-card.cat-fp-false { border-left: 4px solid var(--warning); }
        .category-card.cat-fp-valid { border-left: 4px solid var(--orange); }
        
        .category-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .category-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .category-card.cat-tp .category-value { color: var(--success); }
        .category-card.cat-tn .category-value { color: var(--accent); }
        .category-card.cat-fn-miss .category-value { color: var(--danger); }
        .category-card.cat-fn-early .category-value { color: var(--purple); }
        .category-card.cat-fp-false .category-value { color: var(--warning); }
        .category-card.cat-fp-valid .category-value { color: var(--orange); }
        
        .category-desc {
            font-size: 9px;
            color: var(--text-secondary);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">E</div>
            <div class="logo-text">M14 <span>ì˜ˆì¸¡ í‰ê°€</span></div>
        </div>
        <div class="nav-btns">
            <button class="btn" onclick="location.href='/'">â† ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</button>
            <button class="btn" onclick="location.href='/history'">ğŸ“Š íˆìŠ¤í† ë¦¬</button>
        </div>
    </header>
    
    <div class="controls">
        <div class="control-group">
            <span class="control-label">ë°ì´í„° ì†ŒìŠ¤:</span>
            <div class="radio-group">
                <label class="radio-label source-internal selected" id="radio-internal">
                    <input type="radio" name="data-source" value="internal" checked>
                    ğŸ“ ë‚´ë¶€ (íŒŒì¼)
                </label>
                <label class="radio-label source-external" id="radio-external">
                    <input type="radio" name="data-source" value="external">
                    ğŸŒ ì™¸ë¶€ (ë¡œê·¸í”„ë ˆì†Œ)
                </label>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="control-group">
            <span class="control-label">ì‹œì‘:</span>
            <input type="date" id="date-start">
            <input type="time" id="time-start" value="00:00">
        </div>
        <div class="control-group">
            <span class="control-label">ì¢…ë£Œ:</span>
            <input type="date" id="date-end">
            <input type="time" id="time-end" value="23:59">
        </div>
        
        <div class="divider"></div>
        
        <div class="control-group">
            <span class="control-label">ì˜ˆì¸¡:</span>
            <div class="radio-group">
                <label class="radio-label selected" id="radio-10">
                    <input type="radio" name="pred-type" value="10" checked>
                    10ë¶„
                </label>
                <label class="radio-label" id="radio-30">
                    <input type="radio" name="pred-type" value="30">
                    30ë¶„
                </label>
            </div>
        </div>
        
        <button class="btn btn-primary" id="btn-evaluate" onclick="startEvaluation()">ğŸ” í‰ê°€ ì‹¤í–‰</button>
    </div>
    
    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button class="btn" onclick="loadToday()">ì˜¤ëŠ˜</button>
        <button class="btn" onclick="loadYesterday()">ì–´ì œ</button>
        <button class="btn" onclick="loadLast3Days()">ìµœê·¼ 3ì¼</button>
        <button class="btn" onclick="loadThisWeek()">ì´ë²ˆì£¼</button>
        <span style="color: var(--text-secondary); font-size: 12px; display: flex; align-items: center; margin-left: 10px;">
            ğŸ’¡ <strong style="margin-left: 5px;">ë‚´ë¶€</strong>: data í´ë” CSV ì‚¬ìš© &nbsp;|&nbsp; 
            <strong>ì™¸ë¶€</strong>: ë¡œê·¸í”„ë ˆì†Œ API ì§ì ‘ ì¡°íšŒ (íŒŒì¼ ì—†ì–´ë„ ê°€ëŠ¥)
        </span>
    </div>
    
    <div id="initial-state">
        <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <div>ë‚ ì§œ/ì‹œê°„ì„ ì„ íƒí•˜ê³  <strong>í‰ê°€ ì‹¤í–‰</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
            <div style="color: var(--text-secondary); margin-top: 15px; font-size: 13px;">
                <div style="margin-bottom: 8px;">
                    <span class="source-badge internal">ğŸ“ ë‚´ë¶€</span> data í´ë”ì˜ m14_data_YYYYMMDD.csv íŒŒì¼ ì‚¬ìš©
                </div>
                <div style="margin-bottom: 8px;">
                    <span class="source-badge external">ğŸŒ ì™¸ë¶€</span> ë¡œê·¸í”„ë ˆì†Œ APIì—ì„œ ì§ì ‘ ë°ì´í„° ì¡°íšŒ (íŒŒì¼ ì—†ì–´ë„ í‰ê°€ ê°€ëŠ¥)
                </div>
                <div style="color: var(--success); margin-top: 10px;">
                    âœ… ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì— ì˜í–¥ ì—†ìŒ
                </div>
            </div>
        </div>
    </div>
    
    <div id="loading-state" style="display: none;">
        <div class="loading">
            <div class="loading-spinner"></div>
            <div id="loading-text">í‰ê°€ ì§„í–‰ ì¤‘... ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
            <div id="loading-source" style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">
                ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ ì¤‘ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì— ì˜í–¥ ì—†ìŒ)
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%;">0%</div>
            </div>
            <div id="progress-text" style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">0 / 0</div>
        </div>
    </div>
    
    <div id="results-container" class="results-container">
        <div id="source-info-box" class="source-info-box" style="display: none;"></div>
        <div id="warning-box" class="warning-box" style="display: none;"></div>
        
        <div class="stats-grid">
            <div class="stat-card highlight">
                <div class="stat-label">ì´ í‰ê°€ ìˆ˜</div>
                <div class="stat-value" id="stat-total">-</div>
                <div class="stat-sub" id="stat-period">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì‹¤ì œ 1700+ ë°œìƒ</div>
                <div class="stat-value" id="stat-actual" style="color: var(--danger);">-</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">ì •í™•ë„</div>
                <div class="stat-value" id="stat-accuracy" style="color: var(--success);">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì¬í˜„ìœ¨ (Recall)</div>
                <div class="stat-value" id="stat-recall">-</div>
                <div class="stat-sub">1700+ ê°ì§€ ì„±ê³µë¥ </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì •ë°€ë„ (Precision)</div>
                <div class="stat-value" id="stat-precision">-</div>
                <div class="stat-sub">ê²½ê³  ì •í™•ë¥ </div>
            </div>
        </div>
        
        <!-- ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½ -->
        <div class="section">
            <div class="section-title">ğŸ“Š ìƒíƒœë³„ ë¶„ë¥˜ ìš”ì•½ (í´ë¦­í•˜ì—¬ í•„í„°ë§)</div>
            <div class="category-summary" id="category-summary">
                <div class="category-card cat-tp" data-category="tp" onclick="filterByCategory('tp')">
                    <div class="category-label">âœ… ì •ìƒê°ì§€</div>
                    <div class="category-value" id="cat-tp">0</div>
                    <div class="category-desc">ìœ„í—˜ì˜ˆì¸¡â†’ì‹¤ì œìœ„í—˜</div>
                </div>
                <div class="category-card cat-tn" data-category="tn" onclick="filterByCategory('tn')">
                    <div class="category-label">âœ… ì •ìƒ</div>
                    <div class="category-value" id="cat-tn">0</div>
                    <div class="category-desc">ì •ìƒì˜ˆì¸¡â†’ì‹¤ì œì •ìƒ</div>
                </div>
                <div class="category-card cat-fn-miss" data-category="fn_miss" onclick="filterByCategory('fn_miss')">
                    <div class="category-label">âŒ ì™„ì „ë¯¸íƒ</div>
                    <div class="category-value" id="cat-fn-miss">0</div>
                    <div class="category-desc">ë†“ì¹¨ (ì‚¬ì „ì˜ˆì¸¡ì—†ìŒ)</div>
                </div>
                <div class="category-card cat-fn-early" data-category="fn_early" onclick="filterByCategory('fn_early')">
                    <div class="category-label">âš ï¸ ì¡°ê¸°ê°ì§€</div>
                    <div class="category-value" id="cat-fn-early">0</div>
                    <div class="category-desc">ì´ì „ì— ì˜ˆì¸¡ë¨</div>
                </div>
                <div class="category-card cat-fp-false" data-category="fp_false" onclick="filterByCategory('fp_false')">
                    <div class="category-label">âŒ ì˜¤íƒ</div>
                    <div class="category-value" id="cat-fp-false">0</div>
                    <div class="category-desc">ìœ„í—˜ì˜ˆì¸¡â†’ë¯¸ë°œìƒ</div>
                </div>
                <div class="category-card cat-fp-valid" data-category="fp_valid" onclick="filterByCategory('fp_valid')">
                    <div class="category-label">âš ï¸ ìœ íš¨ê²½ê³ </div>
                    <div class="category-value" id="cat-fp-valid">0</div>
                    <div class="category-desc">ì´í›„ ì‹¤ì œ ëŒíŒŒ</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“ í˜¼ë™ í–‰ë ¬ (Confusion Matrix)</div>
            <div class="confusion-matrix">
                <div class="cm-cell"></div>
                <div class="cm-cell cm-header">ì˜ˆì¸¡: ì •ìƒ</div>
                <div class="cm-cell cm-header">ì˜ˆì¸¡: ìœ„í—˜</div>
                
                <div class="cm-cell cm-header">ì‹¤ì œ: ì •ìƒ</div>
                <div class="cm-cell cm-tn">
                    <div class="cm-value" id="cm-tn">-</div>
                    <div class="cm-label">TN (ì •ìƒâ†’ì •ìƒ)</div>
                </div>
                <div class="cm-cell cm-fp">
                    <div class="cm-value" id="cm-fp">-</div>
                    <div class="cm-label">FP (ì˜¤íƒ)</div>
                </div>
                
                <div class="cm-cell cm-header">ì‹¤ì œ: ìœ„í—˜</div>
                <div class="cm-cell cm-fn">
                    <div class="cm-value" id="cm-fn">-</div>
                    <div class="cm-label">FN (ë¯¸íƒ)</div>
                </div>
                <div class="cm-cell cm-tp">
                    <div class="cm-value" id="cm-tp">-</div>
                    <div class="cm-label">TP (ì •ìƒ ê°ì§€)</div>
                </div>
            </div>
        </div>
        
        <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-card success">
                <div class="stat-label">FN ì¡°ê¸°ê°ì§€</div>
                <div class="stat-value" id="stat-fn-early" style="color: var(--success);">-</div>
                <div class="stat-sub" id="stat-fn-early-sub">ì‚¬ì „ì— ì˜ˆì¸¡ë¨</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-label">ì‹¤ì§ˆ FN (ì™„ì „ ë†“ì¹¨)</div>
                <div class="stat-value" id="stat-real-fn" style="color: var(--danger);">-</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-label">FP ìœ íš¨ê²½ê³ </div>
                <div class="stat-value" id="stat-fp-valid" style="color: var(--warning);">-</div>
                <div class="stat-sub" id="stat-fp-valid-sub">ì´í›„ ì‹¤ì œ ëŒíŒŒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì‹¤ì§ˆ FP (ì˜¤íƒ)</div>
                <div class="stat-value" id="stat-real-fp">-</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“Š ì˜ˆì¸¡ ìƒíƒœ ìƒì„¸ ë¶„ë¥˜</div>
            <div class="status-list" id="status-list"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“ˆ ì˜ˆì¸¡ vs ì‹¤ì œ ì°¨íŠ¸</div>
            <div id="chart"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“‹ ìƒì„¸ ë°ì´í„°</div>
            
            <div class="table-header-row">
                <div class="filter-buttons">
                    <button class="btn filter-btn filter-all active" onclick="filterTable('all')">ì „ì²´</button>
                    <button class="btn filter-btn filter-tp" onclick="filterTable('tp')">âœ… ì •ìƒê°ì§€ (TP)</button>
                    <button class="btn filter-btn filter-tn" onclick="filterTable('tn')">âœ… ì •ìƒ (TN)</button>
                    <button class="btn filter-btn filter-fn" onclick="filterTable('fn')">âŒ ë¯¸íƒ (FN)</button>
                    <button class="btn filter-btn filter-fp" onclick="filterTable('fp')">âš ï¸ ì˜¤íƒ (FP)</button>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="pagination-info" id="table-info">0ê°œ</span>
                    <select class="page-size-select" id="page-size" onchange="changePageSize()">
                        <option value="50">50ê°œì”©</option>
                        <option value="100" selected>100ê°œì”©</option>
                        <option value="200">200ê°œì”©</option>
                        <option value="500">500ê°œì”©</option>
                        <option value="all">ì „ì²´ë³´ê¸°</option>
                    </select>
                </div>
            </div>
            
            <div class="table-container" id="table-container"></div>
            
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        const today = new Date();
        document.getElementById('date-start').value = formatDate(today);
        document.getElementById('date-end').value = formatDate(today);
        
        let pollInterval = null;
        let allData = [];  // ì „ì²´ ë°ì´í„°
        let filteredData = [];  // í•„í„°ë§ëœ ë°ì´í„°
        let currentPage = 1;
        let pageSize = 100;
        let currentFilter = 'all';
        let currentCategoryFilter = null;
        
        // ë°ì´í„° ì†ŒìŠ¤ ë¼ë””ì˜¤ ë²„íŠ¼
        document.querySelectorAll('input[name="data-source"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('radio-internal').classList.remove('selected');
                document.getElementById('radio-external').classList.remove('selected');
                if (this.value === 'internal') {
                    document.getElementById('radio-internal').classList.add('selected');
                } else {
                    document.getElementById('radio-external').classList.add('selected');
                }
            });
        });
        
        // ì˜ˆì¸¡ íƒ€ì… ë¼ë””ì˜¤ ë²„íŠ¼
        document.querySelectorAll('input[name="pred-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.getElementById('radio-10').classList.remove('selected');
                document.getElementById('radio-30').classList.remove('selected');
                this.parentElement.classList.add('selected');
            });
        });
        
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        
        function loadToday() {
            document.getElementById('date-start').value = formatDate(today);
            document.getElementById('date-end').value = formatDate(today);
            document.getElementById('time-start').value = '00:00';
            document.getElementById('time-end').value = '23:59';
        }
        
        function loadYesterday() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('date-start').value = formatDate(yesterday);
            document.getElementById('date-end').value = formatDate(yesterday);
            document.getElementById('time-start').value = '00:00';
            document.getElementById('time-end').value = '23:59';
        }
        
        function loadLast3Days() {
            const threeDaysAgo = new Date();
            threeDaysAgo.setDate(threeDaysAgo.getDate() - 2);
            document.getElementById('date-start').value = formatDate(threeDaysAgo);
            document.getElementById('date-end').value = formatDate(today);
            document.getElementById('time-start').value = '00:00';
            document.getElementById('time-end').value = '23:59';
        }
        
        function loadThisWeek() {
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 6);
            document.getElementById('date-start').value = formatDate(weekAgo);
            document.getElementById('date-end').value = formatDate(today);
            document.getElementById('time-start').value = '00:00';
            document.getElementById('time-end').value = '23:59';
        }
        
        async function startEvaluation() {
            const dateStart = document.getElementById('date-start').value.replace(/-/g, '');
            const dateEnd = document.getElementById('date-end').value.replace(/-/g, '');
            const timeStart = document.getElementById('time-start').value.replace(':', '');
            const timeEnd = document.getElementById('time-end').value.replace(':', '');
            const predType = document.querySelector('input[name="pred-type"]:checked').value;
            const dataSource = document.querySelector('input[name="data-source"]:checked').value;
            
            if (!dateStart || !dateEnd) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            document.getElementById('initial-state').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('results-container').classList.remove('active');
            document.getElementById('btn-evaluate').disabled = true;
            
            const progressFill = document.getElementById('progress-fill');
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';
            progressFill.className = 'progress-fill' + (dataSource === 'external' ? ' external' : '');
            
            document.getElementById('progress-text').textContent = 'ì‹œì‘ ì¤‘...';
            
            const sourceText = dataSource === 'internal' ? 'ğŸ“ ë‚´ë¶€(íŒŒì¼)' : 'ğŸŒ ì™¸ë¶€(ë¡œê·¸í”„ë ˆì†Œ)';
            document.getElementById('loading-source').innerHTML = 
                `<span style="color: ${dataSource === 'external' ? 'var(--orange)' : 'var(--success)'};">${sourceText}</span> ì—ì„œ ë°ì´í„° ì¡°íšŒ ì¤‘...`;
            
            try {
                const startRes = await fetch(`/api/evaluate/start?date_start=${dateStart}&date_end=${dateEnd}&time_start=${timeStart}&time_end=${timeEnd}&pred_type=${predType}&data_source=${dataSource}`);
                const startData = await startRes.json();
                
                if (startData.error) {
                    alert(startData.error);
                    resetUI();
                    return;
                }
                
                pollInterval = setInterval(pollStatus, 1000);
                
            } catch (e) {
                console.error(e);
                alert('í‰ê°€ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                resetUI();
            }
        }
        
        async function pollStatus() {
            try {
                const res = await fetch('/api/evaluate/status');
                const data = await res.json();
                
                document.getElementById('progress-fill').style.width = data.percent + '%';
                document.getElementById('progress-fill').textContent = data.percent + '%';
                document.getElementById('progress-text').textContent = `${data.progress.toLocaleString()} / ${data.total.toLocaleString()}`;
                document.getElementById('loading-text').textContent = `í‰ê°€ ì§„í–‰ ì¤‘... (${data.percent}%)`;
                
                if (data.status === 'completed') {
                    clearInterval(pollInterval);
                    pollInterval = null;
                    await loadResult();
                } else if (data.status === 'error') {
                    clearInterval(pollInterval);
                    pollInterval = null;
                    alert('í‰ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                    resetUI();
                }
                
            } catch (e) {
                console.error(e);
            }
        }
        
        async function loadResult() {
            try {
                const res = await fetch('/api/evaluate/result');
                const data = await res.json();
                
                if (data.error) {
                    alert(data.error);
                    resetUI();
                    return;
                }
                
                displayResults(data);
                
            } catch (e) {
                console.error(e);
                alert('ê²°ê³¼ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                resetUI();
            }
        }
        
        function resetUI() {
            document.getElementById('initial-state').style.display = 'block';
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('btn-evaluate').disabled = false;
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
        }
        
        function displayResults(data) {
            document.getElementById('loading-state').style.display = 'none';
            document.getElementById('btn-evaluate').disabled = false;
            
            // ì „ì²´ ë°ì´í„° ì €ì¥
            allData = data.data || [];
            filteredData = [...allData];
            currentPage = 1;
            currentFilter = 'all';
            currentCategoryFilter = null;
            
            // ë°ì´í„° ì†ŒìŠ¤ í‘œì‹œ
            const sourceInfoBox = document.getElementById('source-info-box');
            if (data.data_source === 'external') {
                sourceInfoBox.innerHTML = `ğŸŒ <strong>ì™¸ë¶€(ë¡œê·¸í”„ë ˆì†Œ)</strong>ì—ì„œ ë°ì´í„° ì¡°íšŒí•˜ì—¬ í‰ê°€ ì™„ë£Œ`;
                sourceInfoBox.style.display = 'block';
            } else {
                sourceInfoBox.innerHTML = `ğŸ“ <strong>ë‚´ë¶€(íŒŒì¼)</strong>ì—ì„œ ë°ì´í„° ë¡œë“œí•˜ì—¬ í‰ê°€ ì™„ë£Œ`;
                sourceInfoBox.className = 'info-box';
                sourceInfoBox.style.display = 'block';
            }
            
            // ê²½ê³ 
            const warningBox = document.getElementById('warning-box');
            if (data.missing_cols && data.missing_cols.length > 0) {
                warningBox.innerHTML = `âš ï¸ ëˆ„ë½/0ì¸ ì»¬ëŸ¼ ${data.missing_cols.length}ê°œ: ${data.missing_cols.slice(0, 5).join(', ')}${data.missing_cols.length > 5 ? '...' : ''}`;
                warningBox.style.display = 'block';
            } else {
                warningBox.style.display = 'none';
            }
            
            const stats = data.stats;
            const predTypeText = data.pred_type === '10' ? '10ë¶„' : '30ë¶„';
            const sourceText = data.data_source === 'internal' ? 'ë‚´ë¶€' : 'ì™¸ë¶€';
            
            const timeStartFmt = data.time_start ? `${data.time_start.slice(0,2)}:${data.time_start.slice(2,4)}` : '00:00';
            const timeEndFmt = data.time_end ? `${data.time_end.slice(0,2)}:${data.time_end.slice(2,4)}` : '23:59';
            
            // ê¸°ë³¸ í†µê³„
            document.getElementById('stat-total').textContent = data.total_count.toLocaleString();
            document.getElementById('stat-period').textContent = `${data.date_start.slice(0,4)}-${data.date_start.slice(4,6)}-${data.date_start.slice(6,8)} ${timeStartFmt} ~ ${data.date_end.slice(0,4)}-${data.date_end.slice(4,6)}-${data.date_end.slice(6,8)} ${timeEndFmt} (${predTypeText}, ${sourceText})`;
            document.getElementById('stat-actual').textContent = data.actual_danger_count.toLocaleString();
            document.getElementById('stat-accuracy').textContent = stats.accuracy + '%';
            document.getElementById('stat-recall').textContent = stats.recall + '%';
            document.getElementById('stat-precision').textContent = stats.precision + '%';
            
            // í˜¼ë™ í–‰ë ¬
            document.getElementById('cm-tp').textContent = stats.TP.toLocaleString();
            document.getElementById('cm-tn').textContent = stats.TN.toLocaleString();
            document.getElementById('cm-fp').textContent = stats.FP.toLocaleString();
            document.getElementById('cm-fn').textContent = stats.FN.toLocaleString();
            
            // ì‹¤ì§ˆ ì„±ëŠ¥
            document.getElementById('stat-fn-early').textContent = stats.fn_early.toLocaleString();
            document.getElementById('stat-fn-early-sub').textContent = `${data.analysis_range}ë¶„ ì´ë‚´ ì‚¬ì „ ì˜ˆì¸¡`;
            document.getElementById('stat-real-fn').textContent = stats.real_fn.toLocaleString();
            document.getElementById('stat-fp-valid').textContent = stats.fp_valid.toLocaleString();
            document.getElementById('stat-fp-valid-sub').textContent = `${data.analysis_range}ë¶„ ì´ë‚´ ì‹¤ì œ ëŒíŒŒ`;
            document.getElementById('stat-real-fp').textContent = stats.real_fp.toLocaleString();
            
            // ì¹´í…Œê³ ë¦¬ë³„ ìš”ì•½
            const catCounts = data.category_counts || {};
            document.getElementById('cat-tp').textContent = (catCounts['tp'] || 0).toLocaleString();
            document.getElementById('cat-tn').textContent = (catCounts['tn'] || 0).toLocaleString();
            document.getElementById('cat-fn-miss').textContent = (catCounts['fn_miss'] || 0).toLocaleString();
            document.getElementById('cat-fn-early').textContent = (catCounts['fn_early'] || 0).toLocaleString();
            document.getElementById('cat-fp-false').textContent = (catCounts['fp_false'] || 0).toLocaleString();
            document.getElementById('cat-fp-valid').textContent = (catCounts['fp_valid'] || 0).toLocaleString();
            
            // ìƒíƒœ ë¦¬ìŠ¤íŠ¸
            const statusList = document.getElementById('status-list');
            let statusHtml = '';
            
            const sortedStatuses = Object.entries(data.status_counts).sort((a, b) => {
                const getOrder = (s) => {
                    if (s === 'TP') return 0;
                    if (s === 'TN') return 1;
                    if (s.startsWith('FN')) return 2;
                    if (s.startsWith('FP')) return 3;
                    return 4;
                };
                return getOrder(a[0]) - getOrder(b[0]);
            });
            
            sortedStatuses.forEach(([status, count]) => {
                let cls = '';
                let label = status;
                
                if (status === 'TP') { cls = 'tp'; label = 'âœ… ì •ìƒê°ì§€'; }
                else if (status === 'TN') { cls = 'tn'; label = 'âœ… ì •ìƒ'; }
                else if (status === 'FN_ë†“ì¹¨') { cls = 'fn'; label = 'âŒ ì™„ì „ë¯¸íƒ'; }
                else if (status.startsWith('FN_')) { 
                    cls = 'fn'; 
                    const mins = status.replace('FN_', '').replace('ë¶„ì „', '');
                    label = `âš ï¸ ${mins}ë¶„ì „ ì¡°ê¸°ê°ì§€`; 
                }
                else if (status === 'FP_ì˜¤íƒ') { cls = 'fp'; label = 'âŒ ì˜¤íƒ'; }
                else if (status.startsWith('FP_')) { 
                    cls = 'fp'; 
                    const mins = status.replace('FP_', '').replace('ë¶„í›„', '');
                    label = `âš ï¸ ${mins}ë¶„í›„ ì‹¤í˜„`; 
                }
                
                statusHtml += `
                    <div class="status-item ${cls}" onclick="filterByStatus('${status}')">
                        <span class="status-name">${label}</span>
                        <span class="status-count">${count.toLocaleString()}</span>
                    </div>
                `;
            });
            statusList.innerHTML = statusHtml;
            
            // ì°¨íŠ¸
            drawChart(allData.slice(-200), data.pred_type);
            
            // í…Œì´ë¸”
            updateTable();
            
            document.getElementById('results-container').classList.add('active');
        }
        
        function filterByCategory(category) {
            // ì¹´í…Œê³ ë¦¬ ì¹´ë“œ active í† ê¸€
            document.querySelectorAll('.category-card').forEach(el => el.classList.remove('active'));
            
            if (currentCategoryFilter === category) {
                currentCategoryFilter = null;
                filteredData = [...allData];
            } else {
                currentCategoryFilter = category;
                document.querySelector(`.category-card[data-category="${category}"]`).classList.add('active');
                filteredData = allData.filter(row => row.status_category === category);
            }
            
            currentPage = 1;
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(el => el.classList.remove('active'));
            document.querySelector('.filter-btn.filter-all').classList.add('active');
            
            updateTable();
        }
        
        function filterByStatus(status) {
            currentCategoryFilter = null;
            document.querySelectorAll('.category-card').forEach(el => el.classList.remove('active'));
            
            filteredData = allData.filter(row => row.status === status);
            currentPage = 1;
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(el => el.classList.remove('active'));
            document.querySelector('.filter-btn.filter-all').classList.add('active');
            
            updateTable();
        }
        
        function filterTable(filter) {
            currentFilter = filter;
            currentCategoryFilter = null;
            document.querySelectorAll('.category-card').forEach(el => el.classList.remove('active'));
            
            document.querySelectorAll('.filter-btn').forEach(el => el.classList.remove('active'));
            document.querySelector(`.filter-btn.filter-${filter}`).classList.add('active');
            
            if (filter === 'all') {
                filteredData = [...allData];
            } else if (filter === 'tp') {
                filteredData = allData.filter(row => row.status === 'TP');
            } else if (filter === 'tn') {
                filteredData = allData.filter(row => row.status === 'TN');
            } else if (filter === 'fn') {
                filteredData = allData.filter(row => row.status && row.status.startsWith('FN'));
            } else if (filter === 'fp') {
                filteredData = allData.filter(row => row.status && row.status.startsWith('FP'));
            }
            
            currentPage = 1;
            updateTable();
        }
        
        function changePageSize() {
            const select = document.getElementById('page-size');
            if (select.value === 'all') {
                pageSize = filteredData.length || 1;
            } else {
                pageSize = parseInt(select.value);
            }
            currentPage = 1;
            updateTable();
        }
        
        function goToPage(page) {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            if (page < 1 || page > totalPages) return;
            currentPage = page;
            updateTable();
        }
        
        function updateTable() {
            const totalPages = Math.ceil(filteredData.length / pageSize);
            const startIdx = (currentPage - 1) * pageSize;
            const endIdx = Math.min(startIdx + pageSize, filteredData.length);
            const pageData = filteredData.slice(startIdx, endIdx);
            
            // í…Œì´ë¸” ì •ë³´
            document.getElementById('table-info').textContent = 
                `${filteredData.length.toLocaleString()}ê°œ ì¤‘ ${startIdx + 1}~${endIdx}`;
            
            // í…Œì´ë¸” ê·¸ë¦¬ê¸°
            drawTable(pageData);
            
            // í˜ì´ì§€ë„¤ì´ì…˜
            let paginationHtml = '';
            if (totalPages > 1) {
                paginationHtml += `<button class="btn" onclick="goToPage(1)" ${currentPage === 1 ? 'disabled' : ''}>â‰ª</button>`;
                paginationHtml += `<button class="btn" onclick="goToPage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>â—€</button>`;
                
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);
                
                if (startPage > 1) {
                    paginationHtml += `<span style="color: var(--text-secondary);">...</span>`;
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    paginationHtml += `<button class="btn ${i === currentPage ? 'btn-primary' : ''}" onclick="goToPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    paginationHtml += `<span style="color: var(--text-secondary);">...</span>`;
                }
                
                paginationHtml += `<button class="btn" onclick="goToPage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>â–¶</button>`;
                paginationHtml += `<button class="btn" onclick="goToPage(${totalPages})" ${currentPage === totalPages ? 'disabled' : ''}>â‰«</button>`;
                paginationHtml += `<span class="pagination-info">${currentPage} / ${totalPages} í˜ì´ì§€</span>`;
            }
            document.getElementById('pagination').innerHTML = paginationHtml;
        }
        
        function drawChart(data, predType) {
            const times = data.map(d => d.pred_time.split(' ')[1] || d.pred_time);
            const actuals = data.map(d => d.actual_max);
            const actualSingles = data.map(d => d.actual_single);
            const predicts = data.map(d => d.predict);
            const currents = data.map(d => d.current);
            
            const allValues = [...actuals, ...actualSingles, ...predicts, ...currents, 1700];
            const minVal = Math.min(...allValues);
            const maxVal = Math.max(...allValues);
            const padding = (maxVal - minVal) * 0.1;
            const yMin = Math.max(0, Math.floor((minVal - padding) / 100) * 100);
            const yMax = Math.ceil((maxVal + padding) / 100) * 100;
            
            const traces = [
                {
                    x: times,
                    y: currents,
                    name: 'í˜„ì¬ TOTALCNT',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#3b82f6', width: 2 }
                },
                {
                    x: times,
                    y: actuals,
                    name: `ì‹¤ì œ(ìµœëŒ€) ${predType}ë¶„`,
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#22c55e', width: 2 }
                },
                {
                    x: times,
                    y: actualSingles,
                    name: `ì‹¤ì œ(ë‹¨ì¼) ${predType}ë¶„`,
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#8b5cf6', width: 2, dash: 'dash' }
                },
                {
                    x: times,
                    y: predicts,
                    name: `ì˜ˆì¸¡ê°’`,
                    type: 'scatter',
                    mode: 'lines+markers',
                    line: { color: '#f97316', width: 2 },
                    marker: { size: 4 }
                }
            ];
            
            const layout = {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#a1a1aa', family: 'Space Grotesk', size: 11 },
                showlegend: true,
                legend: { x: 0, y: 1.08, orientation: 'h' },
                xaxis: { 
                    gridcolor: '#27272a', 
                    tickangle: -45,
                    tickfont: { size: 10 },
                    title: { text: 'ì˜ˆì¸¡ì‹œì ', font: { size: 11 } }
                },
                yaxis: { 
                    gridcolor: '#27272a', 
                    range: [yMin, yMax],
                    tickfont: { size: 11 }
                },
                margin: { t: 40, r: 20, b: 80, l: 55 },
                shapes: [{
                    type: 'line',
                    y0: 1700, y1: 1700,
                    x0: 0, x1: 1, xref: 'paper',
                    line: { color: '#ef4444', width: 2, dash: 'solid' }
                }]
            };
            
            Plotly.newPlot('chart', traces, layout, { responsive: true, displayModeBar: false });
            
            setTimeout(() => {
                Plotly.Plots.resize('chart');
            }, 100);
        }
        
        window.addEventListener('resize', () => {
            const chartEl = document.getElementById('chart');
            if (chartEl && chartEl.data) {
                Plotly.Plots.resize('chart');
            }
        });
        
        function drawTable(data) {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>í˜„ì¬ì‹œê°„</th>
                            <th>í˜„ì¬ê°’</th>
                            <th>ì˜ˆì¸¡ì‹œì </th>
                            <th>ì˜ˆì¸¡ê°’</th>
                            <th>ì‹¤ì œ(ìµœëŒ€)</th>
                            <th>ì‹¤ì œ(ë‹¨ì¼)</th>
                            <th>í™•ë¥ </th>
                            <th>ì˜ˆì¸¡íŒì •</th>
                            <th>ì‹¤ì œìœ„í—˜</th>
                            <th>ì˜ˆì¸¡ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            const startIdx = (currentPage - 1) * pageSize;
            
            data.forEach((row, idx) => {
                const predClass = row.predict >= 1700 ? 'value-danger' : row.predict >= 1600 ? 'value-warning' : '';
                const actualMaxClass = row.actual_max >= 1700 ? 'value-danger' : row.actual_max >= 1600 ? 'value-warning' : '';
                const actualSingleClass = row.actual_single >= 1700 ? 'value-danger' : row.actual_single >= 1600 ? 'value-warning' : '';
                
                // ìƒíƒœ ë°°ì§€
                let statusBadge = '';
                let statusLabel = row.status_label || row.status || '-';
                const status = row.status || '';
                
                if (status === 'TP') {
                    statusBadge = '<span class="badge badge-tp">TP</span>';
                } else if (status === 'TN') {
                    statusBadge = '<span class="badge badge-tn">TN</span>';
                } else if (status === 'FN_ë†“ì¹¨') {
                    statusBadge = '<span class="badge badge-fn">FN</span>';
                } else if (status.startsWith('FN_')) {
                    statusBadge = '<span class="badge badge-fn-early">FN</span>';
                } else if (status === 'FP_ì˜¤íƒ') {
                    statusBadge = '<span class="badge badge-fp">FP</span>';
                } else if (status.startsWith('FP_')) {
                    statusBadge = '<span class="badge badge-fp-valid">FP</span>';
                }
                
                html += `
                    <tr>
                        <td style="color: var(--text-secondary);">${startIdx + idx + 1}</td>
                        <td>${row.currtime}</td>
                        <td>${row.current.toLocaleString()}</td>
                        <td>${row.pred_time}</td>
                        <td class="${predClass}" style="font-weight: 600;">${row.predict.toLocaleString()}</td>
                        <td class="${actualMaxClass}" style="font-weight: 600;">${row.actual_max.toLocaleString()}</td>
                        <td class="${actualSingleClass}" style="font-weight: 600;">${row.actual_single.toLocaleString()}</td>
                        <td>${row.prob}</td>
                        <td>${row.danger ? '<span style="color: var(--danger);">âš ï¸ ìœ„í—˜</span>' : '<span style="color: var(--success);">âœ… ì •ìƒ</span>'}</td>
                        <td>${row.actual_danger ? '<span style="color: var(--danger);">ğŸ”´ ìœ„í—˜</span>' : '<span style="color: var(--success);">ğŸŸ¢ ì •ìƒ</span>'}</td>
                        <td>${statusBadge} ${statusLabel}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html;
        }
    </script>
</body>
</html>