<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>M14 ì˜ˆì¸¡ í‰ê°€</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #09090b;
            --bg-secondary: #18181b;
            --bg-card: #1f1f23;
            --border: #27272a;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --accent: #3b82f6;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --purple: #8b5cf6;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Space Grotesk', system-ui, sans-serif;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--purple), var(--accent));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 600;
        }
        
        .logo-text span {
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .nav-btns {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .btn:hover { background: var(--bg-card); border-color: var(--text-secondary); }
        .btn-primary { background: var(--accent); border-color: var(--accent); }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: var(--success); border-color: var(--success); color: #000; }
        .btn-warning { background: var(--warning); border-color: var(--warning); color: #000; }
        .btn-purple { background: var(--purple); border-color: var(--purple); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            background: var(--bg-secondary);
            padding: 15px 20px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        input[type="date"] {
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
        }
        
        .radio-label {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .radio-label:hover {
            border-color: var(--accent);
        }
        
        .radio-label input {
            accent-color: var(--accent);
        }
        
        .radio-label.selected {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 15px 20px;
        }
        
        .stat-card.highlight {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }
        
        .stat-card.danger {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .stat-card.success {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .stat-card.warning {
            border-color: var(--warning);
            background: rgba(234, 179, 8, 0.05);
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
        }
        
        .stat-sub {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 3px;
        }
        
        .section {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .confusion-matrix {
            display: grid;
            grid-template-columns: auto 1fr 1fr;
            gap: 2px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .cm-cell {
            padding: 15px 20px;
            text-align: center;
            border-radius: 6px;
        }
        
        .cm-header {
            background: var(--bg-card);
            font-weight: 600;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .cm-tp { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .cm-tn { background: rgba(59, 130, 246, 0.2); color: var(--accent); }
        .cm-fp { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        .cm-fn { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        
        .cm-value {
            font-size: 24px;
            font-weight: 700;
        }
        
        .cm-label {
            font-size: 10px;
            margin-top: 3px;
        }
        
        .status-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--bg-card);
            border-radius: 6px;
        }
        
        .status-name {
            font-size: 13px;
        }
        
        .status-count {
            font-weight: 600;
            font-size: 14px;
        }
        
        .status-item.tp .status-count { color: var(--success); }
        .status-item.tn .status-count { color: var(--accent); }
        .status-item.fn .status-count { color: var(--danger); }
        .status-item.fp .status-count { color: var(--warning); }
        
        #chart {
            width: 100%;
            height: 350px;
        }
        
        .table-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--bg-card);
            color: var(--text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            font-size: 10px;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
        }
        
        tr:hover { background: rgba(255,255,255,0.02); }
        
        .value-normal { color: var(--text-primary); }
        .value-warning { color: var(--warning); }
        .value-danger { color: var(--danger); }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .badge-tp { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .badge-tn { background: rgba(59, 130, 246, 0.2); color: var(--accent); }
        .badge-fn { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
        .badge-fp { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .warning-box {
            background: rgba(234, 179, 8, 0.1);
            border: 1px solid rgba(234, 179, 8, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--warning);
        }
        
        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 15px;
            font-size: 13px;
            color: var(--accent);
        }
        
        .results-container {
            display: none;
        }
        
        .results-container.active {
            display: block;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">E</div>
            <div class="logo-text">M14 <span>ì˜ˆì¸¡ í‰ê°€</span></div>
        </div>
        <div class="nav-btns">
            <button class="btn" onclick="location.href='/'">â† ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</button>
            <button class="btn" onclick="location.href='/history'">ğŸ“Š íˆìŠ¤í† ë¦¬</button>
        </div>
    </header>
    
    <div class="controls">
        <div class="control-group">
            <span class="control-label">ì‹œì‘ì¼:</span>
            <input type="date" id="date-start">
        </div>
        <div class="control-group">
            <span class="control-label">ì¢…ë£Œì¼:</span>
            <input type="date" id="date-end">
        </div>
        <div class="control-group">
            <span class="control-label">ì˜ˆì¸¡ íƒ€ì…:</span>
            <div class="radio-group">
                <label class="radio-label selected" id="radio-10">
                    <input type="radio" name="pred-type" value="10" checked>
                    10ë¶„ ì˜ˆì¸¡
                </label>
                <label class="radio-label" id="radio-30">
                    <input type="radio" name="pred-type" value="30">
                    30ë¶„ ì˜ˆì¸¡
                </label>
            </div>
        </div>
        <button class="btn btn-primary" id="btn-evaluate" onclick="runEvaluation()">ğŸ” í‰ê°€ ì‹¤í–‰</button>
        <button class="btn" onclick="loadToday()">ì˜¤ëŠ˜</button>
        <button class="btn" onclick="loadYesterday()">ì–´ì œ</button>
        <button class="btn" onclick="loadLast3Days()">ìµœê·¼ 3ì¼</button>
        <button class="btn" onclick="loadThisWeek()">ì´ë²ˆì£¼</button>
    </div>
    
    <div id="initial-state">
        <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <div>ë‚ ì§œë¥¼ ì„ íƒí•˜ê³  <strong>í‰ê°€ ì‹¤í–‰</strong> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”</div>
            <div style="color: var(--text-secondary); margin-top: 10px; font-size: 13px;">
                data í´ë”ì˜ m14_data_YYYYMMDD.csv íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì˜ˆì¸¡ ì„±ëŠ¥ì„ í‰ê°€í•©ë‹ˆë‹¤
            </div>
        </div>
    </div>
    
    <div id="loading-state" style="display: none;">
        <div class="loading">
            <div class="loading-spinner"></div>
            <div>í‰ê°€ ì§„í–‰ ì¤‘... ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 10px;">
                ë°ì´í„° ì–‘ì— ë”°ë¼ ìˆ˜ ë¶„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
            </div>
        </div>
    </div>
    
    <div id="results-container" class="results-container">
        <div id="warning-box" class="warning-box" style="display: none;"></div>
        
        <div class="stats-grid">
            <div class="stat-card highlight">
                <div class="stat-label">ì´ í‰ê°€ ìˆ˜</div>
                <div class="stat-value" id="stat-total">-</div>
                <div class="stat-sub" id="stat-period">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì‹¤ì œ 1700+ ë°œìƒ</div>
                <div class="stat-value" id="stat-actual" style="color: var(--danger);">-</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">ì •í™•ë„</div>
                <div class="stat-value" id="stat-accuracy" style="color: var(--success);">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì¬í˜„ìœ¨ (Recall)</div>
                <div class="stat-value" id="stat-recall">-</div>
                <div class="stat-sub">1700+ ê°ì§€ ì„±ê³µë¥ </div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì •ë°€ë„ (Precision)</div>
                <div class="stat-value" id="stat-precision">-</div>
                <div class="stat-sub">ê²½ê³  ì •í™•ë¥ </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“ í˜¼ë™ í–‰ë ¬ (Confusion Matrix)</div>
            <div class="confusion-matrix">
                <div class="cm-cell"></div>
                <div class="cm-cell cm-header">ì˜ˆì¸¡: ì •ìƒ</div>
                <div class="cm-cell cm-header">ì˜ˆì¸¡: ìœ„í—˜</div>
                
                <div class="cm-cell cm-header">ì‹¤ì œ: ì •ìƒ</div>
                <div class="cm-cell cm-tn">
                    <div class="cm-value" id="cm-tn">-</div>
                    <div class="cm-label">TN (ì •ìƒâ†’ì •ìƒ)</div>
                </div>
                <div class="cm-cell cm-fp">
                    <div class="cm-value" id="cm-fp">-</div>
                    <div class="cm-label">FP (ì˜¤íƒ)</div>
                </div>
                
                <div class="cm-cell cm-header">ì‹¤ì œ: ìœ„í—˜</div>
                <div class="cm-cell cm-fn">
                    <div class="cm-value" id="cm-fn">-</div>
                    <div class="cm-label">FN (ë¯¸íƒ)</div>
                </div>
                <div class="cm-cell cm-tp">
                    <div class="cm-value" id="cm-tp">-</div>
                    <div class="cm-label">TP (ì •ìƒ ê°ì§€)</div>
                </div>
            </div>
        </div>
        
        <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr);">
            <div class="stat-card success">
                <div class="stat-label">FN ì¡°ê¸°ê°ì§€</div>
                <div class="stat-value" id="stat-fn-early" style="color: var(--success);">-</div>
                <div class="stat-sub" id="stat-fn-early-sub">ì‚¬ì „ì— ì˜ˆì¸¡ë¨</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-label">ì‹¤ì§ˆ FN (ì™„ì „ ë†“ì¹¨)</div>
                <div class="stat-value" id="stat-real-fn" style="color: var(--danger);">-</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-label">FP ìœ íš¨ê²½ê³ </div>
                <div class="stat-value" id="stat-fp-valid" style="color: var(--warning);">-</div>
                <div class="stat-sub" id="stat-fp-valid-sub">ì´í›„ ì‹¤ì œ ëŒíŒŒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ì‹¤ì§ˆ FP (ì˜¤íƒ)</div>
                <div class="stat-value" id="stat-real-fp">-</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“Š ì˜ˆì¸¡ ìƒíƒœ ë¶„ë¥˜</div>
            <div class="status-list" id="status-list"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“ˆ ì˜ˆì¸¡ vs ì‹¤ì œ ì°¨íŠ¸</div>
            <div id="chart"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“‹ ìƒì„¸ ë°ì´í„° (ìµœê·¼ 100ê°œ)</div>
            <div class="table-container" id="table-container"></div>
        </div>
    </div>

    <script>
        // ë‚ ì§œ ì´ˆê¸°í™”
        const today = new Date();
        document.getElementById('date-start').value = formatDate(today);
        document.getElementById('date-end').value = formatDate(today);
        
        // ë¼ë””ì˜¤ ë²„íŠ¼ ìŠ¤íƒ€ì¼
        document.querySelectorAll('input[name="pred-type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                document.querySelectorAll('.radio-label').forEach(l => l.classList.remove('selected'));
                this.parentElement.classList.add('selected');
            });
        });
        
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }
        
        function loadToday() {
            document.getElementById('date-start').value = formatDate(today);
            document.getElementById('date-end').value = formatDate(today);
        }
        
        function loadYesterday() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('date-start').value = formatDate(yesterday);
            document.getElementById('date-end').value = formatDate(yesterday);
        }
        
        function loadLast3Days() {
            const threeDaysAgo = new Date();
            threeDaysAgo.setDate(threeDaysAgo.getDate() - 2);
            document.getElementById('date-start').value = formatDate(threeDaysAgo);
            document.getElementById('date-end').value = formatDate(today);
        }
        
        function loadThisWeek() {
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 6);
            document.getElementById('date-start').value = formatDate(weekAgo);
            document.getElementById('date-end').value = formatDate(today);
        }
        
        async function runEvaluation() {
            const dateStart = document.getElementById('date-start').value.replace(/-/g, '');
            const dateEnd = document.getElementById('date-end').value.replace(/-/g, '');
            const predType = document.querySelector('input[name="pred-type"]:checked').value;
            
            if (!dateStart || !dateEnd) {
                alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            // UI ìƒíƒœ ë³€ê²½
            document.getElementById('initial-state').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';
            document.getElementById('results-container').classList.remove('active');
            document.getElementById('btn-evaluate').disabled = true;
            
            try {
                const res = await fetch(`/api/evaluate?date_start=${dateStart}&date_end=${dateEnd}&pred_type=${predType}`);
                const data = await res.json();
                
                if (data.error) {
                    alert(data.error);
                    document.getElementById('initial-state').style.display = 'block';
                    document.getElementById('loading-state').style.display = 'none';
                    return;
                }
                
                displayResults(data);
                
            } catch (e) {
                console.error(e);
                alert('í‰ê°€ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
                document.getElementById('initial-state').style.display = 'block';
            } finally {
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('btn-evaluate').disabled = false;
            }
        }
        
        function displayResults(data) {
            // ê²½ê³  ë°•ìŠ¤
            const warningBox = document.getElementById('warning-box');
            if (data.missing_cols && data.missing_cols.length > 0) {
                warningBox.innerHTML = `âš ï¸ ëˆ„ë½/0ì¸ ì»¬ëŸ¼ ${data.missing_cols.length}ê°œ: ${data.missing_cols.slice(0, 5).join(', ')}${data.missing_cols.length > 5 ? '...' : ''}`;
                warningBox.style.display = 'block';
            } else {
                warningBox.style.display = 'none';
            }
            
            const stats = data.stats;
            const predTypeText = data.pred_type === '10' ? '10ë¶„' : '30ë¶„';
            
            // ê¸°ë³¸ í†µê³„
            document.getElementById('stat-total').textContent = data.total_count.toLocaleString();
            document.getElementById('stat-period').textContent = `${data.date_start.slice(0,4)}-${data.date_start.slice(4,6)}-${data.date_start.slice(6,8)} ~ ${data.date_end.slice(0,4)}-${data.date_end.slice(4,6)}-${data.date_end.slice(6,8)} (${predTypeText})`;
            document.getElementById('stat-actual').textContent = data.actual_danger_count.toLocaleString();
            document.getElementById('stat-accuracy').textContent = stats.accuracy + '%';
            document.getElementById('stat-recall').textContent = stats.recall + '%';
            document.getElementById('stat-precision').textContent = stats.precision + '%';
            
            // í˜¼ë™ í–‰ë ¬
            document.getElementById('cm-tp').textContent = stats.TP.toLocaleString();
            document.getElementById('cm-tn').textContent = stats.TN.toLocaleString();
            document.getElementById('cm-fp').textContent = stats.FP.toLocaleString();
            document.getElementById('cm-fn').textContent = stats.FN.toLocaleString();
            
            // ì‹¤ì§ˆ ì„±ëŠ¥
            document.getElementById('stat-fn-early').textContent = stats.fn_early.toLocaleString();
            document.getElementById('stat-fn-early-sub').textContent = `${data.analysis_range}ë¶„ ì´ë‚´ ì‚¬ì „ ì˜ˆì¸¡`;
            document.getElementById('stat-real-fn').textContent = stats.real_fn.toLocaleString();
            document.getElementById('stat-fp-valid').textContent = stats.fp_valid.toLocaleString();
            document.getElementById('stat-fp-valid-sub').textContent = `${data.analysis_range}ë¶„ ì´ë‚´ ì‹¤ì œ ëŒíŒŒ`;
            document.getElementById('stat-real-fp').textContent = stats.real_fp.toLocaleString();
            
            // ìƒíƒœ ë¦¬ìŠ¤íŠ¸
            const statusList = document.getElementById('status-list');
            let statusHtml = '';
            
            // ì •ë ¬: TP, TN, FNë¥˜, FPë¥˜
            const sortedStatuses = Object.entries(data.status_counts).sort((a, b) => {
                const order = {'TP': 0, 'TN': 1};
                const getOrder = (s) => {
                    if (s === 'TP') return 0;
                    if (s === 'TN') return 1;
                    if (s.startsWith('FN')) return 2;
                    if (s.startsWith('FP')) return 3;
                    return 4;
                };
                return getOrder(a[0]) - getOrder(b[0]);
            });
            
            sortedStatuses.forEach(([status, count]) => {
                let cls = '';
                if (status === 'TP') cls = 'tp';
                else if (status === 'TN') cls = 'tn';
                else if (status.startsWith('FN')) cls = 'fn';
                else if (status.startsWith('FP')) cls = 'fp';
                
                statusHtml += `
                    <div class="status-item ${cls}">
                        <span class="status-name">${status}</span>
                        <span class="status-count">${count.toLocaleString()}</span>
                    </div>
                `;
            });
            statusList.innerHTML = statusHtml;
            
            // ì°¨íŠ¸
            drawChart(data.data, data.pred_type);
            
            // í…Œì´ë¸”
            drawTable(data.data);
            
            // ê²°ê³¼ í‘œì‹œ
            document.getElementById('results-container').classList.add('active');
        }
        
        function drawChart(data, predType) {
            const times = data.map(d => d.currtime.split(' ')[1] || d.currtime);
            const actuals = data.map(d => d.actual_max);
            const predicts = data.map(d => d.predict);
            const currents = data.map(d => d.current);
            
            const traces = [
                {
                    x: times,
                    y: currents,
                    name: 'í˜„ì¬ TOTALCNT',
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#3b82f6', width: 1 }
                },
                {
                    x: times,
                    y: actuals,
                    name: `ì‹¤ì œ ${predType}ë¶„ ìµœëŒ€`,
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#22c55e', width: 2 }
                },
                {
                    x: times,
                    y: predicts,
                    name: `ì˜ˆì¸¡ê°’`,
                    type: 'scatter',
                    mode: 'lines',
                    line: { color: '#f97316', width: 2, dash: 'dot' }
                }
            ];
            
            const layout = {
                paper_bgcolor: 'transparent',
                plot_bgcolor: 'transparent',
                font: { color: '#a1a1aa', family: 'Space Grotesk', size: 11 },
                showlegend: true,
                legend: { x: 0, y: 1.1, orientation: 'h' },
                xaxis: { gridcolor: '#27272a', tickangle: -45 },
                yaxis: { gridcolor: '#27272a', range: [1000, 2000] },
                margin: { t: 30, r: 20, b: 60, l: 50 },
                shapes: [{
                    type: 'line',
                    y0: 1700, y1: 1700,
                    x0: 0, x1: 1, xref: 'paper',
                    line: { color: '#ef4444', width: 2, dash: 'solid' }
                }]
            };
            
            Plotly.newPlot('chart', traces, layout, { responsive: true, displayModeBar: false });
        }
        
        function drawTable(data) {
            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>í˜„ì¬ì‹œê°„</th>
                            <th>í˜„ì¬ê°’</th>
                            <th>ì˜ˆì¸¡ì‹œì </th>
                            <th>ì˜ˆì¸¡ê°’</th>
                            <th>ì‹¤ì œ(ìµœëŒ€)</th>
                            <th>í™•ë¥ </th>
                            <th>íŒì •</th>
                            <th>ì‹¤ì œìœ„í—˜</th>
                            <th>ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(row => {
                const predClass = row.predict >= 1700 ? 'value-danger' : row.predict >= 1600 ? 'value-warning' : '';
                const actualClass = row.actual_max >= 1700 ? 'value-danger' : row.actual_max >= 1600 ? 'value-warning' : '';
                
                let statusBadge = '';
                if (row.status) {
                    if (row.status === 'TP') statusBadge = '<span class="badge badge-tp">TP</span>';
                    else if (row.status === 'TN') statusBadge = '<span class="badge badge-tn">TN</span>';
                    else if (row.status.startsWith('FN')) statusBadge = `<span class="badge badge-fn">${row.status}</span>`;
                    else if (row.status.startsWith('FP')) statusBadge = `<span class="badge badge-fp">${row.status}</span>`;
                }
                
                html += `
                    <tr>
                        <td>${row.currtime}</td>
                        <td>${row.current.toLocaleString()}</td>
                        <td>${row.pred_time}</td>
                        <td class="${predClass}" style="font-weight: 600;">${row.predict.toLocaleString()}</td>
                        <td class="${actualClass}" style="font-weight: 600;">${row.actual_max.toLocaleString()}</td>
                        <td>${row.prob}</td>
                        <td>${row.danger ? 'âš ï¸' : 'âœ…'}</td>
                        <td>${row.actual_danger ? 'ğŸ”´' : 'ğŸŸ¢'}</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            document.getElementById('table-container').innerHTML = html;
        }
    </script>
</body>
</html>