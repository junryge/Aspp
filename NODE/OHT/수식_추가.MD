# 12. 수식 종합 및 계산 예시

> 📐 Smart ATLAS 시스템에서 사용되는 핵심 수식 5가지와 실제 계산 예시입니다.

---

## 12.1 속도(Velocity) 계산 공식

### 기본 공식

```
속도(ν) = 거리(Δx) / 시간(Δt) × 60.0
```

| 변수 | 설명 | 단위 |
|------|------|------|
| ν | 속도 | m/min (미터/분) |
| Δx | 이동 거리 | mm |
| Δt | 시간 (두 메시지 수신 시간 차이) | 초 |
| ×60.0 | 초 → 분 단위 변환 | - |

### 📝 계산 예시

```
조건:
  - 거리(Δx) = 280mm
  - 시간(Δt) = 1초

계산:
  속도(ν) = 280 / 1 × 60.0 = 16,800 mm/min = 16.8 m/min
```

---

## 12.2 거리(Δx) 계산 공식

> ※ α: 최근(현재) 수신 메시지 정보 / β: 이전(마지막) 수신 메시지 정보

### Case 1: 연속된 RailEdge (α의 시작점과 β의 도착지점이 동일)

```
Δx = (β RailEdge 길이) - (β의 현재 번지 거리) + (α의 현재 번지 거리)
```

#### 📝 Case 1 계산 예시

```
조건:
  - β RailEdge 길이 = 2000mm
  - β의 현재 번지 거리 = 500mm
  - α의 현재 번지 거리 = 300mm

계산:
  Δx = 2000 - 500 + 300 = 1800mm
```

### Case 2: 서로 다른 RailEdge (Dijkstra 경로 탐색 필요)

```
Δx = (β→α 시작점까지 RailEdge 길이의 합) - (β의 현재 번지 거리) + (α의 현재 번지 거리)
```

#### 📝 Case 2 계산 예시

```
조건:
  - RailEdge 1 길이 = 100mm
  - RailEdge 2 길이 = 200mm
  - β의 현재 번지 거리 = 20mm
  - α의 현재 번지 거리 = 0mm

계산:
  Δx = (100 + 200) - 20 + 0 = 280mm
```

---

## 12.3 밀도(Density) 계산 공식

### 기본 공식

```
density = (vehicle 길이) × (현재 vehicle 수량) / {(RailEdge 길이) - (RailEdge 길이 % vehicle 길이)}
```

> **밀도 해석:** 0에 가까울수록 여유, 1에 가까울수록 혼잡

### 📝 계산 예시

```
조건:
  - Factory: M16A (vehicle 길이 = 1243mm)
  - 현재 vehicle 수량 = 3대
  - RailEdge 길이 = 5000mm

계산:
  유효 길이 = 5000 - (5000 % 1243) = 5000 - 271 = 4729mm
  density = 1243 × 3 / 4729 = 3729 / 4729 ≈ 0.789

해석: RailEdge의 약 79%가 Vehicle로 점유됨 (혼잡 상태)
```

---

## 12.4 FutureCost 계산 공식

### 기본 공식

```
FutureCost = baseCost
           + (futureTransCnt × transWeight)
           + (futureAcqCnt × acqTransWeight)
           + (futureDpstCnt × dpstTransWeight)
           + Junction penalty
```

| 변수 | 설명 |
|------|------|
| baseCost | 기본 비용 (거리/시간 기반) |
| futureTransCnt | 예상 Transfer 작업 수 |
| futureAcqCnt | 예상 Acquire 작업 수 |
| futureDpstCnt | 예상 Deposit 작업 수 |
| Junction penalty | 분기점 통과 시 추가 비용 |

### 📝 계산 예시

```
조건:
  - baseCost = 100
  - futureTransCnt = 2, transWeight = 10
  - futureAcqCnt = 1, acqTransWeight = 15
  - futureDpstCnt = 3, dpstTransWeight = 12
  - Junction penalty = 5

계산:
  FutureCost = 100 + (2×10) + (1×15) + (3×12) + 5
             = 100 + 20 + 15 + 36 + 5
             = 176
```

---

## 12.5 absoluteVelocity 계산 공식

### 기본 공식

```
absoluteVelocity = (RailEdge의 현재 속도) / (RailEdge의 최대 속도)
```

> **용도:** ATLAS_RAIL_TRAFFIC 테이블에 저장되어 레일 구간의 상대적 속도 효율을 나타냄

### 📝 계산 예시

```
조건:
  - RailEdge 현재 속도 = 160 m/min
  - RailEdge 최대 속도 = 200 m/min

계산:
  absoluteVelocity = 160 / 200 = 0.8

해석: 최대 속도의 80%로 운행 중
```

### absoluteVelocity 상태 해석표

| absoluteVelocity | 상태 | 설명 |
|:----------------:|:----:|------|
| **1.0** | 🟢 최대 속도 | 정상 최고 속도로 운행 |
| **0.8** | 🔵 정상 (80%) | 양호한 흐름 |
| **0.5** | 🟡 혼잡 (50%) | 속도 저하 발생 |
| **0.2** | 🔴 심각한 지연 | 정체 또는 장애 의심 |

---

## 12.6 수식 요약표

| 수식명 | 공식 | 사용처 |
|--------|------|--------|
| **속도(Velocity)** | `ν = Δx / Δt × 60.0` | DataSet.java, 실시간 속도 계산 |
| **거리(Distance)** | `Δx = RailEdge길이합 - β거리 + α거리` | 속도 계산 전처리 |
| **밀도(Density)** | `vhlLen × vhlCnt / 유효길이` | ATLAS_AREA_TRAFFIC, ATLAS_BRANCH_TRAFFIC |
| **FutureCost** | `baseCost + Σ(cnt × weight) + penalty` | DijkstraVhlRouteFind, 경로 최적화 |
| **absoluteVelocity** | `현재속도 / 최대속도` | ATLAS_RAIL_TRAFFIC, 상대 속도 효율 |

---

*작성일: 2025년 | 대상 시스템: Smart ATLAS OHT 시스템*