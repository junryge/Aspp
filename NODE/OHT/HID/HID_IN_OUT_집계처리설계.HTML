<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HID IN/OUT ì¹´ìš´íŠ¸ ë° FABID ë¶„ë¦¬ ì €ì¥ ìˆ˜ì • ì•ˆë‚´ì„œ</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-orange: #d29922;
            --accent-purple: #a371f7;
            --accent-red: #f85149;
            --accent-cyan: #39c5cf;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --border-color: #30363d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 4rem;
            padding: 3rem;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple), var(--accent-cyan));
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .badge-blue { background: rgba(88, 166, 255, 0.15); color: var(--accent-blue); }
        .badge-green { background: rgba(63, 185, 80, 0.15); color: var(--accent-green); }
        .badge-orange { background: rgba(210, 153, 34, 0.15); color: var(--accent-orange); }

        section {
            margin-bottom: 3rem;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            color: var(--accent-blue);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: var(--accent-blue);
            border-radius: 2px;
        }

        h3 {
            font-size: 1.15rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem;
            color: var(--accent-cyan);
        }

        /* ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ 1 */
        .arch-diagram {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            margin: 2rem 0;
        }

        .arch-title {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        .table-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .table-box {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .table-box:hover {
            border-color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(88, 166, 255, 0.1);
        }

        .table-box.master {
            border-left: 4px solid var(--accent-green);
        }

        .table-box.realtime {
            border-left: 4px solid var(--accent-orange);
        }

        .table-name {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 0.75rem;
        }

        .table-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .table-tag {
            display: inline-block;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: rgba(88, 166, 255, 0.1);
            color: var(--accent-cyan);
            border-radius: 4px;
            margin-top: 0.5rem;
        }

        /* ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ 2 - ë°ì´í„° íë¦„ */
        .flow-diagram {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border-color);
            margin: 2rem 0;
        }

        .flow-section {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .flow-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .flow-box {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .flow-box.source { border-color: var(--accent-green); color: var(--accent-green); }
        .flow-box.process { border-color: var(--accent-blue); color: var(--accent-blue); }
        .flow-box.buffer { border-color: var(--accent-orange); color: var(--accent-orange); }
        .flow-box.target { border-color: var(--accent-purple); color: var(--accent-purple); }

        .flow-arrow {
            color: var(--text-secondary);
            font-size: 1.5rem;
        }

        .flow-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .flow-group {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px dashed var(--border-color);
        }

        .flow-group-title {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .target-tables {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .target-table {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            border: 1px solid var(--accent-purple);
            color: var(--accent-purple);
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .schema-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .schema-table th {
            background: var(--bg-tertiary);
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--accent-blue);
            border-bottom: 2px solid var(--border-color);
        }

        .schema-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .schema-table tr:hover td {
            background: var(--bg-secondary);
        }

        .schema-table code {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-tertiary);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: var(--accent-cyan);
        }

        /* ì½”ë“œ ë¸”ë¡ */
        pre {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.5rem;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            margin: 1rem 0;
        }

        pre code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .code-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .code-lang {
            background: var(--bg-tertiary);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* ìš”ì•½ ì¹´ë“œ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .summary-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.25rem;
            border: 1px solid var(--border-color);
        }

        .summary-card h4 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-blue);
            margin-bottom: 0.75rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            padding: 0.35rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: var(--text-secondary);
        }

        .summary-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* ìˆ˜ì • ì‚¬í•­ í•˜ì´ë¼ì´íŠ¸ */
        .highlight-box {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, rgba(163, 113, 247, 0.1) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--accent-blue);
            margin: 1.5rem 0;
        }

        .highlight-box h4 {
            color: var(--accent-blue);
            margin-bottom: 0.75rem;
        }

        .highlight-list {
            list-style: none;
        }

        .highlight-list li {
            padding: 0.35rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.9rem;
        }

        .highlight-list li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--accent-cyan);
        }

        /* Syntax Highlighting */
        .keyword { color: #ff7b72; }
        .string { color: #a5d6ff; }
        .comment { color: #8b949e; }
        .function { color: #d2a8ff; }
        .type { color: #79c0ff; }
        .number { color: #ffa657; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>HID IN/OUT ì¹´ìš´íŠ¸ ë° FABID ë¶„ë¦¬ ì €ì¥</h1>
            <p>OhtMsgWorkerRunnable ìˆ˜ì • ì•ˆë‚´ì„œ</p>
            <div style="margin-top: 1rem;">
                <span class="badge badge-blue">Logpresso</span>
                <span class="badge badge-green">ATLAS AMHS</span>
                <span class="badge badge-orange">1ë¶„ ë°°ì¹˜</span>
            </div>
        </header>

        <!-- ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ 1: í…Œì´ë¸” êµ¬ì¡° -->
        <section id="architecture">
            <h2>í…Œì´ë¸” ì•„í‚¤í…ì²˜</h2>
            
            <div class="arch-diagram">
                <div class="arch-title">Logpresso í…Œì´ë¸” êµ¬ì¡°</div>
                <div class="table-grid">
                    <div class="table-box master">
                        <div class="table-name">ATLAS_INFO_HID_INOUT</div>
                        <div class="table-desc">â€¢ HID Zone ë§ˆìŠ¤í„° ì •ë³´</div>
                        <div class="table-desc">â€¢ LAYOUT.XML ê¸°ë°˜</div>
                        <div class="table-desc">â€¢ í•˜ë£¨ 1íšŒ ì—…ë°ì´íŠ¸</div>
                        <div class="table-tag">ê¸°ì´ˆì •ë³´ / ë§ˆìŠ¤í„°</div>
                    </div>
                    <div class="table-box realtime">
                        <div class="table-name">ATLAS_M14_HID_INOUT</div>
                        <div class="table-desc">â€¢ HID IN/OUT ì´ë²¤íŠ¸ ë¡œê·¸</div>
                        <div class="table-desc">â€¢ 1ë¶„ ë‹¨ìœ„ ë°°ì¹˜ ì €ì¥</div>
                        <div class="table-desc">â€¢ ë‚ ì§œë³„ ë°ì´í„° ëˆ„ì </div>
                        <div class="table-tag">M14 ì‹¤ì‹œê°„ ë°ì´í„°</div>
                    </div>
                    <div class="table-box realtime">
                        <div class="table-name">ATLAS_M16_HID_INOUT</div>
                        <div class="table-desc">â€¢ HID IN/OUT ì´ë²¤íŠ¸ ë¡œê·¸</div>
                        <div class="table-desc">â€¢ 1ë¶„ ë‹¨ìœ„ ë°°ì¹˜ ì €ì¥</div>
                        <div class="table-desc">â€¢ ë‚ ì§œë³„ ë°ì´í„° ëˆ„ì </div>
                        <div class="table-tag">M16 ì‹¤ì‹œê°„ ë°ì´í„°</div>
                    </div>
                    <div class="table-box realtime">
                        <div class="table-name">ATLAS_M17_HID_INOUT</div>
                        <div class="table-desc">â€¢ HID IN/OUT ì´ë²¤íŠ¸ ë¡œê·¸</div>
                        <div class="table-desc">â€¢ 1ë¶„ ë‹¨ìœ„ ë°°ì¹˜ ì €ì¥</div>
                        <div class="table-desc">â€¢ ë‚ ì§œë³„ ë°ì´í„° ëˆ„ì </div>
                        <div class="table-tag">M17 ì‹¤ì‹œê°„ ë°ì´í„°</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ 2: ë°ì´í„° íë¦„ -->
        <section id="dataflow">
            <h2>ë°ì´í„° íë¦„ë„</h2>
            
            <div class="flow-diagram">
                <div class="arch-title">ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸</div>
                
                <div class="flow-section">
                    <!-- ë§ˆìŠ¤í„° ë°ì´í„° íë¦„ -->
                    <div class="flow-group">
                        <div class="flow-group-title">ğŸ“ ë§ˆìŠ¤í„° ë°ì´í„° (í•˜ë£¨ 1íšŒ)</div>
                        <div class="flow-row">
                            <div class="flow-box source">LAYOUT.XML</div>
                            <span class="flow-arrow">â†’</span>
                            <span class="flow-label">í•˜ë£¨ 1íšŒ</span>
                            <span class="flow-arrow">â†’</span>
                            <div class="flow-box target">ATLAS_INFO_HID_INOUT</div>
                        </div>
                    </div>

                    <!-- ì‹¤ì‹œê°„ ë°ì´í„° íë¦„ -->
                    <div class="flow-group">
                        <div class="flow-group-title">âš¡ ì‹¤ì‹œê°„ ë°ì´í„° (1ë¶„ ì§‘ê³„)</div>
                        <div class="flow-row">
                            <div class="flow-box source">OHT ì°¨ëŸ‰ ì´ë™</div>
                            <span class="flow-arrow">â†’</span>
                            <div class="flow-box process">_calculatedVhlCnt()</div>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem; margin-top: 0.5rem;">
                            <span class="flow-arrow">â†“</span>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem;">
                            <div class="flow-box buffer">IN ê°ì§€ â†’ hidCountBuffer[hidId][0]++</div>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem;">
                            <div class="flow-box buffer">OUT ê°ì§€ â†’ hidCountBuffer[hidId][1]++</div>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem; margin-top: 0.5rem;">
                            <span class="flow-arrow">â†“</span>
                            <span class="flow-label">1ë¶„ ê²½ê³¼ ì‹œ</span>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem;">
                            <div class="flow-box process">flushHidCountBuffer()</div>
                        </div>
                        <div class="flow-row" style="margin-left: 2rem; margin-top: 0.5rem;">
                            <span class="flow-arrow">â†“</span>
                            <span class="flow-label">HIDë³„ IN_CNT, OUT_CNT, VHL_CNT ì €ì¥</span>
                        </div>
                        <div class="target-tables" style="margin-left: 2rem;">
                            <div class="target-table">ATLAS_M14_HID_INOUT<br><small style="color: var(--text-secondary);">1ë¶„ ì§‘ê³„</small></div>
                            <div class="target-table">ATLAS_M16_HID_INOUT<br><small style="color: var(--text-secondary);">1ë¶„ ì§‘ê³„</small></div>
                            <div class="target-table">ATLAS_M17_HID_INOUT<br><small style="color: var(--text-secondary);">1ë¶„ ì§‘ê³„</small></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- í…Œì´ë¸” 1: ê¸°ì´ˆì •ë³´ -->
        <section id="master-table">
            <h2>í…Œì´ë¸” 1: ATLAS_INFO_HID_INOUT</h2>
            
            <h3>ìš©ë„</h3>
            <p>HID Zone ë§ˆìŠ¤í„° ë°ì´í„° (ê¸°ì¤€ ì •ë³´) â€” <code>LAYOUT.XML</code> ê¸°ë°˜, í•˜ë£¨ 1íšŒ ì—…ë°ì´íŠ¸ (ìƒˆë²½ ë°°ì¹˜)</p>

            <h3>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ</h3>
            <table class="schema-table">
                <thead>
                    <tr>
                        <th>ì»¬ëŸ¼ëª…</th>
                        <th>íƒ€ì…</th>
                        <th>ì„¤ëª…</th>
                        <th>ì˜ˆì‹œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><code>HID_ID</code></td><td>INT</td><td>HID Zone ID</td><td>99, 100, 187</td></tr>
                    <tr><td><code>HID_NM</code></td><td>STRING</td><td>HID Zone ì´ë¦„</td><td>HID_099, HID_100</td></tr>
                    <tr><td><code>MCP_ID</code></td><td>STRING</td><td>MCP ID</td><td>MCP01, MCP02</td></tr>
                    <tr><td><code>ZONE_ID</code></td><td>STRING</td><td>Zone ID</td><td>ZONE_A, ZONE_B</td></tr>
                    <tr><td><code>IN_CNT</code></td><td>INT</td><td>IN Lane ê°œìˆ˜</td><td>2, 3</td></tr>
                    <tr><td><code>OUT_CNT</code></td><td>INT</td><td>OUT Lane ê°œìˆ˜</td><td>2, 3</td></tr>
                    <tr><td><code>VHL_MAX</code></td><td>INT</td><td>ìµœëŒ€ í—ˆìš© ì°¨ëŸ‰ ìˆ˜</td><td>10, 15</td></tr>
                    <tr><td><code>ZCU_ID</code></td><td>STRING</td><td>ZCU ID</td><td>ZCU01</td></tr>
                    <tr><td><code>UPDATE_DT</code></td><td>STRING</td><td>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì¼ì‹œ</td><td>2026-01-29 00:00:00</td></tr>
                </tbody>
            </table>

            <h3>ìƒ˜í”Œ ë°ì´í„°</h3>
            <table class="schema-table">
                <thead>
                    <tr>
                        <th>HID_ID</th>
                        <th>HID_NM</th>
                        <th>MCP_ID</th>
                        <th>ZONE_ID</th>
                        <th>IN_CNT</th>
                        <th>OUT_CNT</th>
                        <th>VHL_MAX</th>
                        <th>ZCU_ID</th>
                        <th>UPDATE_DT</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>99</td><td>HID_099</td><td>MCP01</td><td>ZONE_A</td><td>2</td><td>2</td><td>10</td><td>ZCU01</td><td>2026-01-30 00:00:00</td></tr>
                    <tr><td>100</td><td>HID_100</td><td>MCP01</td><td>ZONE_A</td><td>3</td><td>3</td><td>15</td><td>ZCU01</td><td>2026-01-30 00:00:00</td></tr>
                    <tr><td>187</td><td>HID_187</td><td>MCP02</td><td>ZONE_B</td><td>2</td><td>2</td><td>12</td><td>ZCU02</td><td>2026-01-30 00:00:00</td></tr>
                    <tr><td>188</td><td>HID_188</td><td>MCP02</td><td>ZONE_B</td><td>4</td><td>4</td><td>20</td><td>ZCU02</td><td>2026-01-30 00:00:00</td></tr>
                </tbody>
            </table>

            <h3>ë°°ì¹˜ ì €ì¥ ë¡œì§ (Java)</h3>
            <div class="code-header">
                <span class="code-lang">Java</span>
                <span>HidMasterBatchJob.java</span>
            </div>
            <pre><code><span class="comment">// ìŠ¤ì¼€ì¤„: ë§¤ì¼ 00:00 (cron: 0 0 0 * * ?)</span>
<span class="keyword">@Scheduled</span>(cron = <span class="string">"0 0 0 * * ?"</span>)
<span class="keyword">public void</span> <span class="function">updateHidMasterInfo</span>() {
    String xmlPath = <span class="string">"/path/to/LAYOUT.XML"</span>;
    List&lt;Tuple&gt; tuples = <span class="keyword">new</span> ArrayList&lt;&gt;();
    SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);
    String updateDt = dateFormat.format(<span class="keyword">new</span> Date());
    
    <span class="keyword">try</span> {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        Document doc = builder.parse(<span class="keyword">new</span> File(xmlPath));
        doc.getDocumentElement().normalize();
        
        <span class="comment">// HID ë…¸ë“œ íŒŒì‹±</span>
        NodeList hidList = doc.getElementsByTagName(<span class="string">"HID"</span>);
        
        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hidList.getLength(); i++) {
            Element hid = (Element) hidList.item(i);
            Tuple tuple = <span class="keyword">new</span> Tuple();
            
            tuple.put(<span class="string">"HID_ID"</span>, Integer.parseInt(hid.getAttribute(<span class="string">"id"</span>)));
            tuple.put(<span class="string">"HID_NM"</span>, hid.getAttribute(<span class="string">"name"</span>));
            tuple.put(<span class="string">"MCP_ID"</span>, hid.getAttribute(<span class="string">"mcpId"</span>));
            tuple.put(<span class="string">"ZONE_ID"</span>, hid.getAttribute(<span class="string">"zoneId"</span>));
            tuple.put(<span class="string">"IN_CNT"</span>, Integer.parseInt(hid.getAttribute(<span class="string">"inCnt"</span>)));
            tuple.put(<span class="string">"OUT_CNT"</span>, Integer.parseInt(hid.getAttribute(<span class="string">"outCnt"</span>)));
            tuple.put(<span class="string">"VHL_MAX"</span>, Integer.parseInt(hid.getAttribute(<span class="string">"vhlMax"</span>)));
            tuple.put(<span class="string">"ZCU_ID"</span>, hid.getAttribute(<span class="string">"zcuId"</span>));
            tuple.put(<span class="string">"UPDATE_DT"</span>, updateDt);
            
            tuples.add(tuple);
        }
    } <span class="keyword">catch</span> (Exception e) {
        logger.error(<span class="string">"Failed to parse LAYOUT.XML"</span>, e);
        <span class="keyword">return</span>;
    }
    
    <span class="comment">// Full Refresh</span>
    LogpressoAPI.truncateTable(<span class="string">"ATLAS_INFO_HID_INOUT"</span>);
    LogpressoAPI.setInsertTuples(<span class="string">"ATLAS_INFO_HID_INOUT"</span>, tuples, <span class="number">100</span>);
    
    logger.info(<span class="string">"HID Master Info updated from LAYOUT.XML: {} records"</span>, tuples.size());
}</code></pre>
        </section>

        <!-- í…Œì´ë¸” 2: ì‹¤ì‹œê°„ ë°ì´í„° -->
        <section id="realtime-table">
            <h2>í…Œì´ë¸” 2: ATLAS_{FABID}_HID_INOUT</h2>
            
            <h3>ìš©ë„</h3>
            <p>HID IN/OUT 1ë¶„ ì§‘ê³„ ë°ì´í„° â€” FABIDë³„ í…Œì´ë¸” ë¶„ë¦¬ (M14, M16, M17...), 1ë¶„ ë‹¨ìœ„ ë°°ì¹˜ ì €ì¥, ë‚ ì§œë³„ ë°ì´í„° ëˆ„ì </p>

            <h3>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ</h3>
            <table class="schema-table">
                <thead>
                    <tr>
                        <th>ì»¬ëŸ¼ëª…</th>
                        <th>íƒ€ì…</th>
                        <th>ì„¤ëª…</th>
                        <th>ì˜ˆì‹œ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><code>EVENT_DATE</code></td><td>STRING</td><td>ì´ë²¤íŠ¸ ë‚ ì§œ (íŒŒí‹°ì…˜ í‚¤)</td><td>2026-01-30</td></tr>
                    <tr><td><code>EVENT_DT</code></td><td>STRING</td><td>ì§‘ê³„ ì‹œê°„ (1ë¶„ ë‹¨ìœ„)</td><td>2026-01-30 15:30:00</td></tr>
                    <tr><td><code>HID_ID</code></td><td>INT</td><td>HID Zone ID</td><td>99</td></tr>
                    <tr><td><code>IN_CNT</code></td><td>INT</td><td>1ë¶„ê°„ IN íšŸìˆ˜</td><td>12</td></tr>
                    <tr><td><code>OUT_CNT</code></td><td>INT</td><td>1ë¶„ê°„ OUT íšŸìˆ˜</td><td>10</td></tr>
                    <tr><td><code>VHL_CNT</code></td><td>INT</td><td>í˜„ì¬ HID êµ¬ê°„ ë‚´ ì°¨ëŸ‰ ìˆ˜</td><td>2</td></tr>
                    <tr><td><code>MCP_NM</code></td><td>STRING</td><td>MCP ì´ë¦„</td><td>MCP01</td></tr>
                    <tr><td><code>ENV</code></td><td>STRING</td><td>í™˜ê²½ êµ¬ë¶„</td><td>PROD</td></tr>
                </tbody>
            </table>

            <h3>ìƒ˜í”Œ ë°ì´í„° (ATLAS_M14_HID_INOUT)</h3>
            <table class="schema-table">
                <thead>
                    <tr>
                        <th>EVENT_DATE</th>
                        <th>EVENT_DT</th>
                        <th>HID_ID</th>
                        <th>IN_CNT</th>
                        <th>OUT_CNT</th>
                        <th>VHL_CNT</th>
                        <th>MCP_NM</th>
                        <th>ENV</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>2026-01-30</td><td>2026-01-30 14:30:00</td><td>99</td><td>12</td><td>10</td><td>2</td><td>MCP01</td><td>PROD</td></tr>
                    <tr><td>2026-01-30</td><td>2026-01-30 14:30:00</td><td>100</td><td>8</td><td>7</td><td>1</td><td>MCP01</td><td>PROD</td></tr>
                    <tr><td>2026-01-30</td><td>2026-01-30 14:31:00</td><td>99</td><td>15</td><td>13</td><td>4</td><td>MCP01</td><td>PROD</td></tr>
                    <tr><td>2026-01-30</td><td>2026-01-30 14:31:00</td><td>187</td><td>5</td><td>6</td><td>0</td><td>MCP02</td><td>PROD</td></tr>
                </tbody>
            </table>
        </section>

        <!-- ìˆ˜ì • ë°©ì•ˆ -->
        <section id="modification">
            <h2>ìˆ˜ì • ë°©ì•ˆ: 1ë¶„ ë°°ì¹˜ ì €ì¥</h2>

            <h3>Step 1: ì§‘ê³„ ë²„í¼ ì¶”ê°€ (í´ë˜ìŠ¤ í•„ë“œ)</h3>
            <div class="code-header">
                <span class="code-lang">Java</span>
                <span>í´ë˜ìŠ¤ ìƒë‹¨ì— ì¶”ê°€</span>
            </div>
            <pre><code><span class="comment">// HIDë³„ IN/OUT ì¹´ìš´íŠ¸ ì§‘ê³„ (1ë¶„ê°„ ëª¨ì•„ì„œ ë°°ì¹˜ ì €ì¥)</span>
<span class="comment">// Key: HID_ID, Value: [IN_CNT, OUT_CNT]</span>
<span class="keyword">private static</span> ConcurrentMap&lt;Integer, <span class="keyword">int</span>[]&gt; hidCountBuffer = 
    <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();
<span class="keyword">private static long</span> lastFlushTime = System.currentTimeMillis();
<span class="keyword">private static final long</span> FLUSH_INTERVAL = <span class="number">60000</span>; <span class="comment">// 1ë¶„</span>
<span class="keyword">private static final</span> Object flushLock = <span class="keyword">new</span> Object();</code></pre>

            <h3>Step 2: _calculatedVhlCnt() ìˆ˜ì •</h3>
            <div class="code-header">
                <span class="code-lang">Java</span>
                <span>ìˆ˜ì • í›„ ì½”ë“œ</span>
            </div>
            <pre><code><span class="keyword">private void</span> <span class="function">_calculatedVhlCnt</span>(<span class="keyword">int</span> currentHidId, String key, Vhl vehicle) {
    <span class="keyword">long</span> timer = System.currentTimeMillis();
    <span class="keyword">int</span> previousHidId = vehicle.getHidId();

    <span class="keyword">if</span> (previousHidId != currentHidId) {
        <span class="comment">// HID êµ¬ê°„ IN (ìƒˆë¡œìš´ HID êµ¬ê°„ ì§„ì…)</span>
        <span class="keyword">if</span> (currentHidId > <span class="number">0</span>) {
            String v = String.format(<span class="string">"%03d"</span>, currentHidId);
            DataService.getDataSet().increaseHidVehicleCnt(key + <span class="string">":"</span> + v);

            <span class="comment">// ===== ì¶”ê°€: IN ì¹´ìš´íŠ¸ ì¦ê°€ =====</span>
            hidCountBuffer.computeIfAbsent(currentHidId, k -> <span class="keyword">new int</span>[<span class="number">2</span>]);
            <span class="keyword">synchronized</span> (hidCountBuffer.get(currentHidId)) {
                hidCountBuffer.get(currentHidId)[<span class="number">0</span>]++; <span class="comment">// IN_CNT ì¦ê°€</span>
            }
        }

        <span class="comment">// HID êµ¬ê°„ OUT (ì´ì „ HID êµ¬ê°„ ì´íƒˆ)</span>
        <span class="keyword">if</span> (previousHidId > <span class="number">0</span>) {
            String v = String.format(<span class="string">"%03d"</span>, previousHidId);
            DataService.getDataSet().decreaseHidVehicleCnt(key + <span class="string">":"</span> + v);

            <span class="comment">// ===== ì¶”ê°€: OUT ì¹´ìš´íŠ¸ ì¦ê°€ =====</span>
            hidCountBuffer.computeIfAbsent(previousHidId, k -> <span class="keyword">new int</span>[<span class="number">2</span>]);
            <span class="keyword">synchronized</span> (hidCountBuffer.get(previousHidId)) {
                hidCountBuffer.get(previousHidId)[<span class="number">1</span>]++; <span class="comment">// OUT_CNT ì¦ê°€</span>
            }
        }

        vehicle.setHidId(currentHidId);
    }

    <span class="comment">// ===== ì¶”ê°€: 1ë¶„ë§ˆë‹¤ ë²„í¼ í”ŒëŸ¬ì‹œ =====</span>
    <span class="keyword">if</span> (timer - lastFlushTime >= FLUSH_INTERVAL) {
        <span class="keyword">synchronized</span> (flushLock) {
            <span class="keyword">if</span> (timer - lastFlushTime >= FLUSH_INTERVAL) {
                flushHidCountBuffer();
                lastFlushTime = timer;
            }
        }
    }
}</code></pre>

            <h3>Step 3: ì§‘ê³„ ì €ì¥ ë©”ì†Œë“œ ì¶”ê°€</h3>
            <div class="code-header">
                <span class="code-lang">Java</span>
                <span>flushHidCountBuffer()</span>
            </div>
            <pre><code><span class="comment">/**
 * HID IN/OUT ì§‘ê³„ ë°ì´í„°ë¥¼ Logpressoì— 1ë¶„ ë°°ì¹˜ ì €ì¥
 * í…Œì´ë¸”: ATLAS_{FABID}_HID_INOUT
 */</span>
<span class="keyword">private void</span> <span class="function">flushHidCountBuffer</span>() {
    <span class="keyword">if</span> (hidCountBuffer.isEmpty()) {
        <span class="keyword">return</span>;
    }

    <span class="comment">// ë²„í¼ ìŠ¤ëƒ…ìƒ· ìƒì„± ë° ì´ˆê¸°í™”</span>
    Map&lt;Integer, <span class="keyword">int</span>[]&gt; snapshot = <span class="keyword">new</span> HashMap&lt;&gt;();
    <span class="keyword">for</span> (Map.Entry&lt;Integer, <span class="keyword">int</span>[]&gt; entry : hidCountBuffer.entrySet()) {
        <span class="keyword">synchronized</span> (entry.getValue()) {
            snapshot.put(entry.getKey(), 
                <span class="keyword">new int</span>[]{entry.getValue()[<span class="number">0</span>], entry.getValue()[<span class="number">1</span>]});
            entry.getValue()[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// IN_CNT ë¦¬ì…‹</span>
            entry.getValue()[<span class="number">1</span>] = <span class="number">0</span>; <span class="comment">// OUT_CNT ë¦¬ì…‹</span>
        }
    }

    <span class="comment">// í˜„ì¬ ì‹œê°„ (1ë¶„ ë‹¨ìœ„ë¡œ ì •ë ¬)</span>
    SimpleDateFormat dateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:00"</span>);
    SimpleDateFormat dateOnlyFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>);
    Date now = <span class="keyword">new</span> Date();
    String eventDt = dateFormat.format(now);
    String eventDate = dateOnlyFormat.format(now);

    List&lt;Tuple&gt; tuples = <span class="keyword">new</span> ArrayList&lt;&gt;();

    <span class="keyword">for</span> (Map.Entry&lt;Integer, <span class="keyword">int</span>[]&gt; entry : snapshot.entrySet()) {
        <span class="keyword">int</span> hidId = entry.getKey();
        <span class="keyword">int</span> inCnt = entry.getValue()[<span class="number">0</span>];
        <span class="keyword">int</span> outCnt = entry.getValue()[<span class="number">1</span>];

        <span class="comment">// IN/OUT ë‘˜ ë‹¤ 0ì´ë©´ ìŠ¤í‚µ</span>
        <span class="keyword">if</span> (inCnt == <span class="number">0</span> && outCnt == <span class="number">0</span>) {
            <span class="keyword">continue</span>;
        }

        <span class="comment">// í˜„ì¬ HID êµ¬ê°„ ë‚´ ì°¨ëŸ‰ ìˆ˜ ì¡°íšŒ</span>
        String hidKey = <span class="keyword">this</span>.fabId + <span class="string">":"</span> + <span class="keyword">this</span>.mcpName 
                      + <span class="string">":"</span> + String.format(<span class="string">"%03d"</span>, hidId);
        <span class="keyword">int</span> vhlCnt = DataService.getDataSet().getHidVehicleCnt(hidKey);

        Tuple tuple = <span class="keyword">new</span> Tuple();
        tuple.put(<span class="string">"EVENT_DATE"</span>, eventDate);
        tuple.put(<span class="string">"EVENT_DT"</span>, eventDt);
        tuple.put(<span class="string">"HID_ID"</span>, hidId);
        tuple.put(<span class="string">"IN_CNT"</span>, inCnt);
        tuple.put(<span class="string">"OUT_CNT"</span>, outCnt);
        tuple.put(<span class="string">"VHL_CNT"</span>, vhlCnt);
        tuple.put(<span class="string">"MCP_NM"</span>, <span class="keyword">this</span>.mcpName);
        tuple.put(<span class="string">"ENV"</span>, Env.getEnv());

        tuples.add(tuple);
    }

    <span class="keyword">if</span> (tuples.isEmpty()) {
        <span class="keyword">return</span>;
    }

    <span class="comment">// FABIDë³„ í…Œì´ë¸”ì— ì €ì¥</span>
    String tableName = <span class="string">"ATLAS_"</span> + <span class="keyword">this</span>.fabId + <span class="string">"_HID_INOUT"</span>;

    <span class="keyword">boolean</span> success = LogpressoAPI.setInsertTuples(tableName, tuples, <span class="number">100</span>);

    <span class="keyword">if</span> (success) {
        logger.info(<span class="string">"HID IN/OUT aggregated: {} - {} records"</span>, 
                    tableName, tuples.size());
    }
}</code></pre>
        </section>

        <!-- Logpresso ì¿¼ë¦¬ -->
        <section id="queries">
            <h2>Logpresso ì¿¼ë¦¬ ì˜ˆì‹œ</h2>

            <h3>ê¸°ì´ˆì •ë³´ ì¡°íšŒ</h3>
            <pre><code><span class="comment">// HID Zone ë§ˆìŠ¤í„° ì •ë³´ ì „ì²´ ì¡°íšŒ</span>
table ATLAS_INFO_HID_INOUT
| sort HID_ID</code></pre>

            <h3>M14 ì¼ë³„ IN/OUT í†µê³„</h3>
            <pre><code><span class="comment">// M14 íŠ¹ì • ë‚ ì§œ HIDë³„ IN/OUT í•©ê³„</span>
table ATLAS_M14_HID_INOUT duration=1d
| search EVENT_DATE == <span class="string">"2026-01-30"</span>
| stats sum(IN_CNT) as TOTAL_IN, sum(OUT_CNT) as TOTAL_OUT by HID_ID
| sort HID_ID</code></pre>

            <h3>íŠ¹ì • HID êµ¬ê°„ ì‹œê°„ëŒ€ë³„ ì¶”ì´</h3>
            <pre><code><span class="comment">// M14 HID_ID=99 êµ¬ê°„ 1ë¶„ ë‹¨ìœ„ ì¶”ì´</span>
table ATLAS_M14_HID_INOUT duration=1d
| search HID_ID == <span class="number">99</span> and EVENT_DATE == <span class="string">"2026-01-30"</span>
| fields EVENT_DT, IN_CNT, OUT_CNT, VHL_CNT
| sort -EVENT_DT
| limit <span class="number">100</span></code></pre>

            <h3>ë§ˆìŠ¤í„° ì •ë³´ì™€ ì‹¤ì‹œê°„ ë°ì´í„° ì¡°ì¸</h3>
            <pre><code><span class="comment">// IN/OUT ì§‘ê³„ vs ìµœëŒ€ í—ˆìš© ì°¨ëŸ‰ ë¹„êµ</span>
table ATLAS_M14_HID_INOUT duration=1d
| search EVENT_DATE == <span class="string">"2026-01-30"</span>
| stats sum(IN_CNT) as TOTAL_IN, sum(OUT_CNT) as TOTAL_OUT, 
        max(VHL_CNT) as MAX_VHL by HID_ID
| join HID_ID [ table ATLAS_INFO_HID_INOUT | fields HID_ID, HID_NM, MCP_ID, ZONE_ID, VHL_MAX ]
| fields HID_ID, HID_NM, MCP_ID, ZONE_ID, VHL_MAX, TOTAL_IN, TOTAL_OUT, MAX_VHL
| sort HID_ID</code></pre>

            <h3>VHL_MAX ì´ˆê³¼ ì•ŒëŒ ê°ì§€</h3>
            <pre><code><span class="comment">// ìµœëŒ€ í—ˆìš© ì°¨ëŸ‰ ìˆ˜ ì´ˆê³¼ ì¼€ì´ìŠ¤ ì¡°íšŒ</span>
table ATLAS_M14_HID_INOUT duration=1d
| search EVENT_DATE == <span class="string">"2026-01-30"</span>
| join HID_ID [ table ATLAS_INFO_HID_INOUT | fields HID_ID, VHL_MAX ]
| search VHL_CNT > VHL_MAX
| fields EVENT_DT, HID_ID, VHL_CNT, VHL_MAX, MCP_NM
| sort -EVENT_DT</code></pre>
        </section>

        <!-- ìš”ì•½ -->
        <section id="summary">
            <h2>ìš”ì•½</h2>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <h4>ATLAS_INFO_HID_INOUT</h4>
                    <div class="summary-item">
                        <span class="summary-label">ìš©ë„</span>
                        <span class="summary-value">ê¸°ì´ˆì •ë³´ (ë§ˆìŠ¤í„°)</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì—…ë°ì´íŠ¸</span>
                        <span class="summary-value">í•˜ë£¨ 1íšŒ</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì†ŒìŠ¤</span>
                        <span class="summary-value">LAYOUT.XML</span>
                    </div>
                </div>
                <div class="summary-card">
                    <h4>ATLAS_M14_HID_INOUT</h4>
                    <div class="summary-item">
                        <span class="summary-label">ìš©ë„</span>
                        <span class="summary-value">M14 IN/OUT ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì—…ë°ì´íŠ¸</span>
                        <span class="summary-value">1ë¶„ ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì†ŒìŠ¤</span>
                        <span class="summary-value">ì‹¤ì‹œê°„ OHT ì´ë™</span>
                    </div>
                </div>
                <div class="summary-card">
                    <h4>ATLAS_M16_HID_INOUT</h4>
                    <div class="summary-item">
                        <span class="summary-label">ìš©ë„</span>
                        <span class="summary-value">M16 IN/OUT ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì—…ë°ì´íŠ¸</span>
                        <span class="summary-value">1ë¶„ ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì†ŒìŠ¤</span>
                        <span class="summary-value">ì‹¤ì‹œê°„ OHT ì´ë™</span>
                    </div>
                </div>
                <div class="summary-card">
                    <h4>ATLAS_M17_HID_INOUT</h4>
                    <div class="summary-item">
                        <span class="summary-label">ìš©ë„</span>
                        <span class="summary-value">M17 IN/OUT ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì—…ë°ì´íŠ¸</span>
                        <span class="summary-value">1ë¶„ ì§‘ê³„</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">ì†ŒìŠ¤</span>
                        <span class="summary-value">ì‹¤ì‹œê°„ OHT ì´ë™</span>
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <h4>ğŸ“ ìˆ˜ì • íŒŒì¼: OhtMsgWorkerRunnable.java</h4>
                <ul class="highlight-list">
                    <li><strong>ì¶”ê°€</strong>: <code>hidCountBuffer</code> í•„ë“œ (HIDë³„ IN/OUT ì¹´ìš´íŠ¸ ì§‘ê³„)</li>
                    <li><strong>ì¶”ê°€</strong>: <code>flushLock</code> í•„ë“œ (ë™ê¸°í™”ìš©)</li>
                    <li><strong>ì¶”ê°€</strong>: <code>flushHidCountBuffer()</code> ë©”ì†Œë“œ (1ë¶„ ì§‘ê³„ ì €ì¥)</li>
                    <li><strong>ìˆ˜ì •</strong>: <code>_calculatedVhlCnt()</code> ë©”ì†Œë“œ (IN/OUT ì¹´ìš´íŠ¸ ì§‘ê³„ ì¶”ê°€)</li>
                </ul>
            </div>
        </section>
    </div>
</body>
</html>