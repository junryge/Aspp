<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Smart ATLAS OHT 시스템 - 문서 종합 이해</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; background: #f5f5f5; line-height: 1.8; }
        h1 { background: linear-gradient(135deg, #1e3a5f, #2d5a87); color: white; padding: 25px; border-radius: 10px; margin-bottom: 30px; }
        h2 { color: #1e3a5f; border-bottom: 3px solid #667eea; padding-bottom: 10px; margin-top: 50px; font-size: 24px; }
        h3 { color: #2d5a87; margin-top: 30px; font-size: 18px; background: #e3f2fd; padding: 10px 15px; border-radius: 5px; }
        h4 { color: #333; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; vertical-align: top; }
        th { background: #1e3a5f; color: white; }
        tr:nth-child(even) { background: #f9f9f9; }
        .section { background: white; padding: 25px; border-radius: 10px; margin: 20px 0; box-shadow: 0 3px 10px rgba(0,0,0,0.1); }
        .flow-diagram { background: #1a1a2e; color: #00ff00; padding: 20px; font-family: 'Consolas', monospace; font-size: 12px; white-space: pre; overflow-x: auto; border-radius: 8px; line-height: 1.4; }
        .highlight { background: #fff3cd; padding: 15px; border-left: 5px solid #ffc107; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .important { background: #e8f5e9; padding: 15px; border-left: 5px solid #4caf50; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .warning { background: #ffebee; padding: 15px; border-left: 5px solid #f44336; margin: 15px 0; border-radius: 0 8px 8px 0; }
        .info { background: #e3f2fd; padding: 15px; border-left: 5px solid #2196f3; margin: 15px 0; border-radius: 0 8px 8px 0; }
        code { background: #e0e0e0; padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; }
        .formula { background: #f5f5f5; padding: 20px; border: 2px solid #667eea; border-radius: 8px; text-align: center; font-size: 18px; margin: 20px 0; }
        ul, ol { margin: 10px 0; padding-left: 25px; }
        li { margin: 8px 0; }
        .tag { display: inline-block; padding: 3px 10px; border-radius: 15px; font-size: 12px; margin-right: 5px; }
        .tag-source { background: #e3f2fd; color: #1565c0; }
        .tag-process { background: #f3e5f5; color: #7b1fa2; }
        .tag-storage { background: #e8f5e9; color: #2e7d32; }
        .toc { background: #fafafa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        .toc ul { list-style: none; padding-left: 0; }
        .toc li { padding: 5px 0; }
        .toc a { color: #1e3a5f; text-decoration: none; }
        .toc a:hover { text-decoration: underline; }
    </style>
</head>
<body>

<h1>🏭 Smart ATLAS OHT 시스템 - 3개 문서 종합 이해</h1>

<div class="section">
    <p><strong>📄 종합 대상 문서:</strong></p>
    <ul>
        <li>OHT_속도분석.MD (2025.08 버전)</li>
        <li>MCS_LOG_아키텍처.MD (2022.07 버전)</li>
        <li>OHT_VHL_분석.MD (2025.01 버전)</li>
    </ul>
    <p><strong>🎯 시스템 목적:</strong> 반도체 FAB의 OHT(Overhead Hoist Transport) 천장 이송 시스템의 속도 데이터를 실시간 수집, 계산, 분석하여 물류 최적화 지원</p>
</div>

<div class="toc">
    <h3>📑 목차</h3>
    <ul>
        <li><a href="#section1">1. 시스템 전체 구조 이해</a></li>
        <li><a href="#section2">2. 데이터 수집 및 통신 방식</a></li>
        <li><a href="#section3">3. 메시지 처리 Worker 구조</a></li>
        <li><a href="#section4">4. 속도(Velocity) 계산 로직</a></li>
        <li><a href="#section5">5. 데이터 저장소 (Logpresso 테이블)</a></li>
        <li><a href="#section6">6. Batch Job 처리</a></li>
        <li><a href="#section7">7. 경로 탐색 알고리즘</a></li>
        <li><a href="#section8">8. 주요 클래스 및 참조 관계</a></li>
        <li><a href="#section9">9. 설정 파일 구조</a></li>
        <li><a href="#section10">10. 용어 정리</a></li>
        <li><a href="#section11">11. UDP 프로토콜 정의서 (ID:2 Vehicle 상태 보고)</a></li>
    </ul>
</div>

<!-- Section 1 -->
<h2 id="section1">1. 시스템 전체 구조 이해</h2>
<div class="section">
    <h3>1.1 전체 데이터 흐름도</h3>
    <div class="flow-diagram">
┌──────────────────────────────────────────────────────────────────────────────────┐
│                        Smart ATLAS 시스템 전체 데이터 흐름                         │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                        │
│  │  M15A MCS   │     │  M15B MCS   │     │  smartSTAR  │                        │
│  │  APP1/APP2  │     │  APP1/APP2  │     │  APP1/APP2  │    ◄── 데이터 소스      │
│  │   DB1/DB2   │     │   DB1/DB2   │     │   DB1/DB2   │                        │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘                        │
│         │                   │                   │                                │
│         └───────────────────┼───────────────────┘                                │
│                             │                                                    │
│                    ┌────────▼────────┐                                          │
│                    │   smartATLAS    │                                          │
│                    │    (MCSLOG)     │    ◄── 중앙 처리 시스템                   │
│                    └────────┬────────┘                                          │
│                             │                                                    │
│         ┌───────────────────┼───────────────────┐                               │
│         ▼                   ▼                   ▼                               │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                        │
│  │ M15A OHT    │     │ M15B OHT    │     │ smartATLAS  │                        │
│  │  CLWMCP     │     │  CLWMCP     │     │     UI      │    ◄── 출력/제어       │
│  └─────────────┘     └─────────────┘     └─────────────┘                        │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────────┐
│                           상세 처리 흐름                                          │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  [1단계: 데이터 수신]                                                             │
│  ┌─────────────┐        ┌─────────────┐        ┌─────────────┐                  │
│  │   OHT MCP   │        │    MCS      │        │  smartSTAR  │                  │
│  │    (UDP)    │        │  (TIB/rv)   │        │    (DB)     │                  │
│  └──────┬──────┘        └──────┬──────┘        └──────┬──────┘                  │
│         │                      │                      │                          │
│         ▼                      ▼                      ▼                          │
│  OhtUdpListener         TIB/rv Listener        DB Connection                    │
│                                                                                  │
│  [2단계: 메시지 분배]                                                             │
│         └──────────────────────┼──────────────────────┘                          │
│                                ▼                                                 │
│                    ┌───────────────────────┐                                    │
│                    │  MessageDispatcher    │                                    │
│                    └───────────┬───────────┘                                    │
│                                │                                                 │
│  [3단계: Worker 처리]                                                             │
│    ┌───────────┬───────────┬───────────┬───────────┬───────────┐               │
│    ▼           ▼           ▼           ▼           ▼           │               │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐        │               │
│ │OhtMsg  │ │EiMsg   │ │TsMsg   │ │CnvMsg  │ │UiMsg   │        │               │
│ │Worker  │ │Worker  │ │Worker  │ │Worker  │ │Worker  │        │               │
│ └───┬────┘ └───┬────┘ └───┬────┘ └───┬────┘ └───┬────┘        │               │
│     │          │          │          │          │              │               │
│     │    processOhtReport()                                    │               │
│     ▼                                                          │               │
│  [4단계: 데이터 처리 및 계산]                                                     │
│  ┌─────────────────────────────────────────────────────────┐  │               │
│  │                  DataService.java                        │  │               │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐      │  │               │
│  │  │ DataSet.java│  │RailEdgeMap  │  │  VhlMap     │      │  │               │
│  │  │ (속도계산)  │  │             │  │             │      │  │               │
│  │  └─────────────┘  └─────────────┘  └─────────────┘      │  │               │
│  └─────────────────────────────────────────────────────────┘  │               │
│                                │                               │               │
│  [5단계: Batch 처리 및 저장]                                                     │
│                                ▼                                                │
│  ┌────────────────┐ ┌────────────────┐ ┌────────────────┐                      │
│  │ TrafficBatch   │ │BranchTraffic   │ │AreaVhlCount   │                      │
│  │   (3/10초)     │ │ Batch(4/10초)  │ │ Batch(6/10초) │                      │
│  └───────┬────────┘ └───────┬────────┘ └───────┬────────┘                      │
│          │                  │                  │                                │
│          └──────────────────┼──────────────────┘                                │
│                             ▼                                                   │
│  [6단계: 데이터 저장]                                                            │
│  ┌──────────────────────────────────────────────────────────────────┐          │
│  │                      Logpresso API / UDP                          │          │
│  ├──────────────────────────────────────────────────────────────────┤          │
│  │ ATLAS_RAW_DATA │ ATLAS_DATA │ ATLAS_ROUTE │ ATLAS_VEHICLE        │          │
│  │ ATLAS_RAIL_TRAFFIC │ ATLAS_BRANCH_TRAFFIC │ ATLAS_AREA_TRAFFIC   │          │
│  │ ATLAS_VHL_COUNT                                                   │          │
│  └──────────────────────────────────────────────────────────────────┘          │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
    </div>

    <h3>1.2 데이터 제공 소스별 역할</h3>
    <table>
        <tr>
            <th>소스</th>
            <th>제공 데이터</th>
            <th>프로토콜</th>
            <th>상세 설명</th>
        </tr>
        <tr>
            <td><strong>MCS</strong><br>(Material Control System)</td>
            <td>LOG(FTP/TIB), 반송 이벤트 Msg(TIB), 장비/재고상태(DB)</td>
            <td>TIB/rv, FTP</td>
            <td>자재 제어 시스템에서 반송 작업 관련 이벤트 및 로그 제공</td>
        </tr>
        <tr>
            <td><strong>OHT</strong><br>(Overhead Hoist Transport)</td>
            <td>OHT 반송 상태, Layout Data</td>
            <td>UDP, FTP</td>
            <td>천장 이송 장비의 실시간 위치, 상태, 속도 정보</td>
        </tr>
        <tr>
            <td><strong>smartSTAR</strong></td>
            <td>반송 이력 정보, smartFX DB</td>
            <td>DB</td>
            <td>과거 반송 이력 및 통계 데이터</td>
        </tr>
    </table>
</div>

<!-- Section 2 -->
<h2 id="section2">2. 데이터 수집 및 통신 방식</h2>
<div class="section">
    <h3>2.1 통신 방식 결정 로직</h3>
    <div class="info">
        <strong>통신 방식은 MCP Port 개수에 따라 자동 결정됩니다:</strong>
        <ul>
            <li><strong>MCP Port 0개 이하:</strong> TIB/rv 방식 → OhtTibrvListener 사용</li>
            <li><strong>MCP Port 1개 이상:</strong> UDP 방식 → OhtUdpListener 사용</li>
        </ul>
    </div>

    <h3>2.2 OHT Connect Listener 초기화 과정</h3>
    <div class="flow-diagram">
┌─────────────────────────────────────────────────────────────────────────────┐
│                     OHT Connect Listener 초기화 과정                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────┐                                                   │
│  │  DataService.java   │                                                   │
│  └──────────┬──────────┘                                                   │
│             │                                                               │
│             │ .getFabPropertiesMap()                                        │
│             ▼                                                               │
│  ┌─────────────────────────────────────────┐                               │
│  │  fab properties mapper 데이터 호출 (→ fp) │                               │
│  └──────────┬──────────────────────────────┘                               │
│             │                                                               │
│             │ .onStarted()                                                  │
│             ▼                                                               │
│  ┌─────────────────────────────────────────┐                               │
│  │     LauncherListener.java               │                               │
│  └──────────┬──────────────────────────────┘                               │
│             │                                                               │
│             │ fp.getMcpPropertiesMap()의 키 값을 통해 MCP 정보 취득           │
│             ▼                                                               │
│  ┌─────────────────────────────────────────┐                               │
│  │       MCP의 Port 갯수 확인               │                               │
│  └──────────┬──────────────────────────────┘                               │
│             │                                                               │
│      ┌──────┴──────┐                                                       │
│      │             │                                                       │
│   0개 이하      1개 이상                                                     │
│      │             │                                                       │
│      ▼             ▼                                                       │
│  ┌────────┐   ┌────────────┐                                               │
│  │TIB/RV  │   │    UDP     │                                               │
│  │ 방식   │   │    방식    │                                               │
│  └───┬────┘   └─────┬──────┘                                               │
│      │              │                                                       │
│      ▼              ▼                                                       │
│  ┌────────────────────────────────────────────────────────────────────┐    │
│  │ TIB/RV 방식:                    │ UDP 방식:                         │    │
│  │ 1. OhtTibrvListener 인스턴스 생성│ 1. OhtUdpListener 인스턴스 생성    │    │
│  │ 2. fabOhtListenerMap에 저장     │ 2. fabOhtUdpListenerMap에 저장    │    │
│  │ 3. Tib/rv init → start          │ 3. DatagramSocket으로 UDP 연결    │    │
│  └────────────────────────────────────────────────────────────────────┘    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
    </div>

    <h3>2.3 UDP 메시지 구조</h3>
    <div class="highlight">
        <strong>메시지 예시:</strong><br>
        <code>2,OHT,V00399,1,1,0000,1,4176,20,4177,4,4,4PDMG440,4011,00000000,0000,4ANZ16-404,4CSC1602_2,90,0,0,N4PDMG4402025020601541,B16,</code>
    </div>
    
    <table>
        <tr>
            <th>순서</th>
            <th>필드명</th>
            <th>설명</th>
            <th>예시값</th>
        </tr>
        <tr><td>1</td><td>message id</td><td>메시지 식별자</td><td>2</td></tr>
        <tr><td>2</td><td>mcp 명칭</td><td>MCP 이름</td><td>OHT</td></tr>
        <tr><td>3</td><td>vehicle 명칭</td><td>Vehicle ID</td><td>V00399</td></tr>
        <tr><td>4</td><td>상태</td><td>Vehicle 상태 코드</td><td>1</td></tr>
        <tr><td>5</td><td>재하 정보</td><td>적재 상태 (0=비적재, 1=적재)</td><td>1</td></tr>
        <tr><td>6</td><td>error code</td><td>에러 코드</td><td>0000</td></tr>
        <tr><td>7</td><td>통신 상태</td><td>통신 상태 코드</td><td>1</td></tr>
        <tr><td>8</td><td>현재 번지</td><td>현재 위치 주소</td><td>4176</td></tr>
        <tr><td>9</td><td>현재 번지에서의 거리</td><td>현재 번지 내 이동 거리 (mm)</td><td>20</td></tr>
        <tr><td>10</td><td>차 번지</td><td>다음 위치 주소</td><td>4177</td></tr>
        <tr><td>11</td><td>실행 cycle</td><td>실행 사이클 코드</td><td>4</td></tr>
        <tr><td>12</td><td>vehicle 실행 cycle 주기</td><td>사이클 주기 코드</td><td>4</td></tr>
        <tr><td>13</td><td>carrier id</td><td>Carrier 식별자</td><td>4PDMG440</td></tr>
        <tr><td>14</td><td>목적지</td><td>목적지 주소</td><td>4011</td></tr>
        <tr><td>15</td><td>E/M 상태</td><td>E/M 상태 코드</td><td>00000000</td></tr>
        <tr><td>16</td><td>group id</td><td>그룹 식별자</td><td>0000</td></tr>
    </table>
</div>

<!-- Section 3 -->
<h2 id="section3">3. 메시지 처리 Worker 구조</h2>
<div class="section">
    <h3>3.1 Worker별 역할</h3>
    <table>
        <tr>
            <th>Worker</th>
            <th>역할</th>
            <th>주요 처리 내용</th>
        </tr>
        <tr>
            <td><strong>OhtMsgWorker</strong></td>
            <td>OHT 메시지 처리</td>
            <td>VHL 상태 추적, RailEdge/TransferEdge 속도 Update, Carrier 위치 추적</td>
        </tr>
        <tr>
            <td><strong>EiMsgWorker</strong></td>
            <td>Command 처리</td>
            <td>Command 생성/완료 처리, Carrier 위치, RmEdge Cost Update</td>
        </tr>
        <tr>
            <td><strong>TsMsgWorker</strong></td>
            <td>Job 처리</td>
            <td>Job 생성/완료 처리</td>
        </tr>
        <tr>
            <td><strong>CnvMsgWorker</strong></td>
            <td>Conveyor 처리</td>
            <td>CnvTask 추적, Conveyor 상태 Update</td>
        </tr>
        <tr>
            <td><strong>UiMsgWorker</strong></td>
            <td>UI 상태 처리</td>
            <td>포트/장비 상태 Update, Job wakeup 처리</td>
        </tr>
    </table>

    <h3>3.2 processOhtReport() 핵심 처리 흐름</h3>
    <div class="important">
        <strong>processOhtReport()는 OhtMsgWorkerRunnable의 핵심 메서드로, UDP 메시지를 받아 Vehicle 상태 업데이트 및 속도 계산을 수행합니다.</strong>
    </div>

    <div class="flow-diagram">
┌─────────────────────────────────────────────────────────────────────────────┐
│              processOhtReport(token) 처리 흐름                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  processOhtReport(token)                                                    │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────────────────────┐                                           │
│  │ DataService.getVhlMap()에서 │                                           │
│  │ Vehicle 객체(v) 참조        │                                           │
│  └──────────────┬──────────────┘                                           │
│                 │                                                           │
│                 ▼                                                           │
│  ┌──────────────────────────────────┐                                      │
│  │  v(vehicle)의 VHL_STATE가 REMOVING? │                                      │
│  └──────────────┬───────────────────┘                                      │
│                 │                                                           │
│       ┌─────────┴─────────┐                                                │
│       │                   │                                                │
│      Yes                  No                                               │
│       │                   │                                                │
│       ▼                   ▼                                                │
│  ┌────────────────┐  ┌────────────────────────────────────────────────┐   │
│  │ REMOVING 처리  │  │              일반 처리 로직 (6단계)              │   │
│  ├────────────────┤  ├────────────────────────────────────────────────┤   │
│  │ 1. udpState    │  │ [1단계] UDP 통신에 따른 vehicle 정보 업데이트    │   │
│  │    초기화      │  │ [2단계] Rail Edge 정보 업데이트                  │   │
│  │ 2. rail에서    │  │ [3단계] 교차점 ID 비교 및 Logpresso 저장         │   │
│  │    vehicle 삭제│  │ [4단계] Command 및 Job 정보 처리                 │   │
│  │ 3. command삭제 │  │ [5단계] Route 정보 처리 및 상태 기록             │   │
│  │ 4. return      │  │ [6단계] 최종 계산 및 저장                        │   │
│  └────────────────┘  └────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
    </div>

    <h3>3.3 VhlUdpState 필드 정의</h3>
    <table>
        <tr>
            <th>필드명</th>
            <th>REMOVING 상태 값</th>
            <th>일반 상태 값</th>
            <th>설명</th>
        </tr>
        <tr><td>railNodeId</td><td>"" (빈값)</td><td>token에서 추출</td><td>현재 Rail Node ID</td></tr>
        <tr><td>udpCarrierId</td><td>""</td><td>token</td><td>UDP Carrier ID</td></tr>
        <tr><td>destStationId</td><td>""</td><td>token</td><td>목적지 Station ID</td></tr>
        <tr><td>distance</td><td>0</td><td>token</td><td>이동 거리</td></tr>
        <tr><td>isFull</td><td>False</td><td>token</td><td>적재 상태</td></tr>
        <tr><td>runCycle</td><td>RUN_CYCLE.NONE</td><td>token</td><td>실행 주기</td></tr>
        <tr><td>vhlCycle</td><td>VHL_CYCLE.NONE</td><td>token</td><td>Vehicle 주기</td></tr>
        <tr><td>state</td><td>VHL_STATE.REMOVING</td><td>token</td><td>Vehicle 상태</td></tr>
        <tr><td>receivedTime</td><td>receivedMilli</td><td>receivedMilli</td><td>수신 시간</td></tr>
        <tr><td>detailState</td><td>VHL_DET_STATE.NONE</td><td>token</td><td>상세 상태</td></tr>
    </table>
</div>

<!-- Section 4 -->
<h2 id="section4">4. 속도(Velocity) 계산 로직</h2>
<div class="section">
    <h3>4.1 기본 계산 공식</h3>
    <div class="formula">
        <strong>속도(ν) = 거리(Δx) / 시간(Δt) × 60.0</strong><br>
        <small>단위: m/min (미터/분)</small>
    </div>
    
    <ul>
        <li><strong>시간(Δt):</strong> 두 메시지의 수신 시간 차이 (초)</li>
        <li><strong>거리(Δx):</strong> Vehicle 위치에 따라 다른 방식 적용</li>
        <li><strong>×60.0:</strong> 초 단위를 분 단위로 변환</li>
    </ul>

    <h3>4.2 거리 계산 케이스</h3>
    <div class="info">
        <strong>※ α: 최근(현재) 수신 메시지 정보 / β: 이전(마지막) 수신 메시지 정보</strong>
    </div>

    <h4>Case 1: α의 시작점과 β의 도착지점이 동일한 경우 (연속된 RailEdge)</h4>
    <div class="formula">
        거리(Δx) = (β에 위치한 RailEdge의 길이) - (β의 현재 번지에서의 거리) + (α의 현재 번지에서의 거리)
    </div>

    <h4>Case 2: α, β가 서로 다른 RailEdge에 위치한 경우</h4>
    <div class="formula">
        거리(Δx) = (β의 시작점부터 α의 시작점까지의 거리 및 RailEdge 길이의 합) - (β의 현재 번지에서의 거리) + (α의 현재 번지에서의 거리)
    </div>
    <div class="highlight">
        <strong>Case 2의 경우 DijkstraVhlRouteFind 알고리즘으로 경로를 유추하여 거리 계산</strong>
    </div>

    <h3>4.3 계산 예시</h3>
    <table>
        <tr>
            <th>조건</th>
            <th>값</th>
        </tr>
        <tr><td>적용 케이스</td><td>Case 2 (서로 다른 RailEdge)</td></tr>
        <tr><td>RailEdge 길이</td><td>100mm, 200mm (가정)</td></tr>
        <tr><td>β의 현재 번지 거리</td><td>20mm</td></tr>
        <tr><td>α의 현재 번지 거리</td><td>0mm</td></tr>
        <tr><td>시간(Δt)</td><td>1초</td></tr>
    </table>
    <div class="formula">
        거리(Δx) = (100 + 200) - 20 + 0 = <strong>280mm</strong><br>
        속도(ν) = 280 / 1 × 60.0 = <strong>16,800 mm/min = 16.8 m/min</strong>
    </div>

    <h3>4.4 속도 계산 필수 조건 (5가지 - 모두 충족 필요)</h3>
    <div class="warning">
        <strong>아래 5가지 조건을 모두 충족해야만 속도 계산이 수행됩니다!</strong>
    </div>
    <table>
        <tr>
            <th>번호</th>
            <th>조건</th>
            <th>상세</th>
            <th>체크 필드</th>
        </tr>
        <tr>
            <td><strong>1</strong></td>
            <td>메시지 수신 시간 차이</td>
            <td>현재 vehicle과 최근 정보 비교 시 <strong>1분 미만</strong></td>
            <td>receivedTime</td>
        </tr>
        <tr>
            <td><strong>2</strong></td>
            <td>Vehicle 상태</td>
            <td><code>RUN(운전중)</code>, <code>OBS_STOP</code>, <code>JAM(정체)</code>, <code>E84_TIMEOUT</code> 중 하나</td>
            <td>state (VHL_STATE)</td>
        </tr>
        <tr>
            <td><strong>3</strong></td>
            <td>Cycle 일치</td>
            <td>현재 vehicle이 최근 정보와 <code>실행 cycle</code>, <code>vehicle 실행 cycle 주기</code>가 각각 동일</td>
            <td>runCycle, vhlCycle</td>
        </tr>
        <tr>
            <td><strong>4</strong></td>
            <td>실행 Cycle 값</td>
            <td><code>ACQUIRE(물품 집어올리기)</code>, <code>DEPOSIT(물품 내려놓기)</code> 중 하나</td>
            <td>runCycle (RUN_CYCLE)</td>
        </tr>
        <tr>
            <td><strong>5</strong></td>
            <td>Vehicle 실행 Cycle 주기</td>
            <td><code>ACQUIRE_MOVING(구원 이송 중)</code>, <code>DEPOSIT_MOVING(도매 이동)</code> 중 하나</td>
            <td>vhlCycle (VHL_CYCLE)</td>
        </tr>
    </table>

    <h3>4.5 속도 계산 플로우차트</h3>
    <div class="flow-diagram">
┌─────────────────────────────────────────────────────────────────────────────┐
│                           속도 계산 플로우차트                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  [UDP Message 수신]                                                         │
│         │                                                                   │
│         ▼                                                                   │
│  [Message를 통해 vehicle, railEdge 정보 취득]                               │
│         │                                                                   │
│         ▼                                                                   │
│  [5가지 필수 조건 확인] ──────────────────────────────┐                      │
│         │                                           │                      │
│         │ 모두 충족                              미충족│                      │
│         ▼                                           ▼                      │
│  [이전(최근) vehicle 정보 조회] ← lastUdpState   [속도 계산 SKIP]            │
│         │                                                                   │
│         ▼                                                                   │
│  [이전(최근) vehicle의 railEdge 정보 호출] ← lastRailEdge                   │
│         │                                                                   │
│         ▼                                                                   │
│  [현재 railEdge와 이전 railEdge 정보 비교]                                  │
│         │                                                                   │
│         ▼                                                                   │
│  ┌─────────────────────────────────────────────────────┐                   │
│  │  railEdge의 종점과 lastRailEdge의 시작점이 동일한가? │                   │
│  └─────────────────────────┬───────────────────────────┘                   │
│                   ┌────────┴────────┐                                      │
│                  Yes                No                                      │
│                   │                  │                                      │
│                   ▼                  ▼                                      │
│           [Case 1 계산]    [DijkstraVhlRouteFind로                          │
│                             경로 유추 후 Case 2 계산]                       │
│                   │                  │                                      │
│                   └────────┬─────────┘                                      │
│                            │                                                │
│                            ▼                                                │
│           [지수평활법 적용하여 속도 값 평활화]                               │
│                            │                                                │
│                            ▼                                                │
│           [각 구간(railEdge)별로 속도 값 저장]                              │
│                            │                                                │
│                            ▼                                                │
│           [RailEdge.java에 velocity 값 업데이트]                            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
    </div>

    <h3>4.6 속도 초기값 설정</h3>
    <h4>초기값 형성 시점</h4>
    <ul>
        <li>서버 최초 구동 시</li>
        <li><code>dataSetRefresh</code>를 통한 맵 데이터 업데이트 시 (매일 10시)</li>
    </ul>

    <h4>설정 파일 구조 (*.mcp75.cfg)</h4>
    <div class="highlight">
        <code>[MCP75_LAYOUT@SCH.1]<br>
        POINT = 1945, 0, 1946, 2017, 64, 0, 0, 0, 0, 0</code>
    </div>
    <table>
        <tr>
            <th>POINT 순서</th>
            <th>railEdge 속성</th>
            <th>설명</th>
            <th>예시값</th>
        </tr>
        <tr><td>1</td><td>address</td><td>레일의 시작점</td><td>1945</td></tr>
        <tr><td>2</td><td>stNo</td><td>station 번호</td><td>0</td></tr>
        <tr><td>3</td><td>leftAddress</td><td>레일의 좌측 끝점</td><td>1946</td></tr>
        <tr><td>4</td><td>leftDistance</td><td>레일의 좌측 길이</td><td>2017</td></tr>
        <tr><td>5</td><td>leftSpeed</td><td>레일의 좌측 속도 (level 키값)</td><td>64</td></tr>
        <tr><td>6</td><td>rightAddress</td><td>레일의 우측 끝점</td><td>0</td></tr>
        <tr><td>7</td><td>rightDistance</td><td>레일의 우측 길이</td><td>0</td></tr>
        <tr><td>8</td><td>rightSpeed</td><td>레일의 우측 속도</td><td>0</td></tr>
    </table>

    <h4>속도 초기값 결정 과정</h4>
    <ol>
        <li><code>[MCP75_VEHICLE]</code>의 <code>VHL_SPEED_TYPE</code> 값 확인 (예: "CLW07-2")</li>
        <li><code>[MCP75_VEHICLE_SPEED]</code>의 해당 하위 항목과 매칭</li>
        <li>POINT의 <code>leftSpeed</code>(또는 <code>rightSpeed</code>) 값을 level 키로 사용</li>
        <li>해당 level에 매칭되는 SPEED 값 취득</li>
    </ol>
    <div class="highlight">
        <code>[MCP75_VEHICLE]<br>
        VHL_SPEED_TYPE = "CLW07-2";<br><br>
        [MCP75_VEHICLE_SPEED]<br>
        &lt;CLW07-2&gt;<br>
        SPEED = 1, 1.5;      // level=1, 속도=1.5<br>
        SPEED = 60, 320;     // level=60, 속도=320<br>
        SPEED = 64, 320;     // level=64, 속도=320</code>
    </div>

    <h3>4.7 Factory별 Vehicle 길이</h3>
    <table>
        <tr>
            <th>Factory</th>
            <th>Vehicle 본체 (mm)</th>
            <th>추가 길이 (mm)</th>
            <th>총 길이 (mm)</th>
        </tr>
        <tr><td>M14*</td><td>784</td><td>300</td><td><strong>1084</strong></td></tr>
        <tr><td>M16*</td><td>943</td><td>300</td><td><strong>1243</strong></td></tr>
        <tr><td>기타 (ETC)</td><td>784</td><td>300</td><td><strong>1084</strong></td></tr>
    </table>
    <div class="info">
        이 Vehicle 길이는 <strong>density(밀도) 계산</strong>에 사용됩니다.
    </div>
</div>

<!-- Section 5 -->
<h2 id="section5">5. 데이터 저장소 (Logpresso 테이블)</h2>
<div class="section">
    <h3>5.1 테이블 목록 및 용도</h3>
    <table>
        <tr>
            <th>테이블명</th>
            <th>용도</th>
            <th>적재 주체</th>
        </tr>
        <tr><td>ATLAS_RAW_DATA</td><td>원시 데이터</td><td>-</td></tr>
        <tr><td>ATLAS_DATA</td><td>가공된 기본 데이터</td><td>-</td></tr>
        <tr><td>ATLAS_ROUTE</td><td>경로 정보</td><td>RouteItem.sendToLogpresso()</td></tr>
        <tr><td>ATLAS_VEHICLE</td><td>Vehicle 정보</td><td>saveVehicleToLogpresso()</td></tr>
        <tr><td>ATLAS_AREA_TRAFFIC</td><td>Area 단위 트래픽 정보 (속도 포함)</td><td>BranchTrafficBatch</td></tr>
        <tr><td>ATLAS_BRANCH_TRAFFIC</td><td>Branch 단위 트래픽 정보</td><td>BranchTrafficBatch</td></tr>
        <tr><td>ATLAS_RAIL_TRAFFIC</td><td>Rail 단위 트래픽 정보</td><td>TrafficBatch</td></tr>
        <tr><td>ATLAS_VHL_COUNT</td><td>Vehicle 수량 집계</td><td>AreaVhlCountBatch</td></tr>
    </table>

    <h3>5.2 ATLAS_AREA_TRAFFIC 컬럼 정의</h3>
    <table>
        <tr>
            <th>컬럼명</th>
            <th>설명</th>
            <th>예시</th>
        </tr>
        <tr><td>createTime</td><td>데이터 작성 및 저장 일자 (=BranchTrafficBatch.java 동작 시간)</td><td>1723082384000</td></tr>
        <tr><td>density</td><td>area 상 RailEdge의 vehicle 밀도<br><small>계산식: (vehicle 길이) × (현재 vehicle 수량) / {(RailEdge 길이) - (RailEdge 길이) % (vehicle 길이)}</small></td><td>0</td></tr>
        <tr><td>fabId</td><td>factory id</td><td>M11A</td></tr>
        <tr><td>id</td><td>area id</td><td>M11A:AR:B32-2</td></tr>
        <tr><td>passJobCnts</td><td>최근 1분, 2분, 3분, 4분, 5분 이내 area를 지나간 Job 수 (','로 구분)</td><td>0,0,0,0,0</td></tr>
        <tr><td>pathPredictQCnts</td><td>향후 1분, 2분, 3분, 4분, 5분 이내 area를 지나갈 것으로 예상되는 Job 수</td><td>0,0,1,0,0</td></tr>
        <tr><td>railTrafficInputCnt</td><td>area상의 vehicle이 DEPOSIT 혹은 assign command의 수</td><td>2</td></tr>
        <tr><td>railTrafficOutputCnt</td><td>area상의 vehicle이 ACQUIRE 혹은 assign command의 수</td><td>2</td></tr>
        <tr style="background:#e8f5e9;"><td><strong>speed</strong></td><td><strong>현재 BranchJoinEdge의 속도(m/min, 지수평활법)</strong></td><td><strong>117.71171</strong></td></tr>
        <tr><td>vhlCnt</td><td>현재 RailEdge의 vehicle 수량</td><td>0</td></tr>
    </table>

    <h3>5.3 ATLAS_BRANCH_TRAFFIC 컬럼 정의</h3>
    <table>
        <tr>
            <th>컬럼명</th>
            <th>설명</th>
            <th>예시</th>
        </tr>
        <tr><td>createTime</td><td>데이터 작성 및 저장 일자</td><td>1723082384000</td></tr>
        <tr><td>density</td><td>RailEdge의 vehicle 밀도</td><td>0</td></tr>
        <tr><td>edgeIds</td><td>BranchJoinEdge에 해당하는 RailEdge id 목록</td><td>["M11A:RE:A:M11A:RN:A:02258-M11A:RN:A:30081",...]</td></tr>
        <tr><td>elapsedTime</td><td>BranchJoinEdge를 통과하는 데 소요된 시간</td><td>4026</td></tr>
        <tr><td>fabId</td><td>factory id</td><td>M11A</td></tr>
        <tr><td>id</td><td>BranchJoinEdge id</td><td>M11A:BJE:M11A:RN:A:02258-0-M11A:RN:A:20513</td></tr>
        <tr><td>isAvailable</td><td>BranchJoinEdge의 사용 가능 여부 (LaneCut)</td><td>true</td></tr>
        <tr><td>jobCost</td><td>Job을 통해 산출해낸 vehicle의 통과 및 소요 시간</td><td>637.4399648145434</td></tr>
        <tr><td>length</td><td>BranchJoinEdge의 길이(mm)</td><td>3020</td></tr>
        <tr><td>mcpName</td><td>mcp 명칭</td><td>A</td></tr>
        <tr><td>passCnt</td><td>해당 BranchJoinEdge에서 최근 10초 간 vehicle 통과 수량</td><td>0</td></tr>
        <tr><td>passJobCnts</td><td>최근 1분, 2분, 3분, 4분, 5분 이내 지나간 Job 수</td><td>0,0,0,0,0</td></tr>
        <tr><td>pathPredictQCnts</td><td>향후 1분, 2분, 3분, 4분, 5분 이내 지나갈 것으로 예상되는 Job 수</td><td>0,0,0,0,0</td></tr>
        <tr><td>pathPredictQueueSizeAvg</td><td>pathPredictQCnts의 평균값</td><td>0</td></tr>
        <tr><td>railTrafficInOutCnt</td><td>railTrafficOutputCnt + railTrafficInputCnt의 합</td><td>1</td></tr>
    </table>

    <h3>5.4 ATLAS_RAIL_TRAFFIC 컬럼 정의</h3>
    <table>
        <tr>
            <th>컬럼명</th>
            <th>설명</th>
            <th>예시</th>
        </tr>
        <tr><td>absoluteVelocity</td><td>(RailEdge의 속도) / (RailEdge의 최대 속도)</td><td>1</td></tr>
        <tr><td>createTime</td><td>데이터 작성 및 저장 일자</td><td>1723082383001</td></tr>
        <tr><td>fabId</td><td>factory id</td><td>M11A</td></tr>
        <tr><td>isAvailable</td><td>RailEdge의 사용 가능 여부</td><td>true</td></tr>
        <tr><td>jobCost</td><td>Job을 통해 산출해낸 vehicle의 통과 및 소요 시간</td><td>637.4399648145434</td></tr>
        <tr style="background:#e8f5e9;"><td><strong>maxVelocity</strong></td><td><strong>RailEdge의 최대 속도</strong></td><td><strong>200</strong></td></tr>
        <tr><td>passCnt</td><td>RailEdge를 통과한 vehicle 수량</td><td>1</td></tr>
        <tr><td>predictUnder1minCnt</td><td>도착 시간이 1분 미만인 vehicle 수량</td><td>3</td></tr>
        <tr><td>predict1_2minCnt</td><td>도착 시간이 1분 이상, 2분 미만인 vehicle 수량</td><td>1</td></tr>
        <tr><td>predict2_3minCnt</td><td>도착 시간이 2분 이상, 3분 미만인 vehicle 수량</td><td>0</td></tr>
        <tr><td>predict3_4minCnt</td><td>도착 시간이 3분 이상, 4분 미만인 vehicle 수량</td><td>0</td></tr>
        <tr><td>predict4_5minCnt</td><td>도착 시간이 4분 이상, 5분 미만인 vehicle 수량</td><td>0</td></tr>
        <tr><td>predictOver5minCnt</td><td>도착 시간이 5분 이상인 vehicle 수량</td><td>0</td></tr>
        <tr><td>predictQueueAllCnt</td><td>도착이 예상되는 vehicle 수량 (=predict* 값의 전체 합)</td><td>5</td></tr>
        <tr><td>railEdgeId</td><td>RailEdge id</td><td>M11B:RE:B:M11B:RN:B:05235-M11B:RN:B:05234</td></tr>
        <tr><td>vhlAbnormalCnt</td><td>RailEdge 상 ABNORMAL 상태인 vehicle의 수량</td><td>0</td></tr>
        <tr><td>vhlAcquireMovingCnt</td><td>RailEdge 상 ACQUIRE 상태인 vehicle의 수량</td><td>0</td></tr>
    </table>

    <h3>5.5 Logpresso INSERT 메서드</h3>
    <table>
        <tr>
            <th>메서드</th>
            <th>정의 위치</th>
            <th>테이블</th>
            <th>데이터 내용</th>
        </tr>
        <tr>
            <td>JsonUtil.insertJsonArrayDataToLogpresso()</td>
            <td>JsonUtil.java</td>
            <td>'tblNm' 값으로 동적 결정</td>
            <td>OhtRegBjData, OhtRegData</td>
        </tr>
        <tr>
            <td>_.sendToLogpresso()</td>
            <td>RouteItem.java</td>
            <td>ATLAS_ROUTE</td>
            <td>Route Item 정보</td>
        </tr>
        <tr>
            <td>_.saveVehicleToLogpresso()</td>
            <td>OhtMsgWorkerRunnable.java</td>
            <td>ATLAS_VEHICLE</td>
            <td>Vehicle 정보</td>
        </tr>
    </table>
</div>

<!-- Section 6 -->
<h2 id="section6">6. Batch Job 처리</h2>
<div class="section">
    <h3>6.1 트래픽 관련 Batch</h3>
    <table>
        <tr>
            <th>Batch</th>
            <th>주기</th>
            <th>내용</th>
            <th>적재 테이블</th>
        </tr>
        <tr>
            <td><strong>TrafficBatch</strong></td>
            <td>3/10초</td>
            <td>RailEdge별 통계</td>
            <td>ATLAS_RAIL_TRAFFIC</td>
        </tr>
        <tr>
            <td><strong>BranchTrafficBatch</strong></td>
            <td>4/10초</td>
            <td>BranchJoinEdge/Area 통계</td>
            <td>ATLAS_BRANCH_TRAFFIC, ATLAS_AREA_TRAFFIC</td>
        </tr>
        <tr>
            <td><strong>AreaVhlCountBatch</strong></td>
            <td>6/10초</td>
            <td>Area별 VHL 수량 집계</td>
            <td>ATLAS_VHL_COUNT</td>
        </tr>
        <tr>
            <td><strong>VhlBatch</strong></td>
            <td>1분</td>
            <td>전체 VHL 상태</td>
            <td>Logpresso</td>
        </tr>
    </table>

    <h3>6.2 기타 주요 Batch</h3>
    <table>
        <tr>
            <th>Batch</th>
            <th>주기</th>
            <th>내용</th>
        </tr>
        <tr><td>DataSetRefreshBatch</td><td>매일 10시</td><td>Layout/장비/Port 정보 갱신, 초기 속도값 업데이트</td></tr>
        <tr><td>LaneCutRefreshBatch</td><td>5/10초</td><td>FTP로 lanecut.dat 파일 갱신</td></tr>
        <tr><td>HelloBatch</td><td>1분</td><td>Old Job Cleaning, Garbage Route Cleaning</td></tr>
        <tr><td>PredictionClean</td><td>5/10초</td><td>만료된 pathPredictQueue 제거</td></tr>
        <tr><td>ServerStatusBatch</td><td>2초</td><td>CPU, Memory, Thread 상태 집계</td></tr>
        <tr><td>ObjOnMapDiffUpdateBatch</td><td>1초</td><td>OHT, Command 통계 적재</td></tr>
        <tr><td>ObjOnMapUpdateBatch</td><td>30초</td><td>Port, Eqp별 상태 적재</td></tr>
        <tr><td>BridgeEqpMonitorBatch</td><td>1분</td><td>Lifter/Conveyor 처리량, 부하상태, 소요시간 모니터링</td></tr>
    </table>
</div>

<!-- Section 7 -->
<h2 id="section7">7. 경로 탐색 알고리즘</h2>
<div class="section">
    <h3>7.1 변형 Dijkstra 알고리즘</h3>
    <div class="important">
        smartATLAS는 <strong>변형된 Dijkstra 알고리즘</strong>을 사용합니다.
    </div>
    
    <h4>문제점</h4>
    <p>RailNode와 Station을 통한 포트 연결이 복잡하여 일반 Dijkstra로는 경로탐색 불가능한 경우 발생</p>
    
    <h4>해결책</h4>
    <p>TransferEdge_Acquire를 통과 시, 동일 RailEdge상에서는 offset이 더 큰 쪽으로만 방문 가능하도록 제한. 이후 해당 노드를 미방문 처리하여 다시 방문 가능하도록 함</p>

    <h3>7.2 Edge Cost 계산</h3>
    <table>
        <tr>
            <th>메서드</th>
            <th>설명</th>
            <th>용도</th>
        </tr>
        <tr><td>getCost(carrierId)</td><td>지수평활법 평균 속도 기반 소요시간</td><td>UI 속도 표시</td></tr>
        <tr><td>getPPCost()</td><td>PathPredictQueue 수량 × 60ms 추가</td><td>N:1 소요시간 계산</td></tr>
        <tr><td>getVhlCountCost()</td><td>현재 VHL 수량 기반 penalty</td><td>VHL Assign 예측</td></tr>
        <tr><td>getLast1HourCost()</td><td>최근 1시간 평균 통과 소요시간</td><td>FutureCost 대체</td></tr>
    </table>

    <h3>7.3 FutureCost 계산 공식</h3>
    <div class="formula">
        FutureCost = baseCost<br>
        + (futureTransCnt × transWeight)<br>
        + (futureAcqCnt × acqTransWeight)<br>
        + (futureDpstCnt × dpstTransWeight)<br>
        + Junction penalty (있는 경우)
    </div>

    <h3>7.4 ML/DL 보정</h3>
    <div class="info">
        PathPredictQueue의 시간대별 분포가 균일하지 않아 (1~3분 이내 많음) 예측시간과 실제 소요시간 차이가 큼. <strong>AtlasPredictEnhanceTibrvReq</strong>를 통해 ML/DL 보정 수행.
    </div>
</div>

<!-- Section 8 -->
<h2 id="section8">8. 주요 클래스 및 참조 관계</h2>
<div class="section">
    <h3>8.1 전체 클래스 역할</h3>
    <table>
        <tr>
            <th>클래스명</th>
            <th>역할</th>
            <th>비고</th>
        </tr>
        <tr><td>OhtUdpListener.java</td><td>MCP로부터 UDP 메시지 수신</td><td>DatagramSocket 사용</td></tr>
        <tr><td>OhtTibrvListener.java</td><td>TIB/rv 메시지 수신</td><td>MCP Port 0개 이하일 때</td></tr>
        <tr><td>OhtMsgWorkerRunnable.java</td><td>수신한 UDP 메시지를 Queue에 적재, processOhtReport() 실행</td><td>핵심 처리 클래스</td></tr>
        <tr><td>DataSet.java</td><td>Queue 데이터를 사용해 속도(velocity) 값 계산</td><td>지수평활법 적용</td></tr>
        <tr><td>RailEdge.java</td><td>RailEdge 객체 단위로 속도 값 저장</td><td>개별 레일 구간</td></tr>
        <tr><td>RailEdgeMap</td><td>RailEdge 객체들의 맵 구조</td><td>전체 레일 구간 맵핑</td></tr>
        <tr><td>DataService.java</td><td>DataSet의 인스턴스 관리</td><td>싱글톤 패턴</td></tr>
        <tr><td>LauncherListener.java</td><td>시스템 시작 리스너</td><td>onStarted() 이벤트 처리</td></tr>
        <tr><td>DijkstraVhlRouteFind.class</td><td>시작점~목적지 경로 탐색</td><td>다익스트라 알고리즘</td></tr>
        <tr><td>DfkRoutePlanUpdate.java</td><td>Rail 방향 및 노드 목록 업데이트</td><td>defaultDir, railNodeList 관리</td></tr>
        <tr><td>BranchTrafficBatch.java</td><td>areaTraffic/branchTraffic 데이터 구성 및 전송</td><td>4/10초 주기</td></tr>
        <tr><td>TrafficBatch.java</td><td>railTraffic 데이터 구성 및 전송</td><td>3/10초 주기</td></tr>
        <tr><td>AreaVhlCountBatch.java</td><td>areaVhlCountBatch 데이터 구성 및 전송</td><td>6/10초 주기</td></tr>
    </table>

    <h3>8.2 클래스 참조 관계</h3>
    <div class="flow-diagram">
┌─────────────────────────────────────────────────────────────────────────────┐
│              processOhtReport() 클래스 참조 관계                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                      processOhtReport(token)                                │
│                              │                                              │
│              ┌───────────────┼───────────────┐                             │
│              │               │               │                             │
│              ▼               ▼               ▼                             │
│       ┌─────────────┐ ┌─────────────┐ ┌──────────────────┐                │
│       │RailEdge.java│ │  Vhl.java   │ │VhlUdpState.class │                │
│       └──────┬──────┘ └──────┬──────┘ └──────────────────┘                │
│              │               │                                             │
│              │               └─────────┐                                   │
│              │                         │                                   │
│              │ .getRailEdgeMap()       │ .getVhlMap()                      │
│              │ .getEdgeMap()           │                                   │
│              │                         │                                   │
│              └────────────┬────────────┘                                   │
│                           │                                                │
│                           ▼                                                │
│                  ┌─────────────────┐                                       │
│                  │ DataService.java │                                       │
│                  │   (싱글톤)       │                                       │
│                  └─────────────────┘                                       │
│                           │                                                │
│           ┌───────────────┼───────────────┐                               │
│           ▼               ▼               ▼                               │
│    .getVhlMap()    .getRailEdgeMap()  .getNodeMap()                        │
│    .getEdgeMap()   .getStationPortMap()  .getFabPropertiesMap()            │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
    </div>

    <h3>8.3 RailEdge ID 명명 규칙</h3>
    <div class="highlight">
        <code>M16A:RE:BR:M16A:RN:BR:01945-M16A:RN:BR:01946</code>
    </div>
    <table>
        <tr>
            <th>위치</th>
            <th>값</th>
            <th>설명</th>
        </tr>
        <tr><td>1</td><td>M16A</td><td>Factory ID</td></tr>
        <tr><td>2</td><td>RE</td><td>Rail Edge 표시</td></tr>
        <tr><td>3</td><td>BR</td><td>층 정보 (BR=Bridge/3층/Hubroom, RN=일반)</td></tr>
        <tr><td>4</td><td>M16A</td><td>Factory ID (반복)</td></tr>
        <tr><td>5</td><td>RN</td><td>Rail Node 표시</td></tr>
        <tr><td>6</td><td>BR</td><td>층 정보</td></tr>
        <tr><td>7</td><td>01945</td><td>시작점(from) 주소</td></tr>
        <tr><td>8</td><td>-</td><td>구분자</td></tr>
        <tr><td>9</td><td>M16A:RN:BR:01946</td><td>끝점(to) 정보</td></tr>
    </table>
</div>

<!-- Section 9 -->
<h2 id="section9">9. 설정 파일 구조</h2>
<div class="section">
    <h3>9.1 공통 설정</h3>
    <table>
        <tr>
            <th>속성</th>
            <th>설명</th>
            <th>값 예시</th>
        </tr>
        <tr><td>Env</td><td>환경 설정 (TIB/rv Subject 생성에 영향)</td><td>REAL / TEST / QA</td></tr>
        <tr><td>FabIdList</td><td>MCS기준 FAB ID 목록 (콤마 구분)</td><td>M15A,M15B</td></tr>
        <tr><td>ProcessType</td><td>프로세스 타입</td><td>DATAMAKER(수집서버) / QUERY(Logpresso Query 전용)</td></tr>
    </table>

    <h3>9.2 수집서버 설정</h3>
    <table>
        <tr>
            <th>속성</th>
            <th>설명</th>
        </tr>
        <tr><td>Atlas.Daemon</td><td>Atlas tib/rv 통신용 daemon 서버</td></tr>
        <tr><td>Atlas.Gid</td><td>cmessage 통신 그룹 ID</td></tr>
        <tr><td>Atlas.ThreadPool.size</td><td>Worker Thread 수량 (CPU 코어 수)</td></tr>
        <tr><td>Atlas.MonitoringMode</td><td>Y/N (CPU 부하 함수 Disable)</td></tr>
        <tr><td>Logpresso.Host / Host2</td><td>Logpresso 서버 주소 (이중화)</td></tr>
        <tr><td>Logpresso.UdpHost / UdpHost2</td><td>UDP 전송 Target 주소</td></tr>
        <tr><td>Logpresso.UdpPort</td><td>UDP 전송 Port</td></tr>
    </table>

    <h3>9.3 FAB별 설정</h3>
    <table>
        <tr>
            <th>속성</th>
            <th>설명</th>
        </tr>
        <tr><td>[FABID].FacId</td><td>Factory ID (M14A → M14)</td></tr>
        <tr><td>[FABID].BridgeFrom</td><td>다른 FAB에서 연결되는 Bridge 장비 목록</td></tr>
        <tr><td>[FABID].BridgeTo</td><td>다른 FAB에 연결하는 Bridge 장비 목록</td></tr>
        <tr><td>[FABID].MapDir</td><td>OHT Map 폴더 경로</td></tr>
        <tr><td>[FABID].daemon</td><td>MCS 통신 메시지 Listen용 rvd daemon 주소</td></tr>
        <tr><td>[FABID].ei.subject</td><td>MCS EI 프로세스 메시지 Listen Subject</td></tr>
        <tr><td>[FABID].oht.[MCP].port</td><td>CLWMCP UDP Port</td></tr>
        <tr><td>[FABID].oht.[MCP].ftp.*</td><td>CLWMCP FTP 설정 (lanecut, mcp75, station, route, layout)</td></tr>
    </table>
</div>

<!-- Section 10 -->
<h2 id="section10">10. 용어 정리</h2>
<div class="section">
    <table>
        <tr>
            <th>용어</th>
            <th>영문</th>
            <th>설명</th>
        </tr>
        <tr><td>OHT</td><td>Overhead Hoist Transport</td><td>반도체 FAB 천장 이송 시스템</td></tr>
        <tr><td>MCP</td><td>Material Control Point</td><td>자재 제어 포인트</td></tr>
        <tr><td>MCS</td><td>Material Control System</td><td>자재 제어 시스템</td></tr>
        <tr><td>MHS</td><td>Material Handling System</td><td>자재 반송 시스템</td></tr>
        <tr><td>VHL</td><td>Vehicle</td><td>OHT 운반체 (V00001, V00399 등)</td></tr>
        <tr><td>RailEdge</td><td>-</td><td>레일의 한 구간 (시작점 → 끝점)</td></tr>
        <tr><td>BranchJoinEdge</td><td>-</td><td>여러 RailEdge를 묶은 분기/병합 구간</td></tr>
        <tr><td>LongEdge</td><td>-</td><td>Branch~Junction 사이 RailEdge 집합</td></tr>
        <tr><td>Carrier</td><td>-</td><td>Vehicle이 운반하는 FOUP 등의 용기</td></tr>
        <tr><td>FOUP</td><td>Front Opening Unified Pod</td><td>웨이퍼 운반 용기</td></tr>
        <tr><td>ACQUIRE</td><td>-</td><td>물품을 집어 올리는 동작/사이클</td></tr>
        <tr><td>DEPOSIT</td><td>-</td><td>물품을 내려놓는 동작/사이클</td></tr>
        <tr><td>FAB</td><td>Fabrication facility</td><td>반도체 생산 시설</td></tr>
        <tr><td>STK</td><td>Stocker</td><td>저장 장비 (Shelf로 Carrier 저장)</td></tr>
        <tr><td>STB</td><td>Side Track Buffer</td><td>측면 버퍼</td></tr>
        <tr><td>FIO</td><td>Factory I/O</td><td>AMHS 입출고 장치</td></tr>
        <tr><td>RM</td><td>RackMaster/Crane</td><td>Stocker 내부 반송 장치</td></tr>
        <tr><td>CLWMCP</td><td>-</td><td>OHT 제어 장비</td></tr>
        <tr><td>TIB/rv</td><td>TIBCO Rendezvous</td><td>메시지 통신 프로토콜</td></tr>
        <tr><td>Logpresso</td><td>-</td><td>로그 수집 및 분석 플랫폼</td></tr>
        <tr><td>Junction</td><td>-</td><td>합류점</td></tr>
        <tr><td>Branch</td><td>-</td><td>분기점</td></tr>
        <tr><td>LaneCut</td><td>-</td><td>레일 구간 차단</td></tr>
        <tr><td>PathPredictQueue</td><td>-</td><td>경로 예측 대기열</td></tr>
    </table>
</div>

<!-- Section 11 -->
<h2 id="section11">11. UDP 프로토콜 정의서 (ID:2 Vehicle 상태 보고)</h2>
<div class="section">
    <div class="info">
        <strong>📡 OCS → OSS Vehicle 상태 보고 메시지 정의</strong><br>
        이 섹션은 OHT 시스템에서 사용되는 UDP 프로토콜 ID:2 메시지의 상세 필드 정의를 포함합니다.
    </div>

    <h3>11.1 기본 데이터 항목</h3>
    <table>
        <tr><th>데이터 항목</th><th>내용</th></tr>
        <tr><td><strong>텍스트 ID</strong></td><td>2</td></tr>
        <tr><td><strong>MCP 명칭</strong></td><td>각 MCP7의 명칭(유니크)</td></tr>
        <tr><td><strong>Vehicle 명</strong></td><td>Vehicle 식별하기 위한 명칭</td></tr>
    </table>

    <h3>11.2 상태 코드</h3>
    <table>
        <tr><th>코드</th><th>상태</th></tr>
        <tr><td>"1"</td><td>운전 중</td></tr>
        <tr><td>"2"</td><td>정지 중</td></tr>
        <tr><td>"3"</td><td>이상</td></tr>
        <tr><td>"4"</td><td>수동</td></tr>
        <tr><td>"5"</td><td>수출 중</td></tr>
        <tr><td>"6"</td><td>OBS-STOP/BZ-STOP</td></tr>
        <tr><td>"7"</td><td>정체</td></tr>
        <tr><td>"9"</td><td>E84 Timeout</td></tr>
        <tr><td>"10"</td><td>주회 없음 E84 Timeout</td></tr>
        <tr><td>"11"</td><td>HT-STOP</td></tr>
    </table>

    <h3>11.3 재하 정보</h3>
    <table>
        <tr><th>코드</th><th>내용</th></tr>
        <tr><td>"0"</td><td>재하 없음</td></tr>
        <tr><td>"1"</td><td>재하 있음</td></tr>
    </table>

    <h3>11.4 Error Code</h3>
    <ul>
        <li><strong>범위:</strong> "0000" ~ "FFFF"</li>
        <li><strong>비고:</strong> 상태가 "3" 이외인 경우 "0000"을 설정한다</li>
    </ul>

    <h3>11.5 통신 상태</h3>
    <table>
        <tr><th>코드</th><th>내용</th></tr>
        <tr><td>"1"</td><td>정상</td></tr>
        <tr><td>"2"</td><td>통신 끊김</td></tr>
    </table>

    <h3>11.6 위치 정보</h3>
    <table>
        <tr><th>항목</th><th>설명</th></tr>
        <tr><td><strong>현재 번지</strong></td><td>현재 번지를 알 수 없는 경우 아무것도 설정되지 않음</td></tr>
        <tr><td><strong>현재번지로부터의 거리</strong></td><td>현재 번지로부터의 거리(100mm 단위). 현재 번지를 알 수 없는 경우 아무것도 설정되지 않음</td></tr>
        <tr><td><strong>다음번지</strong></td><td>다음 번지를 알 수 없는 경우 아무것도 설정되지 않음</td></tr>
    </table>

    <h3>11.7 실행 Cycle</h3>
    <table>
        <tr><th>코드</th><th>내용</th></tr>
        <tr><td>"0"</td><td>Cycle 없음</td></tr>
        <tr><td>"1"</td><td>위치 확인 Cycle 중</td></tr>
        <tr><td>"2"</td><td>이동 Cycle 중</td></tr>
        <tr><td>"3"</td><td>Unload Cycle 중</td></tr>
        <tr><td>"4"</td><td>Load Cycle 중</td></tr>
        <tr><td>"5"</td><td>수출 Cycle 중</td></tr>
        <tr><td>"9"</td><td>승간 이동 Cycle 중</td></tr>
        <tr><td>"21"</td><td>주회 주행 Cycle 중</td></tr>
    </table>

    <h3>11.8 Vehicle 실행 Cycle 진척</h3>
    <div class="highlight">
        ※ 실행 Cycle이 "0"~"5"인 경우만 유효, 그 외에는 아무것도 설정되지 않음
    </div>
    <table>
        <tr><th>코드</th><th>내용</th></tr>
        <tr><td>"0"</td><td>실행 Cycle 없음</td></tr>
        <tr><td>"1"</td><td>이동 중</td></tr>
        <tr><td>"2"</td><td>Unload 이동 중</td></tr>
        <tr><td>"3"</td><td>Unload 이재 중</td></tr>
        <tr><td>"4"</td><td>Load 이동 중</td></tr>
        <tr><td>"5"</td><td>Load 이재 중</td></tr>
        <tr><td>"7"</td><td>대체 지시 대기</td></tr>
    </table>

    <h3>11.9 Carrier/Destination 정보</h3>
    <table>
        <tr><th>항목</th><th>설명</th></tr>
        <tr><td><strong>Carrier ID</strong></td><td>현재 반송 중, 반송 예정 Carrier ID. 관련 Carrier ID가 없는 경우는 아무것도 설정되지 않음</td></tr>
        <tr><td><strong>Destination</strong></td><td>목적지 Station 번호. 목적지 Station이 없거나 알 수 없는 경우에는 아무것도 설정되지 않음</td></tr>
    </table>

    <h3>11.10 E/M 상태</h3>
    <ul>
        <li><strong>기본값:</strong> "0000000"</li>
        <li><strong>설명:</strong> E/M 상태를 Bit 배치로 설정</li>
        <li><strong>포함 항목:</strong> 방전 표시, 작동 가능 출력, 배터리 수명, Refresh 충전 요구, 배터리 용량 Warning</li>
    </ul>

    <h3>11.11 GroupID</h3>
    <ul>
        <li><strong>표현:</strong> GroupName으로 표현</li>
        <li><strong>유효 문자열:</strong> ["A"~"Z"]["a"~"z"]["0"~"9"]</li>
        <li><strong>기본값:</strong> GroupID가 없는 경우 "0000"으로 설정</li>
    </ul>

    <h3>11.12 Port 정보</h3>
    <table>
        <tr><th>항목</th><th>설명</th></tr>
        <tr><td><strong>반송원 Port</strong></td><td>반송원 Port ID. 관련 Port ID가 없으면 아무것도 설정되지 않음</td></tr>
        <tr><td><strong>반송처 Port</strong></td><td>반송처 Port ID. 관련 Port ID가 없으면 아무것도 설정되지 않음</td></tr>
    </table>

    <h3>11.13 반송 우선도</h3>
    <table>
        <tr><th>값</th><th>설명</th></tr>
        <tr><td>0~99</td><td>범위</td></tr>
        <tr><td>"0"</td><td>무효</td></tr>
        <tr><td>"1"</td><td>최저 우선순위</td></tr>
        <tr><td>"99"</td><td>최고 우선순위</td></tr>
    </table>

    <h3>11.14 작업 상태 상세</h3>
    <div class="highlight">
        ※ 실행 Cycle이 다음과 같은 경우에만 유효: "0":Cycle 없음, "2":이동 Cycle 중
    </div>
    <table>
        <tr><th>코드</th><th>내용</th></tr>
        <tr><td>"0"</td><td>작업 없음</td></tr>
        <tr><td>"1"</td><td>대기 중</td></tr>
        <tr><td>"2"</td><td>STAGE 대기 중</td></tr>
        <tr><td>"3"</td><td>Standby 대기 중</td></tr>
        <tr><td>"4"</td><td>반송 Load 허가 없음 대기 중</td></tr>
        <tr><td>"5"</td><td>Carrier 회수 대기 대기 중</td></tr>
        <tr><td>"6"</td><td>MAP 전송 대기 중</td></tr>
        <tr><td>"101"</td><td>이동 중</td></tr>
        <tr><td>"102"</td><td>Parking UTS 주행 중</td></tr>
        <tr><td>"103"</td><td>STAGE 이동 중</td></tr>
        <tr><td>"104"</td><td>Standby 이동 중</td></tr>
        <tr><td>"105"</td><td>Balance에 의해 이동 중</td></tr>
        <tr><td>"106"</td><td>Parking에 의해 이동 중</td></tr>
        <tr><td>"107"</td><td>Forecast 이동 중 (Config 설정에서 활성화/비활성화 설정 가능)</td></tr>
        <tr><td>"108"</td><td>세차 이동 중 (Config 설정에서 활성화/비활성화 설정 가능)</td></tr>
    </table>

    <h3>11.15 추가 항목</h3>
    <table>
        <tr><th>항목</th><th>설명</th></tr>
        <tr><td><strong>대차 주행거리</strong></td><td>대차가 Cycle 개시 후/주행로 변경 후부터 도착까지 주행한 거리(mm). 대차가 목적지에 도착했을 때 Set 한다. 도착 이외의 상태, 주행하지 않은 경우, 주행거리 불명인 경우 0이 설정됨</td></tr>
        <tr><td><strong>Command ID</strong></td><td>반송 Command ID</td></tr>
        <tr><td><strong>Bay 명칭</strong></td><td>VHL 현재 위치의 Bay 명칭</td></tr>
        <tr><td><strong>도착 예상 시간(ETA)</strong></td><td>경로 확정 시 VHL 도착 예상시간(msec). ※도착 예상 시간은 경로 확정 시 시간으로 실시간 갱신되지 않음</td></tr>
        <tr><td><strong>예약 Command ID</strong></td><td>예약 중인 반송 Command ID (Config 설정에서 활성화/비활성화 설정 가능)</td></tr>
    </table>
</div>

<div class="section" style="background: #fff3cd; border: 2px solid #ffc107;">
    <h2>⚠️ 문서 간 주의사항</h2>
    <ul>
        <li><strong>문서 버전 차이:</strong> MCS_LOG_아키텍처(2022.07) vs OHT_속도분석(2025.08) vs OHT_VHL_분석(2025.01) - 최신 버전 확인 필요</li>
        <li><strong>속도 계산 예시 불일치:</strong> OHT_속도분석.MD에서 속도=280 표기, 실제 공식 적용 시 280×60=16,800 mm/min (16.8 m/min)</li>
        <li><strong>추가 구현 필요 사항:</strong> 장애 Case별 대응 방안, 패치/배포 절차서, UI 동작 구조 설명 등 미구현</li>
    </ul>
</div>

<footer style="text-align: center; padding: 30px; color: #666; margin-top: 50px; border-top: 1px solid #ddd;">
    <p>작성일: 2025년 | Smart ATLAS OHT 시스템 문서 종합</p>
</footer>

</body>
</html>