import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')

# í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

class FilterDataAnalyzer:
    def __init__(self, file_path):
        """CSV íŒŒì¼ ê²½ë¡œë¥¼ ë°›ì•„ ì´ˆê¸°í™”"""
        self.df = self.load_and_prepare_data(file_path)
        
    def load_and_prepare_data(self, file_path):
        """CSV íŒŒì¼ ë¡œë“œ ë° ì „ì²˜ë¦¬"""
        # CSV íŒŒì¼ ì½ê¸°
        df = pd.read_csv(file_path, encoding='utf-8-sig')
        
        # ì»¬ëŸ¼ëª… ì •ë¦¬ (ê³µë°± ì œê±°)
        df.columns = df.columns.str.strip()
        
        # timestampë¥¼ datetimeìœ¼ë¡œ ë³€í™˜
        df['timestamp'] = pd.to_datetime(df['ì‹œê°„'])
        
        # ì‹œê°„ ê´€ë ¨ ì»¬ëŸ¼ ì¶”ê°€
        df['hour'] = df['timestamp'].dt.hour
        df['day'] = df['timestamp'].dt.day
        df['weekday'] = df['timestamp'].dt.weekday
        df['date'] = df['timestamp'].dt.date
        df['month'] = df['timestamp'].dt.month
        
        # ì‹œê°„ëŒ€ ê·¸ë£¹ ìƒì„±
        df['time_group'] = pd.cut(df['hour'], 
                                  bins=[-1, 3, 6, 9, 12, 15, 18, 21, 24],
                                  labels=['00-03ì‹œ', '03-06ì‹œ', '06-09ì‹œ', '09-12ì‹œ', 
                                         '12-15ì‹œ', '15-18ì‹œ', '18-21ì‹œ', '21-24ì‹œ'])
        
        print(f"âœ“ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: {len(df)}ê±´")
        return df
    
    def analyze_all(self):
        """ì „ì²´ ë¶„ì„ ì‹¤í–‰"""
        print("\n" + "="*60)
        print("ì˜ˆì¸¡ ëª¨ë¸ í•„í„° ë°ì´í„° ë¶„ì„ ì‹œì‘")
        print("="*60)
        
        # 1. ê¸°ë³¸ í†µê³„
        print("\n1. ê¸°ë³¸ í†µê³„ ë¶„ì„")
        print("-"*40)
        stats = self.basic_statistics()
        for key, value in stats.items():
            print(f"  {key}: {value}")
        
        # 2. ì‹œê°„ëŒ€ë³„ ë¶„ì„
        print("\n2. ì‹œê°„ëŒ€ë³„ ë¶„ì„")
        print("-"*40)
        time_stats = self.time_analysis()
        print(time_stats.to_string())
        
        # 3. ì˜¤ì°¨ ë¶„í¬
        print("\n3. ì˜¤ì°¨ í¬ê¸°ë³„ ë¶„í¬")
        print("-"*40)
        error_dist = self.error_distribution()
        print(error_dist.to_string())
        
        # 4. ê·¹ë‹¨ê°’ ì¼€ì´ìŠ¤
        print("\n4. ê·¹ë‹¨ê°’ ì¼€ì´ìŠ¤")
        print("-"*40)
        max_errors, min_errors = self.extreme_cases()
        print("\nìµœëŒ€ ì˜¤ì°¨ Top 5:")
        print(max_errors.to_string())
        print("\nìµœì†Œ ì˜¤ì°¨ Top 5:")
        print(min_errors.to_string())
        
        # 5. ì¼ë³„ ì¶”ì´
        print("\n5. ì¼ë³„ ì¶”ì´ (ìµœê·¼ 10ì¼)")
        print("-"*40)
        daily_stats = self.daily_trend()
        print(daily_stats.tail(10).to_string())
        
        # 6. HTML ë³´ê³ ì„œ ìƒì„±
        print("\n6. HTML ë³´ê³ ì„œ ìƒì„± ì¤‘...")
        self.generate_html_report()
        print("âœ“ HTML ë³´ê³ ì„œ ìƒì„± ì™„ë£Œ: filter_analysis_report.html")
        
        # 7. ì‹œê°í™”
        print("\n7. ì‹œê°í™” ì°¨íŠ¸ ìƒì„± ì¤‘...")
        self.create_visualizations()
        print("âœ“ ì‹œê°í™” ì™„ë£Œ")
        
        return {
            'stats': stats,
            'time_stats': time_stats,
            'error_dist': error_dist,
            'max_errors': max_errors,
            'min_errors': min_errors,
            'daily_stats': daily_stats
        }
    
    def basic_statistics(self):
        """ê¸°ë³¸ í†µê³„ ë¶„ì„"""
        stats = {
            'ì´ ë°ì´í„° ìˆ˜': len(self.df),
            'ë¶„ì„ ê¸°ê°„': f"{self.df['timestamp'].min().date()} ~ {self.df['timestamp'].max().date()}",
            'ê´€ì¸¡ê°’ ë²”ìœ„': f"{self.df['ê´€ì¸¡ê°’'].min()} ~ {self.df['ê´€ì¸¡ê°’'].max()}",
            'ì˜ˆì¸¡ê°’ ë²”ìœ„': f"{self.df['ì˜ˆì¸¡ê°’'].min()} ~ {self.df['ì˜ˆì¸¡ê°’'].max()}",
            'ì˜¤ì°¨ ë²”ìœ„': f"{self.df['í•„í„°ì˜¤ì°¨'].min()} ~ {self.df['í•„í„°ì˜¤ì°¨'].max()}",
            'í‰ê·  ì˜¤ì°¨': round(self.df['í•„í„°ì˜¤ì°¨'].mean(), 2),
            'ì¤‘ì•™ê°’ ì˜¤ì°¨': self.df['í•„í„°ì˜¤ì°¨'].median(),
            'í‘œì¤€í¸ì°¨': round(self.df['í•„í„°ì˜¤ì°¨'].std(), 2)
        }
        return stats
    
    def time_analysis(self):
        """ì‹œê°„ëŒ€ë³„ ë¶„ì„"""
        time_stats = self.df.groupby('time_group')['í•„í„°ì˜¤ì°¨'].agg([
            ('ê±´ìˆ˜', 'count'),
            ('í‰ê· ì˜¤ì°¨', 'mean'),
            ('ìµœëŒ€ì˜¤ì°¨', 'max'),
            ('ìµœì†Œì˜¤ì°¨', 'min')
        ]).round(2)
        
        time_stats['ë¹„ìœ¨(%)'] = round(time_stats['ê±´ìˆ˜'] / len(self.df) * 100, 1)
        return time_stats
    
    def error_distribution(self):
        """ì˜¤ì°¨ ë¶„í¬ ë¶„ì„"""
        bins = [0, 20, 40, 60, 80, 100, 200]
        labels = ['0-20', '21-40', '41-60', '61-80', '81-100', '100+']
        self.df['error_group'] = pd.cut(self.df['í•„í„°ì˜¤ì°¨'], bins=bins, labels=labels)
        
        error_dist = self.df['error_group'].value_counts().sort_index()
        error_dist_pct = round(error_dist / len(self.df) * 100, 1)
        
        return pd.DataFrame({
            'ê±´ìˆ˜': error_dist,
            'ë¹„ìœ¨(%)': error_dist_pct
        })
    
    def extreme_cases(self, n=5):
        """ê·¹ë‹¨ê°’ ì¼€ì´ìŠ¤ ë¶„ì„"""
        # ìµœëŒ€ ì˜¤ì°¨ ì¼€ì´ìŠ¤
        max_errors = self.df.nlargest(n, 'í•„í„°ì˜¤ì°¨')[
            ['timestamp', 'ê´€ì¸¡ê°’', 'ì˜ˆì¸¡ê°’', 'í•„í„°ì˜¤ì°¨', 'ê´€ì¸¡ MAX']
        ]
        
        # ìµœì†Œ ì˜¤ì°¨ ì¼€ì´ìŠ¤
        min_errors = self.df.nsmallest(n, 'í•„í„°ì˜¤ì°¨')[
            ['timestamp', 'ê´€ì¸¡ê°’', 'ì˜ˆì¸¡ê°’', 'í•„í„°ì˜¤ì°¨', 'ê´€ì¸¡ MAX']
        ]
        
        return max_errors, min_errors
    
    def daily_trend(self):
        """ì¼ë³„ ì¶”ì´ ë¶„ì„"""
        daily_stats = self.df.groupby('date').agg({
            'í•„í„°ì˜¤ì°¨': ['count', 'mean', 'max', 'min']
        }).round(2)
        daily_stats.columns = ['ê±´ìˆ˜', 'í‰ê· ì˜¤ì°¨', 'ìµœëŒ€ì˜¤ì°¨', 'ìµœì†Œì˜¤ì°¨']
        return daily_stats
    
    def create_visualizations(self):
        """ì‹œê°í™” ì°¨íŠ¸ ìƒì„±"""
        fig, axes = plt.subplots(2, 3, figsize=(18, 10))
        fig.suptitle('ì˜ˆì¸¡ ëª¨ë¸ í•„í„° ë°ì´í„° ë¶„ì„', fontsize=16, fontweight='bold')
        
        # 1. ì‹œê°„ëŒ€ë³„ ì˜¤ë¥˜ ê±´ìˆ˜
        time_counts = self.df['time_group'].value_counts().sort_index()
        axes[0, 0].bar(range(len(time_counts)), time_counts.values, color='steelblue')
        axes[0, 0].set_xticks(range(len(time_counts)))
        axes[0, 0].set_xticklabels(time_counts.index, rotation=45)
        axes[0, 0].set_title('ì‹œê°„ëŒ€ë³„ ì˜¤ë¥˜ ë°œìƒ ê±´ìˆ˜')
        axes[0, 0].set_ylabel('ê±´ìˆ˜')
        
        # 2. ì˜¤ì°¨ ë¶„í¬ íˆìŠ¤í† ê·¸ë¨
        axes[0, 1].hist(self.df['í•„í„°ì˜¤ì°¨'], bins=30, color='coral', edgecolor='black')
        axes[0, 1].set_title('ì˜¤ì°¨ ë¶„í¬')
        axes[0, 1].set_xlabel('ì˜¤ì°¨ ê°’')
        axes[0, 1].set_ylabel('ë¹ˆë„')
        
        # 3. ì¼ë³„ ì˜¤ë¥˜ ê±´ìˆ˜ ì¶”ì´
        daily_counts = self.df.groupby('date')['í•„í„°ì˜¤ì°¨'].count()
        axes[0, 2].plot(daily_counts.index, daily_counts.values, marker='o', linewidth=2)
        axes[0, 2].set_title('ì¼ë³„ ì˜¤ë¥˜ ë°œìƒ ì¶”ì´')
        axes[0, 2].set_xlabel('ë‚ ì§œ')
        axes[0, 2].set_ylabel('ê±´ìˆ˜')
        axes[0, 2].tick_params(axis='x', rotation=45)
        
        # 4. ê´€ì¸¡ê°’ vs ì˜ˆì¸¡ê°’ ì‚°ì ë„
        axes[1, 0].scatter(self.df['ê´€ì¸¡ê°’'], self.df['ì˜ˆì¸¡ê°’'], 
                          alpha=0.5, c=self.df['í•„í„°ì˜¤ì°¨'], cmap='RdYlBu_r')
        axes[1, 0].plot([self.df['ê´€ì¸¡ê°’'].min(), 300], [300, 300], 'r--', label='y=300')
        axes[1, 0].plot([300, 300], [300, self.df['ì˜ˆì¸¡ê°’'].max()], 'r--')
        axes[1, 0].set_title('ê´€ì¸¡ê°’ vs ì˜ˆì¸¡ê°’')
        axes[1, 0].set_xlabel('ê´€ì¸¡ê°’')
        axes[1, 0].set_ylabel('ì˜ˆì¸¡ê°’')
        axes[1, 0].legend()
        
        # 5. ì‹œê°„ëŒ€ë³„ í‰ê·  ì˜¤ì°¨
        time_mean_error = self.df.groupby('time_group')['í•„í„°ì˜¤ì°¨'].mean().sort_index()
        axes[1, 1].bar(range(len(time_mean_error)), time_mean_error.values, color='teal')
        axes[1, 1].set_xticks(range(len(time_mean_error)))
        axes[1, 1].set_xticklabels(time_mean_error.index, rotation=45)
        axes[1, 1].set_title('ì‹œê°„ëŒ€ë³„ í‰ê·  ì˜¤ì°¨')
        axes[1, 1].set_ylabel('í‰ê·  ì˜¤ì°¨')
        
        # 6. ë°•ìŠ¤í”Œë¡¯ - ì‹œê°„ëŒ€ë³„ ì˜¤ì°¨ ë¶„í¬
        time_groups = ['00-03ì‹œ', '03-06ì‹œ', '06-09ì‹œ', '09-12ì‹œ', 
                      '12-15ì‹œ', '15-18ì‹œ', '18-21ì‹œ', '21-24ì‹œ']
        data_for_box = [self.df[self.df['time_group'] == tg]['í•„í„°ì˜¤ì°¨'].values 
                       for tg in time_groups]
        axes[1, 2].boxplot(data_for_box, labels=time_groups)
        axes[1, 2].set_title('ì‹œê°„ëŒ€ë³„ ì˜¤ì°¨ ë¶„í¬ (ë°•ìŠ¤í”Œë¡¯)')
        axes[1, 2].set_ylabel('ì˜¤ì°¨')
        axes[1, 2].tick_params(axis='x', rotation=45)
        
        plt.tight_layout()
        plt.savefig('filter_analysis_charts.png', dpi=100, bbox_inches='tight')
        plt.show()
    
    def generate_html_report(self):
        """HTML ë³´ê³ ì„œ ìƒì„±"""
        stats = self.basic_statistics()
        time_stats = self.time_analysis()
        error_dist = self.error_distribution()
        max_errors, min_errors = self.extreme_cases()
        daily_stats = self.daily_trend()
        
        html_content = f"""
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜ˆì¸¡ ëª¨ë¸ í•„í„° ë°ì´í„° ë¶„ì„ ë³´ê³ ì„œ</title>
    <style>
        * {{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }}
        
        body {{
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            line-height: 1.8;
            color: #2c3e50;
            background: #f8f9fa;
            padding: 20px;
        }}
        
        .container {{
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
        }}
        
        .header {{
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }}
        
        .header h1 {{
            font-size: 32px;
            margin-bottom: 10px;
        }}
        
        .header .subtitle {{
            font-size: 18px;
            opacity: 0.9;
        }}
        
        .content {{
            padding: 40px;
        }}
        
        .section {{
            margin-bottom: 40px;
        }}
        
        h2 {{
            color: #1e3c72;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #1e3c72;
        }}
        
        .stats-grid {{
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }}
        
        .stat-card {{
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }}
        
        .stat-card .value {{
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }}
        
        .stat-card .label {{
            font-size: 14px;
            opacity: 0.9;
            text-transform: uppercase;
        }}
        
        table {{
            width: 100%;
            border-collapse: collapse;
            background: white;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }}
        
        thead {{
            background: #2c3e50;
            color: white;
        }}
        
        th {{
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }}
        
        td {{
            padding: 12px 15px;
            border-bottom: 1px solid #ecf0f1;
        }}
        
        tbody tr:nth-child(even) {{
            background: #f8f9fa;
        }}
        
        tbody tr:hover {{
            background: #e8f4f8;
        }}
        
        .alert {{
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
            border-left: 5px solid;
        }}
        
        .alert-danger {{
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }}
        
        .alert-info {{
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }}
        
        .highlight-row {{
            background: #fff9e6 !important;
            font-weight: 600;
        }}
        
        .danger-cell {{
            color: #dc3545;
            font-weight: bold;
        }}
        
        .success-cell {{
            color: #28a745;
            font-weight: bold;
        }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ì˜ˆì¸¡ ëª¨ë¸ í•„í„° ë°ì´í„° ë¶„ì„ ë³´ê³ ì„œ</h1>
            <p class="subtitle">{stats['ì´ ë°ì´í„° ìˆ˜']}ê±´ ì˜¤ë¥˜ íŒ¨í„´ ë¶„ì„</p>
            <p>ë¶„ì„ ê¸°ê°„: {stats['ë¶„ì„ ê¸°ê°„']}</p>
        </div>
        
        <div class="content">
            <!-- í•µì‹¬ í†µê³„ ì¹´ë“œ -->
            <section class="section">
                <h2>ğŸ“Š í•µì‹¬ ì§€í‘œ</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="label">ì´ ë¶„ì„ ë°ì´í„°</div>
                        <div class="value">{stats['ì´ ë°ì´í„° ìˆ˜']}</div>
                        <div class="label">í•„í„°ëœ ì˜¤ë¥˜ ê±´ìˆ˜</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <div class="label">í‰ê·  ì˜¤ì°¨</div>
                        <div class="value">{stats['í‰ê·  ì˜¤ì°¨']}</div>
                        <div class="label">ì˜ˆì¸¡ê°’ - ê´€ì¸¡ê°’</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                        <div class="label">ì˜¤ì°¨ ë²”ìœ„</div>
                        <div class="value">{stats['ì˜¤ì°¨ ë²”ìœ„']}</div>
                        <div class="label">ìµœì†Œ ~ ìµœëŒ€</div>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                        <div class="label">í‘œì¤€í¸ì°¨</div>
                        <div class="value">{stats['í‘œì¤€í¸ì°¨']}</div>
                        <div class="label">ì˜¤ì°¨ ë³€ë™ì„±</div>
                    </div>
                </div>
            </section>
            
            <!-- ì¤‘ìš” ê²½ê³  -->
            <div class="alert alert-danger">
                <strong>âš ï¸ ì¤‘ìš” ë°œê²¬ì‚¬í•­:</strong> 
                ëª¨ë“  ë°ì´í„°ê°€ "ê´€ì¸¡ê°’ < 300, ì˜ˆì¸¡ê°’ â‰¥ 300" íŒ¨í„´ì„ ë³´ì´ë©°, 
                ì´ëŠ” ëª¨ë¸ì´ 300ì„ ê²½ê³„ë¡œ ì²´ê³„ì ìœ¼ë¡œ ê³¼ëŒ€ì˜ˆì¸¡í•˜ê³  ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
            </div>
            
            <!-- ì‹œê°„ëŒ€ë³„ ë¶„ì„ -->
            <section class="section">
                <h2>â° ì‹œê°„ëŒ€ë³„ ë¶„ì„</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ì‹œê°„ëŒ€</th>
                            <th>ê±´ìˆ˜</th>
                            <th>ë¹„ìœ¨(%)</th>
                            <th>í‰ê·  ì˜¤ì°¨</th>
                            <th>ìµœëŒ€ ì˜¤ì°¨</th>
                            <th>ìµœì†Œ ì˜¤ì°¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        {time_stats.to_html(header=False, index=True, escape=False, classes='')[23:-16]}
                    </tbody>
                </table>
            </section>
            
            <!-- ì˜¤ì°¨ ë¶„í¬ -->
            <section class="section">
                <h2>ğŸ“ˆ ì˜¤ì°¨ í¬ê¸°ë³„ ë¶„í¬</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ì˜¤ì°¨ ë²”ìœ„</th>
                            <th>ê±´ìˆ˜</th>
                            <th>ë¹„ìœ¨(%)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {error_dist.to_html(header=False, index=True, escape=False, classes='')[23:-16]}
                    </tbody>
                </table>
                
                <div class="alert alert-info">
                    <strong>ğŸ“Š ë¶„ì„:</strong> 
                    ëŒ€ë¶€ë¶„ì˜ ì˜¤ë¥˜ê°€ 21-60 ë²”ìœ„ì— ì§‘ì¤‘ë˜ì–´ ìˆìœ¼ë©°, 
                    ì´ëŠ” ëª¨ë¸ì´ ì¼ì •í•œ íŒ¨í„´ìœ¼ë¡œ ê³¼ëŒ€ì˜ˆì¸¡í•˜ê³  ìˆìŒì„ ì‹œì‚¬í•©ë‹ˆë‹¤.
                </div>
            </section>
            
            <!-- ê·¹ë‹¨ê°’ ì¼€ì´ìŠ¤ -->
            <section class="section">
                <h2>ğŸ” ê·¹ë‹¨ê°’ ì¼€ì´ìŠ¤ ë¶„ì„</h2>
                
                <h3>ìµœëŒ€ ì˜¤ì°¨ Top 5</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ì‹œê°„</th>
                            <th>ê´€ì¸¡ê°’</th>
                            <th>ì˜ˆì¸¡ê°’</th>
                            <th>ì˜¤ì°¨</th>
                            <th>ê´€ì¸¡ MAX</th>
                        </tr>
                    </thead>
                    <tbody>
                        {max_errors.to_html(header=False, index=False, escape=False, classes='')[23:-16]}
                    </tbody>
                </table>
                
                <h3>ìµœì†Œ ì˜¤ì°¨ ì¼€ì´ìŠ¤</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ì‹œê°„</th>
                            <th>ê´€ì¸¡ê°’</th>
                            <th>ì˜ˆì¸¡ê°’</th>
                            <th>ì˜¤ì°¨</th>
                            <th>ê´€ì¸¡ MAX</th>
                        </tr>
                    </thead>
                    <tbody>
                        {min_errors.to_html(header=False, index=False, escape=False, classes='')[23:-16]}
                    </tbody>
                </table>
            </section>
            
            <!-- ì¼ë³„ ì¶”ì´ (ìµœê·¼ 10ì¼) -->
            <section class="section">
                <h2>ğŸ“… ìµœê·¼ 10ì¼ ì¶”ì´</h2>
                <table>
                    <thead>
                        <tr>
                            <th>ë‚ ì§œ</th>
                            <th>ê±´ìˆ˜</th>
                            <th>í‰ê·  ì˜¤ì°¨</th>
                            <th>ìµœëŒ€ ì˜¤ì°¨</th>
                            <th>ìµœì†Œ ì˜¤ì°¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        {daily_stats.tail(10).to_html(header=False, index=True, escape=False, classes='')[23:-16]}
                    </tbody>
                </table>
            </section>
            
            <!-- ê²°ë¡  -->
            <section class="section">
                <h2>ğŸ’¡ ê²°ë¡  ë° ì œì–¸</h2>
                <div class="alert alert-danger">
                    <strong>í•µì‹¬ ë°œê²¬ì‚¬í•­:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>ëª¨ë“  {stats['ì´ ë°ì´í„° ìˆ˜']}ê±´ì´ ê³¼ëŒ€ì˜ˆì¸¡ íŒ¨í„´ (ì˜ˆì¸¡ê°’ â‰¥ 300, ê´€ì¸¡ê°’ < 300)</li>
                        <li>í‰ê·  ì˜¤ì°¨ {stats['í‰ê·  ì˜¤ì°¨']}, ìµœëŒ€ ì˜¤ì°¨ {stats['ì˜¤ì°¨ ë²”ìœ„'].split(' ~ ')[1]}</li>
                        <li>íŠ¹ì • ì‹œê°„ëŒ€(ìƒˆë²½/ì˜¤í›„)ì— ì˜¤ì°¨ê°€ ì§‘ì¤‘ë˜ëŠ” ê²½í–¥</li>
                        <li>ëª¨ë¸ì´ 300 ì„ê³„ê°’ì„ ê³¼ë„í•˜ê²Œ íšŒí”¼í•˜ëŠ” ì²´ê³„ì  í¸í–¥ ì¡´ì¬</li>
                    </ul>
                    <br>
                    <strong>ê¶Œì¥ì‚¬í•­:</strong> ëª¨ë¸ ì¬í•™ìŠµ ë˜ëŠ” í›„ì²˜ë¦¬ ë³´ì •ì´ ì‹œê¸‰íˆ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
            </section>
        </div>
    </div>
</body>
</html>
"""
        
        # HTML íŒŒì¼ë¡œ ì €ì¥
        with open('filter_analysis_report.html', 'w', encoding='utf-8') as f:
            f.write(html_content)
        
        return html_content


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    # CSV íŒŒì¼ ê²½ë¡œ ì§€ì •
    file_path = 'your_data.csv'  # ì‹¤ì œ íŒŒì¼ ê²½ë¡œë¡œ ë³€ê²½í•˜ì„¸ìš”
    
    # ë¶„ì„ê¸° ìƒì„± ë° ì‹¤í–‰
    analyzer = FilterDataAnalyzer(file_path)
    results = analyzer.analyze_all()
    
    print("\n" + "="*60)
    print("ë¶„ì„ ì™„ë£Œ!")
    print("="*60)
    print("ìƒì„±ëœ íŒŒì¼:")
    print("  - filter_analysis_report.html (HTML ë³´ê³ ì„œ)")
    print("  - filter_analysis_charts.png (ì‹œê°í™” ì°¨íŠ¸)")