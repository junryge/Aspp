# -*- coding: utf-8 -*-
"""
PatchTST & PatchTST+PINN ëª¨ë¸ êµ¬ì¶•ì„ ìœ„í•œ ì‹¤ì œ ë°ì´í„° ê²€ì¦
ì‹¤ì œ íŒŒì¼: HUB_0509_TO_0807_DATA.CSV, BRTIME_0509_TO_0831.CSV
"""

import pandas as pd
import numpy as np
import os
from datetime import datetime
import matplotlib.pyplot as plt
import seaborn as sns
import warnings
warnings.filterwarnings('ignore')

# ê·¸ë˜í”„ í•œê¸€ ì„¤ì •
plt.rcParams['font.family'] = 'DejaVu Sans'
plt.rcParams['axes.unicode_minus'] = False

def validate_real_data():
    """
    ì‹¤ì œ ë°ì´í„° ê²€ì¦
    Model 1: PatchTST (ì „ì²´ ê· í˜•)
    Model 2: PatchTST + PINN (ë¬¼ë¦¬ë²•ì¹™ ì ìš©)
    """
    
    print("=" * 80)
    print("ğŸ” PatchTST & PatchTST+PINN ëª¨ë¸ ë°ì´í„° ê²€ì¦")
    print(f"ğŸ“… ê²€ì¦ ì‹œê°„: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("=" * 80)
    
    # ì‹¤ì œ ë°ì´í„° íŒŒì¼ ê²½ë¡œ
    data_main = 'data/HUB_0509_TO_0807_DATA.CSV'
    data_bridge = 'data/BRTIME_0509_TO_0831.CSV'
    
    # 1. íŒŒì¼ ì¡´ì¬ í™•ì¸
    print("\nğŸ“ ë°ì´í„° íŒŒì¼ í™•ì¸:")
    print("-" * 60)
    
    if not os.path.exists(data_main):
        print(f"âŒ {data_main} íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return None
        
    if not os.path.exists(data_bridge):
        print(f"âŒ {data_bridge} íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
        return None
    
    # 2. ë°ì´í„° ë¡œë“œ
    print("\nğŸ“Š ë°ì´í„° ë¡œë“œ:")
    print("-" * 60)
    
    df_main = pd.read_csv(data_main, encoding='utf-8-sig')
    df_bridge = pd.read_csv(data_bridge, encoding='utf-8-sig')
    
    print(f"âœ… HUB ë°ì´í„°: {df_main.shape[0]:,}í–‰ Ã— {df_main.shape[1]}ì—´")
    print(f"âœ… ë¸Œë¦¬ì§€íƒ€ì„ ë°ì´í„°: {df_bridge.shape[0]:,}í–‰ Ã— {df_bridge.shape[1]}ì—´")
    
    # 3. íƒ€ê²Ÿ ì»¬ëŸ¼ í™•ì¸
    print("\nğŸ¯ íƒ€ê²Ÿ ì»¬ëŸ¼ í™•ì¸:")
    print("-" * 60)
    
    target_col = 'CURRENT_M16A_3F_JOB_2'
    if target_col in df_main.columns:
        print(f"âœ… íƒ€ê²Ÿ ì»¬ëŸ¼ '{target_col}' ì¡´ì¬")
        print(f"   - í‰ê· : {df_main[target_col].mean():.2f}")
        print(f"   - í‘œì¤€í¸ì°¨: {df_main[target_col].std():.2f}")
        print(f"   - ìµœì†Œê°’: {df_main[target_col].min():.2f}")
        print(f"   - ìµœëŒ€ê°’: {df_main[target_col].max():.2f}")
        print(f"   - ê²°ì¸¡ì¹˜: {df_main[target_col].isna().sum()}ê°œ")
    else:
        print(f"âŒ íƒ€ê²Ÿ ì»¬ëŸ¼ '{target_col}' ì—†ìŒ")
        return None
    
    # 4. ì‹œê°„ ì»¬ëŸ¼ í™•ì¸ ë° ë³‘í•©
    print("\nâ° ì‹œê°„ ì •ë³´ ë° ë³‘í•©:")
    print("-" * 60)
    
    # ì‹œê°„ ì»¬ëŸ¼ í™•ì¸
    time_col_main = None
    time_col_bridge = None
    
    # HUB ë°ì´í„° ì‹œê°„ ì»¬ëŸ¼ ì°¾ê¸°
    for col in ['STAT_DT', 'DATETIME', 'TIME', 'DATE']:
        if col in df_main.columns:
            time_col_main = col
            break
    
    # ë¸Œë¦¬ì§€íƒ€ì„ ì‹œê°„ ì»¬ëŸ¼ ì°¾ê¸°
    for col in ['CRT_TM', 'DATETIME', 'TIME', 'DATE']:
        if col in df_bridge.columns:
            time_col_bridge = col
            break
    
    if time_col_main:
        print(f"âœ… HUB ì‹œê°„ ì»¬ëŸ¼: {time_col_main}")
    else:
        print("âŒ HUB ë°ì´í„°ì—ì„œ ì‹œê°„ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ")
    
    if time_col_bridge:
        print(f"âœ… ë¸Œë¦¬ì§€íƒ€ì„ ì‹œê°„ ì»¬ëŸ¼: {time_col_bridge}")
    else:
        print("âŒ ë¸Œë¦¬ì§€íƒ€ì„ ë°ì´í„°ì—ì„œ ì‹œê°„ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ")
    
    # ì‹œê°„ ë³€í™˜ ë° ë³‘í•©
    if time_col_main and time_col_bridge:
        try:
            # HUB ë°ì´í„° ì‹œê°„ ë³€í™˜
            if time_col_main == 'STAT_DT':
                df_main['time'] = pd.to_datetime(df_main[time_col_main].astype(str), format='%Y%m%d%H%M')
            else:
                df_main['time'] = pd.to_datetime(df_main[time_col_main])
            
            # ë¸Œë¦¬ì§€íƒ€ì„ ì‹œê°„ ë³€í™˜
            if time_col_bridge == 'CRT_TM':
                df_bridge['time'] = pd.to_datetime(df_bridge[time_col_bridge].str[:19])
            else:
                df_bridge['time'] = pd.to_datetime(df_bridge[time_col_bridge])
            
            # ë³‘í•©
            bridge_value_col = 'IDC_VAL' if 'IDC_VAL' in df_bridge.columns else df_bridge.columns[1]
            df = pd.merge(df_main, df_bridge[['time', bridge_value_col]], 
                         on='time', how='left')
            df.rename(columns={bridge_value_col: 'BRIDGE_TIME'}, inplace=True)
            
            # ë¸Œë¦¬ì§€íƒ€ì„ ê²°ì¸¡ì¹˜ ì²˜ë¦¬
            bridge_missing_before = df['BRIDGE_TIME'].isna().sum()
            df['BRIDGE_TIME'] = df['BRIDGE_TIME'].interpolate(method='linear')
            df['BRIDGE_TIME'] = df['BRIDGE_TIME'].fillna(df['BRIDGE_TIME'].mean())
            
            print(f"âœ… ë°ì´í„° ë³‘í•© ì™„ë£Œ: {df.shape[0]:,}í–‰ Ã— {df.shape[1]}ì—´")
            print(f"   ë¸Œë¦¬ì§€íƒ€ì„ ê²°ì¸¡ì¹˜: {bridge_missing_before}ê°œ â†’ 0ê°œ (ë³´ê°„ ì™„ë£Œ)")
        except Exception as e:
            print(f"âŒ ì‹œê°„ ë³€í™˜/ë³‘í•© ì¤‘ ì˜¤ë¥˜: {e}")
            df = df_main.copy()
    else:
        df = df_main.copy()
    
    # 5. í•„ìˆ˜ ì»¬ëŸ¼ ë¶„ì„
    print("\nğŸ“‹ í•„ìˆ˜ ì»¬ëŸ¼ ë¶„ì„:")
    print("-" * 60)
    
    # ì»¬ëŸ¼ ì¹´í…Œê³ ë¦¬ ì •ì˜
    column_categories = {
        'íƒ€ê²Ÿ': ['CURRENT_M16A_3F_JOB_2'],
        'ìœ ì…_í•„ìˆ˜': ['M16A_6F_TO_HUB_JOB', 'M16A_2F_TO_HUB_JOB2', 
                   'M14A_3F_TO_HUB_JOB2', 'M14B_7F_TO_HUB_JOB2'],
        'ìœ ì¶œ_í•„ìˆ˜': ['M16A_3F_TO_M16A_6F_JOB', 'M16A_3F_TO_M16A_2F_JOB',
                   'M16A_3F_TO_M14A_3F_JOB', 'M16A_3F_TO_M14B_7F_JOB'],
        'CMD_í•µì‹¬': ['M16A_3F_CMD'],
        'Storage': ['M16A_3F_STORAGE_UTIL'],
        'ë¸Œë¦¬ì§€íƒ€ì„': ['BRIDGE_TIME'],
        'í™œìš©ë¥ ': ['M16A_6F_LFT_MAXCAPA_UTIL', 'M16A_2F_LFT_MAXCAPA_UTIL',
                 'M14A_3F_CNV_MAXCAPA_UTIL', 'M14B_7F_LFT_MAXCAPA_UTIL'],
        'MaxCapa': ['M16A_6F_LFT_MAXCAPA', 'M16A_2F_LFT_MAXCAPA',
                   'M14A_3F_CNV_MAXCAPA', 'M14B_7F_LFT_MAXCAPA'],
        'OFS': ['M14_TO_M16_OFS_CUR', 'M16_TO_M14_OFS_CUR'],
        'ì§‘ê³„': ['M16_ALL_TO_HUB_JOB', 'M14_ALL_TO_HUB_JOB', 'ALL_TO_HUB_JOB']
    }
    
    # ê° ì¹´í…Œê³ ë¦¬ë³„ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    validation_results = {}
    total_score = 0
    available_score = 0
    
    for category, cols in column_categories.items():
        validation_results[category] = {
            'total': len(cols),
            'found': 0,
            'missing': [],
            'existing': []
        }
        
        for col in cols:
            if col in df.columns:
                validation_results[category]['found'] += 1
                validation_results[category]['existing'].append(col)
                # ì ìˆ˜ ê³„ì‚° (ì¹´í…Œê³ ë¦¬ë³„ ê°€ì¤‘ì¹˜)
                if category == 'íƒ€ê²Ÿ':
                    available_score += 100
                elif category in ['ìœ ì…_í•„ìˆ˜', 'ìœ ì¶œ_í•„ìˆ˜']:
                    available_score += 60
                elif category in ['CMD_í•µì‹¬', 'Storage', 'ë¸Œë¦¬ì§€íƒ€ì„']:
                    available_score += 80
                else:
                    available_score += 40
            else:
                validation_results[category]['missing'].append(col)
            
            # ì´ì  ê³„ì‚°
            if category == 'íƒ€ê²Ÿ':
                total_score += 100
            elif category in ['ìœ ì…_í•„ìˆ˜', 'ìœ ì¶œ_í•„ìˆ˜']:
                total_score += 60
            elif category in ['CMD_í•µì‹¬', 'Storage', 'ë¸Œë¦¬ì§€íƒ€ì„']:
                total_score += 80
            else:
                total_score += 40
        
        # ì¹´í…Œê³ ë¦¬ë³„ ì¶œë ¥
        found_ratio = validation_results[category]['found'] / validation_results[category]['total'] * 100
        status = "âœ…" if found_ratio == 100 else "âš ï¸" if found_ratio >= 50 else "âŒ"
        
        print(f"\n{status} {category}: {validation_results[category]['found']}/{validation_results[category]['total']} ({found_ratio:.0f}%)")
        
        if validation_results[category]['existing']:
            for col in validation_results[category]['existing'][:3]:  # ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
                print(f"   âœ“ {col}")
            if len(validation_results[category]['existing']) > 3:
                print(f"   ... ì™¸ {len(validation_results[category]['existing'])-3}ê°œ")
        
        if validation_results[category]['missing']:
            for col in validation_results[category]['missing'][:3]:  # ìµœëŒ€ 3ê°œë§Œ í‘œì‹œ
                print(f"   âœ— {col}")
            if len(validation_results[category]['missing']) > 3:
                print(f"   ... ì™¸ {len(validation_results[category]['missing'])-3}ê°œ")
    
    # 6. ë¬¼ë¦¬ë²•ì¹™ ê²€ì¦ (ìœ ì…-ìœ ì¶œ ê· í˜•)
    print("\nâš–ï¸ ë¬¼ë¦¬ë²•ì¹™ ê²€ì¦:")
    print("-" * 60)
    
    # ìœ ì… ì»¬ëŸ¼ í•©ê³„
    inflow_cols = [col for col in validation_results['ìœ ì…_í•„ìˆ˜']['existing']]
    if inflow_cols:
        total_inflow = df[inflow_cols].sum(axis=1)
        print(f"âœ… ì´ ìœ ì… ê³„ì‚° ê°€ëŠ¥ ({len(inflow_cols)}ê°œ ì»¬ëŸ¼)")
    else:
        total_inflow = 0
        print("âŒ ìœ ì… ì»¬ëŸ¼ ë¶€ì¡±ìœ¼ë¡œ ê³„ì‚° ë¶ˆê°€")
    
    # ìœ ì¶œ ì»¬ëŸ¼ í•©ê³„
    outflow_cols = [col for col in validation_results['ìœ ì¶œ_í•„ìˆ˜']['existing']]
    if outflow_cols:
        total_outflow = df[outflow_cols].sum(axis=1)
        print(f"âœ… ì´ ìœ ì¶œ ê³„ì‚° ê°€ëŠ¥ ({len(outflow_cols)}ê°œ ì»¬ëŸ¼)")
    else:
        total_outflow = 0
        print("âŒ ìœ ì¶œ ì»¬ëŸ¼ ë¶€ì¡±ìœ¼ë¡œ ê³„ì‚° ë¶ˆê°€")
    
    # ì¬ê³  ë³€í™”ëŸ‰
    if target_col in df.columns:
        stock_change = df[target_col].diff()
        
        # ë¬¼ë¦¬ë²•ì¹™: ì¬ê³  ë³€í™” = ìœ ì… - ìœ ì¶œ
        if isinstance(total_inflow, pd.Series) and isinstance(total_outflow, pd.Series):
            balance = total_inflow - total_outflow - stock_change
            balance_error = balance.abs().mean()
            print(f"\nğŸ“Š ë¬¼ë¦¬ë²•ì¹™ ê· í˜• ì˜¤ì°¨: {balance_error:.2f}")
            
            if balance_error < 10:
                print("   âœ… ìš°ìˆ˜: ë¬¼ë¦¬ë²•ì¹™ ì˜ ìœ ì§€ë¨")
            elif balance_error < 50:
                print("   âš ï¸ ì–‘í˜¸: ì•½ê°„ì˜ ë¶ˆê· í˜• ì¡´ì¬")
            else:
                print("   âŒ ì£¼ì˜: ë¬¼ë¦¬ë²•ì¹™ ë¶ˆê· í˜• ì‹¬ê°")
    
    # 7. ë¸Œë¦¬ì§€íƒ€ì„ ìƒê´€ê´€ê³„ ë¶„ì„
    print("\nğŸ”— ë¸Œë¦¬ì§€íƒ€ì„ ìƒê´€ê´€ê³„:")
    print("-" * 60)
    
    if 'BRIDGE_TIME' in df.columns and target_col in df.columns:
        # ë™ì‹œì  ìƒê´€ê´€ê³„
        corr_instant = df[[target_col, 'BRIDGE_TIME']].corr().iloc[0, 1]
        print(f"ë™ì‹œì  ìƒê´€ê³„ìˆ˜: {corr_instant:.3f}")
        
        # 10ë¶„ í›„ ì˜ˆì¸¡ì„ ìœ„í•œ lag ìƒê´€ê´€ê³„
        df['TARGET_LAG10'] = df[target_col].shift(-10)
        corr_lag10 = df[['BRIDGE_TIME', 'TARGET_LAG10']].corr().iloc[0, 1]
        print(f"10ë¶„ ì˜ˆì¸¡ ìƒê´€ê³„ìˆ˜: {corr_lag10:.3f}")
        
        # ë‹¤ì–‘í•œ lag ë¶„ì„
        lag_corrs = {}
        for lag in [5, 10, 15, 20]:
            df[f'BRIDGE_LAG{lag}'] = df['BRIDGE_TIME'].shift(lag)
            lag_corr = df[[f'BRIDGE_LAG{lag}', 'TARGET_LAG10']].corr().iloc[0, 1]
            lag_corrs[lag] = lag_corr
            print(f"Bridge(t-{lag}) â†’ Target(t+10) ìƒê´€ê³„ìˆ˜: {lag_corr:.3f}")
        
        best_lag = max(lag_corrs, key=lambda x: abs(lag_corrs[x]))
        print(f"\nâœ¨ ìµœì  Lag: {best_lag}ë¶„ (ìƒê´€ê³„ìˆ˜: {lag_corrs[best_lag]:.3f})")
    else:
        print("âŒ ë¸Œë¦¬ì§€íƒ€ì„ ë°ì´í„° ì—†ìŒ")
    
    # 8. ì‹œê³„ì—´ ë°ì´í„° í’ˆì§ˆ ê²€ì¦
    print("\nğŸ“ˆ ì‹œê³„ì—´ ë°ì´í„° í’ˆì§ˆ:")
    print("-" * 60)
    
    if 'time' in df.columns:
        # ì‹œê°„ ê°„ê²© ë¶„ì„
        time_diff = df['time'].diff().dt.total_seconds() / 60  # ë¶„ ë‹¨ìœ„
        time_interval = time_diff.mode().values[0] if len(time_diff.mode()) > 0 else time_diff.median()
        
        print(f"ë°ì´í„° ê°„ê²©: {time_interval:.0f}ë¶„")
        print(f"ì´ ê¸°ê°„: {df['time'].min().date()} ~ {df['time'].max().date()}")
        print(f"ì´ ì¼ìˆ˜: {(df['time'].max() - df['time'].min()).days}ì¼")
        
        # ê²°ì¸¡ êµ¬ê°„ í™•ì¸
        missing_intervals = time_diff[time_diff > time_interval * 2].count()
        print(f"ê²°ì¸¡ êµ¬ê°„: {missing_intervals}ê°œ")
        
        # 20ë¶„ ìœˆë„ìš°ë¡œ 10ë¶„ ì˜ˆì¸¡ ê°€ëŠ¥ ìƒ˜í”Œ ìˆ˜
        valid_samples = len(df) - 30  # 20ë¶„ ì…ë ¥ + 10ë¶„ í›„ íƒ€ê²Ÿ
        print(f"í•™ìŠµ ê°€ëŠ¥ ìƒ˜í”Œ: {valid_samples:,}ê°œ")
        
        if valid_samples > 10000:
            print("   âœ… ì¶©ë¶„í•œ í•™ìŠµ ë°ì´í„°")
        elif valid_samples > 5000:
            print("   âš ï¸ ì ì ˆí•œ í•™ìŠµ ë°ì´í„°")
        else:
            print("   âŒ í•™ìŠµ ë°ì´í„° ë¶€ì¡±")
    
    # 9. ëª¨ë¸ë³„ êµ¬ì¶• ê°€ëŠ¥ì„± í‰ê°€
    print("\nğŸ¤– ëª¨ë¸ êµ¬ì¶• ê°€ëŠ¥ì„± í‰ê°€:")
    print("-" * 60)
    
    score_ratio = (available_score / total_score * 100) if total_score > 0 else 0
    
    # í•„ìˆ˜ ì¡°ê±´ í™•ì¸
    has_target = validation_results['íƒ€ê²Ÿ']['found'] > 0
    has_inflow = validation_results['ìœ ì…_í•„ìˆ˜']['found'] >= 2
    has_outflow = validation_results['ìœ ì¶œ_í•„ìˆ˜']['found'] >= 2
    has_bridge = validation_results['ë¸Œë¦¬ì§€íƒ€ì„']['found'] > 0
    
    print(f"\nğŸ“Š ë°ì´í„° ì¤€ë¹„ë„: {score_ratio:.1f}%")
    print(f"   â€¢ íƒ€ê²Ÿ: {'âœ…' if has_target else 'âŒ'}")
    print(f"   â€¢ ìœ ì…: {'âœ…' if has_inflow else 'âŒ'} ({validation_results['ìœ ì…_í•„ìˆ˜']['found']}/4)")
    print(f"   â€¢ ìœ ì¶œ: {'âœ…' if has_outflow else 'âŒ'} ({validation_results['ìœ ì¶œ_í•„ìˆ˜']['found']}/4)")
    print(f"   â€¢ ë¸Œë¦¬ì§€íƒ€ì„: {'âœ…' if has_bridge else 'âŒ'}")
    
    # Model 1: PatchTST í‰ê°€
    print("\nğŸ“ Model 1: PatchTST (ì „ì²´ ê· í˜•)")
    if has_target and (has_inflow or has_outflow):
        print("   âœ… êµ¬ì¶• ê°€ëŠ¥")
        print("   - ê¸°ë³¸ ì‹œê³„ì—´ íŒ¨í„´ í•™ìŠµ ê°€ëŠ¥")
        print("   - ë¸Œë¦¬ì§€íƒ€ì„ìœ¼ë¡œ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥" if has_bridge else "   - ë¸Œë¦¬ì§€íƒ€ì„ ì—†ì´ë„ êµ¬ì¶• ê°€ëŠ¥")
    else:
        print("   âŒ êµ¬ì¶• ë¶ˆê°€")
        print("   - ìµœì†Œí•œ íƒ€ê²Ÿê³¼ ìœ ì…/ìœ ì¶œ ë°ì´í„° í•„ìš”")
    
    # Model 2: PatchTST + PINN í‰ê°€
    print("\nğŸ“ Model 2: PatchTST + PINN (ë¬¼ë¦¬ë²•ì¹™)")
    if has_target and has_inflow and has_outflow:
        print("   âœ… êµ¬ì¶• ê°€ëŠ¥")
        print("   - ë¬¼ë¦¬ë²•ì¹™ (ìœ ì…-ìœ ì¶œ ê· í˜•) ì ìš© ê°€ëŠ¥")
        print("   - ë¸Œë¦¬ì§€íƒ€ì„ìœ¼ë¡œ ì¶”ê°€ ì œì•½ì¡°ê±´ ê°€ëŠ¥" if has_bridge else "   - ê¸°ë³¸ ë¬¼ë¦¬ë²•ì¹™ë§Œ ì ìš©")
    else:
        print("   âš ï¸ ì œí•œì  êµ¬ì¶•")
        print("   - ìœ ì…/ìœ ì¶œ ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ ë¬¼ë¦¬ë²•ì¹™ ì œì•½")
    
    # 10. ìµœì¢… ê¶Œê³ ì‚¬í•­
    print("\nğŸ’¡ ê¶Œê³ ì‚¬í•­:")
    print("-" * 60)
    
    if score_ratio >= 70:
        print("âœ… ì¦‰ì‹œ ëª¨ë¸ êµ¬ì¶• ê°€ëŠ¥")
        print("   1. ë‘ ëª¨ë¸ ëª¨ë‘ êµ¬ì¶•í•˜ì—¬ ì„±ëŠ¥ ë¹„êµ")
        print("   2. ë¸Œë¦¬ì§€íƒ€ì„ lag ìµœì í™” ìˆ˜í–‰")
        print("   3. ë¬¼ë¦¬ë²•ì¹™ ê°€ì¤‘ì¹˜ íŠœë‹")
    elif score_ratio >= 50:
        print("âš ï¸ ê¸°ë³¸ ëª¨ë¸ êµ¬ì¶• ê°€ëŠ¥")
        print("   1. PatchTST ëª¨ë¸ ìš°ì„  êµ¬ì¶•")
        print("   2. ëˆ„ë½ ë°ì´í„° ìˆ˜ì§‘ í›„ PINN ì¶”ê°€")
        print("   3. ë¸Œë¦¬ì§€íƒ€ì„ í™œìš© ê·¹ëŒ€í™”")
    else:
        print("âŒ ì¶”ê°€ ë°ì´í„° ìˆ˜ì§‘ í•„ìš”")
        print("   1. ìœ ì…/ìœ ì¶œ ì»¬ëŸ¼ í™•ë³´ ìš°ì„ ")
        print("   2. ë¸Œë¦¬ì§€íƒ€ì„ ë°ì´í„° í’ˆì§ˆ ê°œì„ ")
        print("   3. ìµœì†Œ 1ê°œì›” ì´ìƒ ë°ì´í„° ì¶•ì ")
    
    # ê²°ê³¼ ì €ì¥
    validation_summary = {
        'ë°ì´í„°ì¤€ë¹„ë„': f"{score_ratio:.1f}%",
        'íƒ€ê²Ÿì¡´ì¬': has_target,
        'ìœ ì…ì»¬ëŸ¼': validation_results['ìœ ì…_í•„ìˆ˜']['found'],
        'ìœ ì¶œì»¬ëŸ¼': validation_results['ìœ ì¶œ_í•„ìˆ˜']['found'],
        'ë¸Œë¦¬ì§€íƒ€ì„': has_bridge,
        'PatchTSTêµ¬ì¶•ê°€ëŠ¥': has_target and (has_inflow or has_outflow),
        'PINNêµ¬ì¶•ê°€ëŠ¥': has_target and has_inflow and has_outflow,
        'ì´ìƒ˜í”Œìˆ˜': len(df),
        'ê²€ì¦ì‹œê°„': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    }
    
    # CSVë¡œ ì €ì¥
    pd.DataFrame([validation_summary]).to_csv('model_validation_result.csv', index=False, encoding='utf-8-sig')
    print("\nğŸ’¾ ê²€ì¦ ê²°ê³¼ ì €ì¥: model_validation_result.csv")
    
    return validation_results, df

# ì‹¤í–‰
if __name__ == "__main__":
    results, data = validate_real_data()
    print("\n" + "=" * 80)
    print("ğŸ ê²€ì¦ ì™„ë£Œ!")
    print("=" * 80)