"""
실제 CSV 38개 컬럼 상세 평가
- 202509월.csv 로드 (STAT_DT 제외 38개)
- 각 컬럼별 상세 정보 및 평가
"""

import pandas as pd
import numpy as np
import os
from datetime import datetime

def evaluate_38_columns_detailed():
    """실제 38개 컬럼 상세 평가"""
    
    print("="*80)
    print("🔍 실제 38개 컬럼 상세 평가")
    print(f"📅 평가 시간: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("="*80)
    
    # 38개 컬럼 상세 정의
    columns_definition = [
        {"컬럼명": "CURRENT_M16A_3F_JOB_2", "카테고리": "타겟", "V3사용": "O", "V4필수도": "필수", 
         "점수": 100, "300+기여도": 100, "타겟상관도": 100, "유입영향도": 0, "유출영향도": 0, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "HUBROOM 내 총 재고(타겟)"},
        
        # 유입 컬럼
        {"컬럼명": "M16A_6F_TO_HUB_JOB", "카테고리": "유입", "V3사용": "O", "V4필수도": "필수", 
         "점수": 70, "300+기여도": 70, "타겟상관도": 65, "유입영향도": 100, "유출영향도": 0, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "M16A 6F→HUB 유입"},
        
        {"컬럼명": "M16A_2F_TO_HUB_JOB2", "카테고리": "유입", "V3사용": "O", "V4필수도": "필수", 
         "점수": 65, "300+기여도": 65, "타겟상관도": 60, "유입영향도": 100, "유출영향도": 0, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "M16A 2F→HUB 유입2"},
        
        {"컬럼명": "M14A_3F_TO_HUB_JOB2", "카테고리": "유입", "V3사용": "O", "V4필수도": "필수", 
         "점수": 65, "300+기여도": 65, "타겟상관도": 60, "유입영향도": 100, "유출영향도": 0, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "M14A 3F→HUB 유입2"},
        
        {"컬럼명": "M14B_7F_TO_HUB_JOB2", "카테고리": "유입", "V3사용": "O", "V4필수도": "필수", 
         "점수": 65, "300+기여도": 65, "타겟상관도": 60, "유입영향도": 100, "유출영향도": 0, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "M14B 7F→HUB 유입2"},
        
        {"컬럼명": "M16B_10F_TO_HUB_JOB", "카테고리": "유입", "V3사용": "X", "V4필수도": "선택", 
         "점수": 25, "300+기여도": 25, "타겟상관도": 20, "유입영향도": 100, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M16B 10F→HUB 유입"},
        
        # 유출 컬럼
        {"컬럼명": "M16A_3F_TO_M16A_6F_JOB", "카테고리": "유출", "V3사용": "O", "V4필수도": "필수", 
         "점수": 60, "300+기여도": 60, "타겟상관도": 55, "유입영향도": 0, "유출영향도": 100, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "HUB→6F 유출"},
        
        {"컬럼명": "M16A_3F_TO_M16A_2F_JOB", "카테고리": "유출", "V3사용": "O", "V4필수도": "필수", 
         "점수": 55, "300+기여도": 55, "타겟상관도": 50, "유입영향도": 0, "유출영향도": 100, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "HUB→2F 유출"},
        
        {"컬럼명": "M16A_3F_TO_M14A_3F_JOB", "카테고리": "유출", "V3사용": "O", "V4필수도": "필수", 
         "점수": 55, "300+기여도": 55, "타겟상관도": 50, "유입영향도": 0, "유출영향도": 100, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "HUB→M14A 유출"},
        
        {"컬럼명": "M16A_3F_TO_M14B_7F_JOB", "카테고리": "유출", "V3사용": "O", "V4필수도": "필수", 
         "점수": 55, "300+기여도": 55, "타겟상관도": 50, "유입영향도": 0, "유출영향도": 100, 
         "물리법칙": "핵심", "대체가능성": "불가", "설명": "HUB→M14B 유출"},
        
        {"컬럼명": "M16A_3F_TO_3F_MLUD_JOB", "카테고리": "유출", "V3사용": "X", "V4필수도": "선택", 
         "점수": 35, "300+기여도": 35, "타겟상관도": 30, "유입영향도": 0, "유출영향도": 100, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "HUB→MLUD 유출"},
        
        # CMD 컬럼
        {"컬럼명": "M16A_3F_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "필수", 
         "점수": 85, "300+기여도": 85, "타겟상관도": 75, "유입영향도": 40, "유출영향도": 35, 
         "물리법칙": "핵심", "대체가능성": "부분가능", "설명": "HUB 내 총 CMD"},
        
        {"컬럼명": "M16A_6F_TO_HUB_CMD", "카테고리": "외부CMD", "V3사용": "X", "V4필수도": "권장", 
         "점수": 55, "300+기여도": 55, "타겟상관도": 45, "유입영향도": 80, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "부분가능", "설명": "6F→HUB 이동중"},
        
        {"컬럼명": "M16A_2F_TO_HUB_CMD", "카테고리": "외부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 50, "300+기여도": 50, "타겟상관도": 40, "유입영향도": 80, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "부분가능", "설명": "2F→HUB 이동중"},
        
        {"컬럼명": "M14A_3F_TO_HUB_CMD", "카테고리": "외부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 50, "300+기여도": 50, "타겟상관도": 40, "유입영향도": 80, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "부분가능", "설명": "M14A→HUB 이동중"},
        
        {"컬럼명": "M14B_7F_TO_HUB_CMD", "카테고리": "외부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 50, "300+기여도": 50, "타겟상관도": 40, "유입영향도": 80, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "부분가능", "설명": "M14B→HUB 이동중"},
        
        {"컬럼명": "M16A_3F_TO_M16A_LFT_AI_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 30, "300+기여도": 30, "타겟상관도": 25, "유입영향도": 30, "유출영향도": 30, 
         "물리법칙": "보조", "대체가능성": "가능", "설명": "LFT AI 이동"},
        
        {"컬럼명": "M16A_3F_TO_M16A_MLUD_AI_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 20, "300+기여도": 20, "타겟상관도": 20, "유입영향도": 20, "유출영향도": 20, 
         "물리법칙": "보조", "대체가능성": "가능", "설명": "MLUD AI 이동"},
        
        {"컬럼명": "M16A_3F_TO_M16A_3F_STB_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 20, "300+기여도": 20, "타겟상관도": 20, "유입영향도": 20, "유출영향도": 20, 
         "물리법칙": "보조", "대체가능성": "가능", "설명": "STB 이동"},
        
        {"컬럼명": "M16A_3F_TO_M14A_CNV_AI_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 30, "300+기여도": 30, "타겟상관도": 25, "유입영향도": 0, "유출영향도": 50, 
         "물리법칙": "보조", "대체가능성": "가능", "설명": "M14A CNV 이동"},
        
        {"컬럼명": "M16A_3F_TO_M14B_LFT_AI_CMD", "카테고리": "내부CMD", "V3사용": "X", "V4필수도": "선택", 
         "점수": 30, "300+기여도": 30, "타겟상관도": 25, "유입영향도": 0, "유출영향도": 50, 
         "물리법칙": "보조", "대체가능성": "가능", "설명": "M14B LFT 이동"},
        
        # MaxCapa 컬럼
        {"컬럼명": "M16A_6F_LFT_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 50, "300+기여도": 50, "타겟상관도": 40, "유입영향도": 50, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "6F LFT 최대용량"},
        
        {"컬럼명": "M16A_2F_LFT_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 45, "300+기여도": 45, "타겟상관도": 35, "유입영향도": 50, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "2F LFT 최대용량"},
        
        {"컬럼명": "M14A_3F_CNV_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 45, "300+기여도": 45, "타겟상관도": 35, "유입영향도": 50, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M14A CNV 최대용량"},
        
        {"컬럼명": "M14B_7F_LFT_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 45, "300+기여도": 45, "타겟상관도": 35, "유입영향도": 50, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M14B LFT 최대용량"},
        
        {"컬럼명": "M16A_3F_LFT_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 50, "300+기여도": 50, "타겟상관도": 40, "유입영향도": 0, "유출영향도": 50, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "3F LFT 최대용량"},
        
        {"컬럼명": "M16A_3F_CNV_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 45, "300+기여도": 45, "타겟상관도": 35, "유입영향도": 0, "유출영향도": 50, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "3F CNV 최대용량"},
        
        {"컬럼명": "M16A_3F_M14BLFT_MAXCAPA", "카테고리": "MaxCapa", "V3사용": "X", "V4필수도": "선택", 
         "점수": 45, "300+기여도": 45, "타겟상관도": 35, "유입영향도": 0, "유출영향도": 50, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "3F-M14B LFT 용량"},
        
        # 극단값지표
        {"컬럼명": "M16A_3F_STORAGE_UTIL", "카테고리": "극단값지표", "V3사용": "X", "V4필수도": "필수", 
         "점수": 95, "300+기여도": 95, "타겟상관도": 85, "유입영향도": 30, "유출영향도": 20, 
         "물리법칙": "핵심", "대체가능성": "가능", "설명": "Storage 활용률"},
        
        # 대체경로
        {"컬럼명": "M16A_6F_TO_HUB_JOB_ALT", "카테고리": "대체경로", "V3사용": "X", "V4필수도": "제외", 
         "점수": 15, "300+기여도": 15, "타겟상관도": 10, "유입영향도": 30, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "6F 대체경로"},
        
        {"컬럼명": "M16A_2F_TO_HUB_JOB_ALT", "카테고리": "대체경로", "V3사용": "X", "V4필수도": "제외", 
         "점수": 15, "300+기여도": 15, "타겟상관도": 10, "유입영향도": 30, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "2F 대체경로"},
        
        {"컬럼명": "M14A_3F_TO_HUB_JOB_ALT", "카테고리": "대체경로", "V3사용": "X", "V4필수도": "제외", 
         "점수": 15, "300+기여도": 15, "타겟상관도": 10, "유입영향도": 30, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M14A 대체경로"},
        
        {"컬럼명": "M14B_7F_TO_HUB_JOB_ALT", "카테고리": "대체경로", "V3사용": "X", "V4필수도": "제외", 
         "점수": 15, "300+기여도": 15, "타겟상관도": 10, "유입영향도": 30, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M14B 대체경로"},
        
        # 층간이동
        {"컬럼명": "M16A_6F_TO_2F_JOB", "카테고리": "층간이동", "V3사용": "X", "V4필수도": "제외", 
         "점수": 10, "300+기여도": 10, "타겟상관도": 15, "유입영향도": 20, "유출영향도": 20, 
         "물리법칙": "무관", "대체가능성": "불가", "설명": "6F→2F 이동"},
        
        {"컬럼명": "M16A_2F_TO_6F_JOB", "카테고리": "층간이동", "V3사용": "X", "V4필수도": "제외", 
         "점수": 10, "300+기여도": 10, "타겟상관도": 15, "유입영향도": 20, "유출영향도": 20, 
         "물리법칙": "무관", "대체가능성": "불가", "설명": "2F→6F 이동"},
        
        # OFS
        {"컬럼명": "M14_TO_M16_OFS_CUR", "카테고리": "OFS", "V3사용": "X", "V4필수도": "선택", 
         "점수": 40, "300+기여도": 40, "타겟상관도": 35, "유입영향도": 40, "유출영향도": 0, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M14→M16 OFS"},
        
        {"컬럼명": "M16_TO_M14_OFS_CUR", "카테고리": "OFS", "V3사용": "X", "V4필수도": "선택", 
         "점수": 40, "300+기여도": 40, "타겟상관도": 35, "유입영향도": 0, "유출영향도": 40, 
         "물리법칙": "보조", "대체가능성": "불가", "설명": "M16→M14 OFS"},
    ]
    
    # CSV 로드 및 검증
    actual_columns = []
    if os.path.exists('202509월.csv'):
        df = pd.read_csv('202509월.csv')
        actual_columns = [col for col in df.columns if col != 'STAT_DT']
        print(f"\n✅ CSV 로드 성공: {len(df)}행 × {len(actual_columns)}열")
    else:
        print("\n❌ 202509월.csv 파일 없음")
        return None
    
    # 브리지타임 확인
    bridge_exists = os.path.exists('브릿지타임.CSV')
    if bridge_exists:
        print("✅ 브릿지타임.CSV 존재")
    
    # 평가 결과 생성
    print("\n" + "="*60)
    print("📊 38개 컬럼 상세 평가")
    print("="*60)
    
    results = []
    total_score = 0
    actual_score = 0
    
    for col_info in columns_definition:
        col_name = col_info['컬럼명']
        if col_name in actual_columns:
            col_info['존재여부'] = "✅"
            actual_score += col_info['점수']
        else:
            col_info['존재여부'] = "❌"
        total_score += col_info['점수']
        results.append(col_info)
    
    # DataFrame 생성
    df_result = pd.DataFrame(results)
    
    # 카테고리별 집계
    category_summary = df_result.groupby('카테고리').agg({
        '점수': 'sum',
        '존재여부': lambda x: (x == '✅').sum()
    }).rename(columns={'존재여부': '존재개수'})
    category_summary['전체개수'] = df_result.groupby('카테고리').size()
    
    print("\n카테고리별 현황:")
    print("-"*60)
    print(category_summary)
    
    # 최종 점수
    print(f"\n총 점수: {actual_score}/{total_score} ({actual_score/total_score*100:.1f}%)")
    
    # 물리법칙별 집계
    physics_summary = df_result[df_result['물리법칙'] == '핵심'].agg({
        '점수': 'sum',
        '존재여부': lambda x: (x == '✅').sum()
    })
    
    print(f"\n물리법칙 핵심 컬럼: {physics_summary['존재여부']}개 존재")
    
    # CSV 저장
    output_file = '38columns_evaluation.csv'
    df_result.to_csv(output_file, index=False, encoding='utf-8-sig')
    print(f"\n💾 평가 결과 저장: {output_file}")
    
    # 모델 구축 가능성
    print("\n" + "="*60)
    print("🤖 모델 구축 가능성")
    print("="*60)
    
    score_ratio = actual_score/total_score*100
    if score_ratio >= 75:
        print("Model 1 (PatchTST): ✅ 구축 가능")
        print("Model 2 (PINN): ✅ 구축 가능")
    elif score_ratio >= 65:
        print("Model 1 (PatchTST): ✅ 구축 가능")
        print("Model 2 (PINN): ⚠️ 제한적 구축")
    else:
        print("Model 1 (PatchTST): ⚠️ 제한적 구축")
        print("Model 2 (PINN): ❌ 구축 어려움")
    
    return df_result

# 실행
if __name__ == "__main__":
    result = evaluate_38_columns_detailed()
    print("\n✅ 평가 완료!")