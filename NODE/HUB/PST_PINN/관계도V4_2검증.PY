# -*- coding: utf-8 -*-
"""
V4 ë°ì´í„° ê²€ì¦ ê²°ê³¼ë¥¼ CSVë¡œ ì¶œë ¥í•˜ëŠ” ì½”ë“œ
ê²€ì¦ ì½”ë“œ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„¸ ë¶„ì„í‘œ ìƒì„±
"""

import pandas as pd
import numpy as np
import os
from datetime import datetime

def generate_v4_validation_report():
    """V4 ê²€ì¦ ê²°ê³¼ CSV ìƒì„±"""
    
    print("="*80)
    print("ğŸ“Š V4 ë°ì´í„° ê²€ì¦ ê²°ê³¼ CSV ìƒì„±")
    print(f"ğŸ“… ìƒì„± ì‹œê°„: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    print("="*80)
    
    # ë°ì´í„° ë¡œë“œ (ê²€ì¦ìš©)
    data_path = 'data/HUB_0509_TO_0730_DATA.CSV'
    
    # ì‹¤ì œ ì»¬ëŸ¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    existing_cols = set()
    if os.path.exists(data_path):
        df = pd.read_csv(data_path)
        existing_cols = set(df.columns)
    
    # ì»¬ëŸ¼ë³„ ìƒì„¸ ì •ë³´ ì •ì˜
    columns_info = [
        # V3 ê¸°ë³¸ ì»¬ëŸ¼ (9ê°œ)
        {"No": 1, "ì»¬ëŸ¼ëª…": "CURRENT_M16A_3F_JOB_2", "ì¹´í…Œê³ ë¦¬": "íƒ€ê²Ÿ", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 100, "300+ê¸°ì—¬ë„": 100, "íƒ€ê²Ÿìƒê´€ë„": 100, "ìœ ì…ì˜í–¥ë„": 0, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 2, "ì»¬ëŸ¼ëª…": "M16A_6F_TO_HUB_JOB", "ì¹´í…Œê³ ë¦¬": "ìœ ì…", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 70, "300+ê¸°ì—¬ë„": 70, "íƒ€ê²Ÿìƒê´€ë„": 65, "ìœ ì…ì˜í–¥ë„": 100, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 3, "ì»¬ëŸ¼ëª…": "M16A_2F_TO_HUB_JOB2", "ì¹´í…Œê³ ë¦¬": "ìœ ì…", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 65, "300+ê¸°ì—¬ë„": 65, "íƒ€ê²Ÿìƒê´€ë„": 60, "ìœ ì…ì˜í–¥ë„": 100, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 4, "ì»¬ëŸ¼ëª…": "M14A_3F_TO_HUB_JOB2", "ì¹´í…Œê³ ë¦¬": "ìœ ì…", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 65, "300+ê¸°ì—¬ë„": 65, "íƒ€ê²Ÿìƒê´€ë„": 60, "ìœ ì…ì˜í–¥ë„": 100, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 5, "ì»¬ëŸ¼ëª…": "M14B_7F_TO_HUB_JOB2", "ì¹´í…Œê³ ë¦¬": "ìœ ì…", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 65, "300+ê¸°ì—¬ë„": 65, "íƒ€ê²Ÿìƒê´€ë„": 60, "ìœ ì…ì˜í–¥ë„": 100, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 6, "ì»¬ëŸ¼ëª…": "M16A_3F_TO_M16A_6F_JOB", "ì¹´í…Œê³ ë¦¬": "ìœ ì¶œ", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 60, "300+ê¸°ì—¬ë„": 60, "íƒ€ê²Ÿìƒê´€ë„": 55, "ìœ ì…ì˜í–¥ë„": 0, "ìœ ì¶œì˜í–¥ë„": 100, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 7, "ì»¬ëŸ¼ëª…": "M16A_3F_TO_M16A_2F_JOB", "ì¹´í…Œê³ ë¦¬": "ìœ ì¶œ", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 55, "300+ê¸°ì—¬ë„": 55, "íƒ€ê²Ÿìƒê´€ë„": 50, "ìœ ì…ì˜í–¥ë„": 0, "ìœ ì¶œì˜í–¥ë„": 100, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 8, "ì»¬ëŸ¼ëª…": "M16A_3F_TO_M14A_3F_JOB", "ì¹´í…Œê³ ë¦¬": "ìœ ì¶œ", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 55, "300+ê¸°ì—¬ë„": 55, "íƒ€ê²Ÿìƒê´€ë„": 50, "ìœ ì…ì˜í–¥ë„": 0, "ìœ ì¶œì˜í–¥ë„": 100, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 9, "ì»¬ëŸ¼ëª…": "M16A_3F_TO_M14B_7F_JOB", "ì¹´í…Œê³ ë¦¬": "ìœ ì¶œ", "V3ì‚¬ìš©": "O", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 55, "300+ê¸°ì—¬ë„": 55, "íƒ€ê²Ÿìƒê´€ë„": 50, "ìœ ì…ì˜í–¥ë„": 0, "ìœ ì¶œì˜í–¥ë„": 100, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        # V4 í•µì‹¬ ì¶”ê°€ ì»¬ëŸ¼ (4ê°œ)
        {"No": 10, "ì»¬ëŸ¼ëª…": "M16A_3F_STORAGE_UTIL", "ì¹´í…Œê³ ë¦¬": "ê·¹ë‹¨ê°’ì§€í‘œ", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 95, "300+ê¸°ì—¬ë„": 95, "íƒ€ê²Ÿìƒê´€ë„": 85, "ìœ ì…ì˜í–¥ë„": 30, "ìœ ì¶œì˜í–¥ë„": 20, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ê°€ëŠ¥"},
         
        {"No": 11, "ì»¬ëŸ¼ëª…": "M16A_3F_CMD", "ì¹´í…Œê³ ë¦¬": "ê·¹ë‹¨ê°’ì§€í‘œ", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 85, "300+ê¸°ì—¬ë„": 85, "íƒ€ê²Ÿìƒê´€ë„": 75, "ìœ ì…ì˜í–¥ë„": 40, "ìœ ì¶œì˜í–¥ë„": 35, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶€ë¶„ê°€ëŠ¥"},
         
        {"No": 12, "ì»¬ëŸ¼ëª…": "M16A_3F_VHL_ERR_CNT", "ì¹´í…Œê³ ë¦¬": "ê·¹ë‹¨ê°’ì§€í‘œ", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "í•„ìˆ˜", 
         "ì ìˆ˜": 80, "300+ê¸°ì—¬ë„": 80, "íƒ€ê²Ÿìƒê´€ë„": 70, "ìœ ì…ì˜í–¥ë„": 25, "ìœ ì¶œì˜í–¥ë„": 30, 
         "ë¬¼ë¦¬ë²•ì¹™": "í•µì‹¬", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        {"No": 13, "ì»¬ëŸ¼ëª…": "CURRENT_M16A_3F_JOB", "ì¹´í…Œê³ ë¦¬": "ì¬ê³ ë¶€ë¶„", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 70, "300+ê¸°ì—¬ë„": 70, "íƒ€ê²Ÿìƒê´€ë„": 90, "ìœ ì…ì˜í–¥ë„": 20, "ìœ ì¶œì˜í–¥ë„": 20, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶ˆê°€"},
         
        # V4 ê¶Œì¥ ì»¬ëŸ¼ (6ê°œ)
        {"No": 14, "ì»¬ëŸ¼ëª…": "M16A_6F_TO_HUB_CMD", "ì¹´í…Œê³ ë¦¬": "ì´ë™CMD", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 55, "300+ê¸°ì—¬ë„": 55, "íƒ€ê²Ÿìƒê´€ë„": 45, "ìœ ì…ì˜í–¥ë„": 80, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶€ë¶„ê°€ëŠ¥"},
         
        {"No": 15, "ì»¬ëŸ¼ëª…": "M14A_3F_TO_HUB_CMD", "ì¹´í…Œê³ ë¦¬": "ì´ë™CMD", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 50, "300+ê¸°ì—¬ë„": 50, "íƒ€ê²Ÿìƒê´€ë„": 40, "ìœ ì…ì˜í–¥ë„": 80, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶€ë¶„ê°€ëŠ¥"},
         
        {"No": 16, "ì»¬ëŸ¼ëª…": "M14B_7F_TO_HUB_CMD", "ì¹´í…Œê³ ë¦¬": "ì´ë™CMD", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 50, "300+ê¸°ì—¬ë„": 50, "íƒ€ê²Ÿìƒê´€ë„": 40, "ìœ ì…ì˜í–¥ë„": 80, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ë¶€ë¶„ê°€ëŠ¥"},
         
        {"No": 17, "ì»¬ëŸ¼ëª…": "M16A_6F_LFT_MAXCAPA_UTIL", "ì¹´í…Œê³ ë¦¬": "ë³‘ëª©ì§€í‘œ", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 60, "300+ê¸°ì—¬ë„": 60, "íƒ€ê²Ÿìƒê´€ë„": 45, "ìœ ì…ì˜í–¥ë„": 60, "ìœ ì¶œì˜í–¥ë„": 40, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ê°€ëŠ¥"},
         
        {"No": 18, "ì»¬ëŸ¼ëª…": "M16A_3F_LFT_MAXCAPA_UTIL", "ì¹´í…Œê³ ë¦¬": "ë³‘ëª©ì§€í‘œ", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 60, "300+ê¸°ì—¬ë„": 60, "íƒ€ê²Ÿìƒê´€ë„": 45, "ìœ ì…ì˜í–¥ë„": 40, "ìœ ì¶œì˜í–¥ë„": 60, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ê°€ëŠ¥"},
         
        {"No": 19, "ì»¬ëŸ¼ëª…": "ALL_TO_HUB_JOB", "ì¹´í…Œê³ ë¦¬": "ì§‘ê³„", "V3ì‚¬ìš©": "X", "V4í•„ìˆ˜ë„": "ê¶Œì¥", 
         "ì ìˆ˜": 60, "300+ê¸°ì—¬ë„": 60, "íƒ€ê²Ÿìƒê´€ë„": 55, "ìœ ì…ì˜í–¥ë„": 90, "ìœ ì¶œì˜í–¥ë„": 0, 
         "ë¬¼ë¦¬ë²•ì¹™": "ë³´ì¡°", "ëŒ€ì²´ê°€ëŠ¥ì„±": "ìƒì„±ê°€ëŠ¥"},
    ]
    
    # DataFrame ìƒì„±
    df_result = pd.DataFrame(columns_info)
    
    # ê²€ì¦ ê²°ê³¼ ì¶”ê°€
    def check_column_status(col_name):
        if col_name in existing_cols:
            return "âœ…ì¡´ì¬"
        else:
            return "âŒì—†ìŒ"
    
    df_result['ê²€ì¦ê²°ê³¼'] = df_result['ì»¬ëŸ¼ëª…'].apply(check_column_status)
    
    # ê¶Œì¥ì¡°ì¹˜ ì¶”ê°€
    def get_recommendation(row):
        if row['ê²€ì¦ê²°ê³¼'] == "âœ…ì¡´ì¬":
            if row['V3ì‚¬ìš©'] == "O":
                return "ìœ ì§€"
            else:
                return "V4ì¶”ê°€"
        else:
            if row['V4í•„ìˆ˜ë„'] == "í•„ìˆ˜":
                if row['ëŒ€ì²´ê°€ëŠ¥ì„±'] == "ê°€ëŠ¥":
                    return "ëŒ€ì²´ìƒì„±"
                elif row['ëŒ€ì²´ê°€ëŠ¥ì„±'] == "ë¶€ë¶„ê°€ëŠ¥":
                    return "ë¶€ë¶„ëŒ€ì²´"
                else:
                    return "ë°ì´í„°ìš”ì²­"
            else:
                return "ì„ íƒì "
    
    df_result['ê¶Œì¥ì¡°ì¹˜'] = df_result.apply(get_recommendation, axis=1)
    
    # ì ìˆ˜ ê³„ì‚° ì¶”ê°€
    v3_total = df_result[df_result['V3ì‚¬ìš©'] == 'O']['ì ìˆ˜'].sum()
    v4_critical = df_result[(df_result['V4í•„ìˆ˜ë„'] == 'í•„ìˆ˜') & (df_result['V3ì‚¬ìš©'] == 'X')]['ì ìˆ˜'].sum()
    v4_recommended = df_result[(df_result['V4í•„ìˆ˜ë„'] == 'ê¶Œì¥') & (df_result['V3ì‚¬ìš©'] == 'X')]['ì ìˆ˜'].sum()
    
    # ì´ì  ê³„ì‚°
    available_score = df_result[df_result['ê²€ì¦ê²°ê³¼'] == 'âœ…ì¡´ì¬']['ì ìˆ˜'].sum()
    total_score = df_result['ì ìˆ˜'].sum()
    
    # CSV íŒŒì¼ë¡œ ì €ì¥
    output_file = 'v4_validation_report.csv'
    df_result.to_csv(output_file, index=False, encoding='utf-8-sig')
    print(f"\nâœ… CSV íŒŒì¼ ìƒì„± ì™„ë£Œ: {output_file}")
    
    # ìš”ì•½ ì •ë³´ ì¶œë ¥
    print("\nğŸ“Š ê²€ì¦ ìš”ì•½:")
    print("-"*40)
    print(f"ì „ì²´ ì»¬ëŸ¼ ìˆ˜: {len(df_result)}ê°œ")
    print(f"V3 ì‚¬ìš© ì»¬ëŸ¼: {len(df_result[df_result['V3ì‚¬ìš©'] == 'O'])}ê°œ")
    print(f"V4 í•„ìˆ˜ ì¶”ê°€: {len(df_result[(df_result['V4í•„ìˆ˜ë„'] == 'í•„ìˆ˜') & (df_result['V3ì‚¬ìš©'] == 'X')])}ê°œ")
    print(f"V4 ê¶Œì¥ ì¶”ê°€: {len(df_result[(df_result['V4í•„ìˆ˜ë„'] == 'ê¶Œì¥') & (df_result['V3ì‚¬ìš©'] == 'X')])}ê°œ")
    print(f"\nì¡´ì¬í•˜ëŠ” ì»¬ëŸ¼: {len(df_result[df_result['ê²€ì¦ê²°ê³¼'] == 'âœ…ì¡´ì¬'])}ê°œ")
    print(f"ëˆ„ë½ëœ ì»¬ëŸ¼: {len(df_result[df_result['ê²€ì¦ê²°ê³¼'] == 'âŒì—†ìŒ'])}ê°œ")
    
    # ì ìˆ˜ ë¶„ì„
    print("\nğŸ“ˆ ì ìˆ˜ ë¶„ì„:")
    print("-"*40)
    print(f"V3 ê¸°ë³¸ ì ìˆ˜: {v3_total}ì ")
    print(f"V4 í•„ìˆ˜ ì ìˆ˜: {v4_critical}ì ")
    print(f"V4 ê¶Œì¥ ì ìˆ˜: {v4_recommended}ì ")
    print(f"ì‚¬ìš©ê°€ëŠ¥ ì ìˆ˜: {available_score}/{total_score}ì  ({available_score/total_score*100:.1f}%)")
    
    # ë“±ê¸‰ íŒì •
    score_ratio = available_score / total_score * 100
    if score_ratio >= 80:
        grade = "A"
    elif score_ratio >= 60:
        grade = "B"
    elif score_ratio >= 40:
        grade = "C"
    else:
        grade = "D"
    
    print(f"\nìµœì¢… ë“±ê¸‰: {grade}")
    
    return df_result

if __name__ == "__main__":
    # ì‹¤í–‰
    result_df = generate_v4_validation_report()
    
    print("\n" + "="*80)
    print("ğŸ’¾ v4_validation_report.csv íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print("ì—‘ì…€ì—ì„œ ì—´ì–´ì„œ í™•ì¸í•˜ì„¸ìš”.")
    print("="*80)