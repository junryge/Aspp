HUBROOM 극단값 예측 시스템 V4 Ultimate with Mamba Router를 완전히 구현해줘.

=== 시스템 아키텍처 ===
1. Model 1 (Safety Guard): PatchTST 기반, 300 이하 오탐 최소화 전문
2. Model 2 (Extreme Hunter): PatchTST+PINN, 335+ 극단값 감지 전문  
3. Mamba Router: 상황 분석 후 최적 모델 선택/결합

=== 데이터 플로우 ===
입력(20분) → Mamba Router → Model 1/2 선택 → 최종 예측(10분 후)

=== Model 1 상세 (안전 전문가) ===
- 구조: PatchTST (patch_len=5, stride=1, n_heads=4)
- 목적: 300 이하에서 False Positive < 5%
- 오버샘플링: <200(10배), 200-250(5배), 250-300(2배), 300+(1배)
- 손실함수: FP 페널티 40배
- 특징: 보수적 예측, 안정성 우선

=== Model 2 상세 (극단값 사냥꾼) ===
- 구조: PatchTST + PINN 물리법칙
- 목적: 335+ 감지율 > 50%, 310+ 감지율 > 98%
- 오버샘플링: 335+(25배), 310-335(15배), 300-310(5배), <300(1배)
- 손실함수: 335+ 미탐지 30배 페널티
- 특징: 공격적 예측, 극단값 우선

=== Mamba Router 상세 ===
- 입력: 20개 시계열 패턴
- 출력: [Model1 확률, Model2 확률, Both 확률]
- 결정 로직:
  * 확률 > 0.7: Hard routing (단일 모델)
  * 확률 < 0.7: Soft routing (가중평균)
- LSTM(64) + Dense(3, softmax) 구조

=== 학습 3단계 전략 ===
Phase 1: Model 1, 2 개별 학습 (각각의 데이터셋)
Phase 2: Router 학습 (Model 1, 2 freeze)
Phase 3: End-to-end 미세조정 (전체 unfreeze)

=== 필수 21개 컬럼 ===
타겟: CURRENT_M16A_3F_JOB_2
유입: M16A_6F_TO_HUB_JOB, M16A_2F_TO_HUB_JOB2, M14A_3F_TO_HUB_JOB2, M14B_7F_TO_HUB_JOB2, M16B_10F_TO_HUB_JOB
유출: M16A_3F_TO_M16A_6F_JOB, M16A_3F_TO_M16A_2F_JOB, M16A_3F_TO_M14A_3F_JOB, M16A_3F_TO_M14B_7F_JOB, M16A_3F_TO_3F_MLUD_JOB
CMD: M16A_3F_CMD, M16A_6F_TO_HUB_CMD, M16A_2F_TO_HUB_CMD, M14A_3F_TO_HUB_CMD, M14B_7F_TO_HUB_CMD
MaxCapa: M16A_6F_LFT_MAXCAPA, M16A_2F_LFT_MAXCAPA
극단값지표: M16A_3F_STORAGE_UTIL, BRIDGE_TIME
OFS: M14_TO_M16_OFS_CUR, M16_TO_M14_OFS_CUR

=== 물리 특성 9차원 ===
1. 현재값
2. 유입 합계
3. 유출 합계  
4. BRIDGE_TIME
5. 연속 300+ 개수
6. 연속 300+ 확률
7. STORAGE_UTIL
8. CMD 합계
9. 최근 5개 평균

=== 연속 패턴 확률 ===
0/20개 300+: 99.7% 300 이하
20/20개 300+: 98.7% 300 이상
Router가 이 확률 참고하여 모델 선택

=== 성능 목표 ===
- 335+ 감지율: 58% 이상
- False Positive: 3% 이하
- 전체 MAE: 34 이하
- Router 정확도: 85% 이상

=== 체크포인트 관리 ===
- training_state_v4_ultimate.pkl
- model1_v4.h5, model2_v4.h5, router_v4.h5
- 중단/재개 기능 필수

=== 구현 요구사항 ===
1. 전체 시스템 통합 클래스
2. 3개 모델 구현 (Model1, Model2, Router)
3. 데이터 전처리 (모델별 차별화)
4. 3단계 학습 프로세스
5. 라우팅 로직 구현
6. 성능 평가 및 시각화
7. 예측 함수 (Router 기반 동적 선택)

CSV 파일명: merged_1101_1130_filled.csv
시작 시점: 즉시 전체 구현