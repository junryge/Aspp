def predict_sequence(self, sequence):
    """ë§ˆì§€ë§‰ 5ë¶„ ì¶”ì„¸ ì§‘ì¤‘ ë¶„ì„ ë²„ì „"""
    
    past_values = sequence['past_30min_values']
    physics = sequence['physics_features']
    
    # ê¸°ë³¸ ë°ì´í„°
    recent_3 = past_values[-3:]
    recent_5 = past_values[-5:]
    recent_10 = past_values[-10:]
    first_10 = past_values[:10]
    last_10 = past_values[-10:]
    
    max_val = max(past_values)
    max_recent5 = max(recent_5)
    mean_recent5 = np.mean(recent_5)
    
    # ========================================
    # ğŸ” ë§ˆì§€ë§‰ 5ë¶„ ìƒì„¸ ì¶”ì„¸ ë¶„ì„
    # ========================================
    
    # 1. 5ë¶„ê°„ ê°œë³„ ë³€í™” ë¶„ì„
    changes = []
    for i in range(1, len(recent_5)):
        changes.append(recent_5[i] - recent_5[i-1])
    
    # 2. ìƒìŠ¹/í•˜ë½ íŒ¨í„´
    rising_steps = sum(1 for c in changes if c > 0)
    falling_steps = sum(1 for c in changes if c < 0)
    
    # 3. ë³€í™” ê°•ë„
    total_5min_change = recent_5[-1] - recent_5[0]
    avg_change = np.mean(changes) if changes else 0
    max_up = max(changes) if changes else 0
    max_down = min(changes) if changes else 0
    
    # 4. ê°€ì†ë„ ì²´í¬
    if len(changes) >= 2:
        # ìµœê·¼ ë³€í™” vs ì´ˆê¸° ë³€í™”
        recent_momentum = changes[-1]
        early_momentum = changes[0]
        acceleration = recent_momentum - early_momentum
    else:
        acceleration = 0
    
    # 5. ìµœê³ ì  ìœ„ì¹˜
    max_position = np.argmax(recent_5)  # 0~4
    is_peaking = max_position >= 3  # ìµœê³ ì ì´ ëì— ìˆìŒ
    
    # 6. ê²©ì°¨ ë¶„ì„
    gap = max_recent5 - mean_recent5
    gap_ratio = gap / max(mean_recent5, 1)
    
    # ========================================
    # ğŸ¯ ì í”„ íŒë‹¨ ë¡œì§
    # ========================================
    
    jump_score = 0
    
    # ì ìˆ˜ ê³„ì‚°
    if 240 <= max_recent5 < 280:
        
        # 1. ìœ„ì¹˜ ì ìˆ˜
        if max_recent5 >= 275:
            jump_score += 40
        elif max_recent5 >= 270:
            jump_score += 35
        elif max_recent5 >= 265:
            jump_score += 30
        elif max_recent5 >= 260:
            jump_score += 25
        elif max_recent5 >= 255:
            jump_score += 20
        elif max_recent5 >= 250:
            jump_score += 15
        elif max_recent5 >= 245:
            jump_score += 10
        else:
            jump_score += 5
        
        # 2. ìƒìŠ¹ ì¶”ì„¸ ì ìˆ˜ (í•µì‹¬!)
        if rising_steps >= 3:  # 4ë²ˆ ì¤‘ 3ë²ˆ ìƒìŠ¹
            jump_score += 30
        elif rising_steps >= 2:
            jump_score += 20
        elif rising_steps >= 1:
            jump_score += 10
        
        # 3. 5ë¶„ ì´ ë³€í™”ëŸ‰
        if total_5min_change > 5:  # 5ë¶„ê°„ 5 ì´ìƒ ìƒìŠ¹
            jump_score += 25
        elif total_5min_change > 3:
            jump_score += 15
        elif total_5min_change > 1:
            jump_score += 10
        elif total_5min_change < -3:  # í•˜ë½ ì¤‘
            jump_score -= 10
        
        # 4. ê°€ì†ë„ ì ìˆ˜
        if acceleration > 2:  # ê°€ì† ìƒìŠ¹
            jump_score += 20
        elif acceleration > 1:
            jump_score += 10
        elif acceleration < -2:  # ê°ì†
            jump_score -= 10
        
        # 5. ìµœê³ ì  ìœ„ì¹˜ ì ìˆ˜
        if is_peaking:  # ìµœê³ ì ì´ ë§ˆì§€ë§‰ì—
            jump_score += 15
        
        # 6. ê²©ì°¨ ì ìˆ˜
        if gap > 25:
            jump_score += 25
        elif gap > 20:
            jump_score += 20
        elif gap > 15:
            jump_score += 15
        elif gap > 10:
            jump_score += 10
        
        # 7. ìµœëŒ€ ìƒìŠ¹í­ ì ìˆ˜
        if max_up > 3:  # í•œ ë²ˆì— 3 ì´ìƒ ë›´ ì  ìˆìŒ
            jump_score += 15
        elif max_up > 2:
            jump_score += 10
        
        # 8. ë¬¼ë¦¬ íŠ¹ì§•
        if physics[3] > 4:  # BRIDGE_TIME
            jump_score += 10
    
    # ========================================
    # ì˜ˆì¸¡ ê²°ì •
    # ========================================
    
    # ì í”„ í™•ì • (ì ìˆ˜ 70+)
    if jump_score >= 70:
        if max_recent5 >= 275:
            predicted = mean_recent5 * 1.22
        elif max_recent5 >= 270:
            predicted = mean_recent5 * 1.20
        elif max_recent5 >= 265:
            predicted = mean_recent5 * 1.18
        elif max_recent5 >= 260:
            predicted = mean_recent5 * 1.16
        else:
            predicted = mean_recent5 * 1.14
        return predicted, "Model2"
    
    # ì í”„ ê°€ëŠ¥ (ì ìˆ˜ 50-69)
    elif jump_score >= 50:
        if max_recent5 >= 270:
            predicted = mean_recent5 * 1.15
        elif max_recent5 >= 260:
            predicted = mean_recent5 * 1.12
        else:
            predicted = mean_recent5 * 1.10
        return predicted, "Model2"
    
    # ì í”„ ì˜ì‹¬ (ì ìˆ˜ 30-49)
    elif jump_score >= 30:
        predicted = mean_recent5 * 1.08
        return predicted, "Model2"
    
    # ========================================
    # ì¼ë°˜ ì¼€ì´ìŠ¤
    # ========================================
    
    # ì´ë¯¸ ê·¹ë‹¨ê°’
    if mean_recent5 > 300:
        return mean_recent5 * 1.02, "Model2"
    
    # ëª…í™•í•œ í•˜ë½ ì¶”ì„¸
    if total_5min_change < -5 and falling_steps >= 3:
        return mean_recent5 * 0.95, "Model1"
    
    # ì•ˆì • êµ¬ê°„
    if max_val < 240:
        return mean_recent5 * 0.98, "Model1"
    
    # ê¸°ë³¸
    return mean_recent5 * 0.99, "Model1"


# ================================================================================
# ë” ê·¹ë‹¨ì ì¸ ë²„ì „ (ì í”„ë¥¼ ë” ì˜ ì¡ê¸° ìœ„í•´)
# ================================================================================

def predict_sequence_extreme(self, sequence):
    """ê·¹ë‹¨ ë²„ì „ - ìƒìŠ¹ ì‹ í˜¸ë§Œ ìˆì–´ë„ ì í”„ ì˜ˆì¸¡"""
    
    past_values = sequence['past_30min_values']
    recent_5 = past_values[-5:]
    max_recent5 = max(recent_5)
    mean_recent5 = np.mean(recent_5)
    
    # 5ë¶„ ì¶”ì„¸ë§Œ ë³´ê¸°
    is_rising = False
    for i in range(1, len(recent_5)):
        if recent_5[i] > recent_5[i-1]:
            is_rising = True
            break
    
    # MAXê°€ ë†’ê³  + ìƒìŠ¹ ì¤‘ì´ë©´ ë¬´ì¡°ê±´ ì í”„
    if max_recent5 >= 240 and is_rising:
        
        if max_recent5 >= 275:
            return max_recent5 * 1.15, "Model2"
        elif max_recent5 >= 270:
            return max_recent5 * 1.13, "Model2"
        elif max_recent5 >= 265:
            return max_recent5 * 1.12, "Model2"
        elif max_recent5 >= 260:
            return max_recent5 * 1.11, "Model2"
        elif max_recent5 >= 255:
            return max_recent5 * 1.10, "Model2"
        elif max_recent5 >= 250:
            return max_recent5 * 1.09, "Model2"
        elif max_recent5 >= 245:
            return max_recent5 * 1.08, "Model2"
        else:
            return max_recent5 * 1.07, "Model2"
    
    # ì´ë¯¸ ê·¹ë‹¨ê°’
    if mean_recent5 > 300:
        return mean_recent5 * 1.02, "Model2"
    
    # ì•ˆì „ êµ¬ê°„
    if max_recent5 < 240:
        return mean_recent5 * 0.98, "Model1"
    
    # ê¸°ë³¸
    return mean_recent5 * 1.01, "Model2"