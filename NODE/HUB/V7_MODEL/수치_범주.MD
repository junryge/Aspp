# V8 모델 개발 전략: 수치형 + 범주형 2개 모델

작성일: 2025-11-17  
목적: 10분 후 변화량 예측 - 2가지 접근 방식

---

## 📊 2가지 모델 개발 방향

### 1️⃣ 수치형 모델 (Regression Model)

**목적**
- 실제 변화량 수치를 예측 (예: +65, -30, +5)

**출력 형태**
- 연속형 숫자값 (Continuous values)
- MIN/MAX/AVG 변화량 3개 동시 예측

**중점 사항**
- **큰 변화량(±50 이상) 예측 정확도**
- 50+ 샘플에 가중치 부여
- 큰 변화량 오차 최소화

**현재 상태**
- V8-Final 모델이 이미 이 방식
- MAE: 5.92-6.77
- R²: 0.69-0.72

**개선 방향**
```python
# 가중치 적용 예시
sample_weight = np.where(abs(y_train) >= 50, 3.0, 1.0)
model.fit(X_train, y_train, sample_weight=sample_weight)
```

---

### 2️⃣ 범주형 모델 (Classification Model)

**목적**
- 변화량을 3개 구간으로 분류

**출력 형태**
- 클래스 레이블 (0, 1, 2)

**클래스 정의**
```
Class 0: ~0      (음수 또는 0, 하락/정체)
Class 1: 0~50    (작은 증가)
Class 2: 50~     (큰 증가, 급증)
```

**장점**
- 급증 구간 감지에 특화
- Precision/Recall로 성능 평가 가능
- 불균형 데이터 처리 용이 (SMOTE, class_weight)
- 의사결정이 명확 (급증인가? 아닌가?)

**알고리즘**
- XGBoost Classifier
- 클래스 가중치 자동 조정
- Multiclass 지원

---

## 🎯 실제 적용 예시

| 현재값 | 10분 후 | 실제 변화량 | 수치형 예측 | 범주형 예측 |
|--------|---------|-------------|-------------|-------------|
| 250 | 310 | +60 | +58 | Class 2 (50~) |
| 280 | 260 | -20 | -18 | Class 0 (~0) |
| 270 | 300 | +30 | +32 | Class 1 (0~50) |

---

## 🔍 2가지 모델 비교

| 항목 | 수치형 모델 | 범주형 모델 |
|------|-------------|-------------|
| **출력** | 연속형 숫자 | 클래스 (0/1/2) |
| **평가 지표** | MAE, RMSE, R² | Accuracy, Precision, Recall, F1 |
| **급증 감지** | 간접적 (수치 기반) | 직접적 (Class 2 확률) |
| **해석** | 정확한 변화량 | 구간 분류 |
| **활용** | 정밀 예측 | 경보 시스템 |
| **불균형 처리** | 가중치 | SMOTE, class_weight |

---

## 💡 실전 활용 시나리오

### 시나리오 1: 정밀 관리
```
수치형 모델 예측: +45
범주형 모델 예측: Class 1 (0~50)

→ 판단: 중간 수준 증가, 주의 관찰
```

### 시나리오 2: 급증 경보
```
수치형 모델 예측: +58
범주형 모델 예측: Class 2 (50~) 확률 92%

→ 판단: 급증 확실, 즉시 대응
```

### 시나리오 3: 모호한 경계
```
수치형 모델 예측: +48
범주형 모델 예측: Class 1 (55%), Class 2 (40%)

→ 판단: 경계 구간, 추가 모니터링
```

---

## ✅ 개발 단계

### Phase 1: 범주형 모델 개발
1. 클래스 라벨 생성
   ```python
   def create_class_labels(changes):
       labels = []
       for c in changes:
           if c < 0:
               labels.append(0)  # ~0
           elif c < 50:
               labels.append(1)  # 0~50
           else:
               labels.append(2)  # 50~
       return labels
   ```

2. XGBoost Classifier 학습
   ```python
   model = xgb.XGBClassifier(
       objective='multi:softprob',
       num_class=3,
       scale_pos_weight=5,  # Class 2 가중치
       ...
   )
   ```

3. 평가 지표 확인
   - Confusion Matrix
   - Class 2 Precision/Recall
   - ROC-AUC (One-vs-Rest)

### Phase 2: 수치형 모델 개선
1. 50+ 샘플 가중치 적용
2. 큰 변화량 오차 최소화
3. Huber Loss 등 robust loss 고려

### Phase 3: 앙상블 전략
1. 두 모델 결합
2. 범주형 신뢰도 기반 수치형 보정
3. 최종 의사결정 로직

---

## 📁 파일 구조 (예정)

```
V8_수치형_학습코드.py          # 기존 V8-Final 개선
V8_수치형_평가코드.py

V8_범주형_학습코드.py          # 새로 개발
V8_범주형_평가코드.py

V8_앙상블_평가코드.py          # 2개 모델 결합
```

---

## 🎯 다음 작업 선택

**A) 범주형 분류 모델 코드 작성**
- 새로운 학습/평가 코드 생성
- 3-class classification
- Class 2 급증 감지 최적화

**B) 수치형 모델 50+ 가중치 개선**
- 현재 V8-Final 수정
- 큰 변화량 집중 학습
- Loss function 변경

**C) 둘 다 동시 개발**
- 범주형 먼저 → 수치형 개선 → 앙상블

---

## 📌 핵심 포인트

1. **두 모델은 독립적**으로 동작
2. **범주형 모델**은 급증 감지에 특화
3. **수치형 모델**은 정밀한 변화량 예측
4. 실전에서는 **두 모델을 함께** 사용
5. 범주형 확률을 **경보 시스템**으로 활용

---

## 🚀 시작하기

**어떤 작업부터 진행할까요?**

- [ ] A) 범주형 분류 모델 코드 작성
- [ ] B) 수치형 모델 50+ 가중치 개선  
- [ ] C) 둘 다 동시에 개발