import tkinter as tk
from tkinter import ttk, filedialog, messagebox, font
import markdown
from markdown.extensions import fenced_code, tables, toc, nl2br
import webbrowser
from tkinterweb import HtmlFrame
import os
import sys

class MarkdownViewer:
    def __init__(self, root):
        self.root = root
        self.root.title("Markdown Viewer - ë§ˆí¬ë‹¤ìš´ ë·°ì–´")
        self.root.geometry("1200x800")
        
        # í˜„ì¬ íŒŒì¼ ê²½ë¡œ
        self.current_file = None
        
        # ìŠ¤íƒ€ì¼ ì„¤ì •
        self.setup_styles()
        
        # UI êµ¬ì„±
        self.setup_ui()
        
        # ë‹¨ì¶•í‚¤ ì„¤ì •
        self.setup_shortcuts()
        
    def setup_styles(self):
        """í…Œë§ˆì™€ ìŠ¤íƒ€ì¼ ì„¤ì •"""
        self.root.configure(bg='#f0f0f0')
        style = ttk.Style()
        style.theme_use('clam')
        
        # ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼
        style.configure('Title.TLabel', font=('Segoe UI', 12, 'bold'))
        style.configure('Custom.TButton', padding=5)
        
    def setup_ui(self):
        """UI êµ¬ì„±"""
        # ë©”ë‰´ë°” ìƒì„±
        self.create_menubar()
        
        # íˆ´ë°” ìƒì„±
        self.create_toolbar()
        
        # ë©”ì¸ í”„ë ˆì„ (PanedWindowë¡œ ë¶„í• )
        main_paned = ttk.PanedWindow(self.root, orient=tk.HORIZONTAL)
        main_paned.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        # ì™¼ìª½ í”„ë ˆì„ (ë§ˆí¬ë‹¤ìš´ í¸ì§‘ê¸°)
        left_frame = ttk.Frame(main_paned)
        main_paned.add(left_frame, weight=1)
        
        # ë§ˆí¬ë‹¤ìš´ í¸ì§‘ê¸° ì œëª©
        ttk.Label(left_frame, text="ğŸ“ Markdown Editor", style='Title.TLabel').pack(pady=5)
        
        # í…ìŠ¤íŠ¸ í¸ì§‘ê¸°
        text_frame = ttk.Frame(left_frame)
        text_frame.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        # ìŠ¤í¬ë¡¤ë°”
        text_scrollbar = ttk.Scrollbar(text_frame)
        text_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        # í…ìŠ¤íŠ¸ ìœ„ì ¯
        self.text_editor = tk.Text(
            text_frame,
            wrap=tk.WORD,
            font=('Consolas', 11),
            bg='#ffffff',
            fg='#333333',
            insertbackground='#007ACC',
            selectbackground='#b3d9ff',
            yscrollcommand=text_scrollbar.set,
            undo=True,
            maxundo=-1
        )
        self.text_editor.pack(fill=tk.BOTH, expand=True)
        text_scrollbar.config(command=self.text_editor.yview)
        
        # í…ìŠ¤íŠ¸ ë³€ê²½ ì´ë²¤íŠ¸ ë°”ì¸ë”©
        self.text_editor.bind('<<Modified>>', self.on_text_change)
        self.text_editor.bind('<Control-a>', self.select_all)
        
        # ì˜¤ë¥¸ìª½ í”„ë ˆì„ (HTML ë¯¸ë¦¬ë³´ê¸°)
        right_frame = ttk.Frame(main_paned)
        main_paned.add(right_frame, weight=1)
        
        # ë¯¸ë¦¬ë³´ê¸° ì œëª©
        ttk.Label(right_frame, text="ğŸ‘ï¸ Preview", style='Title.TLabel').pack(pady=5)
        
        # HTML í”„ë ˆì„
        self.html_frame = HtmlFrame(right_frame, messages_enabled=False)
        self.html_frame.pack(fill=tk.BOTH, expand=True, padx=5, pady=5)
        
        # ìƒíƒœë°”
        self.create_statusbar()
        
    def create_menubar(self):
        """ë©”ë‰´ë°” ìƒì„±"""
        menubar = tk.Menu(self.root)
        self.root.config(menu=menubar)
        
        # íŒŒì¼ ë©”ë‰´
        file_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="íŒŒì¼", menu=file_menu)
        file_menu.add_command(label="ì—´ê¸°... (Ctrl+O)", command=self.open_file)
        file_menu.add_command(label="ì €ì¥ (Ctrl+S)", command=self.save_file)
        file_menu.add_command(label="ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥...", command=self.save_as_file)
        file_menu.add_separator()
        file_menu.add_command(label="ìƒˆ íŒŒì¼ (Ctrl+N)", command=self.new_file)
        file_menu.add_separator()
        file_menu.add_command(label="HTMLë¡œ ë‚´ë³´ë‚´ê¸°", command=self.export_html)
        file_menu.add_separator()
        file_menu.add_command(label="ì¢…ë£Œ", command=self.root.quit)
        
        # í¸ì§‘ ë©”ë‰´
        edit_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="í¸ì§‘", menu=edit_menu)
        edit_menu.add_command(label="ì‹¤í–‰ ì·¨ì†Œ (Ctrl+Z)", command=self.undo)
        edit_menu.add_command(label="ë‹¤ì‹œ ì‹¤í–‰ (Ctrl+Y)", command=self.redo)
        edit_menu.add_separator()
        edit_menu.add_command(label="ì˜ë¼ë‚´ê¸° (Ctrl+X)", command=self.cut)
        edit_menu.add_command(label="ë³µì‚¬ (Ctrl+C)", command=self.copy)
        edit_menu.add_command(label="ë¶™ì—¬ë„£ê¸° (Ctrl+V)", command=self.paste)
        edit_menu.add_separator()
        edit_menu.add_command(label="ì „ì²´ ì„ íƒ (Ctrl+A)", command=self.select_all_menu)
        
        # ë³´ê¸° ë©”ë‰´
        view_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="ë³´ê¸°", menu=view_menu)
        view_menu.add_command(label="ìƒˆë¡œê³ ì¹¨ (F5)", command=self.refresh_preview)
        view_menu.add_separator()
        view_menu.add_command(label="ê¸€ê¼´ í¬ê¸° ì¦ê°€", command=self.increase_font)
        view_menu.add_command(label="ê¸€ê¼´ í¬ê¸° ê°ì†Œ", command=self.decrease_font)
        
        # ë„ì›€ë§ ë©”ë‰´
        help_menu = tk.Menu(menubar, tearoff=0)
        menubar.add_cascade(label="ë„ì›€ë§", menu=help_menu)
        help_menu.add_command(label="ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ", command=self.show_markdown_guide)
        help_menu.add_command(label="í”„ë¡œê·¸ë¨ ì •ë³´", command=self.show_about)
        
    def create_toolbar(self):
        """íˆ´ë°” ìƒì„±"""
        toolbar = ttk.Frame(self.root)
        toolbar.pack(side=tk.TOP, fill=tk.X, padx=5, pady=2)
        
        # íˆ´ë°” ë²„íŠ¼ë“¤
        buttons = [
            ("ğŸ“", "ì—´ê¸°", self.open_file),
            ("ğŸ’¾", "ì €ì¥", self.save_file),
            ("ğŸ“„", "ìƒˆ íŒŒì¼", self.new_file),
            ("|", None, None),  # êµ¬ë¶„ì„ 
            ("**B**", "êµµê²Œ", lambda: self.insert_markdown("**", "**")),
            ("*I*", "ê¸°ìš¸ì„", lambda: self.insert_markdown("*", "*")),
            ("~~S~~", "ì·¨ì†Œì„ ", lambda: self.insert_markdown("~~", "~~")),
            ("`C`", "ì½”ë“œ", lambda: self.insert_markdown("`", "`")),
            ("|", None, None),  # êµ¬ë¶„ì„ 
            ("H1", "ì œëª© 1", lambda: self.insert_markdown("# ", "")),
            ("H2", "ì œëª© 2", lambda: self.insert_markdown("## ", "")),
            ("H3", "ì œëª© 3", lambda: self.insert_markdown("### ", "")),
            ("|", None, None),  # êµ¬ë¶„ì„ 
            ("â€¢", "ëª©ë¡", lambda: self.insert_markdown("- ", "")),
            ("1.", "ë²ˆí˜¸ ëª©ë¡", lambda: self.insert_markdown("1. ", "")),
            ("[ ]", "ì²´í¬ë°•ìŠ¤", lambda: self.insert_markdown("- [ ] ", "")),
            ("|", None, None),  # êµ¬ë¶„ì„ 
            ("ğŸ”—", "ë§í¬", self.insert_link),
            ("ğŸ–¼ï¸", "ì´ë¯¸ì§€", self.insert_image),
            ("ğŸ“Š", "í‘œ", self.insert_table),
            ("|", None, None),  # êµ¬ë¶„ì„ 
            ("ğŸ”„", "ìƒˆë¡œê³ ì¹¨", self.refresh_preview),
        ]
        
        for text, tooltip, command in buttons:
            if text == "|":
                ttk.Separator(toolbar, orient=tk.VERTICAL).pack(side=tk.LEFT, padx=3, fill=tk.Y)
            else:
                btn = ttk.Button(toolbar, text=text, command=command, style='Custom.TButton', width=6)
                btn.pack(side=tk.LEFT, padx=2)
                if tooltip:
                    self.create_tooltip(btn, tooltip)
    
    def create_statusbar(self):
        """ìƒíƒœë°” ìƒì„±"""
        self.statusbar = ttk.Frame(self.root)
        self.statusbar.pack(side=tk.BOTTOM, fill=tk.X)
        
        # ìƒíƒœ ë©”ì‹œì§€
        self.status_msg = ttk.Label(self.statusbar, text="ì¤€ë¹„", relief=tk.SUNKEN)
        self.status_msg.pack(side=tk.LEFT, padx=5)
        
        # ì»¤ì„œ ìœ„ì¹˜
        self.cursor_pos = ttk.Label(self.statusbar, text="ì¤„: 1, ì—´: 1", relief=tk.SUNKEN)
        self.cursor_pos.pack(side=tk.RIGHT, padx=5)
        
        # ë¬¸ì„œ ì •ë³´
        self.doc_info = ttk.Label(self.statusbar, text="0 ë‹¨ì–´, 0 ë¬¸ì", relief=tk.SUNKEN)
        self.doc_info.pack(side=tk.RIGHT, padx=5)
        
        # ì»¤ì„œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        self.text_editor.bind('<KeyRelease>', self.update_cursor_position)
        self.text_editor.bind('<ButtonRelease>', self.update_cursor_position)
        
    def setup_shortcuts(self):
        """í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì„¤ì •"""
        self.root.bind('<Control-o>', lambda e: self.open_file())
        self.root.bind('<Control-s>', lambda e: self.save_file())
        self.root.bind('<Control-n>', lambda e: self.new_file())
        self.root.bind('<F5>', lambda e: self.refresh_preview())
        self.root.bind('<Control-plus>', lambda e: self.increase_font())
        self.root.bind('<Control-minus>', lambda e: self.decrease_font())
        
    def on_text_change(self, event=None):
        """í…ìŠ¤íŠ¸ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸"""
        if self.text_editor.edit_modified():
            self.refresh_preview()
            self.update_doc_info()
            self.text_editor.edit_modified(False)
    
    def refresh_preview(self):
        """ë¯¸ë¦¬ë³´ê¸° ìƒˆë¡œê³ ì¹¨"""
        content = self.text_editor.get(1.0, tk.END)
        html = self.markdown_to_html(content)
        self.html_frame.load_html(html)
        self.status_msg.config(text="ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ë¨")
        
    def markdown_to_html(self, markdown_text):
        """ë§ˆí¬ë‹¤ìš´ì„ HTMLë¡œ ë³€í™˜"""
        # ë§ˆí¬ë‹¤ìš´ í™•ì¥ ê¸°ëŠ¥ ì„¤ì •
        extensions = [
            'fenced_code',
            'tables',
            'toc',
            'nl2br',
            'sane_lists',
            'codehilite',
            'meta',
            'admonition'
        ]
        
        # HTMLë¡œ ë³€í™˜
        html_body = markdown.markdown(markdown_text, extensions=extensions)
        
        # ì™„ì „í•œ HTML ë¬¸ì„œ ìƒì„±
        html = f"""
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <style>
                body {{
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
                    line-height: 1.6;
                    color: #333;
                    max-width: 900px;
                    margin: 0 auto;
                    padding: 20px;
                    background: #fff;
                }}
                h1, h2, h3, h4, h5, h6 {{
                    color: #2c3e50;
                    margin-top: 24px;
                    margin-bottom: 16px;
                    font-weight: 600;
                    line-height: 1.25;
                }}
                h1 {{ font-size: 2em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }}
                h2 {{ font-size: 1.5em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }}
                h3 {{ font-size: 1.25em; }}
                code {{
                    background-color: #f6f8fa;
                    padding: 2px 4px;
                    border-radius: 3px;
                    font-family: 'Consolas', 'Monaco', monospace;
                    font-size: 0.9em;
                }}
                pre {{
                    background-color: #f6f8fa;
                    padding: 16px;
                    overflow: auto;
                    border-radius: 6px;
                    line-height: 1.45;
                }}
                pre code {{
                    background-color: transparent;
                    padding: 0;
                }}
                blockquote {{
                    border-left: 4px solid #dfe2e5;
                    padding: 0 1em;
                    color: #6a737d;
                    margin: 0;
                }}
                table {{
                    border-collapse: collapse;
                    width: 100%;
                    margin: 16px 0;
                }}
                table th, table td {{
                    border: 1px solid #dfe2e5;
                    padding: 6px 13px;
                }}
                table th {{
                    background-color: #f6f8fa;
                    font-weight: 600;
                }}
                table tr:nth-child(2n) {{
                    background-color: #f6f8fa;
                }}
                a {{
                    color: #0366d6;
                    text-decoration: none;
                }}
                a:hover {{
                    text-decoration: underline;
                }}
                img {{
                    max-width: 100%;
                    height: auto;
                }}
                hr {{
                    border: none;
                    border-top: 1px solid #e1e4e8;
                    margin: 24px 0;
                }}
                ul, ol {{
                    padding-left: 2em;
                    margin: 16px 0;
                }}
                li {{
                    margin: 4px 0;
                }}
                input[type="checkbox"] {{
                    margin-right: 4px;
                }}
                .admonition {{
                    padding: 12px;
                    margin: 16px 0;
                    border-left: 4px solid #4CAF50;
                    background-color: #f0f7ff;
                    border-radius: 4px;
                }}
                .admonition-title {{
                    font-weight: bold;
                    margin-bottom: 8px;
                }}
            </style>
        </head>
        <body>
            {html_body}
        </body>
        </html>
        """
        return html
        
    def open_file(self):
        """íŒŒì¼ ì—´ê¸°"""
        file_path = filedialog.askopenfilename(
            title="ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ì„ íƒ",
            filetypes=[("Markdown files", "*.md *.markdown"), ("All files", "*.*")]
        )
        if file_path:
            try:
                with open(file_path, 'r', encoding='utf-8') as file:
                    content = file.read()
                    self.text_editor.delete(1.0, tk.END)
                    self.text_editor.insert(1.0, content)
                    self.current_file = file_path
                    self.root.title(f"Markdown Viewer - {os.path.basename(file_path)}")
                    self.status_msg.config(text=f"íŒŒì¼ ì—´ê¸°: {os.path.basename(file_path)}")
                    self.refresh_preview()
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"íŒŒì¼ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {str(e)}")
                
    def save_file(self):
        """íŒŒì¼ ì €ì¥"""
        if self.current_file:
            try:
                content = self.text_editor.get(1.0, tk.END)
                with open(self.current_file, 'w', encoding='utf-8') as file:
                    file.write(content.rstrip())
                self.status_msg.config(text=f"ì €ì¥ë¨: {os.path.basename(self.current_file)}")
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {str(e)}")
        else:
            self.save_as_file()
            
    def save_as_file(self):
        """ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥"""
        file_path = filedialog.asksaveasfilename(
            title="ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥",
            defaultextension=".md",
            filetypes=[("Markdown files", "*.md"), ("All files", "*.*")]
        )
        if file_path:
            try:
                content = self.text_editor.get(1.0, tk.END)
                with open(file_path, 'w', encoding='utf-8') as file:
                    file.write(content.rstrip())
                self.current_file = file_path
                self.root.title(f"Markdown Viewer - {os.path.basename(file_path)}")
                self.status_msg.config(text=f"ì €ì¥ë¨: {os.path.basename(file_path)}")
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"íŒŒì¼ì„ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {str(e)}")
                
    def new_file(self):
        """ìƒˆ íŒŒì¼"""
        if messagebox.askyesno("ìƒˆ íŒŒì¼", "í˜„ì¬ ë¬¸ì„œë¥¼ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"):
            self.save_file()
        self.text_editor.delete(1.0, tk.END)
        self.current_file = None
        self.root.title("Markdown Viewer - ì œëª© ì—†ìŒ")
        self.refresh_preview()
        self.status_msg.config(text="ìƒˆ íŒŒì¼ ìƒì„±ë¨")
        
    def export_html(self):
        """HTMLë¡œ ë‚´ë³´ë‚´ê¸°"""
        file_path = filedialog.asksaveasfilename(
            title="HTMLë¡œ ë‚´ë³´ë‚´ê¸°",
            defaultextension=".html",
            filetypes=[("HTML files", "*.html"), ("All files", "*.*")]
        )
        if file_path:
            try:
                content = self.text_editor.get(1.0, tk.END)
                html = self.markdown_to_html(content)
                with open(file_path, 'w', encoding='utf-8') as file:
                    file.write(html)
                self.status_msg.config(text=f"HTML ë‚´ë³´ë‚´ê¸° ì™„ë£Œ: {os.path.basename(file_path)}")
                if messagebox.askyesno("HTML ë‚´ë³´ë‚´ê¸°", "ë¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ë³´ì‹œê² ìŠµë‹ˆê¹Œ?"):
                    webbrowser.open(file_path)
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"HTML ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: {str(e)}")
                
    def insert_markdown(self, prefix, suffix):
        """ë§ˆí¬ë‹¤ìš´ íƒœê·¸ ì‚½ì…"""
        try:
            sel_start = self.text_editor.index(tk.SEL_FIRST)
            sel_end = self.text_editor.index(tk.SEL_LAST)
            selected_text = self.text_editor.get(sel_start, sel_end)
            self.text_editor.delete(sel_start, sel_end)
            self.text_editor.insert(sel_start, f"{prefix}{selected_text}{suffix}")
        except:
            pos = self.text_editor.index(tk.INSERT)
            self.text_editor.insert(pos, f"{prefix}í…ìŠ¤íŠ¸{suffix}")
            
    def insert_link(self):
        """ë§í¬ ì‚½ì…"""
        dialog = tk.Toplevel(self.root)
        dialog.title("ë§í¬ ì‚½ì…")
        dialog.geometry("400x150")
        
        ttk.Label(dialog, text="ë§í¬ í…ìŠ¤íŠ¸:").grid(row=0, column=0, padx=10, pady=10, sticky='w')
        text_entry = ttk.Entry(dialog, width=40)
        text_entry.grid(row=0, column=1, padx=10, pady=10)
        
        ttk.Label(dialog, text="URL:").grid(row=1, column=0, padx=10, pady=10, sticky='w')
        url_entry = ttk.Entry(dialog, width=40)
        url_entry.grid(row=1, column=1, padx=10, pady=10)
        
        def insert():
            text = text_entry.get()
            url = url_entry.get()
            if text and url:
                pos = self.text_editor.index(tk.INSERT)
                self.text_editor.insert(pos, f"[{text}]({url})")
                dialog.destroy()
                
        ttk.Button(dialog, text="ì‚½ì…", command=insert).grid(row=2, column=1, padx=10, pady=10)
        
    def insert_image(self):
        """ì´ë¯¸ì§€ ì‚½ì…"""
        dialog = tk.Toplevel(self.root)
        dialog.title("ì´ë¯¸ì§€ ì‚½ì…")
        dialog.geometry("400x150")
        
        ttk.Label(dialog, text="ëŒ€ì²´ í…ìŠ¤íŠ¸:").grid(row=0, column=0, padx=10, pady=10, sticky='w')
        alt_entry = ttk.Entry(dialog, width=40)
        alt_entry.grid(row=0, column=1, padx=10, pady=10)
        
        ttk.Label(dialog, text="ì´ë¯¸ì§€ URL:").grid(row=1, column=0, padx=10, pady=10, sticky='w')
        url_entry = ttk.Entry(dialog, width=40)
        url_entry.grid(row=1, column=1, padx=10, pady=10)
        
        def insert():
            alt = alt_entry.get()
            url = url_entry.get()
            if alt and url:
                pos = self.text_editor.index(tk.INSERT)
                self.text_editor.insert(pos, f"![{alt}]({url})")
                dialog.destroy()
                
        ttk.Button(dialog, text="ì‚½ì…", command=insert).grid(row=2, column=1, padx=10, pady=10)
        
    def insert_table(self):
        """í‘œ ì‚½ì…"""
        dialog = tk.Toplevel(self.root)
        dialog.title("í‘œ ì‚½ì…")
        dialog.geometry("300x150")
        
        ttk.Label(dialog, text="í–‰ ìˆ˜:").grid(row=0, column=0, padx=10, pady=10, sticky='w')
        rows_entry = ttk.Entry(dialog, width=10)
        rows_entry.grid(row=0, column=1, padx=10, pady=10)
        rows_entry.insert(0, "3")
        
        ttk.Label(dialog, text="ì—´ ìˆ˜:").grid(row=1, column=0, padx=10, pady=10, sticky='w')
        cols_entry = ttk.Entry(dialog, width=10)
        cols_entry.grid(row=1, column=1, padx=10, pady=10)
        cols_entry.insert(0, "3")
        
        def insert():
            try:
                rows = int(rows_entry.get())
                cols = int(cols_entry.get())
                
                # í‘œ ìƒì„±
                table = ""
                # í—¤ë”
                header = "| " + " | ".join([f"í—¤ë”{i+1}" for i in range(cols)]) + " |\n"
                separator = "| " + " | ".join(["---" for _ in range(cols)]) + " |\n"
                table += header + separator
                
                # ë°ì´í„° í–‰
                for i in range(rows):
                    row = "| " + " | ".join([f"ë°ì´í„°{i+1}-{j+1}" for j in range(cols)]) + " |\n"
                    table += row
                    
                pos = self.text_editor.index(tk.INSERT)
                self.text_editor.insert(pos, table)
                dialog.destroy()
            except:
                messagebox.showerror("ì˜¤ë¥˜", "ì˜¬ë°”ë¥¸ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”")
                
        ttk.Button(dialog, text="ì‚½ì…", command=insert).grid(row=2, column=1, padx=10, pady=10)
        
    def undo(self):
        """ì‹¤í–‰ ì·¨ì†Œ"""
        try:
            self.text_editor.edit_undo()
        except:
            pass
            
    def redo(self):
        """ë‹¤ì‹œ ì‹¤í–‰"""
        try:
            self.text_editor.edit_redo()
        except:
            pass
            
    def cut(self):
        """ì˜ë¼ë‚´ê¸°"""
        self.text_editor.event_generate("<<Cut>>")
        
    def copy(self):
        """ë³µì‚¬"""
        self.text_editor.event_generate("<<Copy>>")
        
    def paste(self):
        """ë¶™ì—¬ë„£ê¸°"""
        self.text_editor.event_generate("<<Paste>>")
        
    def select_all(self, event=None):
        """ì „ì²´ ì„ íƒ"""
        self.text_editor.tag_add(tk.SEL, "1.0", tk.END)
        self.text_editor.mark_set(tk.INSERT, "1.0")
        self.text_editor.see(tk.INSERT)
        return 'break'
        
    def select_all_menu(self):
        """ë©”ë‰´ì—ì„œ ì „ì²´ ì„ íƒ"""
        self.select_all()
        
    def increase_font(self):
        """ê¸€ê¼´ í¬ê¸° ì¦ê°€"""
        current_font = font.Font(font=self.text_editor['font'])
        size = current_font['size']
        self.text_editor.configure(font=('Consolas', size + 1))
        
    def decrease_font(self):
        """ê¸€ê¼´ í¬ê¸° ê°ì†Œ"""
        current_font = font.Font(font=self.text_editor['font'])
        size = current_font['size']
        if size > 8:
            self.text_editor.configure(font=('Consolas', size - 1))
            
    def update_cursor_position(self, event=None):
        """ì»¤ì„œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸"""
        position = self.text_editor.index(tk.INSERT)
        line, col = position.split('.')
        self.cursor_pos.config(text=f"ì¤„: {line}, ì—´: {int(col)+1}")
        
    def update_doc_info(self):
        """ë¬¸ì„œ ì •ë³´ ì—…ë°ì´íŠ¸"""
        content = self.text_editor.get(1.0, tk.END)
        words = len(content.split())
        chars = len(content) - 1  # END ë¬¸ì ì œì™¸
        self.doc_info.config(text=f"{words} ë‹¨ì–´, {chars} ë¬¸ì")
        
    def show_markdown_guide(self):
        """ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ í‘œì‹œ"""
        guide_window = tk.Toplevel(self.root)
        guide_window.title("ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ")
        guide_window.geometry("600x500")
        
        text = tk.Text(guide_window, wrap=tk.WORD, padx=10, pady=10)
        text.pack(fill=tk.BOTH, expand=True)
        
        guide_text = """
# ë§ˆí¬ë‹¤ìš´ ê¸°ë³¸ ë¬¸ë²• ê°€ì´ë“œ

## ì œëª© (Headers)
# H1 ì œëª©
## H2 ì œëª©  
### H3 ì œëª©
#### H4 ì œëª©

## ê°•ì¡° (Emphasis)
*ê¸°ìš¸ì„ì²´* ë˜ëŠ” _ê¸°ìš¸ì„ì²´_
**êµµì€ì²´** ë˜ëŠ” __êµµì€ì²´__
***êµµì€ ê¸°ìš¸ì„ì²´*** ë˜ëŠ” ___êµµì€ ê¸°ìš¸ì„ì²´___
~~ì·¨ì†Œì„ ~~

## ëª©ë¡ (Lists)
### ìˆœì„œ ì—†ëŠ” ëª©ë¡
- í•­ëª© 1
- í•­ëª© 2
  - í•˜ìœ„ í•­ëª© 2.1
  - í•˜ìœ„ í•­ëª© 2.2
- í•­ëª© 3

### ìˆœì„œ ìˆëŠ” ëª©ë¡
1. ì²« ë²ˆì§¸ í•­ëª©
2. ë‘ ë²ˆì§¸ í•­ëª©
3. ì„¸ ë²ˆì§¸ í•­ëª©

### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë¯¸ì™„ë£Œ ì‘ì—…
- [x] ì™„ë£Œëœ ì‘ì—…

## ë§í¬ì™€ ì´ë¯¸ì§€
[ë§í¬ í…ìŠ¤íŠ¸](https://www.example.com)
![ëŒ€ì²´ í…ìŠ¤íŠ¸](image-url.jpg)

## ì½”ë“œ
ì¸ë¼ì¸ ì½”ë“œ: `code`

ì½”ë“œ ë¸”ë¡:
```python
def hello():
    print("Hello, World!")
```

## ì¸ìš©ë¬¸
> ì´ê²ƒì€ ì¸ìš©ë¬¸ì…ë‹ˆë‹¤.
> ì—¬ëŸ¬ ì¤„ë¡œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ìˆ˜í‰ì„ 
---
ë˜ëŠ”
***

## í‘œ (Tables)
| í—¤ë” 1 | í—¤ë” 2 | í—¤ë” 3 |
|--------|--------|--------|
| ì…€ 1   | ì…€ 2   | ì…€ 3   |
| ì…€ 4   | ì…€ 5   | ì…€ 6   |

## ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì
\\* ë³„í‘œë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ
\\# ìƒµì„ ê·¸ëŒ€ë¡œ í‘œì‹œ
        """
        
        text.insert(1.0, guide_text)
        text.config(state=tk.DISABLED)
        
    def show_about(self):
        """í”„ë¡œê·¸ë¨ ì •ë³´"""
        messagebox.showinfo(
            "í”„ë¡œê·¸ë¨ ì •ë³´",
            "Markdown Viewer v1.0\n\n"
            "ê¹”ë”í•œ ë§ˆí¬ë‹¤ìš´ ë·°ì–´ í”„ë¡œê·¸ë¨\n"
            "ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ì œê³µ\n\n"
            "Â© 2024"
        )
        
    def create_tooltip(self, widget, text):
        """íˆ´íŒ ìƒì„±"""
        def on_enter(event):
            tooltip = tk.Toplevel()
            tooltip.wm_overrideredirect(True)
            tooltip.wm_geometry(f"+{event.x_root+10}+{event.y_root+10}")
            label = tk.Label(tooltip, text=text, background="#ffffe0", 
                           relief=tk.SOLID, borderwidth=1, font=('Arial', 9))
            label.pack()
            widget.tooltip = tooltip
            
        def on_leave(event):
            if hasattr(widget, 'tooltip'):
                widget.tooltip.destroy()
                del widget.tooltip
                
        widget.bind("<Enter>", on_enter)
        widget.bind("<Leave>", on_leave)


def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    root = tk.Tk()
    
    # ì•„ì´ì½˜ ì„¤ì • (ì˜µì…˜)
    try:
        root.iconbitmap('markdown.ico')
    except:
        pass
    
    app = MarkdownViewer(root)
    
    # ì‹œì‘ ì‹œ ìƒ˜í”Œ í…ìŠ¤íŠ¸
    sample_text = """# Markdown Viewerì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹

ì´ í”„ë¡œê·¸ë¨ì€ **ë§ˆí¬ë‹¤ìš´ íŒŒì¼**ì„ *ì‹¤ì‹œê°„*ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°í•  ìˆ˜ ìˆëŠ” í¸ë¦¬í•œ ë·°ì–´ì…ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥ âœ¨

- ğŸ“ **ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°**: ì…ë ¥í•˜ëŠ” ì¦‰ì‹œ ê²°ê³¼ í™•ì¸
- ğŸ¨ **ê¹”ë”í•œ UI**: í¸ì§‘ê¸°ì™€ ë¯¸ë¦¬ë³´ê¸° ë¶„í•  í™”ë©´
- ğŸ”§ **í¸ì§‘ ë„êµ¬**: ë§ˆí¬ë‹¤ìš´ ë¬¸ë²• ì‚½ì… ë²„íŠ¼
- ğŸ’¾ **íŒŒì¼ ì €ì¥/ì—´ê¸°**: MD íŒŒì¼ ê´€ë¦¬
- ğŸ“¤ **HTML ë‚´ë³´ë‚´ê¸°**: ì›¹ í˜ì´ì§€ë¡œ ë³€í™˜

## ì‚¬ìš© ë°©ë²•

1. ì™¼ìª½ í¸ì§‘ê¸°ì— ë§ˆí¬ë‹¤ìš´ ì‘ì„±
2. ì˜¤ë¥¸ìª½ì—ì„œ ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° í™•ì¸  
3. íˆ´ë°” ë²„íŠ¼ìœ¼ë¡œ ë¹ ë¥¸ ì„œì‹ ì ìš©

### ì˜ˆì œ ì½”ë“œ
```python
print("Hello, Markdown!")
```

### ì²´í¬ë¦¬ìŠ¤íŠ¸ ì˜ˆì œ
- [x] ë§ˆí¬ë‹¤ìš´ ë·°ì–´ ì‹¤í–‰
- [ ] ë¬¸ì„œ ì‘ì„±í•˜ê¸°
- [ ] HTMLë¡œ ë‚´ë³´ë‚´ê¸°

### í‘œ ì˜ˆì œ
| ê¸°ëŠ¥ | ë‹¨ì¶•í‚¤ |
|------|--------|
| ì—´ê¸° | Ctrl+O |
| ì €ì¥ | Ctrl+S |
| ìƒˆë¡œê³ ì¹¨ | F5 |

---

> ğŸ’¡ **íŒ**: ìƒë‹¨ ë©”ë‰´ì˜ 'ë„ì›€ë§ > ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ'ì—ì„œ ë” ë§ì€ ë¬¸ë²•ì„ í™•ì¸í•˜ì„¸ìš”!
"""
    
    app.text_editor.insert(1.0, sample_text)
    app.refresh_preview()
    
    root.mainloop()


if __name__ == "__main__":
    main()