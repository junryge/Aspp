<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>반도체 물류 예측 시스템 - 알고리즘 설명서</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
        }
        
        h2 {
            color: #34495e;
            margin-top: 40px;
            font-size: 1.8em;
            border-left: 5px solid #3498db;
            padding-left: 15px;
        }
        
        h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-top: 25px;
        }
        
        .highlight-box {
            background-color: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .formula-box {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            overflow-x: auto;
        }
        
        .architecture-diagram {
            background-color: #f0f8ff;
            border: 2px dashed #3498db;
            padding: 30px;
            margin: 30px 0;
            border-radius: 10px;
            text-align: center;
        }
        
        .model-card {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .performance-table th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .performance-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .performance-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .warning-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .success-box {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        ul {
            line-height: 2;
        }
        
        .flow-chart {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .flow-item {
            background-color: #3498db;
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            margin: 10px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .flow-arrow {
            font-size: 24px;
            color: #3498db;
            margin: 0 10px;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>반도체 물류 예측 시스템 v5.0<br><small>딥러닝 기반 1400+ 예측 강화 모델</small></h1>
        
        <div class="highlight-box">
            <strong>📋 요약:</strong> 본 시스템은 과거 100분(50분×2)의 물류 데이터를 활용하여 10분 후의 물류량을 예측하는 
            최첨단 딥러닝 모델입니다. 특히 1400개 이상의 급증 상황을 정확히 예측하는데 중점을 두었습니다.
        </div>

        <h2>1. 시스템 전체 구조</h2>
        
        <div class="architecture-diagram">
            <h3>🏗️ 시스템 아키텍처</h3>
            <div class="flow-chart">
                <div class="flow-item">원시 데이터<br>(CSV)</div>
                <span class="flow-arrow">→</span>
                <div class="flow-item">데이터 전처리<br>& 특징 추출</div>
                <span class="flow-arrow">→</span>
                <div class="flow-item">4개 딥러닝<br>모델 학습</div>
                <span class="flow-arrow">→</span>
                <div class="flow-item">앙상블<br>예측</div>
                <span class="flow-arrow">→</span>
                <div class="flow-item">최종 예측값</div>
            </div>
        </div>

        <h2>2. 데이터 전처리 과정</h2>
        
        <h3>2.1 시계열 윈도우 생성</h3>
        <div class="formula-box">
            <p>입력 시퀀스: \(X_t = [x_{t-49}, x_{t-48}, ..., x_{t-1}, x_t]\)</p>
            <p>예측 타겟: \(y_t = x_{t+10}\)</p>
            <p>여기서 \(x_t\)는 시간 \(t\)에서의 12개 특징 벡터</p>
        </div>

        <h3>2.2 특징 엔지니어링</h3>
        <div class="feature-grid">
            <div class="feature-item">
                <strong>📊 이동평균 (MA)</strong>
                <div class="formula-box">
                    \(MA_n(t) = \frac{1}{n} \sum_{i=0}^{n-1} x_{t-i}\)
                </div>
                <p>n = 10, 30, 60분</p>
            </div>
            <div class="feature-item">
                <strong>📈 표준편차 (STD)</strong>
                <div class="formula-box">
                    \(STD_n(t) = \sqrt{\frac{1}{n} \sum_{i=0}^{n-1} (x_{t-i} - MA_n(t))^2}\)
                </div>
                <p>n = 10, 30분</p>
            </div>
            <div class="feature-item">
                <strong>📉 변화율</strong>
                <div class="formula-box">
                    \(Change\_Rate(t) = \frac{x_t - x_{t-1}}{x_{t-1}}\)
                </div>
                <p>1분, 10분 변화율</p>
            </div>
            <div class="feature-item">
                <strong>🕐 시간 특징</strong>
                <ul style="margin: 0; padding-left: 20px;">
                    <li>시간대 (0-23)</li>
                    <li>요일 (0-6)</li>
                    <li>주말 여부 (0/1)</li>
                    <li>트렌드 (MA10 - MA30)</li>
                </ul>
            </div>
        </div>

        <h3>2.3 데이터 정규화</h3>
        <div class="formula-box">
            <p><strong>RobustScaler 적용:</strong></p>
            <p>\(x_{scaled} = \frac{x - median(X)}{IQR(X)}\)</p>
            <p>여기서 IQR = Q3 - Q1 (사분위수 범위)</p>
        </div>

        <h2>3. 딥러닝 모델 구조</h2>

        <div class="model-card">
            <h3>3.1 LSTM 모델 (Long Short-Term Memory)</h3>
            <div class="formula-box">
                <p><strong>LSTM 셀 수식:</strong></p>
                <p>망각 게이트: \(f_t = \sigma(W_f \cdot [h_{t-1}, x_t] + b_f)\)</p>
                <p>입력 게이트: \(i_t = \sigma(W_i \cdot [h_{t-1}, x_t] + b_i)\)</p>
                <p>셀 상태: \(C_t = f_t * C_{t-1} + i_t * \tilde{C}_t\)</p>
                <p>출력 게이트: \(o_t = \sigma(W_o \cdot [h_{t-1}, x_t] + b_o)\)</p>
                <p>은닉 상태: \(h_t = o_t * \tanh(C_t)\)</p>
            </div>
            <ul>
                <li>3층 LSTM 구조 (128 → 64 → 32 유닛)</li>
                <li>각 층마다 Dropout (40%) 적용</li>
                <li>L1/L2 정규화로 과적합 방지</li>
            </ul>
        </div>

        <div class="model-card">
            <h3>3.2 GRU 모델 (Gated Recurrent Unit)</h3>
            <div class="formula-box">
                <p><strong>GRU 셀 수식:</strong></p>
                <p>리셋 게이트: \(r_t = \sigma(W_r \cdot [h_{t-1}, x_t])\)</p>
                <p>업데이트 게이트: \(z_t = \sigma(W_z \cdot [h_{t-1}, x_t])\)</p>
                <p>후보 은닉 상태: \(\tilde{h}_t = \tanh(W \cdot [r_t * h_{t-1}, x_t])\)</p>
                <p>은닉 상태: \(h_t = (1 - z_t) * h_{t-1} + z_t * \tilde{h}_t\)</p>
            </div>
            <ul>
                <li>LSTM보다 간단한 구조로 빠른 학습</li>
                <li>3층 구조 (128 → 64 → 32 유닛)</li>
            </ul>
        </div>

        <div class="model-card">
            <h3>3.3 CNN-LSTM 하이브리드 모델</h3>
            <div class="formula-box">
                <p><strong>1D Convolution:</strong></p>
                <p>\(y_i = \sum_{j=0}^{k-1} w_j \cdot x_{i+j} + b\)</p>
                <p>여기서 k는 커널 크기 (3)</p>
            </div>
            <ul>
                <li>CNN으로 로컬 패턴 추출</li>
                <li>LSTM으로 시계열 의존성 학습</li>
                <li>급격한 변화 감지에 효과적</li>
            </ul>
        </div>

        <div class="model-card">
            <h3>3.4 급변 감지기 (Spike Detector)</h3>
            <ul>
                <li>양방향 LSTM 사용 (과거와 미래 컨텍스트 활용)</li>
                <li>이진 분류: 1400+ 여부 예측</li>
                <li>시그모이드 활성화 함수로 확률 출력</li>
            </ul>
        </div>

        <h2>4. 핵심 혁신: 가중 손실 함수</h2>
        
        <div class="warning-box">
            <strong>⚠️ 문제점:</strong> 1400+ 데이터가 전체의 약 5%만 차지하여 일반적인 학습으로는 예측이 어려움
        </div>

        <div class="success-box">
            <strong>✅ 해결책:</strong> 1400+ 값에 10배 가중치를 부여하는 커스텀 손실 함수 개발
        </div>

        <div class="formula-box">
            <h3>가중 MSE (Weighted Mean Squared Error)</h3>
            <p>\(L_{weighted} = \frac{1}{n} \sum_{i=1}^{n} w_i \cdot (y_i - \hat{y}_i)^2\)</p>
            <p>여기서 가중치 \(w_i = \begin{cases} 
                10.0 & \text{if } y_i \geq 1400 \\
                1.0 & \text{otherwise}
            \end{cases}\)</p>
        </div>

        <h2>5. 데이터 증강 전략</h2>
        
        <div class="highlight-box">
            <strong>🔧 1400+ 샘플 증강:</strong> 원본 데이터에 점진적 노이즈(1%, 2%, 3%)를 추가하여 3배 증강
        </div>
        
        <div class="formula-box">
            <p>증강된 샘플: \(x_{aug} = x_{original} + \mathcal{N}(0, \sigma)\)</p>
            <p>여기서 \(\sigma = 0.01 \times level\), level ∈ {1, 2, 3}</p>
        </div>

        <h2>6. 동적 앙상블 예측</h2>
        
        <h3>6.1 급변 확률 기반 가중치 조정</h3>
        
        <table class="performance-table">
            <thead>
                <tr>
                    <th>급변 확률</th>
                    <th>LSTM 가중치</th>
                    <th>GRU 가중치</th>
                    <th>CNN-LSTM 가중치</th>
                    <th>부스팅 계수</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>70% 이상</td>
                    <td>0.15</td>
                    <td>0.15</td>
                    <td>0.70</td>
                    <td>1.20 (20% 증폭)</td>
                </tr>
                <tr>
                    <td>50-70%</td>
                    <td>0.20</td>
                    <td>0.20</td>
                    <td>0.60</td>
                    <td>1.15 (15% 증폭)</td>
                </tr>
                <tr>
                    <td>30-50%</td>
                    <td>0.30</td>
                    <td>0.30</td>
                    <td>0.40</td>
                    <td>1.08 (8% 증폭)</td>
                </tr>
                <tr>
                    <td>30% 미만</td>
                    <td>0.40</td>
                    <td>0.35</td>
                    <td>0.25</td>
                    <td>1.00 (증폭 없음)</td>
                </tr>
            </tbody>
        </table>

        <div class="formula-box">
            <h3>최종 앙상블 예측</h3>
            <p>\(\hat{y}_{ensemble} = boost\_factor \times \sum_{i=1}^{3} w_i \cdot \hat{y}_i\)</p>
            <p>여기서 \(w_i\)는 모델별 동적 가중치</p>
        </div>

        <h2>7. 성능 평가 지표</h2>
        
        <div class="feature-grid">
            <div class="feature-item">
                <strong>MAE (평균 절대 오차)</strong>
                <div class="formula-box">
                    \(MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i|\)
                </div>
            </div>
            <div class="feature-item">
                <strong>RMSE (평균 제곱근 오차)</strong>
                <div class="formula-box">
                    \(RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}\)
                </div>
            </div>
            <div class="feature-item">
                <strong>R² (결정계수)</strong>
                <div class="formula-box">
                    \(R^2 = 1 - \frac{\sum (y_i - \hat{y}_i)^2}{\sum (y_i - \bar{y})^2}\)
                </div>
            </div>
            <div class="feature-item">
                <strong>Precision & Recall (1400+)</strong>
                <div class="formula-box">
                    \(Precision = \frac{TP}{TP + FP}\)<br>
                    \(Recall = \frac{TP}{TP + FN}\)
                </div>
            </div>
        </div>

        <h2>8. 재시작 가능한 학습 시스템</h2>
        
        <div class="highlight-box">
            <strong>💾 체크포인트 시스템:</strong>
            <ul style="margin: 5px 0;">
                <li>5 에폭마다 모델 가중치 자동 저장</li>
                <li>학습 상태를 JSON 파일로 관리</li>
                <li>전처리된 데이터 캐싱으로 재시작 시간 단축</li>
                <li>중단된 지점부터 정확히 재개 가능</li>
            </ul>
        </div>

        <h2>9. 실행 방법</h2>
        
        <div class="model-card">
            <h3>🚀 사용법</h3>
            <pre style="background-color: #f5f5f5; padding: 15px; border-radius: 5px;">
# 처음 시작
python model_v5_ultimate.py

# 이전 학습 재개
python model_v5_ultimate.py --resume

# 초기화 후 새로 시작
python model_v5_ultimate.py --reset
            </pre>
        </div>

        <h2>10. 기대 효과</h2>
        
        <div class="success-box">
            <h3>✨ 주요 성과</h3>
            <ul>
                <li><strong>1400+ 예측 정확도 대폭 향상</strong> - 가중 손실 함수와 데이터 증강으로 급증 상황 예측력 강화</li>
                <li><strong>안정적인 일반 예측</strong> - 4개 모델 앙상블로 노이즈에 강건한 예측</li>
                <li><strong>실시간 예측 가능</strong> - 학습된 모델로 10분 후 물류량 즉시 예측</li>
                <li><strong>지속적인 개선 가능</strong> - 재시작 가능한 구조로 추가 학습 용이</li>
            </ul>
        </div>

        <div class="warning-box">
            <h3>📌 주의사항</h3>
            <ul>
                <li>최소 6개월 이상의 과거 데이터 필요</li>
                <li>데이터 품질이 예측 정확도에 직접적 영향</li>
                <li>정기적인 모델 재학습 권장 (월 1회)</li>
                <li>TensorFlow 2.15.0 버전 필수</li>
            </ul>
        </div>

        <hr style="margin: 40px 0; border: 1px solid #e0e0e0;">
        
        <div style="text-align: center; color: #666;">
            <p><strong>반도체 물류 예측 시스템 v5.0</strong></p>
            <p>본 문서는 고객님의 이해를 돕기 위해 작성된 기술 설명서입니다.</p>
            <p>추가 문의사항은 기술지원팀으로 연락 주시기 바랍니다.</p>
        </div>
    </div>

    <script>
        // MathJax 설정
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
</body>
</html>