import pandas as pd
import os

def split_csv_by_date(input_file, output_folder='output_by_date'):
    """
    CURRTIME (202508012053 í˜•ì‹)ì„ ë‚ ì§œë³„(20250801)ë¡œ CSV íŒŒì¼ ë¶„ë¦¬
    """
    
    # CSV íŒŒì¼ ì½ê¸°
    print(f"ğŸ“‚ íŒŒì¼ ì½ëŠ” ì¤‘: {input_file}")
    df = pd.read_csv(input_file)
    print(f"âœ… ì´ {len(df)}ê°œ í–‰ ì½ê¸° ì™„ë£Œ")
    
    # ì¶œë ¥ í´ë” ìƒì„±
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)
        print(f"ğŸ“ ì¶œë ¥ í´ë” ìƒì„±: {output_folder}")
    
    # CURRTIMEì—ì„œ ë‚ ì§œ ë¶€ë¶„(YYYYMMDD)ë§Œ ì¶”ì¶œ
    # 202508012053 -> 20250801
    df['date_only'] = df['CURRTIME'].astype(str).str[:8]
    
    # ê³ ìœ í•œ ë‚ ì§œ ëª©ë¡
    unique_dates = df['date_only'].unique()
    print(f"\nğŸ“… ë°œê²¬ëœ ë‚ ì§œ: {len(unique_dates)}ê°œ")
    for date in sorted(unique_dates):
        print(f"   - {date}")
    
    # ë‚ ì§œë³„ë¡œ íŒŒì¼ ë¶„ë¦¬ ë° ì €ì¥
    print(f"\nğŸ’¾ ë‚ ì§œë³„ CSV íŒŒì¼ ìƒì„± ì¤‘...")
    
    for date in unique_dates:
        # í•´ë‹¹ ë‚ ì§œì˜ ë°ì´í„°ë§Œ í•„í„°ë§
        date_df = df[df['date_only'] == date].copy()
        
        # ì„ì‹œ ì»¬ëŸ¼ ì œê±° (ì›ë³¸ CURRTIMEì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
        date_df = date_df.drop('date_only', axis=1)
        
        # íŒŒì¼ëª…: 20250801.csv
        output_file = os.path.join(output_folder, f'{date}.csv')
        
        # CSVë¡œ ì €ì¥
        date_df.to_csv(output_file, index=False, encoding='utf-8-sig')
        print(f"   âœ… {date}.csv: {len(date_df)}ê°œ í–‰ ì €ì¥ ì™„ë£Œ")
    
    print(f"\nğŸ‰ ì™„ë£Œ! ì´ {len(unique_dates)}ê°œ íŒŒì¼ë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
    print(f"ğŸ“ ì €ì¥ ìœ„ì¹˜: {output_folder}/")
    
    return unique_dates


# ê°„ë‹¨í•œ ì‚¬ìš© ì˜ˆì‹œ
def quick_split(input_file):
    """ë¹ ë¥¸ ì‹¤í–‰ìš© í•¨ìˆ˜"""
    split_csv_by_date(input_file, 'split_by_date')


# ë©”ì¸ ì‹¤í–‰ ì½”ë“œ
if __name__ == "__main__":
    # ì…ë ¥ íŒŒì¼ ê²½ë¡œ
    input_csv = "data.csv"  # â† ì—¬ê¸°ì— ì‹¤ì œ CSV íŒŒì¼ëª… ì…ë ¥
    
    # ì‹¤í–‰
    split_csv_by_date(input_csv)