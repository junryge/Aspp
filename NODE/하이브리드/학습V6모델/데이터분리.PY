import pandas as pd
import os

def split_csv_by_date(input_file, output_folder='output_by_date'):
    """
    CSV íŒŒì¼ì„ CURRTIME ì»¬ëŸ¼ì˜ ë‚ ì§œë³„ë¡œ ë¶„ë¦¬
    CURRTIME ì»¬ëŸ¼ì€ ìˆ˜ì •í•˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ìœ ì§€
    """
    
    # CSV íŒŒì¼ ì½ê¸°
    print(f"ğŸ“‚ íŒŒì¼ ì½ëŠ” ì¤‘: {input_file}")
    df = pd.read_csv(input_file)
    print(f"âœ… ì´ {len(df)}ê°œ í–‰ ì½ê¸° ì™„ë£Œ")
    
    # ì¶œë ¥ í´ë” ìƒì„±
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)
        print(f"ğŸ“ ì¶œë ¥ í´ë” ìƒì„±: {output_folder}")
    
    # CURRTIMEì—ì„œ ë‚ ì§œ ë¶€ë¶„ë§Œ ì¶”ì¶œ (ë°ì´í„°ëŠ” ìˆ˜ì •í•˜ì§€ ì•ŠìŒ)
    # CURRTIME í˜•ì‹ì— ë”°ë¼ ë‚ ì§œ ì¶”ì¶œ
    df['temp_date'] = df['CURRTIME'].apply(lambda x: str(x).split(' ')[0] if pd.notna(x) else 'unknown')
    
    # ê³ ìœ í•œ ë‚ ì§œ ëª©ë¡
    unique_dates = df['temp_date'].unique()
    print(f"\nğŸ“… ë°œê²¬ëœ ë‚ ì§œ: {len(unique_dates)}ê°œ")
    
    # ë‚ ì§œë³„ë¡œ íŒŒì¼ ë¶„ë¦¬ ë° ì €ì¥
    for date in unique_dates:
        # í•´ë‹¹ ë‚ ì§œì˜ ë°ì´í„°ë§Œ í•„í„°ë§
        date_df = df[df['temp_date'] == date].copy()
        
        # ì„ì‹œ ì»¬ëŸ¼ ì œê±° (ì›ë³¸ ë°ì´í„° ê·¸ëŒ€ë¡œ ìœ ì§€)
        date_df = date_df.drop('temp_date', axis=1)
        
        # íŒŒì¼ëª… ìƒì„± (íŠ¹ìˆ˜ë¬¸ì ì œê±°)
        safe_date = str(date).replace('/', '-').replace(':', '-')
        output_file = os.path.join(output_folder, f'data_{safe_date}.csv')
        
        # CSVë¡œ ì €ì¥
        date_df.to_csv(output_file, index=False)
        print(f"   âœ… {safe_date}: {len(date_df)}ê°œ í–‰ â†’ {output_file}")
    
    print(f"\nğŸ‰ ì™„ë£Œ! ì´ {len(unique_dates)}ê°œ íŒŒì¼ë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
    return unique_dates


# ë©”ì¸ ì‹¤í–‰ ì½”ë“œ
if __name__ == "__main__":
    # ì…ë ¥ íŒŒì¼ ê²½ë¡œ
    input_csv = "your_file.csv"  # â† ì—¬ê¸°ì— ì‹¤ì œ CSV íŒŒì¼ ê²½ë¡œ ì…ë ¥
    
    # ë‚ ì§œë³„ë¡œ ë¶„ë¦¬ ì‹¤í–‰
    split_csv_by_date(input_csv, output_folder='split_by_date')