#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ“Š í ê°œìˆ˜ êµ¬ê°„ë³„ 10ë¶„ í›„ ì¦ê°ëŸ‰ ë¶„ì„
"""

import pandas as pd
import numpy as np

# ë°ì´í„° ë¡œë“œ
DATA_PATH = 'your_data.csv'  # â† ì‹¤ì œ íŒŒì¼ ê²½ë¡œ!
df = pd.read_csv(DATA_PATH)

print("="*70)
print("ğŸ“Š í ê°œìˆ˜ êµ¬ê°„ë³„ 10ë¶„ í›„ ì¦ê°ëŸ‰ ë¶„ì„")
print("="*70)

# 10ë¶„ í›„ ê°’ê³¼ ë³€í™”ëŸ‰ ê³„ì‚°
df['TOTALCNT_10min_later'] = df['TOTALCNT'].shift(-10)
df['ë³€í™”ëŸ‰'] = df['TOTALCNT_10min_later'] - df['TOTALCNT']

# ë³€í™”ëŸ‰ êµ¬ê°„ ì •ì˜
bins = [-np.inf, -200, -150, -100, -50, 0, 50, 100, 150, 200, np.inf]
labels = ['<-200', '-200~-150', '-150~-100', '-100~-50', '-50~0', 
          '0~50', '50~100', '100~150', '150~200', '>200']

# ì„ê³„ê°’ë³„ ë¶„ì„
thresholds = [1200, 1300, 1400, 1500, 1600, 1700, 1800]

results = {}
for th in thresholds:
    subset = df[df['TOTALCNT'] >= th].copy()
    subset = subset.dropna(subset=['ë³€í™”ëŸ‰'])
    
    subset['êµ¬ê°„'] = pd.cut(subset['ë³€í™”ëŸ‰'], bins=bins, labels=labels)
    counts = subset['êµ¬ê°„'].value_counts().sort_index()
    
    results[f'>={th}'] = counts
    
    print(f"\n{'='*50}")
    print(f"ğŸ”¹ í˜„ì¬ íê°œìˆ˜ >= {th} (ì´ {len(subset):,}ê±´)")
    print(f"{'='*50}")
    print(counts.to_string())
    print(f"\n  í‰ê·  ë³€í™”ëŸ‰: {subset['ë³€í™”ëŸ‰'].mean():.1f}")
    print(f"  ì¦ê°€ ë¹„ìœ¨: {(subset['ë³€í™”ëŸ‰'] > 0).sum()/len(subset)*100:.1f}%")
    print(f"  ê°ì†Œ ë¹„ìœ¨: {(subset['ë³€í™”ëŸ‰'] < 0).sum()/len(subset)*100:.1f}%")

# ê²°ê³¼ í…Œì´ë¸”ë¡œ ì •ë¦¬
result_df = pd.DataFrame(results)
result_df.to_csv('queue_change_analysis.csv', encoding='utf-8-sig')
print(f"\nğŸ’¾ queue_change_analysis.csv ì €ì¥ ì™„ë£Œ!")
print("\n" + result_df.to_string())