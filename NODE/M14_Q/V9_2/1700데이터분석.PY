#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ğŸ”¬ í™©ê¸ˆíŒ¨í„´ ì´ë¡  ê²€ì¦ - ìˆ˜ì •íŒ
ì»¬ëŸ¼ ì§ì ‘ ì§€ì •!
"""

import pandas as pd
import numpy as np

CSV_FILE = "YOUR_CSV_FILE.csv"  # â† ì‹¤ì œ íŒŒì¼ ê²½ë¡œ!

print("="*70)
print("ğŸ“‚ ë°ì´í„° ë¡œë“œ")
print("="*70)

df = pd.read_csv(CSV_FILE, on_bad_lines='skip')
print(f"ì´ {len(df):,}í–‰ Ã— {df.shape[1]}ì—´")

# ============================================
# ì»¬ëŸ¼ ì§ì ‘ ì§€ì •! (ìë™íƒì§€ X)
# ============================================
totalcnt_col = 'TOTALCNT'
m14b_col = 'M14AM14B'
m14bsum_col = 'M14AM14BSUM'
qcreated_col = 'M14.QUE.ALL.CURRENTQCREATED'      # â† ìˆ˜ì •!
qcompleted_col = 'M14.QUE.ALL.CURRENTQCOMPLETED'  # â† ìˆ˜ì •!

print(f"\nâœ… ì‚¬ìš© ì»¬ëŸ¼:")
print(f"  TOTALCNT: {totalcnt_col}")
print(f"  M14AM14B: {m14b_col}")
print(f"  M14AM14BSUM: {m14bsum_col}")
print(f"  Q_CREATED: {qcreated_col}")
print(f"  Q_COMPLETED: {qcompleted_col}")

# ============================================
# queue_gap ê³„ì‚°
# ============================================
df['queue_gap'] = df[qcreated_col] - df[qcompleted_col]

print(f"\nğŸ“Š queue_gap í†µê³„:")
print(f"  min: {df['queue_gap'].min():.0f}")
print(f"  max: {df['queue_gap'].max():.0f}")
print(f"  mean: {df['queue_gap'].mean():.1f}")

# ============================================
# í™©ê¸ˆíŒ¨í„´ ì´ë¡  ê²€ì¦
# ============================================
print("\n" + "="*70)
print("ğŸ”¬ í™©ê¸ˆíŒ¨í„´ ì´ë¡  ê²€ì¦")
print("="*70)

df['is_1700'] = df[totalcnt_col] >= 1700
df['gap_over_300'] = df['queue_gap'] > 300
df['gap_over_250'] = df['queue_gap'] > 250
df['gold_pattern'] = (df[m14b_col] > 520) & (df[m14bsum_col] > 600)
df['triple_check'] = (df[m14b_col] > 520) & (df[m14bsum_col] > 600) & (df['queue_gap'] > 250)

total = len(df)
cnt_1700 = df['is_1700'].sum()

print(f"\nğŸ“Š ê¸°ë³¸ í†µê³„:")
print(f"  ì „ì²´ ë°ì´í„°: {total:,}ê°œ")
print(f"  1700+ ì´ë²¤íŠ¸: {cnt_1700:,}ê°œ ({cnt_1700/total*100:.2f}%)")

# ì´ë¡  1: queue_gap > 300 â†’ ìœ„í—˜
print(f"\nğŸ”¥ ì´ë¡  1: queue_gap > 300 â†’ 1700+")
gap_over = df['gap_over_300'].sum()
gap_and_1700 = (df['gap_over_300'] & df['is_1700']).sum()
print(f"  gap > 300: {gap_over:,}ê°œ")
if gap_over > 0:
    print(f"  ê·¸ ì¤‘ 1700+: {gap_and_1700:,}ê°œ ({gap_and_1700/gap_over*100:.1f}%)")

# ì´ë¡  2: í™©ê¸ˆíŒ¨í„´ â†’ 1700+
print(f"\nğŸ† ì´ë¡  2: M14B>520 & SUM>600 â†’ 1700+")
gold = df['gold_pattern'].sum()
gold_and_1700 = (df['gold_pattern'] & df['is_1700']).sum()
print(f"  í™©ê¸ˆíŒ¨í„´: {gold:,}ê°œ")
if gold > 0:
    print(f"  ê·¸ ì¤‘ 1700+: {gold_and_1700:,}ê°œ ({gold_and_1700/gold*100:.1f}%)")

# ì´ë¡  3: Triple Check â†’ 96.5%
print(f"\nâš¡ ì´ë¡  3: M14B>520 & SUM>600 & gap>250 â†’ 96.5%")
triple = df['triple_check'].sum()
triple_and_1700 = (df['triple_check'] & df['is_1700']).sum()
print(f"  Triple Check: {triple:,}ê°œ")
if triple > 0:
    print(f"  ê·¸ ì¤‘ 1700+: {triple_and_1700:,}ê°œ ({triple_and_1700/triple*100:.1f}%)")

# 1700+ ì¤‘ íŒ¨í„´ ë¯¸ì¶©ì¡±
print(f"\nâš ï¸ 1700+ ì¤‘ íŒ¨í„´ ë¯¸ì¶©ì¡± ì¼€ì´ìŠ¤:")
no_pattern = df['is_1700'] & ~df['gold_pattern'] & ~df['gap_over_300']
print(f"  í™©ê¸ˆíŒ¨í„´X & gap<=300 ì¸ë° 1700+: {no_pattern.sum():,}ê°œ")

# ============================================
# ìƒì„¸ ì„ê³„ê°’ ë¶„ì„
# ============================================
print("\n" + "="*70)
print("ğŸ“Š queue_gap ì„ê³„ê°’ë³„ ë¶„ì„")
print("="*70)

for gap_th in [100, 150, 200, 250, 300, 350, 400, 500]:
    cond = df['queue_gap'] > gap_th
    cnt = cond.sum()
    if cnt > 0:
        hit = (cond & df['is_1700']).sum()
        print(f"  gap > {gap_th}: {cnt:,}ê°œ ì¤‘ 1700+: {hit:,}ê°œ ({hit/cnt*100:.1f}%)")

print("\n" + "="*70)
print("ğŸ“Š M14B ì„ê³„ê°’ë³„ ë¶„ì„")
print("="*70)

for m14b_th in [400, 450, 480, 500, 520, 540, 560]:
    cond = df[m14b_col] > m14b_th
    cnt = cond.sum()
    if cnt > 0:
        hit = (cond & df['is_1700']).sum()
        print(f"  M14B > {m14b_th}: {cnt:,}ê°œ ì¤‘ 1700+: {hit:,}ê°œ ({hit/cnt*100:.1f}%)")

print("\n" + "="*70)
print("ğŸ“Š ë³µí•© ì¡°ê±´ ë¶„ì„")
print("="*70)

# ë‹¤ì–‘í•œ ì¡°í•© í…ŒìŠ¤íŠ¸
combos = [
    ("M14B>520 & SUM>600", (df[m14b_col] > 520) & (df[m14bsum_col] > 600)),
    ("M14B>520 & gap>250", (df[m14b_col] > 520) & (df['queue_gap'] > 250)),
    ("SUM>600 & gap>250", (df[m14bsum_col] > 600) & (df['queue_gap'] > 250)),
    ("M14B>520 & SUM>600 & gap>200", (df[m14b_col] > 520) & (df[m14bsum_col] > 600) & (df['queue_gap'] > 200)),
    ("M14B>520 & SUM>600 & gap>250", (df[m14b_col] > 520) & (df[m14bsum_col] > 600) & (df['queue_gap'] > 250)),
    ("M14B>520 & SUM>600 & gap>300", (df[m14b_col] > 520) & (df[m14bsum_col] > 600) & (df['queue_gap'] > 300)),
    ("gap>300 alone", df['queue_gap'] > 300),
    ("gap>400 alone", df['queue_gap'] > 400),
    ("gap>500 alone", df['queue_gap'] > 500),
]

for name, cond in combos:
    cnt = cond.sum()
    if cnt > 0:
        hit = (cond & df['is_1700']).sum()
        print(f"  {name}: {cnt:,}ê°œ ì¤‘ 1700+: {hit:,}ê°œ ({hit/cnt*100:.1f}%)")
    else:
        print(f"  {name}: 0ê°œ")

print("\nâœ… ê²€ì¦ ì™„ë£Œ!")