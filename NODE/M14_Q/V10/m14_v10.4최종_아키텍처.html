<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M14 V10_4 프로젝트 아키텍처</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #080810;
  --bg-secondary: #0d0d1a;
  --bg-card: rgba(255,255,255,0.03);
  --bg-code: #0a0a16;
  --border: rgba(255,255,255,0.08);
  --border-accent: rgba(0,212,255,0.25);
  --text-primary: #e0e0e8;
  --text-secondary: #8892b0;
  --text-muted: #555;
  --cyan: #00d4ff;
  --green: #00ff88;
  --red: #ff4466;
  --orange: #ff6b35;
  --yellow: #ffcc00;
  --purple: #a855f7;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.7; font-size: 15px; }

.layout { display: flex; min-height: 100vh; }
.sidebar { width: 280px; position: fixed; top: 0; left: 0; height: 100vh; background: var(--bg-secondary); border-right: 1px solid var(--border); overflow-y: auto; padding: 24px 0; z-index: 100; scrollbar-width: thin; scrollbar-color: #333 transparent; }
.sidebar-logo { padding: 0 20px 20px; border-bottom: 1px solid var(--border); margin-bottom: 16px; }
.sidebar-logo h2 { font-family: 'Orbitron', sans-serif; font-size: 0.95rem; font-weight: 700; background: linear-gradient(90deg, var(--cyan), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 1px; }
.sidebar-logo .version { font-size: 0.7rem; color: var(--text-muted); margin-top: 4px; font-family: 'JetBrains Mono', monospace; }
.nav-section { padding: 8px 16px 4px; font-size: 0.65rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; }
.nav-link { display: block; padding: 7px 20px 7px 24px; font-size: 0.82rem; color: var(--text-secondary); text-decoration: none; transition: all 0.15s; border-left: 2px solid transparent; }
.nav-link:hover { color: var(--cyan); background: rgba(0,212,255,0.05); border-left-color: var(--cyan); }
.nav-link.active { color: var(--cyan); border-left-color: var(--cyan); background: rgba(0,212,255,0.08); }

.main { margin-left: 280px; flex: 1; padding: 40px 60px 80px; max-width: 1100px; }
.doc-header { margin-bottom: 48px; padding-bottom: 32px; border-bottom: 1px solid var(--border); }
.doc-header h1 { font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight: 900; background: linear-gradient(135deg, var(--cyan), var(--green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 12px; letter-spacing: 1px; }
.doc-meta { display: flex; gap: 16px; flex-wrap: wrap; }
.doc-meta .tag { font-size: 0.75rem; padding: 4px 14px; border-radius: 20px; font-family: 'JetBrains Mono', monospace; font-weight: 500; }
.tag-version { background: rgba(0,212,255,0.12); color: var(--cyan); border: 1px solid rgba(0,212,255,0.3); }
.tag-date { background: rgba(0,255,136,0.08); color: var(--green); border: 1px solid rgba(0,255,136,0.2); }
.tag-model { background: rgba(168,85,247,0.1); color: var(--purple); border: 1px solid rgba(168,85,247,0.25); }

.section { margin-bottom: 48px; scroll-margin-top: 24px; }
.section h2 { font-size: 1.35rem; font-weight: 700; color: var(--cyan); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-accent); display: flex; align-items: center; gap: 10px; }
.section h2 .num { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; background: rgba(0,212,255,0.15); padding: 3px 10px; border-radius: 6px; color: var(--cyan); min-width: 36px; text-align: center; }
.section h3 { font-size: 1.05rem; font-weight: 600; color: var(--text-primary); margin: 28px 0 14px; padding-left: 12px; border-left: 3px solid var(--orange); }
.section p { margin-bottom: 14px; color: var(--text-secondary); }
.section strong { color: var(--text-primary); }

table { width: 100%; border-collapse: collapse; margin: 16px 0 24px; font-size: 0.85rem; }
thead th { background: rgba(0,212,255,0.08); color: var(--cyan); font-weight: 600; padding: 10px 14px; text-align: left; border-bottom: 2px solid rgba(0,212,255,0.2); font-size: 0.8rem; letter-spacing: 0.5px; }
tbody td { padding: 9px 14px; border-bottom: 1px solid var(--border); color: var(--text-secondary); vertical-align: top; }
tbody tr:hover { background: rgba(0,212,255,0.03); }
td code, th code { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; background: rgba(0,212,255,0.08); color: var(--cyan); padding: 2px 6px; border-radius: 4px; word-break: break-all; }

pre { background: var(--bg-code); border: 1px solid var(--border); border-radius: 10px; padding: 18px 22px; margin: 14px 0 22px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; line-height: 1.65; color: #c8d0e0; }
pre .cm { color: #5c6370; font-style: italic; }
pre .kw { color: #c678dd; }
pre .st { color: #98c379; }
pre .nb { color: #d19a66; }
pre .fn { color: #61afef; }

p code, li code { font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; background: rgba(0,212,255,0.08); color: var(--cyan); padding: 2px 7px; border-radius: 4px; }

.card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 16px 0 24px; }
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 18px; transition: all 0.2s; }
.card:hover { border-color: var(--border-accent); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
.card .card-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.card .card-value { font-family: 'Orbitron', sans-serif; font-size: 1.4rem; font-weight: 700; }
.card .card-desc { font-size: 0.78rem; color: var(--text-secondary); margin-top: 4px; }

.rule-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 18px 20px; margin: 10px 0; display: grid; grid-template-columns: 80px 1fr; gap: 16px; align-items: start; transition: all 0.2s; }
.rule-card:hover { border-color: var(--border-accent); }
.rule-card .rule-num { font-family: 'Orbitron', sans-serif; font-size: 0.85rem; font-weight: 700; text-align: center; padding: 8px 0; border-radius: 8px; }
.rule-card .rule-body h4 { font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; color: var(--text-primary); margin-bottom: 6px; }
.rule-card .rule-body p { font-size: 0.82rem; color: var(--text-secondary); margin: 0; }
.rule-card .rule-body .rule-target { margin-top: 6px; font-size: 0.75rem; color: var(--text-muted); font-style: italic; }

.badge { display: inline-block; font-size: 0.72rem; padding: 3px 10px; border-radius: 6px; font-weight: 600; }
.badge-tp { background: rgba(0,255,136,0.12); color: var(--green); }
.badge-tn { background: rgba(59,130,246,0.12); color: #3b82f6; }
.badge-fn { background: rgba(255,68,102,0.12); color: var(--red); }
.badge-fp { background: rgba(255,204,0,0.12); color: var(--yellow); }
.badge-warn { background: rgba(255,107,53,0.1); color: var(--orange); }

.flow { background: var(--bg-code); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin: 16px 0 24px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; line-height: 2; color: var(--text-secondary); overflow-x: auto; white-space: pre-wrap; }
.flow .step { color: var(--cyan); font-weight: 600; }
.flow .arrow { color: var(--text-muted); }
.flow .hl { color: var(--green); font-weight: 600; }
.flow .warn { color: var(--orange); }

.callout { border-radius: 10px; padding: 16px 20px; margin: 16px 0; font-size: 0.85rem; }
.callout-info { background: rgba(0,212,255,0.06); border-left: 3px solid var(--cyan); color: var(--text-secondary); }
.callout-warn { background: rgba(255,204,0,0.06); border-left: 3px solid var(--yellow); color: var(--text-secondary); }
.callout-danger { background: rgba(255,68,102,0.06); border-left: 3px solid var(--red); color: var(--text-secondary); }

ul, ol { margin: 10px 0 18px 20px; color: var(--text-secondary); }
li { margin-bottom: 6px; font-size: 0.88rem; }

@media (max-width: 900px) { .sidebar { display: none; } .main { margin-left: 0; padding: 24px 20px; } }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
</style>
</head>
<body>
<div class="layout">

<nav class="sidebar">
  <div class="sidebar-logo"><h2>M14 V10_4</h2><div class="version">Architecture Document v2025.02</div></div>
  <div class="nav-section">Overview</div>
  <a class="nav-link" href="#s1">1. 핵심 목적</a>
  <a class="nav-link" href="#s2">2. 기술 스택</a>
  <a class="nav-link" href="#s3">3. 전체 아키텍처</a>
  <div class="nav-section">Feature &amp; Model</div>
  <a class="nav-link" href="#s4">4. Feature 그룹 (4개)</a>
  <a class="nav-link" href="#s5">5. Feature 엔지니어링</a>
  <a class="nav-link" href="#s6">6. 모델 구성</a>
  <div class="nav-section">Prediction Logic</div>
  <a class="nav-link" href="#s7">7. 앙상블 5개 규칙</a>
  <a class="nav-link" href="#s8">8. 황금 패턴</a>
  <a class="nav-link" href="#s9">9. 앙상블 회귀 예측값</a>
  <a class="nav-link" href="#s10">10. 예측 타겟 정의</a>
  <div class="nav-section">Evaluation</div>
  <a class="nav-link" href="#s11">11. 성능 지표 산출 로직</a>
  <div class="nav-section">Infrastructure</div>
  <a class="nav-link" href="#s12">12. 파일 구조</a>
  <a class="nav-link" href="#s13">13. 평가 CSV 출력 컬럼</a>
  <a class="nav-link" href="#s14">14. 대시보드 구성</a>
  <a class="nav-link" href="#s15">15. PKL 저장 구조</a>
  <div class="nav-section">Reference</div>
  <a class="nav-link" href="#s16">16. 핵심 파생 변수</a>
  <a class="nav-link" href="#s17">17. 확장 규칙 (후보)</a>
  <a class="nav-link" href="#s18">18. V8.3→V10_4 변경</a>
  <a class="nav-link" href="#s19">19. 성능 지표 (참고)</a>
  <a class="nav-link" href="#s20">20. 용어 정리</a>
  <a class="nav-link" href="#s21">21. 코드 수정 주의사항</a>
</nav>

<div class="main">

<div class="doc-header">
  <h1>M14 V10_4 프로젝트 아키텍처</h1>
  <div class="doc-meta">
    <span class="tag tag-version">V10_4</span>
    <span class="tag tag-date">2025-02-06</span>
    <span class="tag tag-model">XGBoost + LightGBM + 5-Rule Voting</span>
  </div>
</div>

<div class="section" id="s1">
  <h2><span class="num">01</span> 핵심 목적</h2>
  <p>반도체 <strong>M14 Fab</strong> 물류량(TOTALCNT)을 <strong>10분/30분 후</strong> 예측하여 <strong>1700+ 위험 사전 경고</strong> 제공.</p>
  <p>XGBoost 회귀 앙상블 + LightGBM 분류 앙상블 + <strong>5개 규칙 투표 방식</strong>으로 최종 판정.</p>
</div>

<div class="section" id="s2">
  <h2><span class="num">02</span> 기술 스택</h2>
  <table><thead><tr><th>항목</th><th>값</th></tr></thead><tbody>
    <tr><td>회귀 모델</td><td>XGBoost Regressor × 3~4그룹</td></tr>
    <tr><td>분류 모델</td><td>LightGBM Classifier × 3~4그룹</td></tr>
    <tr><td>판정 방식</td><td>투표 + 5개 규칙 OR 조합</td></tr>
    <tr><td>입력 시퀀스</td><td>280분 시계열</td></tr>
    <tr><td>예측 범위</td><td>10분 / 30분 내 최대값</td></tr>
    <tr><td>Feature 수</td><td>컬럼당 20개 × 43컬럼 = ~860 (그룹별 분리)</td></tr>
    <tr><td>스케일링</td><td>StandardScaler (그룹별 독립)</td></tr>
  </tbody></table>
</div>

<div class="section" id="s3">
  <h2><span class="num">03</span> 전체 아키텍처 (파이프라인)</h2>
  <div class="flow"><span class="step">[1] 학습</span> (V10_4학습10min.py / 30min.py)
    CSV 로드 <span class="arrow">→</span> Feature 그룹 분리 <span class="arrow">→</span> 시퀀스 Feature 생성
    <span class="arrow">→</span> StandardScaler <span class="arrow">→</span> XGB 회귀 + LGBM 분류 학습 <span class="arrow">→</span> <span class="hl">pkl 저장</span>

<span class="step">[2] 평가</span> (V10_4평가10min.py / 30min.py)
    pkl 로드 <span class="arrow">→</span> 평가CSV 로드 <span class="arrow">→</span> 시퀀스 Feature 생성
    <span class="arrow">→</span> 그룹별 예측 <span class="arrow">→</span> <span class="warn">투표 + 5규칙</span> <span class="arrow">→</span> 최종판정
    <span class="arrow">→</span> 예측상태 분류 (TP/TN/FN/FP 세분화) <span class="arrow">→</span> <span class="hl">CSV 저장</span>

<span class="step">[3] 대시보드</span> (트렌드그래프10min.py / 30min.py)
    평가 CSV 로드 <span class="arrow">→</span> 통계 분석 <span class="arrow">→</span> <span class="hl">HTML 대시보드 생성</span>
    (Chart.js 기반, 필터/모달/툴팁 인터랙션)</div>
</div>

<div class="section" id="s4">
  <h2><span class="num">04</span> Feature 그룹 (4개)</h2>
  <h3>4-1. target (1개 컬럼)</h3>
  <table><thead><tr><th>컬럼명</th><th>설명</th></tr></thead><tbody>
    <tr><td><code>TOTALCNT</code></td><td>M14 전체 물류 총량 (<strong>예측 목표</strong>)</td></tr>
  </tbody></table>
  <h3>4-2. important (17개 컬럼)</h3>
  <table><thead><tr><th>컬럼명</th><th>설명</th></tr></thead><tbody>
    <tr><td><code>M14.QUE.LOAD.CURRENTLOADQCNT</code></td><td>현재 로드 대기 큐 카운트</td></tr>
    <tr><td><code>M14.QUE.LOAD.AVGLOADTIME</code></td><td>평균 로드 시간</td></tr>
    <tr><td><code>M14.QUE.LOAD.AVGLOADTIME1MIN</code></td><td>1분 평균 로드 시간</td></tr>
    <tr><td><code>M14.QUE.LOAD.AVGFOUPLOADTIME</code></td><td>FOUP 평균 로드 시간</td></tr>
    <tr><td><code>M14.QUE.LOAD.AVGRETICLELOADTIME</code></td><td>레티클 평균 로드 시간</td></tr>
    <tr><td><code>M14.QUE.LOAD.CURRENTRETICLELOADQCNT</code></td><td>레티클 로드 대기 큐 카운트</td></tr>
    <tr><td><code>M14.QUE.ALL.CURRENTQCOMPLETED</code></td><td>현재 완료된 큐 카운트</td></tr>
    <tr><td><code>M14.QUE.ALL.CURRENTQCREATED</code></td><td>현재 생성된 큐 카운트</td></tr>
    <tr><td><code>M14.QUE.ALL.TRANSPORT4MINOVERCNT</code></td><td>4분 초과 반송 건수</td></tr>
    <tr><td><code>M14.QUE.ALL.TRANSPORT4MINOVERTIMEAVG</code></td><td>4분 초과 반송 평균 시간</td></tr>
    <tr><td><code>M14.QUE.ALL.TRANSPORT4MINOVERRATIO</code></td><td>4분 초과 반송 비율</td></tr>
    <tr><td><code>M16HUB.QUE.M16TOM14B.CURRENTQCREATED</code></td><td>M16→M14B 생성 큐</td></tr>
    <tr><td><code>M16HUB.QUE.M14BTOM16.CURRENTQCREATED</code></td><td>M14B→M16 생성 큐</td></tr>
    <tr><td><code>M16HUB.QUE.M14TOM16.CURRENTQCREATED</code></td><td>M14→M16 생성 큐</td></tr>
    <tr><td><code>M16HUB.QUE.M16TOM14.CURRENTQCREATED</code></td><td>M16→M14 생성 큐</td></tr>
    <tr><td><code>M16HUB.QUE.M14TOM16.MESCURRENTQCNT</code></td><td>M14→M16 MES 현재 큐</td></tr>
    <tr><td><code>M16HUB.QUE.M16TOM14.MESCURRENTQCNT</code></td><td>M16→M14 MES 현재 큐</td></tr>
  </tbody></table>
  <h3>4-3. auxiliary (21개 + 파생 1개)</h3>
  <table><thead><tr><th>컬럼명</th><th>설명</th></tr></thead><tbody>
    <tr><td><code>M14AM10A</code></td><td>M14A→M10A 물량</td></tr>
    <tr><td><code>M10AM14A</code></td><td>M10A→M14A 물량</td></tr>
    <tr><td><code>M14AM10ASUM</code></td><td>M14A↔M10A 합계</td></tr>
    <tr><td><code>M14AM14B</code></td><td>M14A→M14B 물량</td></tr>
    <tr><td><code>M14BM14A</code></td><td>M14B→M14A 물량</td></tr>
    <tr><td><code>M14AM14BSUM</code></td><td>M14A↔M14B 합계</td></tr>
    <tr><td><code>M14AM16</code></td><td>M14A→M16 물량</td></tr>
    <tr><td><code>M16M14A</code></td><td>M16→M14A 물량</td></tr>
    <tr><td><code>M14AM16SUM</code></td><td>M14A↔M16 합계</td></tr>
    <tr><td><code>M14.QUE.SFAB.*</code></td><td>S-Fab 송신/수신/반환/완료 큐 합계 (4개)</td></tr>
    <tr><td><code>M14.QUE.OHT.*</code></td><td>OHT 사용률/큐 (4개)</td></tr>
    <tr><td><code>M14.QUE.CNV.*</code></td><td>컨베이어 북/남/전체 큐 (4개)</td></tr>
    <tr><td><code>QUEUE_GAP</code> <span class="badge badge-warn">파생</span></td><td><code>CURRENTQCREATED - CURRENTQCOMPLETED</code></td></tr>
  </tbody></table>
  <h3>4-4. pdt_new (3개 컬럼)</h3>
  <table><thead><tr><th>컬럼명</th><th>설명</th></tr></thead><tbody>
    <tr><td><code>M14.STRATE.N2.STORAGERATIO</code></td><td>N2 스토리지 비율</td></tr>
    <tr><td><code>M14.PDT.LAYOUT.M14A_M14ATOM14ACNV_CURRENTQCNT</code></td><td>M14A→M14A CNV 현재 큐</td></tr>
    <tr><td><code>M14.PDT.LAYOUT.HUBROOM_M14TOM16_CURRENTQCNT</code></td><td>HubRoom M14→M16 현재 큐</td></tr>
  </tbody></table>
</div>

<div class="section" id="s5">
  <h2><span class="num">05</span> Feature 엔지니어링 (컬럼당 20개)</h2>
  <p>280분 시퀀스에서 각 컬럼마다 <strong>20개 통계 Feature</strong> 생성:</p>
  <table><thead><tr><th>#</th><th>Feature</th><th>수식/설명</th></tr></thead><tbody>
    <tr><td>1</td><td>mean</td><td><code>np.mean(seq)</code> 280분 평균</td></tr>
    <tr><td>2</td><td>std</td><td><code>np.std(seq)</code> 280분 표준편차</td></tr>
    <tr><td>3</td><td>min</td><td><code>np.min(seq)</code> 280분 최솟값</td></tr>
    <tr><td>4</td><td>max</td><td><code>np.max(seq)</code> 280분 최댓값</td></tr>
    <tr><td>5</td><td>current</td><td><code>seq[-1]</code> 현재값</td></tr>
    <tr><td>6</td><td>total_change</td><td><code>seq[-1] - seq[0]</code> 전체 변화량</td></tr>
    <tr><td>7-8</td><td>percentile 25/75</td><td>사분위수</td></tr>
    <tr><td>9</td><td>momentum</td><td><code>mean(last10) - mean(first10)</code></td></tr>
    <tr><td>10</td><td>recent_max_30</td><td><code>max(last30)</code> 최근 30분 최대</td></tr>
    <tr><td>11-13</td><td>delta 10/30/60</td><td>N분 변화량</td></tr>
    <tr><td>14-15</td><td>velocity 10/30</td><td>N분 변화 속도</td></tr>
    <tr><td>16-17</td><td>range 10/30</td><td>N분 범위 (max-min)</td></tr>
    <tr><td>18</td><td>distance_to_limit</td><td><code>1700 - current</code></td></tr>
    <tr><td>19-20</td><td>flag 1500/1600</td><td>임계값 플래그</td></tr>
  </tbody></table>
</div>

<div class="section" id="s6">
  <h2><span class="num">06</span> 모델 구성</h2>
  <h3>6-1. XGBoost 회귀 (3~4개) — 연속값 예측</h3>
  <table><thead><tr><th>모델</th><th>입력</th><th>역할</th></tr></thead><tbody>
    <tr><td><code>xgb_target</code></td><td>target</td><td>TOTALCNT 자체 패턴 학습</td></tr>
    <tr><td><code>xgb_important</code></td><td>important</td><td>로드/큐/허브 패턴 학습</td></tr>
    <tr><td><code>xgb_auxiliary</code></td><td>auxiliary</td><td>물류이동/OHT/CNV 패턴 학습</td></tr>
    <tr><td><code>xgb_pdt_new</code></td><td>pdt_new</td><td>스토리지/레이아웃 (선택)</td></tr>
  </tbody></table>
  <h3>6-2. LightGBM 분류 (3~4개) — 이진 분류 (1700+)</h3>
  <table><thead><tr><th>모델</th><th>입력</th><th>역할</th></tr></thead><tbody>
    <tr><td><code>lgb_target</code></td><td>target</td><td>TOTALCNT 기반 위험 분류</td></tr>
    <tr><td><code>lgb_important</code></td><td>important</td><td>로드/큐 기반 위험 분류</td></tr>
    <tr><td><code>lgb_auxiliary</code></td><td>auxiliary</td><td>물류 기반 위험 분류</td></tr>
    <tr><td><code>lgb_pdt_new</code></td><td>pdt_new</td><td>PDT 기반 (선택)</td></tr>
  </tbody></table>
  <h3>6-3. 하이퍼파라미터</h3>
  <pre><span class="cm"># XGBoost / LightGBM 공통</span>
n_estimators = <span class="nb">200</span>, max_depth = <span class="nb">6</span>, learning_rate = <span class="nb">0.05</span>
random_state = <span class="nb">42</span>, n_jobs = <span class="nb">-1</span></pre>
</div>

<div class="section" id="s7">
  <h2><span class="num">07</span> 앙상블 모델 5개 규칙 (상세)</h2>
  <h3>7-1. 투표 구성 (6~8표)</h3>
  <p>6개 모델이 각각 1700+ 위험 여부를 판정하고 투표 합산 (PDT 포함 시 8표).</p>
  <pre><span class="cm"># XGB 회귀 3개: 예측값 >= 1700이면 위험 투표</span>
votes = [
    <span class="nb">1</span> <span class="kw">if</span> pred_xgb_target >= <span class="nb">1700</span> <span class="kw">else</span> <span class="nb">0</span>,       <span class="cm"># [1표] XGB 타겟</span>
    <span class="nb">1</span> <span class="kw">if</span> pred_xgb_important >= <span class="nb">1700</span> <span class="kw">else</span> <span class="nb">0</span>,     <span class="cm"># [2표] XGB 중요</span>
    <span class="nb">1</span> <span class="kw">if</span> pred_xgb_auxiliary >= <span class="nb">1700</span> <span class="kw">else</span> <span class="nb">0</span>,     <span class="cm"># [3표] XGB 보조</span>
    <span class="cm"># LGBM 분류 3개: 직접 0/1 출력</span>
    pred_lgb_target,                             <span class="cm"># [4표]</span>
    pred_lgb_important,                          <span class="cm"># [5표]</span>
    pred_lgb_auxiliary,                          <span class="cm"># [6표]</span>
]
vote_sum = <span class="fn">sum</span>(votes)  <span class="cm"># 0~6 (또는 0~8)</span></pre>

  <h3>7-2. 최종 판정 5개 규칙 (OR 조합)</h3>
  <p>5개 규칙 중 <strong>하나라도 True</strong>이면 최종 위험 판정:</p>

  <div class="rule-card"><div class="rule-num" style="background:rgba(0,255,136,0.1);color:var(--green)">R1</div><div class="rule-body"><h4>vote_sum >= 3</h4><p>다수결 원칙 — 과반수가 위험으로 판단</p><div class="rule-target">감지: 전반적 위험</div></div></div>
  <div class="rule-card"><div class="rule-num" style="background:rgba(168,85,247,0.1);color:var(--purple)">R2</div><div class="rule-body"><h4>prob_lgb_important >= 0.50 AND 현재값 >= 1450</h4><p>LGBM 확률이 높고 현재값도 경계 진입</p><div class="rule-target">감지: 확률 기반 조기 감지</div></div></div>
  <div class="rule-card"><div class="rule-num" style="background:rgba(0,212,255,0.1);color:var(--cyan)">R3</div><div class="rule-body"><h4>pred_xgb_important >= 1680 AND 현재값 >= 1500</h4><p>XGB가 1700 근접 예측 + 현재 위험 근접</p><div class="rule-target">감지: 근접 예측 보완</div></div></div>
  <div class="rule-card"><div class="rule-num" style="background:rgba(255,204,0,0.1);color:var(--yellow)">R4</div><div class="rule-body"><h4>현재값 >= 1600 AND vote_sum >= 2</h4><p>이미 위험 근접 시 낮은 투표로도 경고</p><div class="rule-target">감지: 고위험 구간 민감 감지</div></div></div>
  <div class="rule-card"><div class="rule-num" style="background:rgba(255,68,102,0.1);color:var(--red)">R5</div><div class="rule-body"><h4>pred_xgb_important >= 1700</h4><p>XGB 중요 모델의 단독 판정 신뢰</p><div class="rule-target">감지: 강한 신호 단독 감지</div></div></div>

  <pre>final_pred_danger = <span class="nb">1</span> <span class="kw">if</span> (rule1 <span class="kw">or</span> rule2 <span class="kw">or</span> rule3 <span class="kw">or</span> rule4 <span class="kw">or</span> rule5) <span class="kw">else</span> <span class="nb">0</span></pre>

  <h3>7-3. 규칙 간 역할 분담</h3>
  <div class="flow"><span class="warn">[R5]</span> XGB 중요 >= 1700 ──────────── 강한 신호 단독
<span class="hl">[R1]</span> 투표 >= 3 ─────────────────── 다수결 합의
<span class="step">[R3]</span> XGB >= 1680 &amp; 현재 >= 1500 ── 근접 보완
<span class="step">[R2]</span> LGBM >= 0.50 &amp; 현재 >= 1450 ─ 확률 조기 감지
<span class="step">[R4]</span> 현재 >= 1600 &amp; 투표 >= 2 ──── 고위험 민감 감지

R5, R1 → 모델 충분히 강할 때, 현재값 조건 없이
R3, R2 → 모델 근접/확률 수준일 때, 현재값 병행
R4    → 현재 이미 위험할 때, 투표 기준 완화</div>
</div>

<div class="section" id="s8">
  <h2><span class="num">08</span> 예측값 활용 황금 패턴</h2>
  <h3>8-1. V8.3 황금 패턴 (이전 버전)</h3>
  <pre><span class="cm"># V8.3 - 1650~1699 구간에서 boost</span>
<span class="kw">if</span> M14AM14B > <span class="nb">540</span> <span class="kw">and</span> M14AM14BSUM > <span class="nb">620</span>: boost += <span class="nb">50</span>  <span class="cm"># gold_strict</span>
<span class="kw">if</span> M14AM14B > <span class="nb">520</span> <span class="kw">and</span> M14AM14BSUM > <span class="nb">600</span>: boost += <span class="nb">40</span>  <span class="cm"># gold_normal</span>
<span class="kw">if</span> queue_gap > <span class="nb">350</span>: boost += <span class="nb">40</span></pre>
  <h3>8-2. V10_4 황금 패턴 → Feature 자동 학습</h3>
  <table><thead><tr><th>V8.3 황금 패턴</th><th>V10_4 Feature로 전환</th><th>그룹</th></tr></thead><tbody>
    <tr><td><code>M14AM14B > 520</code></td><td>current값 + flag Feature</td><td>auxiliary</td></tr>
    <tr><td><code>M14AM14BSUM > 600</code></td><td>current + delta/velocity</td><td>auxiliary</td></tr>
    <tr><td><code>queue_gap > 250</code></td><td>QUEUE_GAP 20개 Feature</td><td>auxiliary</td></tr>
    <tr><td><code>TRANSPORT > 151</code></td><td>TRANSPORT4MINOVERCNT 20개</td><td>important</td></tr>
    <tr><td>Triple Check 조합</td><td>XGB 트리 분할로 자동 학습</td><td>자동</td></tr>
  </tbody></table>
  <h3>8-3. Triple Check</h3>
  <div class="callout callout-info"><strong>Triple Check</strong> = M14AM14B > 520 &amp; M14AM14BSUM > 600 &amp; queue_gap > 250</div>
  <table><thead><tr><th>항목</th><th>V8.3</th><th>V10_4</th></tr></thead><tbody>
    <tr><td>적용</td><td>if문 직접 boost</td><td>XGB 트리 분할 자동 학습</td></tr>
    <tr><td>발동</td><td>1650~1699 구간만</td><td>전 구간 반영</td></tr>
    <tr><td>정확도</td><td>96.7% (11월 급상승)</td><td>다양한 패턴 대응</td></tr>
    <tr><td>한계</td><td>12월 점진상승 실패</td><td>데이터에서 학습</td></tr>
  </tbody></table>
  <h3>8-4. 대시보드 시각화</h3>
  <div class="card-grid" style="grid-template-columns:repeat(3,1fr)">
    <div class="card"><div class="card-label">XGB_타겟 (MAX)</div><div class="card-value" style="color:var(--red)">상한</div><div class="card-desc">가장 공격적 예측</div></div>
    <div class="card"><div class="card-label">앙상블예측</div><div class="card-value" style="color:var(--cyan)">중간</div><div class="card-desc">XGB 평균값</div></div>
    <div class="card"><div class="card-label">XGB_보조 (MIN)</div><div class="card-value" style="color:var(--orange)">하한</div><div class="card-desc">가장 보수적 예측</div></div>
  </div>
  <ul>
    <li><strong>MAX &amp; MIN 모두 1700+:</strong> 매우 강한 위험 (황금 패턴 수준)</li>
    <li><strong>MAX만 1700+:</strong> 일부 패턴 감지, 주의</li>
    <li><strong>둘 다 미만:</strong> 안전 구간</li>
  </ul>
</div>

<div class="section" id="s9">
  <h2><span class="num">09</span> 앙상블 회귀 예측값</h2>
  <pre>ensemble = (xgb_target + xgb_important + xgb_auxiliary) / <span class="nb">3</span>  <span class="cm"># PDT 있으면 /4</span></pre>
  <table><thead><tr><th>모델</th><th>역할</th><th>경향</th></tr></thead><tbody>
    <tr><td><code>xgb_target</code></td><td>TOTALCNT 패턴</td><td>가장 공격적 (MAX)</td></tr>
    <tr><td><code>xgb_important</code></td><td>로드/큐/허브</td><td>중간 (판정 핵심)</td></tr>
    <tr><td><code>xgb_auxiliary</code></td><td>물류/OHT/CNV</td><td>가장 보수적 (MIN)</td></tr>
  </tbody></table>
</div>

<div class="section" id="s10">
  <h2><span class="num">10</span> 예측 타겟 정의</h2>
  <table><thead><tr><th>항목</th><th>10분 예측</th><th>30분 예측</th></tr></thead><tbody>
    <tr><td>회귀 타겟</td><td><code>iloc[idx:idx+10].max()</code></td><td><code>iloc[idx:idx+30].max()</code></td></tr>
    <tr><td>분류 타겟</td><td>>= 1700 → 1</td><td>동일</td></tr>
    <tr><td>의미</td><td>향후 10분 내 최고점</td><td>향후 30분 내 최고점</td></tr>
  </tbody></table>
</div>

<div class="section" id="s11">
  <h2><span class="num">11</span> 모델 성능 지표 산출 로직</h2>
  <h3>11-1. 혼동 행렬</h3>
  <pre>TP = (actual_danger &amp; pred_danger).<span class="fn">sum</span>()       <span class="cm"># 실제 위험 &amp; 예측 위험</span>
TN = (~actual_danger &amp; ~pred_danger).<span class="fn">sum</span>()     <span class="cm"># 실제 안전 &amp; 예측 안전</span>
FP = (~actual_danger &amp; pred_danger).<span class="fn">sum</span>()      <span class="cm"># 오탐</span>
FN = (actual_danger &amp; ~pred_danger).<span class="fn">sum</span>()      <span class="cm"># 놓침</span></pre>

  <h3>11-2. 핵심 성능 지표</h3>
  <table><thead><tr><th>지표</th><th>산출식</th><th>의미</th></tr></thead><tbody>
    <tr><td><strong>Recall</strong></td><td><code>TP / (TP+FN) × 100</code></td><td>실제 위험 중 감지율</td></tr>
    <tr><td><strong>Precision</strong></td><td><code>TP / (TP+FP) × 100</code></td><td>위험 예측 중 정확률</td></tr>
    <tr><td><strong>Accuracy</strong></td><td><code>(TP+TN) / 전체 × 100</code></td><td>전체 정확도</td></tr>
  </tbody></table>

  <h3>11-3. 예측상태 6분류 (10분 전후 세분화)</h3>
  <p>기본 4분류를 <strong>시간 맥락</strong>으로 세분화:</p>
  <pre><span class="kw">def</span> <span class="fn">get_prediction_status</span>(row, all_df):
    <span class="kw">if</span> actual==<span class="nb">1</span> <span class="kw">and</span> pred==<span class="nb">1</span>: <span class="kw">return</span> <span class="st">'정상예측_TP'</span>
    <span class="kw">elif</span> actual==<span class="nb">0</span> <span class="kw">and</span> pred==<span class="nb">0</span>: <span class="kw">return</span> <span class="st">'정상예측_TN'</span>

    <span class="kw">elif</span> actual==<span class="nb">1</span> <span class="kw">and</span> pred==<span class="nb">0</span>:  <span class="cm"># FN → 10분 전에 잡았는지?</span>
        prev = all_df[time - <span class="nb">10</span>min]
        <span class="kw">if</span> prev 최종판정 == <span class="nb">1</span>: <span class="kw">return</span> <span class="st">'FN_10분전예측'</span>  <span class="cm"># 조기 감지됨</span>
        <span class="kw">else</span>: <span class="kw">return</span> <span class="st">'FN_완전놓침'</span>              <span class="cm"># 실질적 문제!</span>

    <span class="kw">else</span>:  <span class="cm"># FP → 10분 후 실제 돌파?</span>
        later = all_df[time + <span class="nb">10</span>min]
        <span class="kw">if</span> later 실제위험 == <span class="nb">1</span>: <span class="kw">return</span> <span class="st">'FP_10분후돌파'</span>  <span class="cm"># 유효 경고</span>
        <span class="kw">else</span>: <span class="kw">return</span> <span class="st">'FP_잘못된경고'</span>              <span class="cm"># 실질적 오탐!</span></pre>

  <h3>11-4. 예측상태 분류표</h3>
  <table><thead><tr><th>상태</th><th>실제</th><th>예측</th><th>시간 맥락</th><th>평가</th></tr></thead><tbody>
    <tr><td><span class="badge badge-tp">정상예측_TP</span></td><td>위험</td><td>위험</td><td>-</td><td>✅ 정확</td></tr>
    <tr><td><span class="badge badge-tn">정상예측_TN</span></td><td>안전</td><td>안전</td><td>-</td><td>✅ 정확</td></tr>
    <tr><td><span class="badge badge-fp">FN_10분전예측</span></td><td>위험</td><td>안전</td><td>10분 전 이미 감지</td><td>⚠️ 허용</td></tr>
    <tr><td><span class="badge badge-fn">FN_완전놓침</span></td><td>위험</td><td>안전</td><td>10분 전에도 미감지</td><td>❌ <strong>놓침</strong></td></tr>
    <tr><td><span class="badge badge-fp">FP_10분후돌파</span></td><td>안전</td><td>위험</td><td>10분 후 실제 돌파</td><td>⚠️ 유효 경고</td></tr>
    <tr><td><span class="badge badge-fn">FP_잘못된경고</span></td><td>안전</td><td>위험</td><td>10분 후에도 안전</td><td>❌ <strong>오탐</strong></td></tr>
  </tbody></table>

  <h3>11-5. 실질적 성능</h3>
  <div class="callout callout-danger">
    <strong>진짜 문제만 추출:</strong> <code>FN_완전놓침</code> + <code>FP_잘못된경고</code><br>
    나머지(FN_10분전예측, FP_10분후돌파)는 시간 맥락상 허용 가능
  </div>

  <h3>11-6. 대시보드 성능 산출</h3>
  <pre>total_positive = TP + FN_10min + FN_miss
recall    = TP / total_positive * <span class="nb">100</span>
precision = TP / (TP + FP_10min + FP_false) * <span class="nb">100</span></pre>
  <div class="callout callout-warn"><strong>주의:</strong> 대시보드 Recall은 FN_10분전예측도 FN에 포함하므로 평가 코드 혼동행렬보다 더 보수적</div>
</div>

<div class="section" id="s12">
  <h2><span class="num">12</span> 파일 구조</h2>
  <h3>학습</h3>
  <table><thead><tr><th>파일</th><th>출력 모델</th><th>범위</th></tr></thead><tbody>
    <tr><td><code>V10_4학습10min.py</code></td><td><code>models/v10_4_m14_model.pkl</code></td><td>10분</td></tr>
    <tr><td><code>V10_4학습30min.py</code></td><td><code>models/v10_4_30min_m14_model.pkl</code></td><td>30분</td></tr>
  </tbody></table>
  <h3>평가</h3>
  <table><thead><tr><th>파일</th><th>모델</th><th>출력</th></tr></thead><tbody>
    <tr><td><code>V10_4평가10min.py</code></td><td><code>v10_4_m14_model.pkl</code></td><td><code>V10_4_평가결과_*.csv</code></td></tr>
    <tr><td><code>V10_4평가30min.py</code></td><td><code>v10_4_30min_m14_model.pkl</code></td><td><code>V10_4_30min_평가결과_*.csv</code></td></tr>
  </tbody></table>
  <h3>대시보드</h3>
  <table><thead><tr><th>파일</th><th>출력</th></tr></thead><tbody>
    <tr><td><code>트렌드그래프10min.py</code></td><td><code>V10_4_10min_dashboard_*.html</code></td></tr>
    <tr><td><code>트렌드그래프30min.py</code></td><td><code>V10_4_30min_dashboard_*.html</code></td></tr>
  </tbody></table>
</div>

<div class="section" id="s13">
  <h2><span class="num">13</span> 평가 CSV 출력 컬럼</h2>
  <table><thead><tr><th>컬럼</th><th>타입</th><th>설명</th></tr></thead><tbody>
    <tr><td><code>현재시간</code></td><td>str</td><td>예측 수행 시점</td></tr>
    <tr><td><code>현재TOTALCNT</code></td><td>float</td><td>예측 시점 TOTALCNT</td></tr>
    <tr><td><code>예측시점</code></td><td>str</td><td>N분 후 시점</td></tr>
    <tr><td><code>실제값10min</code></td><td>float</td><td>N분 내 최대값</td></tr>
    <tr><td><code>실제단일값</code></td><td>float</td><td>정확히 N분 후 값</td></tr>
    <tr><td><code>XGB_타겟/중요/보조/PDT</code></td><td>float</td><td>각 XGB 예측값</td></tr>
    <tr><td><code>LGBM_중요_확률</code></td><td>float</td><td>위험 확률 (0~1)</td></tr>
    <tr><td><code>앙상블예측</code></td><td>float</td><td>XGB 평균</td></tr>
    <tr><td><code>투표(N개중)</code></td><td>int</td><td>투표 합계</td></tr>
    <tr><td><code>최종판정</code></td><td>int</td><td>0=안전, 1=위험</td></tr>
    <tr><td><code>실제위험(1700+)</code></td><td>int</td><td>실제 돌파 여부</td></tr>
    <tr><td><code>예측상태</code></td><td>str</td><td>6분류 결과</td></tr>
  </tbody></table>
</div>

<div class="section" id="s14">
  <h2><span class="num">14</span> 대시보드 구성 (HTML)</h2>
  <div class="card-grid" style="grid-template-columns:1fr 1fr">
    <div class="card"><div class="card-label">10분 대시보드</div><div class="card-desc" style="margin-top:8px"><strong>X:</strong> 현재시간<br><strong>Y:</strong> 현재TOTALCNT, 실제MAX, XGB_타겟, XGB_보조</div></div>
    <div class="card"><div class="card-label">30분 대시보드</div><div class="card-desc" style="margin-top:8px"><strong>X:</strong> 예측시점<br><strong>Y:</strong> 실제단일값, 실제MAX, XGB_타겟, XGB_보조</div></div>
  </div>
  <h3>공통 인터랙션</h3>
  <ul>
    <li>차트 범위 조정 / 알람 구간 점프</li>
    <li>필터 탭 (전체/TP/TN/FN/FP/돌파/MAX 1700+)</li>
    <li>클릭 → 툴팁 / 더블클릭 → ±30분 모달 차트 / ESC 닫기</li>
  </ul>
</div>

<div class="section" id="s15">
  <h2><span class="num">15</span> PKL 모델 저장 구조</h2>
  <pre>model_data = {
    <span class="st">'models'</span>: { xgb_target, xgb_important, xgb_auxiliary, lgb_* ... },
    <span class="st">'scalers'</span>: { target, important, auxiliary, pdt_new },
    <span class="st">'config'</span>: { sequence_length:<span class="nb">280</span>, prediction_offset:<span class="nb">10|30</span>, limit:<span class="nb">1700</span> },
    <span class="st">'feature_groups'</span>: { target:[], important:[], auxiliary:[], pdt_new:[] },
    <span class="st">'training_info'</span>: { version, train_date, samples, danger_samples }
}</pre>
</div>

<div class="section" id="s16">
  <h2><span class="num">16</span> 핵심 파생 변수</h2>
  <pre>QUEUE_GAP = CURRENTQCREATED - CURRENTQCOMPLETED</pre>
  <ul>
    <li><strong>의미:</strong> 현재 대기 중인 작업량</li>
    <li><strong>상관관계:</strong> 0.4+ (합법적 강한 예측 변수)</li>
    <li><strong>위치:</strong> auxiliary 그룹에 자동 추가</li>
  </ul>
</div>

<div class="section" id="s17">
  <h2><span class="num">17</span> 확장 규칙 (미래 적용 후보)</h2>
  <table><thead><tr><th>규칙</th><th>조건</th><th>비고</th></tr></thead><tbody>
    <tr><td>rule6</td><td><code>xgb_auxiliary >= 1720 AND 현재값 >= 1550</code></td><td>보조 모델 활용</td></tr>
    <tr><td>rule9</td><td><code>현재값 >= 1600 AND vote_sum >= 2</code></td><td>현 rule4 동일</td></tr>
    <tr><td>rule10</td><td><code>현재값 >= 1650 AND xgb_target >= 1650</code></td><td>고위험 근접</td></tr>
  </tbody></table>
</div>

<div class="section" id="s18">
  <h2><span class="num">18</span> V8.3 → V10_4 주요 변경사항</h2>
  <table><thead><tr><th>항목</th><th>V8.3</th><th>V10_4</th></tr></thead><tbody>
    <tr><td>모델</td><td>XGBoost 1개</td><td>XGB 3~4 + LGBM 3~4</td></tr>
    <tr><td>컬럼</td><td>8개</td><td>43개 (4그룹)</td></tr>
    <tr><td>Feature</td><td>82개</td><td>~860개</td></tr>
    <tr><td>판정</td><td>보정 + 추세</td><td>투표 + 5규칙 OR</td></tr>
    <tr><td>보정</td><td>하한선 -80, boost</td><td>제거 (모델 학습)</td></tr>
    <tr><td>추세</td><td>12분 변화량</td><td>시퀀스 Feature 대체</td></tr>
    <tr><td>예측 범위</td><td>10분만</td><td>10분 + 30분</td></tr>
    <tr><td>대시보드</td><td>없음</td><td>HTML 인터랙티브</td></tr>
  </tbody></table>
</div>

<div class="section" id="s19">
  <h2><span class="num">19</span> 성능 지표 (참고)</h2>
  <div class="card-grid" style="grid-template-columns:repeat(3,1fr)">
    <div class="card"><div class="card-label">10분 Recall</div><div class="card-value" style="color:var(--green)">86.5%</div></div>
    <div class="card"><div class="card-label">30분 Recall</div><div class="card-value" style="color:var(--green)">96.9%</div></div>
    <div class="card"><div class="card-label">목표</div><div class="card-value" style="color:var(--cyan)">85%+</div></div>
  </div>
</div>

<div class="section" id="s20">
  <h2><span class="num">20</span> 용어 정리</h2>
  <table><thead><tr><th>용어</th><th>설명</th></tr></thead><tbody>
    <tr><td>TOTALCNT</td><td>M14 전체 물류 큐 총량 (예측 목표)</td></tr>
    <tr><td>QUEUE_GAP</td><td>대기 작업량 (생성큐 - 완료큐)</td></tr>
    <tr><td>vote_sum</td><td>6~8개 모델의 위험 판정 합계</td></tr>
    <tr><td>앙상블예측</td><td>XGB 회귀 평균값</td></tr>
    <tr><td>XGB_타겟/보조</td><td>대시보드 MAX/MIN 역할</td></tr>
    <tr><td>limit_value</td><td>1700 (위험 임계값)</td></tr>
    <tr><td>sequence_length</td><td>280 (입력 시계열, 분)</td></tr>
    <tr><td>prediction_offset</td><td>10 또는 30 (예측 범위, 분)</td></tr>
  </tbody></table>
</div>

<div class="section" id="s21">
  <h2><span class="num">21</span> 코드 수정 시 주의사항</h2>
  <ol>
    <li><strong>Feature 함수 동기화:</strong> 학습/평가의 <code>create_sequence_features()</code>가 동일해야 함</li>
    <li><strong>QUEUE_GAP 순서:</strong> Feature 그룹 필터링 전에 파생 변수 먼저 생성</li>
    <li><strong>스케일러 일치:</strong> 평가 시 학습 저장 StandardScaler 그대로 사용</li>
    <li><strong>투표 규칙 변경:</strong> rule 추가/변경 시 재학습 불필요 (후처리)</li>
    <li><strong>대시보드 컬럼명:</strong> CSV 컬럼명 = 대시보드 <code>row.get()</code> 키</li>
    <li><strong>인코딩:</strong> 저장 <code>utf-8-sig</code>, 로드 <code>utf-8</code>→<code>cp949</code>→<code>euc-kr</code></li>
  </ol>
</div>

<div style="text-align:center;padding:40px 0;color:var(--text-muted);font-size:0.75rem;border-top:1px solid var(--border);margin-top:40px;">
  M14 V10_4 프로젝트 아키텍처 · 2025-02-06 · XGBoost + LightGBM + 5-Rule Voting Ensemble
</div>

</div>
</div>

<script>
const sections=document.querySelectorAll('.section'),navLinks=document.querySelectorAll('.nav-link');
const obs=new IntersectionObserver(e=>{e.forEach(en=>{if(en.isIntersecting){navLinks.forEach(l=>l.classList.remove('active'));const l=document.querySelector(`.nav-link[href="#${en.target.id}"]`);if(l)l.classList.add('active')}})},{rootMargin:'-20% 0px -70% 0px'});
sections.forEach(s=>obs.observe(s));
navLinks.forEach(l=>{l.addEventListener('click',e=>{e.preventDefault();document.querySelector(l.getAttribute('href'))?.scrollIntoView({behavior:'smooth',block:'start'})})});
</script>
</body>
</html>