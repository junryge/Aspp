#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ðŸ”¥ ì‹¤ì œ 1700+ íŒ¨í„´ ê¸°ë°˜ ë°ì´í„° ìƒì„±ê¸°
ì‹¤ì œë¡œ ë°œìƒí•œ 1700+ íŒ¨í„´ë§Œ ì •í™•ížˆ ë³µì œ!
"""

import numpy as np
import pandas as pd
from datetime import datetime, timedelta
import warnings
warnings.filterwarnings('ignore')

def generate_realistic_1700_sample(base_sample):
    """ì‹¤ì œ 1700+ íŒ¨í„´ê³¼ ë™ì¼í•˜ê²Œ ìƒì„±"""
    new_sample = base_sample.copy()
    
    # ðŸŽ¯ ì‹¤ì œ 1700+ íŒ¨í„´ ë²”ìœ„ (ì •í™•ížˆ!)
    
    # TOTALCNT: 1700~1750 ì§‘ì¤‘!
    new_sample['TOTALCNT'] = int(np.random.uniform(1700, 1750))
    
    # M14AM14B: 400~530 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14AM14B']
    new_sample['M14AM14B'] = int(np.clip(
        base_val + np.random.uniform(-30, 30), 400, 530
    ))
    
    # M14AM10A: 75~110 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14AM10A']
    new_sample['M14AM10A'] = int(np.clip(
        base_val + np.random.uniform(-15, 15), 75, 110
    ))
    
    # M14AM16: 80~105 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14AM16']
    new_sample['M14AM16'] = int(np.clip(
        base_val + np.random.uniform(-10, 10), 80, 105
    ))
    
    # OHT_UTIL: 88~96 (ì‹¤ì œ íŒ¨í„´, ì¢ì€ ë²”ìœ„!)
    base_val = base_sample['M14.QUE.OHT.OHTUTIL']
    new_sample['M14.QUE.OHT.OHTUTIL'] = round(np.clip(
        base_val + np.random.uniform(-2, 2), 88, 96
    ), 2)
    
    # CURRENTQCREATED: 2830~2950 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14.QUE.ALL.CURRENTQCREATED']
    new_sample['M14.QUE.ALL.CURRENTQCREATED'] = int(np.clip(
        base_val + np.random.uniform(-50, 50), 2830, 2950
    ))
    
    # CURRENTQCOMPLETED: 2680~2920 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14.QUE.ALL.CURRENTQCOMPLETED']
    new_sample['M14.QUE.ALL.CURRENTQCOMPLETED'] = int(np.clip(
        base_val + np.random.uniform(-50, 50), 2680, 2920
    ))
    
    # TRANSPORT4MINOVERCNT: 180~280 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14.QUE.ALL.TRANSPORT4MINOVERCNT']
    new_sample['M14.QUE.ALL.TRANSPORT4MINOVERCNT'] = int(np.clip(
        base_val + np.random.uniform(-30, 30), 180, 280
    ))
    
    # VERTICALQUEUECOUNT: 195~265 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M14B.QUE.SENDFAB.VERTICALQUEUECOUNT']
    new_sample['M14B.QUE.SENDFAB.VERTICALQUEUECOUNT'] = int(np.clip(
        base_val + np.random.uniform(-30, 30), 195, 265
    ))
    
    # M10A.QUE.ALL.CURRENTQCNT: 330~390 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M10A.QUE.ALL.CURRENTQCNT']
    new_sample['M10A.QUE.ALL.CURRENTQCNT'] = int(np.clip(
        base_val + np.random.uniform(-20, 20), 330, 390
    ))
    
    # M10A.QUE.OHT_OHS.OHTUTIL: 50~85 (ì‹¤ì œ íŒ¨í„´)
    base_val = base_sample['M10A.QUE.OHT_OHS.OHTUTIL']
    new_sample['M10A.QUE.OHT_OHS.OHTUTIL'] = round(np.clip(
        base_val + np.random.uniform(-10, 10), 50, 85
    ), 2)
    
    # ê¸°íƒ€ ì»¬ëŸ¼ë“¤ (ì‹¤ì œ íŒ¨í„´ ê¸°ë°˜)
    new_sample['M10AM14A'] = int(np.random.uniform(43, 57))
    new_sample['M14AM10ASUM'] = new_sample['M14AM10A'] + new_sample['M10AM14A']
    new_sample['M14BM14A'] = int(np.random.uniform(107, 133))
    new_sample['M14AM14BSUM'] = new_sample['M14AM14B'] + new_sample['M14BM14A']
    new_sample['M16M14A'] = int(np.random.uniform(133, 158))
    new_sample['M14AM16SUM'] = new_sample['M14AM16'] + new_sample['M16M14A']
    
    return new_sample

def main():
    """ë©”ì¸ ì‹¤í–‰"""
    print("="*80)
    print("ðŸŽ¯ ì‹¤ì œ 1700+ íŒ¨í„´ ê¸°ë°˜ ë°ì´í„° ìƒì„±ê¸°")
    print("="*80)
    
    # ì›ë³¸ ë°ì´í„° ë¡œë“œ
    csv_file = 'Ois.csv'
    print(f"\nðŸ“‚ ë°ì´í„° ë¡œë”©: {csv_file}")
    
    df = pd.read_csv(csv_file)
    print(f"âœ… ì›ë³¸: {len(df):,}í–‰")
    
    # 1700+ ìƒ˜í”Œë§Œ ì¶”ì¶œ
    high_risk = df[df['TOTALCNT'] >= 1700].copy()
    print(f"1700+ ìƒ˜í”Œ: {len(high_risk)}ê°œ")
    
    if len(high_risk) == 0:
        print("âŒ 1700+ ìƒ˜í”Œ ì—†ìŒ!")
        return
    
    # íŒ¨í„´ ì¶œë ¥
    print(f"\nðŸ“Š ì‹¤ì œ 1700+ íŒ¨í„´:")
    print(f"  TOTALCNT: {high_risk['TOTALCNT'].min():.0f} ~ {high_risk['TOTALCNT'].max():.0f}")
    print(f"  M14AM14B: {high_risk['M14AM14B'].min():.0f} ~ {high_risk['M14AM14B'].max():.0f}")
    print(f"  OHT_UTIL: {high_risk['M14.QUE.OHT.OHTUTIL'].min():.1f} ~ {high_risk['M14.QUE.OHT.OHTUTIL'].max():.1f}")
    
    # í•©ì„± ë°ì´í„° ìƒì„±
    num_synthetic = 5000  # ëŒ€ëŸ‰ ìƒì„±!
    print(f"\nâš™ï¸ ìƒì„± ì¤‘: {num_synthetic}ê°œ")
    
    synthetic_data = []
    last_time = pd.to_datetime(df['CURRTIME'].iloc[-1], format='%Y%m%d%H%M')
    
    for i in range(num_synthetic):
        # ëžœë¤í•˜ê²Œ ì‹¤ì œ 1700+ ìƒ˜í”Œ ì„ íƒ
        base_sample = high_risk.sample(1).iloc[0]
        
        # ì‹¤ì œ íŒ¨í„´ê³¼ ë™ì¼í•˜ê²Œ ìƒì„±!
        new_sample = generate_realistic_1700_sample(base_sample)
        
        # ì‹œê°„ ì„¤ì •
        new_time = last_time + timedelta(minutes=i+1)
        new_sample['CURRTIME'] = new_time.strftime('%Y%m%d%H%M')
        new_sample['TIME'] = new_time.strftime('%Y%m%d%H%M')
        
        synthetic_data.append(new_sample)
        
        if (i+1) % 1000 == 0:
            print(f"  ì§„í–‰: {i+1}/{num_synthetic} ({(i+1)/num_synthetic*100:.0f}%)")
    
    print(f"âœ… ìƒì„± ì™„ë£Œ: {len(synthetic_data)}ê°œ")
    
    # DataFrame ë³€í™˜
    synthetic_df = pd.DataFrame(synthetic_data)
    
    # ë³‘í•©
    print(f"\nðŸ”— ë°ì´í„° ë³‘í•©")
    print(f"ì›ë³¸: {len(df):,}ê°œ")
    print(f"í•©ì„±: {len(synthetic_df):,}ê°œ")
    
    merged_df = pd.concat([df, synthetic_df], ignore_index=True)
    
    print(f"ë³‘í•© í›„: {len(merged_df):,}ê°œ")
    print(f"1700+ ìƒ˜í”Œ: {(merged_df['TOTALCNT'] >= 1700).sum():,}ê°œ")
    print(f"1700+ ë¹„ìœ¨: {(merged_df['TOTALCNT'] >= 1700).sum() / len(merged_df) * 100:.1f}%")
    
    # ì €ìž¥
    output_file = 'Ois_augmented_v2.csv'
    merged_df.to_csv(output_file, index=False, encoding='utf-8-sig')
    print(f"\nðŸ’¾ ì €ìž¥: {output_file}")
    
    # ìƒì„±ëœ ë°ì´í„° í†µê³„
    print(f"\nðŸ“Š ìƒì„±ëœ ë°ì´í„° í†µê³„:")
    print(f"  TOTALCNT: {synthetic_df['TOTALCNT'].min():.0f} ~ {synthetic_df['TOTALCNT'].max():.0f}")
    print(f"  M14AM14B: {synthetic_df['M14AM14B'].min():.0f} ~ {synthetic_df['M14AM14B'].max():.0f}")
    print(f"  OHT_UTIL: {synthetic_df['M14.QUE.OHT.OHTUTIL'].min():.1f} ~ {synthetic_df['M14.QUE.OHT.OHTUTIL'].max():.1f}")
    
    print("\n" + "="*80)
    print("âœ… ì™„ë£Œ!")
    print("="*80)
    print(f"ì›ë³¸ íŒŒì¼: {csv_file}")
    print(f"ì¦ê°• íŒŒì¼: {output_file}")
    print(f"\nì›ë³¸ 1700+: {len(high_risk)}ê°œ")
    print(f"ì¦ê°• 1700+: {(merged_df['TOTALCNT'] >= 1700).sum():,}ê°œ")
    print(f"ì¦ê°€: {len(high_risk)}ê°œ â†’ {(merged_df['TOTALCNT'] >= 1700).sum():,}ê°œ")
    print("="*80)

if __name__ == '__main__':
    main()