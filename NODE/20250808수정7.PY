"""
ë°˜ë„ì²´ ë¬¼ë¥˜ ì˜ˆì¸¡ í†µí•© UI ì‹œìŠ¤í…œ
=====================================
LSTM, RNN, GRU, ARIMA í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸ì„ í™œìš©í•œ
ë°˜ë„ì²´ FAB ë¬¼ë¥˜ ì´ë™ ë° ë³‘ëª© êµ¬ê°„ ì˜ˆì¸¡ ì‹œìŠ¤í…œ

ì£¼ìš” ê¸°ëŠ¥:
1. ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
2. í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸ í•™ìŠµ (ì²´í¬í¬ì¸íŠ¸ ì§€ì›)
3. ì‹¤ì‹œê°„ ì˜ˆì¸¡ ë° ë³‘ëª© êµ¬ê°„ ê°ì§€
4. ëª¨ë¸ ì„±ëŠ¥ í‰ê°€ ë° ì‹œê°í™”

ê°œë°œì¼: 2024ë…„
ë²„ì „: 1.0
"""

import sys
import os
import json
import pickle
import traceback
from datetime import datetime, timedelta
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass
from enum import Enum
import threading
import time

# ë°ì´í„° ì²˜ë¦¬
import numpy as np
import pandas as pd
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import mean_squared_error, mean_absolute_error, r2_score

# ë”¥ëŸ¬ë‹
import tensorflow as tf
from tensorflow.keras.models import Sequential, load_model, Model
from tensorflow.keras.layers import Input, LSTM, Dense, Dropout, BatchNormalization, Bidirectional, GRU, SimpleRNN
from tensorflow.keras.callbacks import EarlyStopping, ReduceLROnPlateau, ModelCheckpoint
from tensorflow.keras.optimizers import Adam

# GUI
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *
from PyQt5.QtGui import *

# ì‹œê°í™”
import matplotlib.pyplot as plt
from matplotlib.backends.backend_qt5agg import FigureCanvasQTAgg as FigureCanvas
from matplotlib.figure import Figure
import matplotlib.font_manager as fm

# ê²½ê³  ìˆ¨ê¸°ê¸°
import warnings
warnings.filterwarnings('ignore')

# CPU ëª¨ë“œ ì„¤ì •
os.environ['CUDA_VISIBLE_DEVICES'] = '-1'
tf.config.set_visible_devices([], 'GPU')

# ëœë¤ ì‹œë“œ
RANDOM_SEED = 2079936
tf.random.set_seed(RANDOM_SEED)
np.random.seed(RANDOM_SEED)


class WorkerSignals(QObject):
    """ì›Œì»¤ ìŠ¤ë ˆë“œ ì‹œê·¸ë„"""
    started = pyqtSignal()
    progress = pyqtSignal(int, str)
    log = pyqtSignal(str)
    result = pyqtSignal(object)
    error = pyqtSignal(str)
    finished = pyqtSignal()


class TrainingWorker(QRunnable):
    """í•™ìŠµ ì›Œì»¤ ìŠ¤ë ˆë“œ"""
    def __init__(self, data_path, config):
        super().__init__()
        self.data_path = data_path
        self.config = config
        self.signals = WorkerSignals()
        self.is_running = True
        
    def run(self):
        """í•™ìŠµ ì‹¤í–‰"""
        try:
            self.signals.started.emit()
            self.signals.log.emit("í•™ìŠµ ì‹œì‘...")
            
            # ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
            self.signals.progress.emit(10, "ë°ì´í„° ë¡œë“œ ì¤‘...")
            data = self.load_and_preprocess_data()
            
            # ëª¨ë¸ ìƒì„±
            self.signals.progress.emit(30, "ëª¨ë¸ ìƒì„± ì¤‘...")
            models = self.create_models(data['input_shape'])
            
            # í•™ìŠµ
            self.signals.progress.emit(50, "ëª¨ë¸ í•™ìŠµ ì¤‘...")
            histories = self.train_models(models, data)
            
            # ì €ì¥
            self.signals.progress.emit(90, "ëª¨ë¸ ì €ì¥ ì¤‘...")
            self.save_models(models)
            
            self.signals.progress.emit(100, "í•™ìŠµ ì™„ë£Œ!")
            self.signals.result.emit({
                'models': models,
                'histories': histories,
                'data': data
            })
            
        except Exception as e:
            self.signals.error.emit(str(e))
            traceback.print_exc()
        finally:
            self.signals.finished.emit()
            
    def load_and_preprocess_data(self):
        """ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬"""
        # ì‹¤ì œ êµ¬í˜„ ì½”ë“œ (í•™ìŠµ_ìˆ˜ì •í›„.PY ì°¸ì¡°)
        self.signals.log.emit(f"ë°ì´í„° ë¡œë”©: {self.data_path}")
        
        # ë”ë¯¸ ë°ì´í„° (ì‹¤ì œë¡œëŠ” CSV ë¡œë“œ)
        Full_Data = pd.read_csv(self.data_path)
        
        # ì‹œê°„ ì»¬ëŸ¼ ë³€í™˜
        Full_Data['CURRTIME'] = pd.to_datetime(Full_Data['CURRTIME'], format='%Y%m%d%H%M')
        Full_Data['TIME'] = pd.to_datetime(Full_Data['TIME'], format='%Y%m%d%H%M')
        
        # ì „ì²˜ë¦¬...
        self.signals.log.emit(f"ë°ì´í„° shape: {Full_Data.shape}")
        
        # ì‹œí€€ìŠ¤ ìƒì„±
        seq_length = self.config.get('seq_length', 30)
        # ... ì‹¤ì œ ì‹œí€€ìŠ¤ ìƒì„± ì½”ë“œ
        
        # ë”ë¯¸ ë°˜í™˜ (ì‹¤ì œë¡œëŠ” ì²˜ë¦¬ëœ ë°ì´í„°)
        return {
            'X_train': np.random.randn(1000, seq_length, 10),
            'y_train': np.random.randn(1000, 1),
            'X_val': np.random.randn(200, seq_length, 10),
            'y_val': np.random.randn(200, 1),
            'X_test': np.random.randn(200, seq_length, 10),
            'y_test': np.random.randn(200, 1),
            'input_shape': (seq_length, 10),
            'scaler': StandardScaler()
        }
        
    def create_models(self, input_shape):
        """ëª¨ë¸ ìƒì„±"""
        models = {}
        
        # LSTM ëª¨ë¸
        if self.config.get('use_lstm', True):
            lstm_model = Sequential([
                Input(shape=input_shape),
                LSTM(100, return_sequences=True),
                Dropout(0.2),
                LSTM(100, return_sequences=False),
                Dropout(0.2),
                Dense(50, activation='relu'),
                Dense(1)
            ])
            lstm_model.compile(optimizer='adam', loss='mse', metrics=['mae'])
            models['lstm'] = lstm_model
            self.signals.log.emit("LSTM ëª¨ë¸ ìƒì„± ì™„ë£Œ")
            
        # RNN ëª¨ë¸
        if self.config.get('use_rnn', True):
            rnn_model = Sequential([
                Input(shape=input_shape),
                SimpleRNN(100, return_sequences=True),
                Dropout(0.2),
                SimpleRNN(50, return_sequences=False),
                Dropout(0.2),
                Dense(30, activation='relu'),
                Dense(1)
            ])
            rnn_model.compile(optimizer='adam', loss='mse', metrics=['mae'])
            models['rnn'] = rnn_model
            self.signals.log.emit("RNN ëª¨ë¸ ìƒì„± ì™„ë£Œ")
            
        # GRU ëª¨ë¸
        if self.config.get('use_gru', True):
            gru_model = Sequential([
                Input(shape=input_shape),
                GRU(100, return_sequences=True),
                Dropout(0.2),
                GRU(50, return_sequences=False),
                Dropout(0.2),
                Dense(30, activation='relu'),
                Dense(1)
            ])
            gru_model.compile(optimizer='adam', loss='mse', metrics=['mae'])
            models['gru'] = gru_model
            self.signals.log.emit("GRU ëª¨ë¸ ìƒì„± ì™„ë£Œ")
            
        return models
        
    def train_models(self, models, data):
        """ëª¨ë¸ í•™ìŠµ"""
        histories = {}
        epochs = self.config.get('epochs', 100)
        batch_size = self.config.get('batch_size', 64)
        
        for name, model in models.items():
            if not self.is_running:
                break
                
            self.signals.log.emit(f"{name.upper()} ëª¨ë¸ í•™ìŠµ ì‹œì‘...")
            
            # ê°„ë‹¨í•œ í•™ìŠµ (ì‹¤ì œë¡œëŠ” ì½œë°± ë“± ì¶”ê°€)
            history = model.fit(
                data['X_train'], data['y_train'],
                validation_data=(data['X_val'], data['y_val']),
                epochs=min(epochs, 10),  # ë°ëª¨ìš© ì œí•œ
                batch_size=batch_size,
                verbose=0
            )
            
            histories[name] = history.history
            self.signals.log.emit(f"{name.upper()} ëª¨ë¸ í•™ìŠµ ì™„ë£Œ")
            
        return histories
        
    def save_models(self, models):
        """ëª¨ë¸ ì €ì¥"""
        os.makedirs('models', exist_ok=True)
        
        for name, model in models.items():
            model_path = f'models/{name}_model.keras'
            model.save(model_path)
            self.signals.log.emit(f"{name.upper()} ëª¨ë¸ ì €ì¥: {model_path}")


class PredictionWorker(QRunnable):
    """ì˜ˆì¸¡ ì›Œì»¤ ìŠ¤ë ˆë“œ"""
    def __init__(self, data_path, model_paths):
        super().__init__()
        self.data_path = data_path
        self.model_paths = model_paths
        self.signals = WorkerSignals()
        
    def run(self):
        """ì˜ˆì¸¡ ì‹¤í–‰"""
        try:
            self.signals.started.emit()
            self.signals.log.emit("ì˜ˆì¸¡ ì‹œì‘...")
            
            # ë°ì´í„° ë¡œë“œ
            self.signals.progress.emit(20, "ë°ì´í„° ë¡œë“œ ì¤‘...")
            data = self.load_data()
            
            # ëª¨ë¸ ë¡œë“œ
            self.signals.progress.emit(40, "ëª¨ë¸ ë¡œë“œ ì¤‘...")
            models = self.load_models()
            
            # ì˜ˆì¸¡
            self.signals.progress.emit(60, "ì˜ˆì¸¡ ìˆ˜í–‰ ì¤‘...")
            predictions = self.make_predictions(models, data)
            
            # ë³‘ëª© ë¶„ì„
            self.signals.progress.emit(80, "ë³‘ëª© êµ¬ê°„ ë¶„ì„ ì¤‘...")
            bottlenecks = self.analyze_bottlenecks(predictions)
            
            self.signals.progress.emit(100, "ì˜ˆì¸¡ ì™„ë£Œ!")
            self.signals.result.emit({
                'predictions': predictions,
                'bottlenecks': bottlenecks,
                'data': data
            })
            
        except Exception as e:
            self.signals.error.emit(str(e))
            traceback.print_exc()
        finally:
            self.signals.finished.emit()
            
    def load_data(self):
        """ë°ì´í„° ë¡œë“œ"""
        # ì‹¤ì œ êµ¬í˜„
        return np.random.randn(100, 30, 10)  # ë”ë¯¸ ë°ì´í„°
        
    def load_models(self):
        """ëª¨ë¸ ë¡œë“œ"""
        models = {}
        for name, path in self.model_paths.items():
            if os.path.exists(path):
                models[name] = load_model(path, compile=False)
                self.signals.log.emit(f"{name.upper()} ëª¨ë¸ ë¡œë“œ ì™„ë£Œ")
        return models
        
    def make_predictions(self, models, data):
        """ì˜ˆì¸¡ ìˆ˜í–‰"""
        predictions = {}
        for name, model in models.items():
            pred = model.predict(data, verbose=0)
            predictions[name] = pred
            self.signals.log.emit(f"{name.upper()} ì˜ˆì¸¡ ì™„ë£Œ")
            
        # ì•™ìƒë¸” ì˜ˆì¸¡
        if len(predictions) > 1:
            ensemble = np.mean(list(predictions.values()), axis=0)
            predictions['ensemble'] = ensemble
            
        return predictions
        
    def analyze_bottlenecks(self, predictions):
        """ë³‘ëª© êµ¬ê°„ ë¶„ì„"""
        bottlenecks = []
        
        # ì„ê³„ê°’ ê¸°ë°˜ ë³‘ëª© ê°ì§€
        threshold = 2000  # ì˜ˆì‹œ ì„ê³„ê°’
        
        for name, pred in predictions.items():
            bottleneck_indices = np.where(pred > threshold)[0]
            if len(bottleneck_indices) > 0:
                bottlenecks.append({
                    'model': name,
                    'indices': bottleneck_indices.tolist(),
                    'severity': 'HIGH' if len(bottleneck_indices) > 10 else 'MEDIUM'
                })
                
        return bottlenecks


class MatplotlibWidget(QWidget):
    """Matplotlib ìœ„ì ¯"""
    def __init__(self, parent=None):
        super().__init__(parent)
        self.figure = Figure(figsize=(10, 6))
        self.canvas = FigureCanvas(self.figure)
        
        layout = QVBoxLayout()
        layout.addWidget(self.canvas)
        self.setLayout(layout)
        
    def clear(self):
        """ê·¸ë˜í”„ ì´ˆê¸°í™”"""
        self.figure.clear()
        self.canvas.draw()
        
    def plot_training_history(self, histories):
        """í•™ìŠµ ì´ë ¥ í”Œë¡¯"""
        self.clear()
        
        n_models = len(histories)
        axes = self.figure.subplots(1, n_models, figsize=(5*n_models, 4))
        
        if n_models == 1:
            axes = [axes]
            
        for idx, (name, history) in enumerate(histories.items()):
            ax = axes[idx]
            
            # ì†ì‹¤ ê³¡ì„ 
            ax.plot(history.get('loss', []), label='Training Loss', color='blue')
            ax.plot(history.get('val_loss', []), label='Validation Loss', color='red')
            
            ax.set_title(f'{name.upper()} Training')
            ax.set_xlabel('Epoch')
            ax.set_ylabel('Loss')
            ax.legend()
            ax.grid(True, alpha=0.3)
            
        self.figure.tight_layout()
        self.canvas.draw()
        
    def plot_predictions(self, predictions, actual=None):
        """ì˜ˆì¸¡ ê²°ê³¼ í”Œë¡¯"""
        self.clear()
        
        ax = self.figure.add_subplot(111)
        
        # ì‹¤ì œê°’
        if actual is not None:
            ax.plot(actual, label='Actual', color='black', linewidth=2)
            
        # ì˜ˆì¸¡ê°’ë“¤
        colors = ['blue', 'green', 'red', 'orange', 'purple']
        for idx, (name, pred) in enumerate(predictions.items()):
            color = colors[idx % len(colors)]
            ax.plot(pred, label=f'{name.upper()}', color=color, alpha=0.7)
            
        ax.set_title('ë¬¼ë¥˜ëŸ‰ ì˜ˆì¸¡ ê²°ê³¼')
        ax.set_xlabel('Time')
        ax.set_ylabel('Value')
        ax.legend()
        ax.grid(True, alpha=0.3)
        
        self.figure.tight_layout()
        self.canvas.draw()
        
    def plot_evaluation(self, metrics):
        """í‰ê°€ ì§€í‘œ í”Œë¡¯"""
        self.clear()
        
        # ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ
        models = list(metrics.keys())
        mae_values = [metrics[m].get('mae', 0) for m in models]
        r2_values = [metrics[m].get('r2', 0) for m in models]
        
        ax1 = self.figure.add_subplot(121)
        bars1 = ax1.bar(models, mae_values, color='coral')
        ax1.set_title('MAE (ë‚®ì„ìˆ˜ë¡ ì¢‹ìŒ)')
        ax1.set_ylabel('MAE')
        ax1.set_xlabel('Model')
        
        # ê°’ í‘œì‹œ
        for bar, val in zip(bars1, mae_values):
            height = bar.get_height()
            ax1.text(bar.get_x() + bar.get_width()/2., height,
                    f'{val:.2f}', ha='center', va='bottom')
        
        ax2 = self.figure.add_subplot(122)
        bars2 = ax2.bar(models, r2_values, color='skyblue')
        ax2.set_title('RÂ² Score (ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ)')
        ax2.set_ylabel('RÂ²')
        ax2.set_xlabel('Model')
        ax2.set_ylim(0, 1)
        
        # ê°’ í‘œì‹œ
        for bar, val in zip(bars2, r2_values):
            height = bar.get_height()
            ax2.text(bar.get_x() + bar.get_width()/2., height,
                    f'{val:.3f}', ha='center', va='bottom')
        
        self.figure.tight_layout()
        self.canvas.draw()


class TrainingTab(QWidget):
    """í•™ìŠµ íƒ­"""
    def __init__(self):
        super().__init__()
        self.init_ui()
        self.worker = None
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        layout = QVBoxLayout()
        
        # ë°ì´í„° ì„¤ì • ê·¸ë£¹
        data_group = QGroupBox("ë°ì´í„° ì„¤ì •")
        data_layout = QGridLayout()
        
        data_layout.addWidget(QLabel("ë°ì´í„° íŒŒì¼:"), 0, 0)
        self.data_path_edit = QLineEdit()
        self.data_path_edit.setText("data/20240201_TO_202507281705.csv")
        data_layout.addWidget(self.data_path_edit, 0, 1)
        
        self.browse_btn = QPushButton("ì°¾ì•„ë³´ê¸°...")
        self.browse_btn.clicked.connect(self.browse_file)
        data_layout.addWidget(self.browse_btn, 0, 2)
        
        data_layout.addWidget(QLabel("ë‚ ì§œ ë²”ìœ„:"), 1, 0)
        self.date_range_edit = QLineEdit("2024-02-01 ~ 2024-07-27")
        data_layout.addWidget(self.date_range_edit, 1, 1, 1, 2)
        
        data_group.setLayout(data_layout)
        layout.addWidget(data_group)
        
        # ëª¨ë¸ ì„¤ì • ê·¸ë£¹
        model_group = QGroupBox("ëª¨ë¸ ì„¤ì •")
        model_layout = QGridLayout()
        
        self.lstm_check = QCheckBox("LSTM (ì´ì†¡ì‹œê°„ ì˜ˆì¸¡)")
        self.lstm_check.setChecked(True)
        model_layout.addWidget(self.lstm_check, 0, 0)
        
        self.rnn_check = QCheckBox("RNN (ë³‘ëª© ì˜ˆì¸¡)")
        self.rnn_check.setChecked(True)
        model_layout.addWidget(self.rnn_check, 0, 1)
        
        self.gru_check = QCheckBox("GRU (ë³µí•© ì˜ˆì¸¡)")
        self.gru_check.setChecked(True)
        model_layout.addWidget(self.gru_check, 0, 2)
        
        self.bidirectional_check = QCheckBox("Bidirectional LSTM")
        self.bidirectional_check.setChecked(False)
        model_layout.addWidget(self.bidirectional_check, 0, 3)
        
        model_layout.addWidget(QLabel("ì‹œí€€ìŠ¤ ê¸¸ì´:"), 1, 0)
        self.seq_length_spin = QSpinBox()
        self.seq_length_spin.setRange(10, 100)
        self.seq_length_spin.setValue(30)
        model_layout.addWidget(self.seq_length_spin, 1, 1)
        
        model_layout.addWidget(QLabel("ì—í­ ìˆ˜:"), 1, 2)
        self.epochs_spin = QSpinBox()
        self.epochs_spin.setRange(10, 500)
        self.epochs_spin.setValue(100)
        model_layout.addWidget(self.epochs_spin, 1, 3)
        
        model_layout.addWidget(QLabel("ë°°ì¹˜ í¬ê¸°:"), 2, 0)
        self.batch_size_spin = QSpinBox()
        self.batch_size_spin.setRange(16, 256)
        self.batch_size_spin.setValue(64)
        self.batch_size_spin.setSingleStep(16)
        model_layout.addWidget(self.batch_size_spin, 2, 1)
        
        model_layout.addWidget(QLabel("í•™ìŠµë¥ :"), 2, 2)
        self.learning_rate_spin = QDoubleSpinBox()
        self.learning_rate_spin.setRange(0.0001, 0.1)
        self.learning_rate_spin.setValue(0.0005)
        self.learning_rate_spin.setSingleStep(0.0001)
        self.learning_rate_spin.setDecimals(4)
        model_layout.addWidget(self.learning_rate_spin, 2, 3)
        
        model_group.setLayout(model_layout)
        layout.addWidget(model_group)
        
        # ê³ ê¸‰ ì˜µì…˜ ê·¸ë£¹
        advanced_group = QGroupBox("ê³ ê¸‰ ì˜µì…˜")
        advanced_layout = QGridLayout()
        
        self.checkpoint_check = QCheckBox("ì²´í¬í¬ì¸íŠ¸ ì‚¬ìš©")
        self.checkpoint_check.setChecked(True)
        advanced_layout.addWidget(self.checkpoint_check, 0, 0)
        
        self.early_stop_check = QCheckBox("ì¡°ê¸° ì¢…ë£Œ")
        self.early_stop_check.setChecked(True)
        advanced_layout.addWidget(self.early_stop_check, 0, 1)
        
        self.reduce_lr_check = QCheckBox("í•™ìŠµë¥  ê°ì†Œ")
        self.reduce_lr_check.setChecked(True)
        advanced_layout.addWidget(self.reduce_lr_check, 0, 2)
        
        advanced_layout.addWidget(QLabel("ê²€ì¦ ë¹„ìœ¨:"), 1, 0)
        self.val_split_spin = QDoubleSpinBox()
        self.val_split_spin.setRange(0.1, 0.5)
        self.val_split_spin.setValue(0.3)
        self.val_split_spin.setSingleStep(0.05)
        advanced_layout.addWidget(self.val_split_spin, 1, 1)
        
        advanced_group.setLayout(advanced_layout)
        layout.addWidget(advanced_group)
        
        # ì§„í–‰ ìƒí™©
        progress_group = QGroupBox("ì§„í–‰ ìƒí™©")
        progress_layout = QVBoxLayout()
        
        self.progress_bar = QProgressBar()
        progress_layout.addWidget(self.progress_bar)
        
        self.status_label = QLabel("ëŒ€ê¸° ì¤‘...")
        progress_layout.addWidget(self.status_label)
        
        self.log_text = QTextEdit()
        self.log_text.setReadOnly(True)
        self.log_text.setMaximumHeight(150)
        progress_layout.addWidget(self.log_text)
        
        progress_group.setLayout(progress_layout)
        layout.addWidget(progress_group)
        
        # ë²„íŠ¼
        button_layout = QHBoxLayout()
        
        self.start_btn = QPushButton("í•™ìŠµ ì‹œì‘")
        self.start_btn.clicked.connect(self.start_training)
        button_layout.addWidget(self.start_btn)
        
        self.stop_btn = QPushButton("ì¤‘ì§€")
        self.stop_btn.clicked.connect(self.stop_training)
        self.stop_btn.setEnabled(False)
        button_layout.addWidget(self.stop_btn)
        
        self.resume_btn = QPushButton("ì´ì–´ì„œ í•™ìŠµ")
        self.resume_btn.clicked.connect(self.resume_training)
        button_layout.addWidget(self.resume_btn)
        
        button_layout.addStretch()
        layout.addLayout(button_layout)
        
        # ê·¸ë˜í”„
        self.plot_widget = MatplotlibWidget()
        layout.addWidget(self.plot_widget)
        
        self.setLayout(layout)
        
    def browse_file(self):
        """íŒŒì¼ ì°¾ì•„ë³´ê¸°"""
        filename, _ = QFileDialog.getOpenFileName(
            self,
            "ë°ì´í„° íŒŒì¼ ì„ íƒ",
            "",
            "CSV Files (*.csv);;All Files (*.*)"
        )
        if filename:
            self.data_path_edit.setText(filename)
            
    def start_training(self):
        """í•™ìŠµ ì‹œì‘"""
        # ì„¤ì • ìˆ˜ì§‘
        config = {
            'use_lstm': self.lstm_check.isChecked(),
            'use_rnn': self.rnn_check.isChecked(),
            'use_gru': self.gru_check.isChecked(),
            'use_bidirectional': self.bidirectional_check.isChecked(),
            'seq_length': self.seq_length_spin.value(),
            'epochs': self.epochs_spin.value(),
            'batch_size': self.batch_size_spin.value(),
            'learning_rate': self.learning_rate_spin.value(),
            'val_split': self.val_split_spin.value(),
            'use_checkpoint': self.checkpoint_check.isChecked(),
            'early_stopping': self.early_stop_check.isChecked(),
            'reduce_lr': self.reduce_lr_check.isChecked(),
        }
        
        # ì›Œì»¤ ìƒì„± ë° ì‹¤í–‰
        self.worker = TrainingWorker(self.data_path_edit.text(), config)
        self.worker.signals.started.connect(self.on_training_started)
        self.worker.signals.progress.connect(self.update_progress)
        self.worker.signals.log.connect(self.append_log)
        self.worker.signals.result.connect(self.on_training_completed)
        self.worker.signals.error.connect(self.on_training_error)
        self.worker.signals.finished.connect(self.on_training_finished)
        
        # ìŠ¤ë ˆë“œ í’€ì—ì„œ ì‹¤í–‰
        QThreadPool.globalInstance().start(self.worker)
        
    def stop_training(self):
        """í•™ìŠµ ì¤‘ì§€"""
        if self.worker:
            self.worker.is_running = False
            self.append_log("í•™ìŠµ ì¤‘ì§€ ìš”ì²­...")
            
    def resume_training(self):
        """í•™ìŠµ ì¬ê°œ"""
        self.append_log("ì´ì „ ì²´í¬í¬ì¸íŠ¸ì—ì„œ í•™ìŠµ ì¬ê°œ...")
        # ì‹¤ì œ êµ¬í˜„ í•„ìš”
        
    def on_training_started(self):
        """í•™ìŠµ ì‹œì‘ ì‹œ"""
        self.start_btn.setEnabled(False)
        self.stop_btn.setEnabled(True)
        self.status_label.setText("í•™ìŠµ ì¤‘...")
        
    def update_progress(self, value, message):
        """ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸"""
        self.progress_bar.setValue(value)
        self.status_label.setText(message)
        
    def append_log(self, message):
        """ë¡œê·¸ ì¶”ê°€"""
        timestamp = datetime.now().strftime("%H:%M:%S")
        self.log_text.append(f"[{timestamp}] {message}")
        
    def on_training_completed(self, result):
        """í•™ìŠµ ì™„ë£Œ ì‹œ"""
        self.append_log("í•™ìŠµì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")
        
        # í•™ìŠµ ê³¡ì„  í‘œì‹œ
        if 'histories' in result:
            self.plot_widget.plot_training_history(result['histories'])
            
    def on_training_error(self, error):
        """í•™ìŠµ ì˜¤ë¥˜ ì‹œ"""
        QMessageBox.critical(self, "í•™ìŠµ ì˜¤ë¥˜", f"í•™ìŠµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n{error}")
        
    def on_training_finished(self):
        """í•™ìŠµ ì¢…ë£Œ ì‹œ"""
        self.start_btn.setEnabled(True)
        self.stop_btn.setEnabled(False)
        self.progress_bar.setValue(0)


class PredictionTab(QWidget):
    """ì˜ˆì¸¡ íƒ­"""
    def __init__(self):
        super().__init__()
        self.init_ui()
        self.worker = None
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        layout = QVBoxLayout()
        
        # ë°ì´í„° ì„¤ì •
        data_group = QGroupBox("ë°ì´í„° ì„¤ì •")
        data_layout = QGridLayout()
        
        data_layout.addWidget(QLabel("ì˜ˆì¸¡ ë°ì´í„°:"), 0, 0)
        self.data_path_edit = QLineEdit()
        self.data_path_edit.setText("data/0730to31.csv")
        data_layout.addWidget(self.data_path_edit, 0, 1)
        
        self.browse_btn = QPushButton("ì°¾ì•„ë³´ê¸°...")
        self.browse_btn.clicked.connect(self.browse_file)
        data_layout.addWidget(self.browse_btn, 0, 2)
        
        data_group.setLayout(data_layout)
        layout.addWidget(data_group)
        
        # ëª¨ë¸ ì„ íƒ
        model_group = QGroupBox("ëª¨ë¸ ì„ íƒ")
        model_layout = QVBoxLayout()
        
        self.model_list = QListWidget()
        self.model_list.setSelectionMode(QAbstractItemView.MultiSelection)
        
        # ëª¨ë¸ íŒŒì¼ ê²€ìƒ‰
        self.refresh_model_list()
        
        model_layout.addWidget(self.model_list)
        
        refresh_btn = QPushButton("ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨")
        refresh_btn.clicked.connect(self.refresh_model_list)
        model_layout.addWidget(refresh_btn)
        
        model_group.setLayout(model_layout)
        layout.addWidget(model_group)
        
        # ì˜ˆì¸¡ ì˜µì…˜
        option_group = QGroupBox("ì˜ˆì¸¡ ì˜µì…˜")
        option_layout = QGridLayout()
        
        option_layout.addWidget(QLabel("ì˜ˆì¸¡ ê¸°ê°„:"), 0, 0)
        self.period_combo = QComboBox()
        self.period_combo.addItems(["10ë¶„", "30ë¶„", "1ì‹œê°„", "4ì‹œê°„", "1ì¼"])
        option_layout.addWidget(self.period_combo, 0, 1)
        
        option_layout.addWidget(QLabel("ë³‘ëª© ì„ê³„ê°’:"), 0, 2)
        self.threshold_spin = QSpinBox()
        self.threshold_spin.setRange(1000, 5000)
        self.threshold_spin.setValue(2000)
        self.threshold_spin.setSingleStep(100)
        option_layout.addWidget(self.threshold_spin, 0, 3)
        
        self.ensemble_check = QCheckBox("ì•™ìƒë¸” ì˜ˆì¸¡ ì‚¬ìš©")
        self.ensemble_check.setChecked(True)
        option_layout.addWidget(self.ensemble_check, 1, 0, 1, 2)
        
        self.realtime_check = QCheckBox("ì‹¤ì‹œê°„ ëª¨ë“œ")
        self.realtime_check.setChecked(False)
        option_layout.addWidget(self.realtime_check, 1, 2, 1, 2)
        
        option_group.setLayout(option_layout)
        layout.addWidget(option_group)
        
        # ë²„íŠ¼
        button_layout = QHBoxLayout()
        
        self.predict_btn = QPushButton("ì˜ˆì¸¡ ì‹œì‘")
        self.predict_btn.clicked.connect(self.start_prediction)
        button_layout.addWidget(self.predict_btn)
        
        self.stop_btn = QPushButton("ì¤‘ì§€")
        self.stop_btn.clicked.connect(self.stop_prediction)
        self.stop_btn.setEnabled(False)
        button_layout.addWidget(self.stop_btn)
        
        button_layout.addStretch()
        
        self.export_btn = QPushButton("ê²°ê³¼ ë‚´ë³´ë‚´ê¸°")
        self.export_btn.clicked.connect(self.export_results)
        self.export_btn.setEnabled(False)
        button_layout.addWidget(self.export_btn)
        
        layout.addLayout(button_layout)
        
        # ê²°ê³¼ í‘œì‹œ
        result_group = QGroupBox("ì˜ˆì¸¡ ê²°ê³¼")
        result_layout = QVBoxLayout()
        
        # íƒ­ ìœ„ì ¯
        self.result_tabs = QTabWidget()
        
        # ìš”ì•½ íƒ­
        self.summary_text = QTextEdit()
        self.summary_text.setReadOnly(True)
        self.result_tabs.addTab(self.summary_text, "ìš”ì•½")
        
        # ìƒì„¸ íƒ­
        self.detail_text = QTextEdit()
        self.detail_text.setReadOnly(True)
        self.result_tabs.addTab(self.detail_text, "ìƒì„¸")
        
        # ë³‘ëª© ë¶„ì„ íƒ­
        self.bottleneck_text = QTextEdit()
        self.bottleneck_text.setReadOnly(True)
        self.result_tabs.addTab(self.bottleneck_text, "ë³‘ëª© ë¶„ì„")
        
        result_layout.addWidget(self.result_tabs)
        
        # ê·¸ë˜í”„
        self.plot_widget = MatplotlibWidget()
        result_layout.addWidget(self.plot_widget)
        
        result_group.setLayout(result_layout)
        layout.addWidget(result_group)
        
        self.setLayout(layout)
        
    def browse_file(self):
        """íŒŒì¼ ì°¾ì•„ë³´ê¸°"""
        filename, _ = QFileDialog.getOpenFileName(
            self,
            "ì˜ˆì¸¡ ë°ì´í„° ì„ íƒ",
            "",
            "CSV Files (*.csv);;All Files (*.*)"
        )
        if filename:
            self.data_path_edit.setText(filename)
            
    def refresh_model_list(self):
        """ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"""
        self.model_list.clear()
        
        if os.path.exists('models'):
            for file in os.listdir('models'):
                if file.endswith('.keras') or file.endswith('.h5'):
                    item = QListWidgetItem(file)
                    self.model_list.addItem(item)
                    item.setSelected(True)  # ê¸°ë³¸ ì„ íƒ
                    
    def start_prediction(self):
        """ì˜ˆì¸¡ ì‹œì‘"""
        # ì„ íƒëœ ëª¨ë¸ í™•ì¸
        selected_items = self.model_list.selectedItems()
        if not selected_items:
            QMessageBox.warning(self, "ê²½ê³ ", "ì˜ˆì¸¡í•  ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”.")
            return
            
        # ëª¨ë¸ ê²½ë¡œ ìˆ˜ì§‘
        model_paths = {}
        for item in selected_items:
            name = item.text().replace('.keras', '').replace('.h5', '')
            model_paths[name] = os.path.join('models', item.text())
            
        # ì›Œì»¤ ìƒì„± ë° ì‹¤í–‰
        self.worker = PredictionWorker(self.data_path_edit.text(), model_paths)
        self.worker.signals.started.connect(self.on_prediction_started)
        self.worker.signals.progress.connect(self.update_progress)
        self.worker.signals.log.connect(self.append_log)
        self.worker.signals.result.connect(self.on_prediction_completed)
        self.worker.signals.error.connect(self.on_prediction_error)
        self.worker.signals.finished.connect(self.on_prediction_finished)
        
        QThreadPool.globalInstance().start(self.worker)
        
    def stop_prediction(self):
        """ì˜ˆì¸¡ ì¤‘ì§€"""
        # ì‹¤ì œ êµ¬í˜„ í•„ìš”
        pass
        
    def on_prediction_started(self):
        """ì˜ˆì¸¡ ì‹œì‘ ì‹œ"""
        self.predict_btn.setEnabled(False)
        self.stop_btn.setEnabled(True)
        
    def update_progress(self, value, message):
        """ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸"""
        # ìƒíƒœë°”ë‚˜ ì§„í–‰ë°” ì—…ë°ì´íŠ¸
        pass
        
    def append_log(self, message):
        """ë¡œê·¸ ì¶”ê°€"""
        timestamp = datetime.now().strftime("%H:%M:%S")
        self.detail_text.append(f"[{timestamp}] {message}")
        
    def on_prediction_completed(self, result):
        """ì˜ˆì¸¡ ì™„ë£Œ ì‹œ"""
        # ìš”ì•½ í‘œì‹œ
        summary = self.generate_summary(result)
        self.summary_text.setPlainText(summary)
        
        # ë³‘ëª© ë¶„ì„ í‘œì‹œ
        if 'bottlenecks' in result:
            bottleneck_text = self.analyze_bottlenecks(result['bottlenecks'])
            self.bottleneck_text.setPlainText(bottleneck_text)
            
        # ê·¸ë˜í”„ í‘œì‹œ
        if 'predictions' in result:
            self.plot_widget.plot_predictions(result['predictions'])
            
        self.export_btn.setEnabled(True)
        self.last_result = result
        
    def generate_summary(self, result):
        """ì˜ˆì¸¡ ìš”ì•½ ìƒì„±"""
        summary = "=" * 60 + "\n"
        summary += "ì˜ˆì¸¡ ê²°ê³¼ ìš”ì•½\n"
        summary += "=" * 60 + "\n\n"
        summary += f"ì˜ˆì¸¡ ì‹œì : {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n"
        summary += f"ì˜ˆì¸¡ ê¸°ê°„: {self.period_combo.currentText()}\n"
        summary += f"ë³‘ëª© ì„ê³„ê°’: {self.threshold_spin.value()}\n\n"
        
        if 'predictions' in result:
            for name, pred in result['predictions'].items():
                summary += f"\n{name.upper()} ëª¨ë¸:\n"
                summary += f"  - í‰ê·  ì˜ˆì¸¡ê°’: {np.mean(pred):.2f}\n"
                summary += f"  - ìµœëŒ€ ì˜ˆì¸¡ê°’: {np.max(pred):.2f}\n"
                summary += f"  - ìµœì†Œ ì˜ˆì¸¡ê°’: {np.min(pred):.2f}\n"
                
        return summary
        
    def analyze_bottlenecks(self, bottlenecks):
        """ë³‘ëª© ë¶„ì„ í…ìŠ¤íŠ¸ ìƒì„±"""
        text = "ë³‘ëª© êµ¬ê°„ ë¶„ì„ ê²°ê³¼\n"
        text += "=" * 60 + "\n\n"
        
        for bn in bottlenecks:
            text += f"\n{bn['model'].upper()} ëª¨ë¸:\n"
            text += f"  - ë³‘ëª© êµ¬ê°„ ìˆ˜: {len(bn['indices'])}\n"
            text += f"  - ì‹¬ê°ë„: {bn['severity']}\n"
            text += f"  - ìœ„ì¹˜: {bn['indices'][:10]}...\n" if len(bn['indices']) > 10 else f"  - ìœ„ì¹˜: {bn['indices']}\n"
            
        return text
        
    def on_prediction_error(self, error):
        """ì˜ˆì¸¡ ì˜¤ë¥˜ ì‹œ"""
        QMessageBox.critical(self, "ì˜ˆì¸¡ ì˜¤ë¥˜", f"ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n{error}")
        
    def on_prediction_finished(self):
        """ì˜ˆì¸¡ ì¢…ë£Œ ì‹œ"""
        self.predict_btn.setEnabled(True)
        self.stop_btn.setEnabled(False)
        
    def export_results(self):
        """ê²°ê³¼ ë‚´ë³´ë‚´ê¸°"""
        if not hasattr(self, 'last_result'):
            return
            
        filename, _ = QFileDialog.getSaveFileName(
            self,
            "ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥",
            f"prediction_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx",
            "Excel Files (*.xlsx);;CSV Files (*.csv)"
        )
        
        if filename:
            # ì‹¤ì œ ë‚´ë³´ë‚´ê¸° êµ¬í˜„
            QMessageBox.information(self, "ì™„ë£Œ", "ì˜ˆì¸¡ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")


class EvaluationTab(QWidget):
    """í‰ê°€ íƒ­"""
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        layout = QVBoxLayout()
        
        # ëª¨ë¸ ì„ íƒ
        model_group = QGroupBox("í‰ê°€í•  ëª¨ë¸")
        model_layout = QVBoxLayout()
        
        self.model_list = QListWidget()
        self.model_list.setSelectionMode(QAbstractItemView.MultiSelection)
        self.refresh_model_list()
        
        model_layout.addWidget(self.model_list)
        
        refresh_btn = QPushButton("ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨")
        refresh_btn.clicked.connect(self.refresh_model_list)
        model_layout.addWidget(refresh_btn)
        
        model_group.setLayout(model_layout)
        layout.addWidget(model_group)
        
        # í‰ê°€ ì˜µì…˜
        option_group = QGroupBox("í‰ê°€ ì˜µì…˜")
        option_layout = QGridLayout()
        
        self.mape_check = QCheckBox("MAPE")
        self.mape_check.setChecked(True)
        option_layout.addWidget(self.mape_check, 0, 0)
        
        self.mae_check = QCheckBox("MAE")
        self.mae_check.setChecked(True)
        option_layout.addWidget(self.mae_check, 0, 1)
        
        self.rmse_check = QCheckBox("RMSE")
        self.rmse_check.setChecked(True)
        option_layout.addWidget(self.rmse_check, 0, 2)
        
        self.r2_check = QCheckBox("RÂ² Score")
        self.r2_check.setChecked(True)
        option_layout.addWidget(self.r2_check, 0, 3)
        
        option_layout.addWidget(QLabel("í…ŒìŠ¤íŠ¸ ë°ì´í„°:"), 1, 0)
        self.test_data_edit = QLineEdit()
        option_layout.addWidget(self.test_data_edit, 1, 1, 1, 2)
        
        browse_btn = QPushButton("ì°¾ì•„ë³´ê¸°...")
        browse_btn.clicked.connect(self.browse_test_data)
        option_layout.addWidget(browse_btn, 1, 3)
        
        option_group.setLayout(option_layout)
        layout.addWidget(option_group)
        
        # í‰ê°€ ì‹œì‘ ë²„íŠ¼
        eval_btn = QPushButton("í‰ê°€ ì‹œì‘")
        eval_btn.clicked.connect(self.start_evaluation)
        layout.addWidget(eval_btn)
        
        # ê²°ê³¼ í‘œì‹œ
        result_group = QGroupBox("í‰ê°€ ê²°ê³¼")
        result_layout = QVBoxLayout()
        
        # ê²°ê³¼ í…Œì´ë¸”
        self.result_table = QTableWidget()
        self.result_table.setColumnCount(5)
        self.result_table.setHorizontalHeaderLabels(["ëª¨ë¸", "MAPE", "MAE", "RMSE", "RÂ²"])
        result_layout.addWidget(self.result_table)
        
        # ê·¸ë˜í”„
        self.plot_widget = MatplotlibWidget()
        result_layout.addWidget(self.plot_widget)
        
        result_group.setLayout(result_layout)
        layout.addWidget(result_group)
        
        # ë¦¬í¬íŠ¸ ìƒì„± ë²„íŠ¼
        report_btn = QPushButton("í‰ê°€ ë¦¬í¬íŠ¸ ìƒì„±")
        report_btn.clicked.connect(self.generate_report)
        layout.addWidget(report_btn)
        
        self.setLayout(layout)
        
    def refresh_model_list(self):
        """ëª¨ë¸ ëª©ë¡ ìƒˆë¡œê³ ì¹¨"""
        self.model_list.clear()
        
        if os.path.exists('models'):
            for file in os.listdir('models'):
                if file.endswith('.keras') or file.endswith('.h5'):
                    item = QListWidgetItem(file)
                    self.model_list.addItem(item)
                    item.setSelected(True)
                    
    def browse_test_data(self):
        """í…ŒìŠ¤íŠ¸ ë°ì´í„° ì°¾ì•„ë³´ê¸°"""
        filename, _ = QFileDialog.getOpenFileName(
            self,
            "í…ŒìŠ¤íŠ¸ ë°ì´í„° ì„ íƒ",
            "",
            "CSV Files (*.csv);;All Files (*.*)"
        )
        if filename:
            self.test_data_edit.setText(filename)
            
    def start_evaluation(self):
        """í‰ê°€ ì‹œì‘"""
        selected_items = self.model_list.selectedItems()
        if not selected_items:
            QMessageBox.warning(self, "ê²½ê³ ", "í‰ê°€í•  ëª¨ë¸ì„ ì„ íƒí•˜ì„¸ìš”.")
            return
            
        # ë”ë¯¸ í‰ê°€ ê²°ê³¼ ìƒì„±
        self.result_table.setRowCount(len(selected_items))
        
        metrics = {}
        for idx, item in enumerate(selected_items):
            model_name = item.text().replace('.keras', '').replace('.h5', '')
            
            # ë”ë¯¸ ë©”íŠ¸ë¦­
            mape = np.random.uniform(5, 15)
            mae = np.random.uniform(50, 150)
            rmse = np.random.uniform(70, 200)
            r2 = np.random.uniform(0.7, 0.95)
            
            self.result_table.setItem(idx, 0, QTableWidgetItem(model_name))
            self.result_table.setItem(idx, 1, QTableWidgetItem(f"{mape:.2f}%"))
            self.result_table.setItem(idx, 2, QTableWidgetItem(f"{mae:.2f}"))
            self.result_table.setItem(idx, 3, QTableWidgetItem(f"{rmse:.2f}"))
            self.result_table.setItem(idx, 4, QTableWidgetItem(f"{r2:.3f}"))
            
            metrics[model_name] = {'mae': mae, 'r2': r2}
            
        # ê·¸ë˜í”„ í‘œì‹œ
        self.plot_widget.plot_evaluation(metrics)
        
        QMessageBox.information(self, "ì™„ë£Œ", "ëª¨ë¸ í‰ê°€ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        
    def generate_report(self):
        """í‰ê°€ ë¦¬í¬íŠ¸ ìƒì„±"""
        filename, _ = QFileDialog.getSaveFileName(
            self,
            "í‰ê°€ ë¦¬í¬íŠ¸ ì €ì¥",
            f"evaluation_report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt",
            "Text Files (*.txt)"
        )
        
        if filename:
            with open(filename, 'w', encoding='utf-8') as f:
                f.write("=" * 60 + "\n")
                f.write("ëª¨ë¸ í‰ê°€ ë¦¬í¬íŠ¸\n")
                f.write("=" * 60 + "\n\n")
                f.write(f"ìƒì„± ì¼ì‹œ: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                
                # í…Œì´ë¸” ë‚´ìš© ì €ì¥
                for row in range(self.result_table.rowCount()):
                    model = self.result_table.item(row, 0).text() if self.result_table.item(row, 0) else ""
                    mape = self.result_table.item(row, 1).text() if self.result_table.item(row, 1) else ""
                    mae = self.result_table.item(row, 2).text() if self.result_table.item(row, 2) else ""
                    rmse = self.result_table.item(row, 3).text() if self.result_table.item(row, 3) else ""
                    r2 = self.result_table.item(row, 4).text() if self.result_table.item(row, 4) else ""
                    
                    f.write(f"\n{model}\n")
                    f.write("-" * 40 + "\n")
                    f.write(f"  MAPE: {mape}\n")
                    f.write(f"  MAE: {mae}\n")
                    f.write(f"  RMSE: {rmse}\n")
                    f.write(f"  RÂ²: {r2}\n")
                    
            QMessageBox.information(self, "ì™„ë£Œ", "í‰ê°€ ë¦¬í¬íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")


class MainWindow(QMainWindow):
    """ë©”ì¸ ìœˆë„ìš°"""
    def __init__(self):
        super().__init__()
        self.init_ui()
        
    def init_ui(self):
        """UI ì´ˆê¸°í™”"""
        self.setWindowTitle("ë°˜ë„ì²´ ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ - í†µí•© ê´€ë¦¬ì")
        self.setGeometry(100, 100, 1400, 900)
        
        # ì•„ì´ì½˜ ì„¤ì • (ìˆë‹¤ë©´)
        # self.setWindowIcon(QIcon('icon.png'))
        
        # ì¤‘ì•™ ìœ„ì ¯
        central_widget = QWidget()
        self.setCentralWidget(central_widget)
        
        # ë©”ì¸ ë ˆì´ì•„ì›ƒ
        main_layout = QVBoxLayout()
        central_widget.setLayout(main_layout)
        
        # í—¤ë”
        header_layout = QHBoxLayout()
        
        title_label = QLabel("ğŸš€ ë°˜ë„ì²´ FAB ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ")
        title_label.setStyleSheet("""
            QLabel {
                font-size: 24px;
                font-weight: bold;
                color: #2c3e50;
                padding: 10px;
            }
        """)
        header_layout.addWidget(title_label)
        
        header_layout.addStretch()
        
        info_label = QLabel("LSTM/RNN/GRU í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸")
        info_label.setStyleSheet("""
            QLabel {
                font-size: 14px;
                color: #7f8c8d;
                padding: 10px;
            }
        """)
        header_layout.addWidget(info_label)
        
        main_layout.addLayout(header_layout)
        
        # êµ¬ë¶„ì„ 
        line = QFrame()
        line.setFrameShape(QFrame.HLine)
        line.setFrameShadow(QFrame.Sunken)
        main_layout.addWidget(line)
        
        # íƒ­ ìœ„ì ¯
        self.tabs = QTabWidget()
        self.tabs.setStyleSheet("""
            QTabWidget::pane {
                border: 1px solid #cccccc;
                background-color: white;
            }
            QTabBar::tab {
                padding: 10px 20px;
                margin-right: 5px;
            }
            QTabBar::tab:selected {
                background-color: #3498db;
                color: white;
            }
        """)
        
        # íƒ­ ì¶”ê°€
        self.training_tab = TrainingTab()
        self.tabs.addTab(self.training_tab, "ğŸ“š í•™ìŠµ")
        
        self.prediction_tab = PredictionTab()
        self.tabs.addTab(self.prediction_tab, "ğŸ”® ì˜ˆì¸¡")
        
        self.evaluation_tab = EvaluationTab()
        self.tabs.addTab(self.evaluation_tab, "ğŸ“Š í‰ê°€")
        
        main_layout.addWidget(self.tabs)
        
        # ìƒíƒœë°”
        self.statusBar().showMessage("ì¤€ë¹„ë¨")
        
        # ë©”ë‰´ë°”
        self.create_menu_bar()
        
        # íˆ´ë°”
        self.create_toolbar()
        
        # ìŠ¤íƒ€ì¼ ì ìš©
        self.setStyleSheet("""
            QMainWindow {
                background-color: #f5f5f5;
            }
            QGroupBox {
                font-weight: bold;
                border: 2px solid #cccccc;
                border-radius: 5px;
                margin-top: 10px;
                padding-top: 10px;
            }
            QGroupBox::title {
                subcontrol-origin: margin;
                left: 10px;
                padding: 0 5px 0 5px;
            }
            QPushButton {
                padding: 8px 15px;
                background-color: #3498db;
                color: white;
                border: none;
                border-radius: 4px;
                font-weight: bold;
            }
            QPushButton:hover {
                background-color: #2980b9;
            }
            QPushButton:pressed {
                background-color: #21618c;
            }
            QPushButton:disabled {
                background-color: #bdc3c7;
            }
            QLineEdit, QSpinBox, QDoubleSpinBox, QComboBox {
                padding: 5px;
                border: 1px solid #cccccc;
                border-radius: 3px;
            }
            QTextEdit {
                border: 1px solid #cccccc;
                border-radius: 3px;
            }
        """)
        
    def create_menu_bar(self):
        """ë©”ë‰´ë°” ìƒì„±"""
        menubar = self.menuBar()
        
        # íŒŒì¼ ë©”ë‰´
        file_menu = menubar.addMenu("íŒŒì¼")
        
        new_action = QAction("ìƒˆ í”„ë¡œì íŠ¸", self)
        new_action.setShortcut("Ctrl+N")
        file_menu.addAction(new_action)
        
        open_action = QAction("í”„ë¡œì íŠ¸ ì—´ê¸°", self)
        open_action.setShortcut("Ctrl+O")
        file_menu.addAction(open_action)
        
        save_action = QAction("í”„ë¡œì íŠ¸ ì €ì¥", self)
        save_action.setShortcut("Ctrl+S")
        file_menu.addAction(save_action)
        
        file_menu.addSeparator()
        
        exit_action = QAction("ì¢…ë£Œ", self)
        exit_action.setShortcut("Ctrl+Q")
        exit_action.triggered.connect(self.close)
        file_menu.addAction(exit_action)
        
        # ë„êµ¬ ë©”ë‰´
        tools_menu = menubar.addMenu("ë„êµ¬")
        
        settings_action = QAction("ì„¤ì •", self)
        settings_action.triggered.connect(self.show_settings)
        tools_menu.addAction(settings_action)
        
        # ë„ì›€ë§ ë©”ë‰´
        help_menu = menubar.addMenu("ë„ì›€ë§")
        
        about_action = QAction("í”„ë¡œê·¸ë¨ ì •ë³´", self)
        about_action.triggered.connect(self.show_about)
        help_menu.addAction(about_action)
        
        manual_action = QAction("ì‚¬ìš© ì„¤ëª…ì„œ", self)
        manual_action.triggered.connect(self.show_manual)
        help_menu.addAction(manual_action)
        
    def create_toolbar(self):
        """íˆ´ë°” ìƒì„±"""
        toolbar = self.addToolBar("ë©”ì¸ íˆ´ë°”")
        toolbar.setMovable(False)
        
        # í•™ìŠµ ì‹œì‘
        train_action = QAction("ğŸš€ í•™ìŠµ", self)
        train_action.triggered.connect(lambda: self.tabs.setCurrentIndex(0))
        toolbar.addAction(train_action)
        
        # ì˜ˆì¸¡ ì‹œì‘
        predict_action = QAction("ğŸ”® ì˜ˆì¸¡", self)
        predict_action.triggered.connect(lambda: self.tabs.setCurrentIndex(1))
        toolbar.addAction(predict_action)
        
        # í‰ê°€ ì‹œì‘
        eval_action = QAction("ğŸ“Š í‰ê°€", self)
        eval_action.triggered.connect(lambda: self.tabs.setCurrentIndex(2))
        toolbar.addAction(eval_action)
        
        toolbar.addSeparator()
        
        # ì„¤ì •
        settings_action = QAction("âš™ï¸ ì„¤ì •", self)
        settings_action.triggered.connect(self.show_settings)
        toolbar.addAction(settings_action)
        
    def show_settings(self):
        """ì„¤ì • ëŒ€í™”ìƒì"""
        dialog = QDialog(self)
        dialog.setWindowTitle("ì„¤ì •")
        dialog.setModal(True)
        
        layout = QVBoxLayout()
        
        # ì„¤ì • ì˜µì…˜ë“¤
        layout.addWidget(QLabel("GPU ì‚¬ìš©: ë¹„í™œì„±í™” (CPU ëª¨ë“œ)"))
        layout.addWidget(QLabel("ìë™ ì €ì¥: í™œì„±í™”"))
        layout.addWidget(QLabel("ë¡œê·¸ ë ˆë²¨: INFO"))
        
        buttons = QDialogButtonBox(QDialogButtonBox.Ok)
        buttons.accepted.connect(dialog.accept)
        layout.addWidget(buttons)
        
        dialog.setLayout(layout)
        dialog.exec_()
        
    def show_about(self):
        """í”„ë¡œê·¸ë¨ ì •ë³´"""
        QMessageBox.information(
            self,
            "í”„ë¡œê·¸ë¨ ì •ë³´",
            "ë°˜ë„ì²´ ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ v1.0\n\n"
            "LSTM/RNN/GRU í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë¸ì„ í™œìš©í•œ\n"
            "ë°˜ë„ì²´ FAB ë¬¼ë¥˜ ì´ë™ ë° ë³‘ëª© êµ¬ê°„ ì˜ˆì¸¡\n\n"
            "ê°œë°œ: 2024ë…„\n"
            "Python 3.8+ / TensorFlow 2.x / PyQt5"
        )
        
    def show_manual(self):
        """ì‚¬ìš© ì„¤ëª…ì„œ"""
        manual = """
        ì‚¬ìš© ë°©ë²•:
        
        1. í•™ìŠµ íƒ­
           - ë°ì´í„° íŒŒì¼ ì„ íƒ
           - ëª¨ë¸ ì˜µì…˜ ì„¤ì •
           - í•™ìŠµ ì‹œì‘ í´ë¦­
           
        2. ì˜ˆì¸¡ íƒ­
           - í•™ìŠµëœ ëª¨ë¸ ì„ íƒ
           - ì˜ˆì¸¡ ë°ì´í„° ì…ë ¥
           - ì˜ˆì¸¡ ì‹œì‘ í´ë¦­
           
        3. í‰ê°€ íƒ­
           - í‰ê°€í•  ëª¨ë¸ ì„ íƒ
           - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì…ë ¥
           - í‰ê°€ ì‹œì‘ í´ë¦­
           
        ë‹¨ì¶•í‚¤:
        - Ctrl+N: ìƒˆ í”„ë¡œì íŠ¸
        - Ctrl+O: í”„ë¡œì íŠ¸ ì—´ê¸°
        - Ctrl+S: í”„ë¡œì íŠ¸ ì €ì¥
        - Ctrl+Q: ì¢…ë£Œ
        """
        
        msg = QMessageBox(self)
        msg.setWindowTitle("ì‚¬ìš© ì„¤ëª…ì„œ")
        msg.setText(manual)
        msg.setIcon(QMessageBox.Information)
        msg.exec_()


def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    app = QApplication(sys.argv)
    
    # ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë³´ ì„¤ì •
    app.setApplicationName("ë°˜ë„ì²´ ë¬¼ë¥˜ ì˜ˆì¸¡ ì‹œìŠ¤í…œ")
    app.setOrganizationName("Semiconductor Logistics")
    
    # ìŠ¤íƒ€ì¼ ì„¤ì •
    app.setStyle("Fusion")
    
    # ë©”ì¸ ìœˆë„ìš° ìƒì„± ë° í‘œì‹œ
    window = MainWindow()
    window.show()
    
    sys.exit(app.exec_())


if __name__ == "__main__":
    main()