function displaySingleResult(data) {
    const equipColor = EQUIP_COLORS[data.equipment_type] || EQUIP_COLORS['UNKNOWN'];
    const preprocess = data.preprocess_details || {};
    const hasDelay = preprocess.delays?.length > 0;
    const totalDuration = preprocess.total_duration_sec || 0;
    
    let html = `<div style="padding: 10px;">`;
    
    // ========================================
    // 1. ğŸ“Œ ìµœì¢… ê²°ë¡  (ë§¨ ìœ„)
    // ========================================
    html += `<div style="background: ${hasDelay ? 'linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)' : 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%)'}; border-radius: 12px; padding: 20px; margin-bottom: 20px; border-left: 5px solid ${hasDelay ? '#f59e0b' : '#10b981'};">`;
    html += `<h2 style="margin: 0 0 15px 0; color: ${hasDelay ? '#92400e' : '#065f46'};">ğŸ“Œ ìµœì¢… ê²°ë¡ </h2>`;
    
    // í•µì‹¬ í•œ ì¤„ ìš”ì•½
    if (hasDelay) {
        html += `<div style="font-size: 18px; font-weight: 700; color: #92400e; margin-bottom: 12px;">ğŸ”´ ì§€ì—° ë°œìƒ - ì´ ì†Œìš”ì‹œê°„: ${formatDuration(totalDuration)}</div>`;
        
        // ì§€ì—° êµ¬ê°„ ìƒì„¸
        html += `<div style="background: white; border-radius: 8px; padding: 15px; margin-top: 10px;">`;
        html += `<div style="font-weight: 600; margin-bottom: 10px;">ğŸ“ ì§€ì—° êµ¬ê°„:</div>`;
        html += `<ul style="margin: 0; padding-left: 20px;">`;
        preprocess.delays.forEach(d => {
            html += `<li style="margin-bottom: 5px;"><strong>${d.segment}</strong>: ${d.duration_str}`;
            if (d.cause) html += ` - ${d.cause}`;
            html += `</li>`;
        });
        html += `</ul></div>`;
        
        // ê¶Œì¥ ì¡°ì¹˜
        html += `<div style="background: white; border-radius: 8px; padding: 15px; margin-top: 10px;">`;
        html += `<div style="font-weight: 600; margin-bottom: 10px;">ğŸ’¡ ê¶Œì¥ ì¡°ì¹˜:</div>`;
        html += `<ul style="margin: 0; padding-left: 20px;">`;
        
        const allCauses = preprocess.delays.map(d => d.cause || '').join(' ');
        if (allCauses.includes('HCACK') || allCauses.includes('OHT') || allCauses.includes('Vehicle')) {
            html += `<li>OHT ì°¨ëŸ‰ ê°€ìš©ì„± ì ê²€ ë° Rail Cut ì—¬ë¶€ í™•ì¸</li>`;
        }
        if (allCauses.includes('Conveyor') || allCauses.includes('ì»¨ë² ì´ì–´') || allCauses.includes('ì ì²´')) {
            html += `<li>ì»¨ë² ì´ì–´ ì ì²´ êµ¬ê°„ ë° ì„¼ì„œ ì ê²€</li>`;
        }
        if (allCauses.includes('Lifter') || allCauses.includes('í¬ë ˆì¸') || allCauses.includes('ì¸µê°„')) {
            html += `<li>Lifter í¬ë ˆì¸ ìƒíƒœ ì ê²€</li>`;
        }
        if (allCauses.includes('í¬íŠ¸') || allCauses.includes('ì ìœ ')) {
            html += `<li>í¬íŠ¸ ì ìœ  ìƒíƒœ ë° ì‘ì—… ìŠ¤ì¼€ì¤„ í™•ì¸</li>`;
        }
        html += `<li>í•´ë‹¹ ì‹œê°„ëŒ€ ì „ì²´ ì‘ì—… ë¶€í•˜ ë¶„ì„</li>`;
        html += `</ul></div>`;
        
    } else {
        html += `<div style="font-size: 18px; font-weight: 700; color: #065f46; margin-bottom: 12px;">âœ… ì •ìƒ ì™„ë£Œ</div>`;
        if (totalDuration > 0) {
            html += `<div style="color: #047857;">ì´ ì†Œìš”ì‹œê°„: ${formatDuration(totalDuration)} - ì •ìƒ ë²”ìœ„ ë‚´ ì™„ë£Œ</div>`;
        } else {
            html += `<div style="color: #047857;">ì´ì†¡ ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;
        }
    }
    
    // ìºë¦¬ì–´/LOT ì •ë³´
    if (preprocess.carrier_id || preprocess.lot_id) {
        html += `<div style="margin-top: 12px; font-size: 14px; color: #666;">`;
        if (preprocess.carrier_id) html += `<span style="margin-right: 15px;">ğŸ“¦ ìºë¦¬ì–´: <strong>${preprocess.carrier_id}</strong></span>`;
        if (preprocess.lot_id) html += `<span>ğŸ·ï¸ LOT: <strong>${preprocess.lot_id}</strong></span>`;
        html += `</div>`;
    }
    
    html += `</div>`;
    
    // ========================================
    // 2. ğŸ“Š íŒŒì¼ ì •ë³´
    // ========================================
    html += `<div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-left: 4px solid #22c55e; margin-bottom: 20px;">`;
    html += `<h3 style="color: #15803d; margin: 0 0 10px 0;">ğŸ“Š íŒŒì¼ ì •ë³´ <span class="equip-badge" style="background: ${equipColor}22; color: ${equipColor}; margin-left: 10px;">ğŸ”§ ${data.equipment_type}</span></h3>`;
    html += `<div style="font-size: 14px; display: flex; flex-wrap: wrap; gap: 15px;">`;
    html += `<span><strong>íŒŒì¼ëª…:</strong> ${data.filename || 'N/A'}</span>`;
    html += `<span><strong>ë ˆì½”ë“œ:</strong> ${data.basic_info?.row_count || 0}ê±´</span>`;
    if (data.basic_info?.time_range?.start) {
        html += `<span><strong>ì‹œê°„:</strong> ${data.basic_info.time_range.start} ~ ${data.basic_info.time_range.end}</span>`;
    }
    html += `</div>`;
    
    // ì„¤ë¹„ë³„ ì¶”ê°€ ì •ë³´
    if (data.equipment_type === 'OHT' && preprocess.vehicle_id) {
        html += `<div style="margin-top: 8px; font-size: 13px; color: #666;">ğŸšƒ ì°¨ëŸ‰: ${preprocess.vehicle_id} | ê²½ë¡œ: ${preprocess.source_port || 'N/A'} â†’ ${preprocess.dest_port || 'N/A'}</div>`;
    } else if (data.equipment_type === 'CONVEYOR' && preprocess.machine_name) {
        html += `<div style="margin-top: 8px; font-size: 13px; color: #666;">ğŸ”„ ì¥ë¹„: ${preprocess.machine_name} | Zone: ${preprocess.source_zone || 'N/A'} â†’ ${preprocess.dest_zone || 'N/A'}</div>`;
    } else if (data.equipment_type === 'LIFTER' && preprocess.machine_name) {
        html += `<div style="margin-top: 8px; font-size: 13px; color: #666;">ğŸ—ï¸ ì¥ë¹„: ${preprocess.machine_name} | ì¸µ: ${preprocess.source_floor || 'N/A'} â†’ ${preprocess.dest_floor || 'N/A'}</div>`;
    } else if (data.equipment_type === 'FABJOB' && preprocess.hcack_errors > 0) {
        html += `<div style="margin-top: 8px; font-size: 13px; color: #dc2626;">âš ï¸ HCACK=2 ê±°ì ˆ: ${preprocess.hcack_errors}íšŒ ë°œìƒ</div>`;
    }
    
    html += `</div>`;
    
    // ========================================
    // 3. ğŸ¤– AI ë¶„ì„ ê²°ê³¼
    // ========================================
    html += `<div style="background: #faf5ff; padding: 20px; border-radius: 10px; border-left: 4px solid #a855f7;">`;
    html += `<h3 style="color: #7e22ce; margin: 0 0 15px 0;">ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h3>`;
    html += `<div class="markdown-content">${marked.parse(data.analysis || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ')}</div>`;
    html += `</div>`;
    
    html += `</div>`;
    
    resultDiv.innerHTML = html;
    resultDiv.className = 'success';
    addToHistory(`[${data.equipment_type}] ${data.filename}`, data.analysis, 'amhs');
}

// ì†Œìš”ì‹œê°„ í¬ë§· í—¬í¼ í•¨ìˆ˜ (ì—†ìœ¼ë©´ ì¶”ê°€)
function formatDuration(seconds) {
    if (!seconds || seconds < 0) return 'N/A';
    if (seconds < 60) return `${Math.round(seconds)}ì´ˆ`;
    if (seconds < 3600) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.round(seconds % 60);
        return `${mins}ë¶„ ${secs}ì´ˆ`;
    }
    const hours = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    return `${hours}ì‹œê°„ ${mins}ë¶„`;
}